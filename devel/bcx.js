// BCX: Bondage Club Extended STRICT

!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=(new Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="a76e42c9-dfe5-5a2c-a157-220fb4a3ec2f")}catch(e){}}();
if("function"!=typeof window.ImportBondageCollege)throw alert("Club not detected! Please only use this while you have Club open!"),"Dependency not met";if(void 0!==window.BCX_Loaded)throw alert("HardCoreClub is already detected in current window. To reload, please refresh the window."),"Already loaded";window.BCX_Loaded=!1,console.debug("HardCoreClub: Parse start..."),(()=>{var e={531:(e,t)=>{!function(){"use strict";const e="1.2.0";function n(e){alert("Mod ERROR:\n"+e);const t=new Error(e);throw console.error(t),t}const r=new TextEncoder;function o(e){return!!e&&"object"==typeof e&&!Array.isArray(e)}function i(e){const t=new Set;return e.filter((e=>!t.has(e)&&t.add(e)))}const a=new Map,s=new Set;function l(e){s.has(e)||(s.add(e),console.warn(e))}function c(e){const t=[],n=new Map,r=new Set;for(const o of m.values()){const i=o.patching.get(e.name);if(i){t.push(...i.hooks);for(const[t,a]of i.patches.entries())n.has(t)&&n.get(t)!==a&&l(`ModSDK: Mod '${o.name}' is patching function ${e.name} with same pattern that is already applied by different mod, but with different pattern:\nPattern:\n${t}\nPatch1:\n${n.get(t)||""}\nPatch2:\n${a}`),n.set(t,a),r.add(o.name)}}t.sort(((e,t)=>t.priority-e.priority));const o=function(e,t){if(0===t.size)return e;let n=e.toString().replaceAll("\r\n","\n");for(const[r,o]of t.entries())n.includes(r)||l(`ModSDK: Patching ${e.name}: Patch ${r} not applied`),n=n.replaceAll(r,o);return(0,eval)(`(${n})`)}(e.original,n);let i=function(t){var n,i;const a=null===(i=(n=y.errorReporterHooks).hookChainExit)||void 0===i?void 0:i.call(n,e.name,r),s=o.apply(this,t);return null==a||a(),s};for(let n=t.length-1;n>=0;n--){const r=t[n],o=i;i=function(t){var n,i;const a=null===(i=(n=y.errorReporterHooks).hookEnter)||void 0===i?void 0:i.call(n,e.name,r.mod),s=r.hook.apply(this,[t,e=>{if(1!==arguments.length||!Array.isArray(t))throw new Error(`Mod ${r.mod} failed to call next hook: Expected args to be array, got ${typeof e}`);return o.call(this,e)}]);return null==a||a(),s}}return{hooks:t,patches:n,patchesSources:r,enter:i,final:o}}function u(e,t=!1){let n=a.get(e);if(n)t&&(n.precomputed=c(n));else{let t=window;const i=e.split(".");for(let n=0;n<i.length-1;n++)if(t=t[i[n]],!o(t))throw new Error(`ModSDK: Function ${e} to be patched not found; ${i.slice(0,n+1).join(".")} is not object`);const s=t[i[i.length-1]];if("function"!=typeof s)throw new Error(`ModSDK: Function ${e} to be patched not found`);const l=function(e){let t=-1;for(const n of r.encode(e)){let e=255&(t^n);for(let t=0;t<8;t++)e=1&e?-306674912^e>>>1:e>>>1;t=t>>>8^e}return((-1^t)>>>0).toString(16).padStart(8,"0").toUpperCase()}(s.toString().replaceAll("\r\n","\n")),u={name:e,original:s,originalHash:l};n=Object.assign(Object.assign({},u),{precomputed:c(u),router:()=>{},context:t,contextProperty:i[i.length-1]}),n.router=function(e){return function(...t){return e.precomputed.enter.apply(this,[t])}}(n),a.set(e,n),t[n.contextProperty]=n.router}return n}function d(){for(const e of a.values())e.precomputed=c(e)}function h(){const e=new Map;for(const[t,n]of a)e.set(t,{name:t,original:n.original,originalHash:n.originalHash,sdkEntrypoint:n.router,currentEntrypoint:n.context[n.contextProperty],hookedByMods:i(n.precomputed.hooks.map((e=>e.mod))),patchedByMods:Array.from(n.precomputed.patchesSources)});return e}const m=new Map;function p(e){m.get(e.name)!==e&&n(`Failed to unload mod '${e.name}': Not registered`),m.delete(e.name),e.loaded=!1,d()}function f(e,t){e&&"object"==typeof e||n("Failed to register mod: Expected info object, got "+typeof e),"string"==typeof e.name&&e.name||n("Failed to register mod: Expected name to be non-empty string, got "+typeof e.name);let r=`'${e.name}'`;"string"==typeof e.fullName&&e.fullName||n(`Failed to register mod ${r}: Expected fullName to be non-empty string, got ${typeof e.fullName}`),r=`'${e.fullName} (${e.name})'`,"string"!=typeof e.version&&n(`Failed to register mod ${r}: Expected version to be string, got ${typeof e.version}`),e.repository||(e.repository=void 0),void 0!==e.repository&&"string"!=typeof e.repository&&n(`Failed to register mod ${r}: Expected repository to be undefined or string, got ${typeof e.version}`),null==t&&(t={}),t&&"object"==typeof t||n(`Failed to register mod ${r}: Expected options to be undefined or object, got ${typeof t}`);const i=!0===t.allowReplace,a=m.get(e.name);a&&(a.allowReplace&&i||n(`Refusing to load mod ${r}: it is already loaded and doesn't allow being replaced.\nWas the mod loaded multiple times?`),p(a));const s=e=>{let t=h.patching.get(e.name);return t||(t={hooks:[],patches:new Map},h.patching.set(e.name,t)),t},l=(e,t)=>(...o)=>{var i,a;const s=null===(a=(i=y.errorReporterHooks).apiEndpointEnter)||void 0===a?void 0:a.call(i,e,h.name);h.loaded||n(`Mod ${r} attempted to call SDK function after being unloaded`);const l=t(...o);return null==s||s(),l},c={unload:l("unload",(()=>p(h))),hookFunction:l("hookFunction",((e,t,o)=>{"string"==typeof e&&e||n(`Mod ${r} failed to patch a function: Expected function name string, got ${typeof e}`);const i=u(e),a=s(i);"number"!=typeof t&&n(`Mod ${r} failed to hook function '${e}': Expected priority number, got ${typeof t}`),"function"!=typeof o&&n(`Mod ${r} failed to hook function '${e}': Expected hook function, got ${typeof o}`);const l={mod:h.name,priority:t,hook:o};return a.hooks.push(l),d(),()=>{const e=a.hooks.indexOf(l);e>=0&&(a.hooks.splice(e,1),d())}})),patchFunction:l("patchFunction",((e,t)=>{"string"==typeof e&&e||n(`Mod ${r} failed to patch a function: Expected function name string, got ${typeof e}`);const i=u(e),a=s(i);o(t)||n(`Mod ${r} failed to patch function '${e}': Expected patches object, got ${typeof t}`);for(const[o,i]of Object.entries(t))"string"==typeof i?a.patches.set(o,i):null===i?a.patches.delete(o):n(`Mod ${r} failed to patch function '${e}': Invalid format of patch '${o}'`);d()})),removePatches:l("removePatches",(e=>{"string"==typeof e&&e||n(`Mod ${r} failed to patch a function: Expected function name string, got ${typeof e}`);const t=u(e);s(t).patches.clear(),d()})),callOriginal:l("callOriginal",((e,t,o)=>{"string"==typeof e&&e||n(`Mod ${r} failed to call a function: Expected function name string, got ${typeof e}`);const i=u(e);return Array.isArray(t)||n(`Mod ${r} failed to call a function: Expected args array, got ${typeof t}`),i.original.apply(null!=o?o:globalThis,t)})),getOriginalHash:l("getOriginalHash",(e=>("string"==typeof e&&e||n(`Mod ${r} failed to get hash: Expected function name string, got ${typeof e}`),u(e).originalHash)))},h={name:e.name,fullName:e.fullName,version:e.version,repository:e.repository,allowReplace:i,api:c,loaded:!0,patching:new Map};return m.set(e.name,h),Object.freeze(c)}function g(){const e=[];for(const t of m.values())e.push({name:t.name,fullName:t.fullName,version:t.version,repository:t.repository});return e}let y;const v=void 0===window.bcModSdk?window.bcModSdk=function(){const t={version:e,apiVersion:1,registerMod:f,getModsInfo:g,getPatchingInfo:h,errorReporterHooks:Object.seal({apiEndpointEnter:null,hookEnter:null,hookChainExit:null})};return y=t,Object.freeze(t)}():(o(window.bcModSdk)||n("Failed to init Mod SDK: Name already in use"),1!==window.bcModSdk.apiVersion&&n(`Failed to init Mod SDK: Different version already loaded ('1.2.0' vs '${window.bcModSdk.version}')`),window.bcModSdk.version!==e&&alert(`Mod SDK warning: Loading different but compatible versions ('1.2.0' vs '${window.bcModSdk.version}')\nOne of mods you are using is using an old version of SDK. It will work for now but please inform author to update`),window.bcModSdk);Object.defineProperty(t,"__esModule",{value:!0}),t.default=v}()}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";const e="data:image/svg+xml;base64,\nPD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4NCjxzdmcgeG1sbnM9Imh0dHA6\nLy93d3cudzMub3JnLzIwMDAvc3ZnIiB3aWR0aD0iMjAiIGhlaWdodD0iMjAiIHZpZXdCb3g9IjAg\nMCAyMCAyMCI+DQogIDx0aXRsZT4NCiAgICBleHRlcm5hbCBsaW5rDQogIDwvdGl0bGU+DQogIDxw\nYXRoIGQ9Ik0xNyAxN0gzVjNoNVYxSDNhMiAyIDAgMCAwLTIgMnYxNGEyIDIgMCAwIDAgMiAyaDE0\nYTIgMiAwIDAgMCAyLTJ2LTVoLTJ6Ii8+DQogIDxwYXRoIGQ9Ik0xOSAxaC04bDMuMjkgMy4yOS01\nLjczIDUuNzMgMS40MiAxLjQyIDUuNzMtNS43M0wxOSA5VjF6Ii8+DQo8L3N2Zz4NCg==\n".replaceAll("\n",""),t=("data:image/png;base64,\niVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAAABGdBTUEAALGOfPtRkwAAACBjSFJN\nAAB6JQAAgIMAAPn/AACA6QAAdTAAAOpgAAA6mAAAF2+SX8VGAAADpElEQVR42uyZP0grWRTGz+gk\nyhPEXYSQQmTAJoWCqJ2VqAgmYhBFtxELURHfW7ERbATTprEIJmAEWcbONBKf+KcRG7HQoGEW0ZhC\ngwmmEGIiZvy2eXlkvE40muhG5oMUmTn3nvO75947d85wAOgrqIi+iDQQDUQD0UA0EA3kPeLD4TA5\nnc7voihOSpL0BxHJhZIEQRDuOjs7F8fHx220sLDwg4hQyL/p6Wk7NTU1/ZvJiOO4Tw/0pRiqq6uD\nHM/zN8lk8k8iIqPRSKFQSJE/q9VKExMTVFJSQvF4nMkvAOI47sV5kDqcZrJN7wsAlZaWkizL5HK5\nSBRFha0gCBQMBunx8ZGIKEo8z9+kyNbW1uB0OhnikZERXF5e4qMVDocxOTnJZMRut2N/fz/92o0C\nZGdnBwCwu7sLk8mkaFxZWQmPx/NhEOvr66iqqlLEIAgCNjc3AQB+v18dZGtrSzEaY2NjTHZmZ2cR\nj8fzBnB/fw+bzcb4HRwcxNXV1W+7k5MTdZDt7W2mY5fLxXTa0dEBSZJyDnF+fg6r1cr4m5+fhyzL\nCtusQQDA5/PBYrEoOi8vL4fD4cDd3V1OsuB2u2EwGBQ+WltbcXBw8Gyb4+Pj7EEAIJFIwG63M6PV\n39+PUCj0ZohIJIKhoSGm37m5OcRiMdV2GTOSvkbUtLGxAaPRqHBaU1OTcRDUtLe3h9raWkVfFRUV\n8Hq9L7Z909R6qmAwiL6+PmYUbTZbxlF8KbsWiwWnp6eviiEnIKl5vbKywszrlpYW+Hw+1XaSJMFs\nNjNZcLvdWe2GDEhxcfGbQFLy+/1obm5WBMbzPBYXFxU7jSzLEEURZWVlCtuGhgYcHh5m7ffda+Q5\n3d7eYmZm5tm9//r6GtFoFKOjo8z9qakpRKPRN/nM2dR6Tl6vl3ka19fXo7GxkTklrK6uvstXXkEA\nIBAIYGBgQPWk2t3d/eoF/akgAJBMJrG0tAS9Xq+AcDgceHh4yImPvKwRNR0dHcFsNqOtrU31CZ0r\nED69iP2a94psVFdXRx6PhwCQTqfL7zt7roNnHPD8x1dRCvkTgwIk39nJK8iX+dCTnoVCzgj/qwpB\nREQXFxcUCAQokUgwVY+n1ZLU/6cZVbN/TeUl3Wem9jqdjs7OzpQXTSbTRaEX6AwGw2VRb2/vP4W+\nPrq6urb5np6euUgk8m15efmvWCxWQkSPBRI/p9fr5fb29p/Dw8N/c9rnaQ1EA9FANBANRAPRQP5/\n+m8A4sEE5SZccHcAAAAASUVORK5CYII=".replaceAll("\n",""),"m14.483 4.5372c-10.063 0.0305-12.109 8.5713-12.008 12.355 0.1628 6.5444 5.4929 11.067 10.223 15.516 4.7684 3.8893 8.5801 8.3608 12.383 12.838 3.8031-4.4771 7.614-8.9486 12.382-12.838 4.7298-4.4488 10.06-8.9712 10.223-15.516 0.10164-3.7842-1.9446-12.325-12.008-12.355-4.9198-0.28718-10.597 6.153-10.597 6.153-1.7777-1.9041-4.833-6.2892-10.598-6.153z"),r="data:image/png;base64,\niVBORw0KGgoAAAANSUhEUgAAAFYAAABWCAQAAAD/X6l8AAAABGdBTUEAALGOfPtRkwAAACBjSFJN\nAAB6JQAAgIMAAPn/AACA6QAAdTAAAOpgAAA6mAAAF2+SX8VGAAAUPUlEQVR42rTbeZRdVbUu8N8+\n/ak2VUmlJ30fCKGTRiFECQECCAER5cngCfK4cFFRvOodV0EZDK/eq2LzHD5RwOYiCELohNBjICBN\nICSkIX3fVaoq1ddp9n5/1EmlEtAEU5w1xhn7VK191nfmmmvObzY7iPzj15jyXX8280sdk3UpCkWI\nEICYuKSiO2N/iyZcPejeEESaRKX/75m18d5piUvDitI9+9bb+w0ZG/woY8nAs1fW/2MsiYNgVdHW\n8dru2WtSE8WECErLRQKBSCiUdbTX7D6/tgdsrAdU81w1U5SLxHru1QtwTMxqnYa8OLr+YFhiB5sQ\nqZgXa1miWUKsJI2g539EQgWTjNA0s2F8h3btOnTJyclrHdry8cGGi5V+2r67gx5ptVokbMrcvcdh\ng82oWlz23AYrxQS9pgcluJFQUT+ThUOaz0tKSkrIl8Dm5uQmjDZUWIIaHaAIMQlrbVC9urBix+GD\n7VIslD3QbpmcuKBHLlHPopFQ3DRlWs7IZwoKCuLi4oJE4yVZR0r+g+Ujy7Wru29sy9jDB0uk8oXU\nqhXqS2CD/XQuLiEp7gjVOme0fbRTh86S1IrTO4+rNExKRlJc0Gv7u68SGiyR3h57dJeGgyI56AEr\nIr6+8rmm8e8aKiYswY2JIa9Vh112aNAmKmub0/+ZsMdeNJ4V1uQ8o9ZQg2VlpQRCYWlfYhJW2a3q\n+WB558GldnCwBQTKH2q88u34ybIKcnK6NNiu1SabddmjS1xSXNvZ/W4NdndbimJF6zlxXV4SSquS\nMcQRKg02QEpSQlzkHZ1G/aVfFPYF2O4vybxU9tq7J71uiHpbrdWqSZNIKBAXkyltcX5c24ziA5Gk\nQO7U/HEBkog0KtrsDZEaNcqMNNRATdYqX1w7PyvqC7DdE4I9ZffvOemPyCkoiIn3GLKYqGQVIkGi\ndc6wB+jAnguKqag0LxAXL52APRqE3hGXRqcBT9nZTl+Ardh7Dp9qru8YEBNI9LopFCqISQgMVW2L\n5vOyk8pXbJEb1TY7bqyc7UJFYckBEJcoaXUXkm39H8gL+wbsXouQWZp9uf28bi9U7LGX5WpljDBU\ntaGqPGx+3bZZg1Z06Tg9N/IjzhOp12yrzTo0aS7tRLesA6Gy16sWB4cG4uBg925QLCx/qOM8CgL9\npIxRq8IgA6WlS5uddJSFGueW/yrW1XZOhSNVSBgoUJTTpd42LRqt06lTuzSqHu9oD/sKbFWPVUw9\n27ixMOI40w2RUS7ZY4ZCRTGBomGOsOTY+KTKjrWnTzJCKJQHSSnVxonktOvQZJHXJLb3n5c4pMN1\nSGA79l2uS8/r+OJ4M3XKycv3eLG9fr8ga4IVVQ3fIV43RlkvFxL28LC4av1N0m6hyqcSK/sQ7K5e\nHic7v+XqdzP1siWt3eeJ9rneqZ6z85ORChMkxCVFJbYWCBRLliOm2QpR2O+xmAJ9BTbb27m+mFqx\nfPpmk7qdaQ/QoIeDFQwywd8wwQhpjZbaLY+YlBrT9FcUSdpqubLVNQsI+g5s7wmx5sqHtk9fYmIv\nvqoXXEIpUy3RaYJ2j9upwvlG6VQu4zl/0c+J+kt7S73h9/ffGhyyEhwC2Nh+tKX8scSX3u23W42w\nZ/u7GVhQug6N009Rg/uc4LvGqsVyf7PDKlstsdh4oywRb6h+aLcifQc2tf+nN8qeXn/xBgMUe8UM\nvd8Lak31iryfOQXtfukt8/FpZ7pQmTa7PGaL8uaO5iah4FCN/cHnpfcPQ8Kqv2y7eJlpglKY44Bg\nJaHRDpf4nhp5j/u+dWb5hWmG9Zp1mSV+NmrBfdkvJZ49dMkelM8W9xuh6qdjG96xQ1zQww72vZKa\nPOlzfqrGble72hTz3ensXlBDnQab5SeuPNJ9xbl9qAYHGpbEpn5PbPs/Kw3vkew+2cZ1eMTlrsQK\nX9DqTrNL8uiy0qvWaZcx1qlShvhvmdpf3hHf5uU+Apt7TzyauS+4fGn2RNmS8Yp6NinvEaf4PNa5\nwpF+oFqXrB2ec5e3pIVy0lqNd73zRS62oHrZL+Ona+wTNWg/YLSJvZp+a4Nt4iUWtS/AeVk/Nwls\n8r+d7OdqxST9j7mukzJZRlZkms+K+brfWmm6a6Sm5S7tVrLDBpt+72ipeqzR2yXSF5S8U9ImO3xf\nRrvrHeN7OnVo9g23Otq3DbdNq3Z5aT92t5F+q12XSeoU56rpE8lWvmdUqHwianxbo0QpGgvEtHrG\nFUbjZhk/kJG2wyWWeMIN3jJPU+mndXnLDqdrstACrcpFIx3bJzr7fpuTebt84Y45G/QXiImssNYu\nOxUttN4Tfi6J0HcN8w3tHvakUKLkOoarsFBWu3WulTTIu2Vhvz4Bm3+/7chX/XHzOYuDaeJC8633\nNYNsVm23d82w3jLHWajBH6U850/yJedS0N/JJmuwWkzSuwbLCcSCD8V0lSzCi6k168ftMMIO77jM\nHF1GGoXTZDW41/N+b46ChBW2i5eccd5glV61zWJZExU8ayedUXOfku8D4G5omr9x3EqjNQo0+g8p\nY40zxiApg31Jl0941HUu8KbWUiSXV+HrTveCjZar8wkTrNMmttGiD00NiOn30O4vLEoVNZlqmS71\nNko40/FmOBZpx5ruGXd6VVIgkhd3sTNl1HhKu9k2S1lsj/jCqP5QwAYHI2gT/97BK9/5WGLGmX4i\naYexmiywxk6Paneiy8xUrVVGpzv8UJuEpH/3aZuU+a2fOtO3ZLzkt96pz34kWgeb+9qD9fCvtuz8\n9IxL7VKQEZc1y0X4qsV+4zojXOlkY5S5Xo1blLnZDDW2e9hvHGW2Sboss0L659bF+sbdvn8OKi4U\nPV286cF0g4Q6oxzvOKGYIYY4y1/90HVOdIMpGpxpsm/YIa5gqZ+p8kUfsczr/iJ4JfbzQ40VDqoG\nQ/6Oznadcuy3Z5+xPt4maY3NutS4zKmmyYgEWt3jP7W40izHqvZ7N/umuJtU+ayLTXC731i3LXlR\n0ENjNh0u2KHvk/CgMHbiM78aOdEGQ2TtVLTYi97yonNc5nQFWSmLfdUCZ/k3Q7T7g98qmOBGoyRV\n+ooXculrgjv3ffNh62zwPmCLEsdMH77ZRkmBAbLKnOUsnR4xz+ed5EozFI12ix97VLlzjXeTNd70\nVeeI+bV5FrWnvu7OQ4/ADjl9tB/YVNvxwSnPeUiXhKkuNMjxRiLjUy7ymO+73FyfV+Z4t7vWQzIG\na3eRN62yyxr3Wryl7MbgnugDrXyIKc/en7Nf+cIt5Ym1qmRsscqNIke51CxHoWCOM/zETy31L4Yb\n6CpbPGmANhe6yzyhB6xfkb0yWPhBxXRQna07QCXyl196x4/iCVuNEGi13RrveNCbKs3wLybqL4l7\n3KjWt/RXbpsbDHa9mX7ldmmtDydviNbuXxWDLYdLEbtLGXuzhwWOGx7/g1972waNisaY7Svm+5OT\nPOwc13nBLlvNdL+M71gk7QLnW2WTDYaL7PlV6qLYWv/E6xDzBiESCmJ03q1TTpnBTnSG6QaizDlm\n+ZNfmGeRy33CBCe53cXuM0yLC8y3yFSvy0stigrRP4NV7INMDnVOGDhtioSxZulvgWud4ufelEen\ny/zJV7W4zW22KBjoCls9ostMH/eUa/xZoi1YGQpLNbQ+lmxvGl747Kwf3DDscaFbTcLLvqLWf+p0\noc+aKmmYHxjrFo/pdJWsy+Xcb5W8OhU6xTdEN3vee7S1TyUbCBPF73zmrq8Pm29nCep63/Ypj5jn\nXz3oMt/0uh2WOdt/GW6B3wkMd4bAGkdJyUn+OvWRxF2hvzf6Kk1flv+vr197na9Z7w4DsNkVxpgr\nZpqXZbX5s5dc7UT9fUbcVzzvCDtNd7EX/be/KkhHQ3cWtXyAvOEHLjRHIp03zr32Rk/b4MeGSVvj\nImPcJmmr292qS0ZGm5/4f7aqd6xLBZ5Sb4oZ3vEr68W1ndJY989DPUTJ5k6d+OUv+oPvuc0UNLpa\nzpdVKXO378tLieQcb5Z7/YfPG+VmGzzmDfOlDMAYXZZOHDij7v7iPw32ECQbpqPzrqip9kPfdI6C\nolutcqOsdzzv+5qlUNTPdOe50wqPa5N1ugprpQ3TZphrzJRNNF2aixX9vdEHko2qKyYP9IAxLkfC\nPLe7yiWS3vYjm5SXSPrJPmKDMtM9aIR651rmj27UocPRksYaZOPHBk5KL4s+LMl2C3eR37tCXKTe\nLYY50S7tnvKyshJFH+kq5xvjNTlneUSZwUZIaFDuXKfIqXKU4qA9sxIlr/je0QeSjbXkV97hY85E\n4EFLzTFes1ZPlg5LTsanTUe15c5xhnM9KSOjwhmOExcpSjrSy/ZcOOL2ZPuH58E6w9XtZpfC6Zfk\nbDHIJHWa5QW6JFzv0+pt9Li8k6zAq0ZKKjNZQrFUNh3lCG0f3X1ysz3vO/rCdJU7Km4QWOB5M/Dv\n1gh9x5H2KHetfzXWQG0edb5jNCpaa657fFJlqV4WKUo5SpBo+mRY+suB47DVIKAYdVIJNtjhStM9\n7BqtqoXOcpUpUqj2M036+5sl9hjvNHUq5UrpuG44Ew3QMnPQwOTO6MOwsxGd0cqg1OeSQqNjzLFQ\nuyqhsQYJNUu6yyNutdsaL2CacTrkepVJQgWDTLHgyKYZZfeFHxo3WBrt6s7MHGu8J3SKOc5pTjJd\nbXd+xt2+7TpnGGW99YYYbY9CqbK7t/xUlHCMtLYL+wU13jsOG2wgELwSPb0RjHOu5b7mDZEMMpIi\nG93seqc73iavWazLGDGF0sHaq4+hSNFIw7XMzk8vl33P6AudFfDo7z81N1GBqzzvIcudZZajJW3w\nhD9b70rXeVGrdy1WZ3KptyYsvcdLudmCGpOtqN398dSbH9ztHmKSoyh88McXfE5R3NuutETeMCOw\n2QbVLnerrNu1utdqH3VCqYkqUQqKupusYuLKrPB/Ff467qxEx4Frv9I3fDam+K2b1r0ojmlud7GJ\nGrzkNYG5bneJJouEXrTaYBMUFEp1s70dCXt7P/KOMFHXiYWTszIHjD4LxVNLd9305d/cljxFo9Hu\n8LaHkDPG55RZ7Y8ylntFymRl8uJiwlLxKegpQYWKyk31RrrhkvSzYV+brnyP5ibvXjntqhtujM9W\nK2W0G9TaZY1QpyUqrPAXOaOM0CohLhQqCkol6VhJayOh8Yao/3j5sHBLH4Pdl98SJm/bEvvWNX8r\n+19G2KpWmZ3WWSmryWue0GGgo8WslTBRsdQOEfQ0XEY91na0TePzMyrvDj8MsHtTh+l7Ok64+9QX\nfNTZNntHq1C7lZ6zVpc606V12Ywx4gqlQ7GvC6y73zbtOG/Y88mKu6MPDWwxaoiP6xxTq9qznjFE\njaQOO9VrlzDYFOUKOm0ValYrJiUlJdnrHHc7hzFGW/Gx6MjM0qiP3e2+7EwYOzY/bIxT7bLJaqtE\nSIipMdxQaaG07VpF6o0VSJcKe/v6bQOhomqjLRvafsGApWFfgq3srQfJxvNTpqnTz3jTNcsrCJFU\njkBaymKdIvUqe4WGUU+feFQKuo/xgoazB/0k1tKHbSf9e6lsy9Htx08yTEpKd+Pf3vbTvQwgZadN\nAjFr7DT8fWs93YdsqLGWHLv9hPSz0Qc4NIeUmIuLS2i/OOw/xYCeVF13F21cXFJaWlLSBk2SUnZZ\n8Z6U9L4m6kCN6cJM57kfxCkccq4r0FW7Z05Mi/WakJCS7MkvdnuqQKe3dapQoehdnb3iqkBcUlJK\nQmS35XaLaZulLilRGn3mwWJaTssfmfCSherUKTfQSBUqlEmWCtJxG62VVHlfVJWevdZGU+RL7Weh\nNm3abLJVsy3ahZJyR7bNKb+rz3oRO3ok03xeJC4vtNF6kZgqMXVGqVRnqHJpq7Wqbq2YXxhVMbvR\nEmPltdpuu2br7VbQrFhSnu6uo6Zz+/0uDPsIbLwEtXNk+0zCno2HNqFGq0TKVKlQYZNI3abUfWpq\nr2oe/Jqd2rXao70k30CyVB8PSgSy47TChOyKPuqfDUtKkJ+TG52V1Fp6lmP/buOCXXaKxJSre6wt\nJV/1u8y/tVoiVrISwX65s1AopkpeV139nH59BbabIkeJPReWOdsI6+zSbLMuRbmS349RitGKhrzS\n73stbYVk7Q8HnLLlYymxHnrY3TSZlJAyTLUBJtlhnuazB/wi6OgzyQa6Tmw58WgnqDJRpFOjPXZb\nqVXOTh1iiuICSQN/VGgIg6graq377o75URCVmFdWnbRyY9WpVqNCWlLOSq9+tOu0qvl90qBejcDm\nT8QqR8vKiwmkDDFM5CR5nbbbpdUaG+RUrIo/n1eIIjmJNyqWNU7NGGmcSrWGKisZu+724C4FGRO8\nnmk8p3p+0BdgYwJhXcsllSb26N3ejF9MUlqtQKDZbbaqebq4K54MCqFocHxb7f27p5a73DDFUvgY\nyffEdaFAaLI6TWc2DI5vjw7fKXTJqZ/ZPnWCgT2PVe1TkVBRTk5cs2aZrsEP9hOdEKUJ+hWD5EPJ\n1jYtYvLyJbD784XuTELHxOIZFaVs5GGBzUpqvqDcJOkDoO7t6Oqm1m/ao+bNygWdwhWpQmUU2x7F\nc0uqXmnxpsIBXYuRfc87pUyWDZo+G0+mDh9sh9axrR+rM+6Ax6N6X8e1eFdgyLygM0FDopAQNgWF\nysKAe+KW2CnRs1B0QAmgYJw6TSe1TwoPH2xB08eLR0xQ1RP6Rb2CwG6GmrLGelW7+z2S2McGIspU\nPFm2cZvVPZY56EVp9vKvfqYLa5pmJw8fbCLbcVnGeAl6PSu3L+cXiMl5R07tM43LNtpWOnyBLk3y\nmyofK1isU1ysF+cKelHLmKMM0HBxR+VhW4OuqS2TJ7WNLES99DXarxMhYZeVQSJRdX9Y8k1Bj8UI\nVf3Prs+si28Oxyrs186+j4rnjTI88dYRrUd78R9j+f8DAFFTI9BZXoPgAAAAAElFTkSuQmCC\n".replaceAll("\n",""),o="data:image/png;base64,\niVBORw0KGgoAAAANSUhEUgAAAFYAAABWCAYAAABVVmH3AAAABGdBTUEAALGOfPtRkwAAACBjSFJN\nAAB6JQAAgIMAAPn/AACA6QAAdTAAAOpgAAA6mAAAF2+SX8VGAAAMyUlEQVR42uyde2xUV37HP3Pv\nzPg5gz02njE2hrjhsSF4wRBCsgtBBiK1aOv1atOHFJWN2rCNKqKoEklXVaQkjdSlm6ZJiygl2zZt\nNt0u2pJNQrI0ySpZSIXlBBwwGD+CAzZjxsZ47BnPwzP33tM/5kwyMWDmvY53vtKRNWPfe3/3e37n\n/J732iSEoIDsQylQUCC2QGwBBWILxBaILaBAbIHYArEFFIjNMUx5vNYqYCXgBIqAEHAFOAtc+A3z\nsBpYLmUrBsJStm6gdy4S6wJ2Adul0OUVFRXFDofDAuherzfg9XqngEHgbeDfgMk8kbkU2AncDywE\nyuWEK4AhyfUDw8BbwE+AkbmwGn4AXFBV1Q+IJIZPau+f5VguK/A0cB6YSkG208Du36TGOoGfqqq6\nUdf1kviXjzzyCJs3b8bpdGK1WgmHw7jdbt577z1eeeWVxONDwGvAI/KGsrXlCWAF8CKwGShJ4zxB\nKdvjUpPzhjqgR1VVIz7b+/btE4ODgyIcDotIJCKi0ajQNE1Eo1ExPT0tQqGQ6O/vF88++2yihhjA\n+0BlFmVbB3QkqaG3Gm8Bt+eL1FK5lAUgtm/fLs6ePSt0XReGYYjZYBiG0DRNfPjhh2LLli2JN/Cm\n3PcyRSPw6yyRGh//JVdnzvHT+EVbW1uFx+MR6aC7u1u0trYm3sATgJqhS/nvWSY1Pp7MNan3WywW\nDRBNTU1icHBQZIKOjg7R0tISFz4K3JaBbN8DRnNE7GfAtlwS2wEIm80mjh49KrKBl156STidzvhe\nfTDNYKYCOJwjUuPj79M0hEkZhen4FqBpWlaIvXbtmmhra4sLHwFsacj2beBSjontAu7ORUj7XavV\nqgDs2rULVVWzMlsOh4OWlhbsdrsALMDvpnGaZqAhx9vgnTfyELJB7CbDMFSANWvWZFXijRs3cttt\nn2+v96V4uC3DvTkVrJjpvWSD2Ns1TTMBuFyurEpbX1+P3W6PBzErUzy8Ro58YLHcz7NGrCKTFuzY\nsQNFyW6yzGazYbFY4h8Xpnh4mRz5wIJsa6z58wDcas1+6s1kmhnjpzrp+cremWZeK1NiI3Jw+vRp\nst1VEwgEMAwjMU5PNa4P5olYv/SMsrrHXrJYLGJgYICxsbGsSjs8PEwgEIh/vJLi4aPA1TwRe3lm\nujMbxB63Wq0irrXZxKlTpxgcHIwvg09SPHwCuJgnYvtlVi6rxB4KBoM6wOHDh9E0LSuS+nw+jh49\nysjISHzvejuN03wCeHJM6qekWWVIBh/GI5Fjx45lJfI6dOiQqK+v1xOim3SsoxM4kuPIa7/0CnKC\nLdKIiba2NnHx4sWMSO3q6hLbtm0zEoT/TgayfV9uC7kgdRj4vVzvM8/GL7hnz560M1y9vb1i165d\nicIfTFNb47AnpjSzPPbG/fhcogx4PpHczs7OpAnVNE2cOHFCPPzww4mCvwJUZ0G2JuDjLJN6BFiS\nD8uoAn9OQoGura1NvPzyy6Knp0dEIpEbEhoKhcSZM2fEwYMHE3Ow8fETIFsJiG+SUOHIcLwvky+z\nRgyZoopYGfn3iZWU60wmk9lkMn3u3O/cuZNly5ZRV1f3pWLiyMgIQ0NDdHd3c+jQoVgoZ7ag61o8\n2JgChmS+98fSSGaCtcCPgK0ZnONnxCoH/bmMj/8aODXTOJSUlopN920RdrtdmM3mL832XXfdJTZt\n2iSam5uv0wSnq1asWt0kVFWd+TudWLb+VZn/zQSLgD2kXlW4QKxHoirZGDddS/t9YBmxRocvobzc\nxvMHfozXfZFfvf0GZ3p6uTrmRdf16wN6RaG6upoNa9by9fXrONV1lnd/+fbN/GFdRjnvSmN5KU35\nS4B6YAfQRqwcfiNEgV8Rq0K8K72ASC6IvRv4G/nTPtsf7vvX/8DrvkiFOYqqWuj45By9A5/Rde48\nU1NTVFZWUOtyUbeolubmdTgdlfgDIU52d/PLI0eIRmaVPyoJfhX4IRBIk+BieR9lMvVXJ0kPyvNf\nltuRL1lCr8tOJYEfAH8hl9KsE2KxWDCbVUQ0gqGApkX43oN/yJ1fX8UPf/SPnO/5lJqahVRVV2Er\nL0fTDaLRCBbFoLioCMV0y/m2EEti7wH+APgn6agbKRIblgMZ/qp80dwRD07SzqfeCnXAIWJtOXXJ\naLmiKOjRKIamYbGYiUSjeCfGqaqrZf26NTQ2LqW21oVZVQkGgxiGwGJWcJQXU1FWOjNdOBuKiDWz\nPSejsz+VpKcDAWhyNWiZkJoMseuBnwMPpCJwUXExQgi0aBhFUdB0DYtqZXR0BLdngm9sbsFeUf1F\nmtEEJiGwCJ0Sq0o4HE71PoqArwH/Qqwn66/IUzNFOsRuk37kxpRDnQUL8HmvUVZkpbjIimIyYbGq\nRKMm/FN+BGA2q5+7YyYhMJtVbCVWVH063YKkSS7l3wH+VrpDrxGr1Jbnm9ib3cF24IC0+iljyu9n\nYnycppW3YysrJhCK0rCknqsTQTxXRhHCAKHg801gVlXMqoq9yMzUxDg/P/o+nqtZyesWEauT/RHw\nl9J3bZDhsU8mpk0zBjf4zpTuLM/EPTI+vzPTO1vkcrHI5eK+b9zNhg3rmAzrjI2NceXyMIuX3saw\ne4hoZJpQMMgHx45zbdyLz+8nT8/3TgIDMq04Kq3/tBwR6Wn45e/7ZKAyLQ3kLQ3bTGKXSwt7f7rS\nLl++HKfTSWNjI2vXrsXlcrF//35CwRCbN20mEPAzMHCB5vV3c/LjDgY++4w1a9bQ2tpKb18fn3R2\ncuXKFfr7+/H7/cwhCBkB/i/wBnBOGjr9VgdWAP+Qbvzc3NwsHnzwQfH6668Lt9t9XU4gEAiIA/+8\nXxw+/D/C7XaL1177hWg/0X7d34XDYXHy5Enx1FNP3Sh3MJfGceBb3KQSrCZobqt0W1LGAw88wOOP\nP85jjz3GHXfcgc12fTeQruv09fQycOECH390krLycpYvX47D4fiyY202U1tby5YtW1i/fj3FxcUM\nDQ3h8/mYY2gA/phYi+h5blJfWwGcTGfmnnzySTE6OnrLtKBhGKK3p1c893fPizffOCLa29tvmvGa\nqcH79u0T9fX1c1l7z8hk/3XW87F0Trh3714RDAaTzrn6fD7x6qv/LT744LgYGxtLKQF+4MCBuUpq\nvNJxLtE1VWVo+CLgSGUdPProozzxxBOUlSXfbKJpGt3nzlFSbGVRXR0lJcl3PzY1NTE5OUlHR8dc\n2xLiIXCNDEqOAX5FspxyP/3u3btvuJfOBq/Xi883ydDgEB3t7UwFppI+1mq1snv3buYo4t7Vt2QM\nYFZllJJSIPDCCy+wdetWzObkczjRaJSPPvoI36QXz/Aw4+NeFtbUUFOTfN9aVVUVPp+P9vZ25jCc\nwFtKOj5rS0tLYrNa0sSOjo5x+7IV7HzoIVZ+bSVTU6ln+3bs2MEcxz1Ag5Ji6jA2JU5nyp2FJpMJ\nQ9ew2+w0LF1KcWk5hq6nLHVDQwNfAaw2p3NUuu2aJkyc6z5HeDqM99o4FRVLUz5HLroac+Hj5u3p\nb1VVqaxy4PGM8OsPjhOeDrN48WLmKSzmfF3JarWyYcNdBINBHJUODEOnurp6vhIr8vq+ggUL7CxY\nYEfTNMrKy7P2IMhchAL8Z0L2JqeIRjVGPB50LYrJpKRSgvlKEvscsQ6R2e5ygix0R7uHh3FfHqav\nt4/+/j6uXh2b18R2AX9C7InmG+EisU6X45lcSNM03O5hKisrqa5ZiKIojI6OzFti48ark9gzp01A\nC7Eaux84AfyfJPehTC+mRaI0NTVx7zfv5Z133iEUCs17YgHGiDV7nZDfG8RKEdqMeDh9U4mObmhM\nR6YxDIP5/IpV83X3PqOXPmt7jqJgtVg5e6aLU52ncdYspLGxcV7vsfm5kKLQsGQJkz4/JUVFlNts\nOJ3O3xqNzSlqamqor1/M4iUNlJaXppx2LGjsLIkYk6IQDobAMLL+iOhvrcbquo7PP4EWmSYcDhBc\ntYrS0tKCxmZK6sDAAKqicGHgU852n2dwcKigsZkiEonQ29tHfV0dq1evZujyZYIplGYKGnuzGTSb\nqaioxLWojnvuvRdHpYNAMFjQWDJ7RROqqlJWVsbgpUuUlZYyOTGJ05X6exq+IkGFkgqxnwI9MiIL\n8UUndNKEBAJTS7rOdNV1dp7WGpYsVpatWNYHjKfoWdiI9epOz1FSSwB3KmFqcYKGB0mxLf3pp59G\nVYu2OirtP3M5XbZLFy91ea56Wvfu3etOVfnJ0euYsmlSzCksrXAmV3rmmWdYuLDyjKZpD5XZytTp\nSKihOBQKprG0dWItlwWvIA6Px3MVeDP+woinXnxx3ma6TYV/4jMPQtoCsQUUiC0QWyC2gAKxBWIL\nxBaQJfz/AJiiFen2ESExAAAAAElFTkSuQmCC\n".replaceAll("\n",""),i="data:image/png;base64,\niVBORw0KGgoAAAANSUhEUgAAAFYAAABWCAQAAAD/X6l8AAAABGdBTUEAALGOfPtRkwAAACBjSFJN\nAAB6JQAAgIMAAPn/AACA6QAAdTAAAOpgAAA6mAAAF2+SX8VGAAAF5UlEQVR42uybf1BUVRTHP/sT\nhRWMNAdLFMNMMLUZSGoYbdAYRtS0nEJLbcgfjCZaaiOjKWE6jpaDmWZZmjL5C8tfhIwa5TSIP1ML\nUksTyPInprLgCuze/uCx7rLsG3bp0WPac/95c8+5937ffeee83333acRtB7RyykvcJaL7GNPo9pQ\nMvGjhDX8LNXEEjU4M5l7dhNNkC1u0fELf9j1aYRyg6FUNtKflgn4E0l34rwBKy8adOgxIkLwRwAU\nmo+kMszR5ja7zogNmOoaiCr9ZX0zhmwG2LvcIJC89OI0tNgArFhd+rMt5r36uysUG5ZOf+dqnbEy\nYDVu6q+RQdv2JVOEsakj2MieuH+Z5c5dN6ba5oHVY9RYQ2hHo+uwtJaHaOvJ3NQYrz/GTXejWssN\n5Tq55kKmlLE1tM9XbSqxUuu22GS7aFhsMj1ZTTfDt6/s9oPbxrI9FwR1LfYIyr9QHi5a9bg7pawb\nrH29NAKC6epmSWio5qxHy0VHL/SN+xSC81TxZ+SW8VPSvHAD09cIxG7hXiyip0fzFi4sMr3NFAiE\nZr1XM2s2AnSQsfAjiyyZiOE8LTAGPxmLdnY7b6JBE3JxNNEtlm61tCLxgVUN2OOMZBg71UcRXeUE\ng3mbUMYyn9lOmnP8jkDwAL0JbNDqEhX0anmwRbRjDlqqaUhGFrKPHlixYSabSCfdNo6ypeXd4EX8\nmA4kM7VhTCaDAg5zlAksAO5QIzHa+1H4PLnckq5PcQCzsmC/5UkKGEShjE1bLMBIyWYIpfihAVYy\njsW8wq/AJlJYQAKXlXODMsZymAg+ZADD2erU2MR8NlKNAS1ZQAW1ANyhFmhDMbkcAg4yi918ypu8\nTCFCuZkNJpAcIJVT5LHeSWdhFMvpjyCf7i4tjRRziFj6M4MiBHNIpS+/0Fm5mTWxiWGcZh2RLkys\nlj7EEMOrLCLD8bXGnrej+IBb6LBRSwKn2MUSrpGmnM8O4AxanuYFXiMZwV8uBDGTPeQD3cihnM1c\nwgBYiKeCK0RzhDwMjOIEExlMubJJoTNZzCeXcAxcY7w9hAUTQB1He5+VwFJOEkMZ0UAAAbRnBUvo\nQwFTgWmk0wvh9AyaRNzcF/YgEIccGOcckS0xz4FCCJuoEDY7s62RruprraJSCHFX2ESNxGId7atF\npQufTa8b1js+6yo3SSUME/uIBTTShkAds73//mCSHpo/0Aao3ytwtDdgUDqDLSeECUACc9XPDQJI\nZ17z9kZaDiz/GVAf+faB9YFVO9hSUrneOsDm0o8AOqo3zt6X1bzBFl5Sc1Kol8+YRz7POpDDUo/z\nfQ1dmaE82B1MZq8DVCsfccGLfiI8AOuxz64jGStljCOJeLVzg0rW05vD6Hhf/URmGueYCWwixKle\nxxRKvPJZRRdYIquIIsml/i01xtmnSCGrSXvdKghdD/Kxjxv4wPrA+sACVoejGqoH+439tEM2n6g9\nzt4mk0l04V0WssyJ3f7mRboNI7Xp5p5tzAkhRIXoIUaIL4RBHHSorRWPevXJPkK5jTkAEzuIYyer\nGdAaokEYHQFja+AGZ4kjgTUM4Uem0UH6xK+jG2bZD/SNyT0eURLsSYYSx1p05JHA5xwgVtLs9eoI\nlFZJsP04Rid0wDOUcJswu8agPjfQOHwOCibYl259YH1g/8dgzVS1HrAr2A5AFTPYrPZ0ayGD0ViI\nx8wYh/qL/O3xvdsIJFxJsJNYwSyuc5XT0oG8OqqZyBkvZusJflISbBd2MoggjjlABRvVXj1aq9LR\nwEoAVs6pnyJW8SWTyEHDcFJ5nr60l+46CL3HFNEinVJQCOwO5rKNRCCXUXxPvp3g7Mfi8Xad8Oj2\nPAY7mhHSbMRzBY3D+fRg9bmB1uHB+fvSrQ+sD2wzwGrqwotaRDYaRF86BiwmystU6pkY2QVAJ5tM\nWHZfZie29M8qCERSilf/1mwkabKxsiWB6iuHp+Rq3ak1ch5ZShE53bOfKze0iONqe5pjvhtcMpAu\n7pZQa/rh8p8BAGnHC5gYPqZsAAAAAElFTkSuQmCC".replaceAll("\n",""),a="data:image/png;base64,\niVBORw0KGgoAAAANSUhEUgAAAFYAAABWCAYAAABVVmH3AAAABGdBTUEAALGOfPtRkwAAACBjSFJN\nAAB6JQAAgIMAAPn/AACA6QAAdTAAAOpgAAA6mAAAF2+SX8VGAAAHsklEQVR42uyda2wVRRSAv0KB\ntkipKLYCMVJBIOVRRREQH1GUkKCoxMifQnwGVBRQEAwSKMFAIBgNCmgkGkSDIgooGNEIAkZ8BAVB\n5P0URKW8KWB7/XFPk5vNzt2d2dl797Y9yYSw3Tv3zLc7Z2bOOTM3KxaLUS/2pUE9gnAk2+uGrKys\ndOtYANwO3Cz//wFYAxxNp1KePT0WiyUtaZRi4GVgPxBzlKPAbKBTOsEm5RZBsB2A14EzLkCd5Rww\nH+hWD1YtVwPvAP/5AOpWPkkl4EwAmw9MBU4ZAk0sF4G5QFFdBpsNDAcOWADqLMflYTWra2C7A2tD\nAOosvwP96wLYlsA8oDIFUBPLYqBtbQU7WDF1SlWpAEYBjWoL2FJgaRqBOss64I5MBttCJvHnIwQ1\nsSwAWmcS2GbACOBgRIEmlmPABODyKINtCgwD9mQAUGc5ArwANI8S2NbAs8DuDATqLAeAiUB7ICsI\n2CwveAnerSzgCuBacZB0Bm6Vf/NqmdfvArAVWA38Ir1wO/CXPABr3q2WwBLgdC14K03LKeAreZGs\nmII84Os6DNRZdgNXe3HzE0EYamPeV4ukLTAkcARBDHm67V2N56uBrJxyfeoelrSxAfZgipWuBn4W\ne7ZWBo3jcj0baCLmqQjoA/QFesv1VMnx4PMxeDhFtusw8CrQFf0gZ3ugHNiVIl0n2Bi8HghZyQvA\ndFkCB5VcYGwKZi8jbIDtG7K/9JYQumon4pHcsPQeYgNsjwBxKK8YVdMQ7WCWmJYwwA704uZn8KqQ\nrtXcYqM/BMrEDCSTPLG5JUDDBNOxG9jsMYjEZKl9Fhhn+aGdtDF4FQA7LT7t9wVSMukDfCQzkipF\nPUeBZUA/H/XNsKh/JVBqywmz3pJSWyQqq5IOwGcytdKpdwPQK0m9jS2uHv8EimyB/dSCQuc9BqrH\nxeyY1l/m8dZeI2950HZ8DzSwBXauBYVmJGn0iwHrftKnbRxmoR3LbPpjn7Yw+b9S0diyAPVWA09p\nDDqNxQ0YpC1v2QTbL6AysxUNLQFOBKh3tKLeYqCn4m/PBGzLSJtguxgMKInlJkUjlweoc3wSqDuB\nbUCOwoESxJb3twm2uYyGJor8qAhz3B2gcc8roHZ0hIgGK+5bFMD0dLEd8/rWUJnXFI2bY1jfZEV9\nnYF9jnuXWx7EDtVMF22CnW+ozCCXhuUbhsdHKUB1U9R3TmJ0bg+hyuD7v/G7sNJxz20wyWsAdii6\nrG6yxGTgFQXUFYr6csRX65QjYmd1ZYffG3XAbjZQ5IwkRbh5n3RkHDDJ5XoPYBXQKslnWyn8H4cN\n2rM+DLB7JUSiI5VS3JwrfmWi+GudUiorwpYen3dzHlXJNE9XfgsD7BEZHHRNQUxx3S/UKS7XewIr\nkyw6EqVhEt105B+d9uuArZaZgY7kKGJRp318dowC6vXyphZp9Bo3X61utvcWgWsdLMB3mvfnidvR\nKbs8PlcOzFTY1M+BQg0dDivMQ6FmW1br9VW93K2r0N+E0V8x3TqkuH+sQtUbZCDU+e4qscVus5KL\nmnXdpcXNIClug6ZCUxSg3nO5t1xxbxfMNoFsVNjYQehnIxbogDXZS/uF5v29FdcXu3T/iS73dZeB\nqo2BrgvkrXVbTuvIGvzkEgQwBYinXjeU4ZZNky1+hGQOlc6Yb1c6rJjD5svUUaeux7S5GYDNNYiB\nTVCAGwBMU/ytlGCbQVTO74c06zkpY0voYAHe1VRuqzwQv1Iids0U6vwkdX+pWddSo55uCHaAQWP9\nevqLiedrmUJdpfDDIiO7bn3DUgk216Dx/+KduVgcsPsvRJ0Eki9LUp36ziq8Y6HuQTCJ1a/0ANvL\n0ARUEN+pk0xM/L9LjQf9AGC7Es9K0VV2mgeAS2SAWedjEr9JBikvR8xowx4w0BSszuYON1mB2Sbg\n8T4A1ywMbpSH2CKhe24lnkP7E95pSmXEz0HQnbNvA65T+BpCP7rk3gD2cDrhy0jME/pGB+IWEGxT\n8aoHyTgsDAFoHvBGAL1c566pBBvEftWU/dJdG1uCOsBg9HeWeYFXrBbA5mNnV+KvAtgkZ7YRcA/m\nkeTEcoZ4cl7awQI8h700yf3Am/LmdSS+gThHvFQNxXF+KdBOnCmzgD8sfv9sGz6WoLOCxCnSJiyf\nYiEDzwnxLJ2Ta03EUV1g0XzUyDGJUOzzAzbMWYFzBM70XYfl1ryCFsE2ktBNpkLdC1wWRbAQP4Ow\nOkPBPmLVjx3CCRuzMhDqx7qNTAfYQtJ7WpHJ9KokE8AC3JdBYEeZNDCdpxhNzQCoi0wbl06wuQah\n8lSW7QQ4XDLdB5q1I5rHRFUSP8+GTAVbE2eK2qFmw4M2KipnGw6NENTJNhoUpUMjJ0UA6gJbjYna\nMafpnCl8gKWTOKMIFuK7aFINdQmWD+eJ6onH01MIdTEhHDgR5TO6x6QA6hxC+nWSqJ8q/4SEs20D\nrRZ7HtrPjmTCcf29UWd3m5QTuG/aq3NgkZCOjVPmd6DeEF0nwSLd9qUAjvK3JfZGPVh3uRO9E98q\ngEdTrWQmgoV4rsJMvJPiFpJ8u2c9WIX0JJ745gS6B7g/nYqlKq8gTMkDHgRuk9XTRuJbmf5ON9ik\n3Op/MzEcqf/NxJDk/wEAzLV3Lfb0+2sAAAAASUVORK5CYII=".replaceAll("\n","");let s=!1,l={};function c(e,t){return setInterval((()=>{const t=m("BCX internal interval",{root:!0,modArea:"BCX"});e(),t.end()}),t)}function u(e,t){return setTimeout((()=>{const t=m("BCX internal timeout",{root:!0,modArea:"BCX"});e(),t.end()}),t)}let d=[];function h(){return 0===d.length?null:d[d.length-1].modArea}function m(e,{root:t=!1,modArea:n,extraInfo:r}={}){var o;const i={name:e,modArea:void 0!==n?n:null!==(o=h())&&void 0!==o?o:"",root:t,extraInfo:r},a={end:()=>{if(d[d.length-1]===i)return void d.pop();const e=d.indexOf(i);if(e<0)console.warn("HardCoreClub Debug context end while it is not on stack",i,new Error);else{const t=d.length-e,n=d.splice(e,t);console.warn(`HardCoreClub Debug context end while not on top of the stack (depth ${t})`,n,new Error)}}};return t&&d.length>0&&(console.warn("HardCoreClub Root context when we already have context",d,new Error),d=[]),d.push(i),a}function p(){var e;let t="----- Current context (most recent first) -----\n";if(0===d.length)t+="[None]\n";else{for(let n=d.length-1;n>=0;n--){const r=d[n];if(t+=`> ${r.name}\n`,r.extraInfo){let n="";try{n=r.extraInfo()}catch(t){n="Error processing extra info:\n"+(t instanceof Error?null!==(e=t.stack)&&void 0!==e?e:"[stack missing]":`${t}`)}n&&(t+=n.trim().replace(/\n|^/g,(e=>`${e}| `))+"\n")}}d[0].root||(t+="[unknown origin]\n")}return t}const f=Object.prototype.toString;function g(e){switch(f.call(e)){case"[object Error]":case"[object Exception]":case"[object DOMException]":return!0;default:return S(e,Error)}}function y(e,t){return f.call(e)===`[object ${t}]`}function v(e){return y(e,"ErrorEvent")}function b(e){return y(e,"DOMError")}function w(e){return y(e,"String")}function C(e){return"object"==typeof e&&null!==e&&"__sentry_template_string__"in e&&"__sentry_template_values__"in e}function _(e){return null===e||C(e)||"object"!=typeof e&&"function"!=typeof e}function k(e){return y(e,"Object")}function A(e){return"undefined"!=typeof Event&&S(e,Event)}function E(e){return Boolean(e&&e.then&&"function"==typeof e.then)}function S(e,t){try{return e instanceof t}catch(e){return!1}}function D(e){return!("object"!=typeof e||null===e||!e.__isVue&&!e._isVue)}const M="8.26.0",x=globalThis;function N(e,t,n){const r=n||x,o=r.__SENTRY__=r.__SENTRY__||{},i=o[M]=o[M]||{};return i[e]||(i[e]=t())}const I=x,R=80;function L(e,t={}){if(!e)return"<unknown>";try{let n=e;const r=5,o=[];let i=0,a=0;const s=" > ",l=s.length;let c;const u=Array.isArray(t)?t:t.keyAttrs,d=!Array.isArray(t)&&t.maxStringLength||R;for(;n&&i++<r&&(c=T(n,u),!("html"===c||i>1&&a+o.length*l+c.length>=d));)o.push(c),a+=c.length,n=n.parentNode;return o.reverse().join(s)}catch(e){return"<unknown>"}}function T(e,t){const n=e,r=[];if(!n||!n.tagName)return"";if(I.HTMLElement&&n instanceof HTMLElement&&n.dataset){if(n.dataset.sentryComponent)return n.dataset.sentryComponent;if(n.dataset.sentryElement)return n.dataset.sentryElement}r.push(n.tagName.toLowerCase());const o=t&&t.length?t.filter((e=>n.getAttribute(e))).map((e=>[e,n.getAttribute(e)])):null;if(o&&o.length)o.forEach((e=>{r.push(`[${e[0]}="${e[1]}"]`)}));else{n.id&&r.push(`#${n.id}`);const e=n.className;if(e&&w(e)){const t=e.split(/\s+/);for(const e of t)r.push(`.${e}`)}}const i=["aria-label","type","name","title","alt"];for(const e of i){const t=n.getAttribute(e);t&&r.push(`[${e}="${t}"]`)}return r.join("")}function P(){try{return I.document.location.href}catch(e){return""}}function B(e){if(!I.HTMLElement)return null;let t=e;for(let e=0;e<5;e++){if(!t)return null;if(t instanceof HTMLElement){if(t.dataset.sentryComponent)return t.dataset.sentryComponent;if(t.dataset.sentryElement)return t.dataset.sentryElement}t=t.parentNode}return null}const O="undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__,$=["debug","info","warn","error","log","assert","trace"],F={};function H(e){if(!("console"in x))return e();const t=x.console,n={},r=Object.keys(F);r.forEach((e=>{const r=F[e];n[e]=t[e],t[e]=r}));try{return e()}finally{r.forEach((e=>{t[e]=n[e]}))}}const W=function(){let e=!1;const t={enable:()=>{e=!0},disable:()=>{e=!1},isEnabled:()=>e};return O?$.forEach((n=>{t[n]=(...t)=>{e&&H((()=>{x.console[n](`Sentry Logger [${n}]:`,...t)}))}})):$.forEach((e=>{t[e]=()=>{}})),t}();function G(e,t=0){return"string"!=typeof e||0===t||e.length<=t?e:`${e.slice(0,t)}...`}function j(e,t){if(!Array.isArray(e))return"";const n=[];for(let t=0;t<e.length;t++){const r=e[t];try{D(r)?n.push("[VueViewModel]"):n.push(String(r))}catch(e){n.push("[value cannot be serialized]")}}return n.join(t)}function U(e,t=[],n=!1){return t.some((t=>function(e,t,n=!1){return!!w(e)&&(y(t,"RegExp")?t.test(e):!!w(t)&&(n?e===t:e.includes(t)))}(e,t,n)))}function Y(e,t,n){if(!(t in e))return;const r=e[t],o=n(r);"function"==typeof o&&X(o,r),e[t]=o}function q(e,t,n){try{Object.defineProperty(e,t,{value:n,writable:!0,configurable:!0})}catch(n){O&&W.log(`Failed to add non-enumerable property "${t}" to object`,e)}}function X(e,t){try{const n=t.prototype||{};e.prototype=t.prototype=n,q(e,"__sentry_original__",t)}catch(e){}}function z(e){return e.__sentry_original__}function V(e){if(g(e))return{message:e.message,name:e.name,stack:e.stack,...K(e)};if(A(e)){const t={type:e.type,target:Z(e.target),currentTarget:Z(e.currentTarget),...K(e)};return"undefined"!=typeof CustomEvent&&S(e,CustomEvent)&&(t.detail=e.detail),t}return e}function Z(e){try{return"undefined"!=typeof Element&&S(e,Element)?L(e):Object.prototype.toString.call(e)}catch(e){return"<unknown>"}}function K(e){if("object"==typeof e&&null!==e){const t={};for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}return{}}function J(e){return Q(e,new Map)}function Q(e,t){if(function(e){if(!k(e))return!1;try{const t=Object.getPrototypeOf(e).constructor.name;return!t||"Object"===t}catch(e){return!0}}(e)){const n=t.get(e);if(void 0!==n)return n;const r={};t.set(e,r);for(const n of Object.keys(e))void 0!==e[n]&&(r[n]=Q(e[n],t));return r}if(Array.isArray(e)){const n=t.get(e);if(void 0!==n)return n;const r=[];return t.set(e,r),e.forEach((e=>{r.push(Q(e,t))})),r}return e}const ee="baggage",te="sentry-",ne=/^sentry-/,re=8192;function oe(e){const t=function(e){if(e&&(w(e)||Array.isArray(e)))return Array.isArray(e)?e.reduce(((e,t)=>{const n=ae(t);return Object.entries(n).forEach((([t,n])=>{e[t]=n})),e}),{}):ae(e)}(e);if(!t)return;const n=Object.entries(t).reduce(((e,[t,n])=>(t.match(ne)&&(e[t.slice(te.length)]=n),e)),{});return Object.keys(n).length>0?n:void 0}function ie(e){if(e)return function(e){if(0!==Object.keys(e).length)return Object.entries(e).reduce(((e,[t,n],r)=>{const o=`${encodeURIComponent(t)}=${encodeURIComponent(n)}`,i=0===r?o:`${e},${o}`;return i.length>re?(O&&W.warn(`Not adding key: ${t} with val: ${n} to baggage header due to exceeding baggage size limits.`),e):i}),"")}(Object.entries(e).reduce(((e,[t,n])=>(n&&(e[`${te}${t}`]=n),e)),{}))}function ae(e){return e.split(",").map((e=>e.split("=").map((e=>decodeURIComponent(e.trim()))))).reduce(((e,[t,n])=>(t&&n&&(e[t]=n),e)),{})}function se(){const e=x,t=e.crypto||e.msCrypto;let n=()=>16*Math.random();try{if(t&&t.randomUUID)return t.randomUUID().replace(/-/g,"");t&&t.getRandomValues&&(n=()=>{const e=new Uint8Array(1);return t.getRandomValues(e),e[0]})}catch(e){}return([1e7]+1e3+4e3+8e3+1e11).replace(/[018]/g,(e=>(e^(15&n())>>e/4).toString(16)))}function le(e){return e.exception&&e.exception.values?e.exception.values[0]:void 0}function ce(e){const{message:t,event_id:n}=e;if(t)return t;const r=le(e);return r?r.type&&r.value?`${r.type}: ${r.value}`:r.type||r.value||n||"<unknown>":n||"<unknown>"}function ue(e,t,n){const r=e.exception=e.exception||{},o=r.values=r.values||[],i=o[0]=o[0]||{};i.value||(i.value=t||""),i.type||(i.type=n||"Error")}function de(e,t){const n=le(e);if(!n)return;const r=n.mechanism;if(n.mechanism={type:"generic",handled:!0,...r,...t},t&&"data"in t){const e={...r&&r.data,...t.data};n.mechanism.data=e}}function he(e){if(e&&e.__sentry_captured__)return!0;try{q(e,"__sentry_captured__",!0)}catch(e){}return!1}function me(e){return Array.isArray(e)?e:[e]}const pe=new RegExp("^[ \\t]*([0-9a-f]{32})?-?([0-9a-f]{16})?-?([01])?[ \\t]*$");function fe(e=se(),t=se().substring(16),n){let r="";return void 0!==n&&(r=n?"-1":"-0"),`${e}-${t}${r}`}const ge=1e3;function ye(){return Date.now()/ge}const ve=function(){const{performance:e}=x;if(!e||!e.now)return ye;const t=Date.now()-e.now(),n=null==e.timeOrigin?t:e.timeOrigin;return()=>(n+e.now())/ge}();let be;const we=(()=>{const{performance:e}=x;if(!e||!e.now)return void(be="none");const t=36e5,n=e.now(),r=Date.now(),o=e.timeOrigin?Math.abs(e.timeOrigin+n-r):t,i=o<t,a=e.timing&&e.timing.navigationStart,s="number"==typeof a?Math.abs(a+n-r):t;return i||s<t?o<=s?(be="timeOrigin",e.timeOrigin):(be="navigationStart",a):(be="dateNow",r)})();function Ce(){return _e(x),x}function _e(e){const t=e.__SENTRY__=e.__SENTRY__||{};return t.version=t.version||M,t[M]=t[M]||{}}function ke(){return{traceId:se(),spanId:se().substring(16)}}function Ae(e,t={}){if(t.user&&(!e.ipAddress&&t.user.ip_address&&(e.ipAddress=t.user.ip_address),e.did||t.did||(e.did=t.user.id||t.user.email||t.user.username)),e.timestamp=t.timestamp||ve(),t.abnormal_mechanism&&(e.abnormal_mechanism=t.abnormal_mechanism),t.ignoreDuration&&(e.ignoreDuration=t.ignoreDuration),t.sid&&(e.sid=32===t.sid.length?t.sid:se()),void 0!==t.init&&(e.init=t.init),!e.did&&t.did&&(e.did=`${t.did}`),"number"==typeof t.started&&(e.started=t.started),e.ignoreDuration)e.duration=void 0;else if("number"==typeof t.duration)e.duration=t.duration;else{const t=e.timestamp-e.started;e.duration=t>=0?t:0}t.release&&(e.release=t.release),t.environment&&(e.environment=t.environment),!e.ipAddress&&t.ipAddress&&(e.ipAddress=t.ipAddress),!e.userAgent&&t.userAgent&&(e.userAgent=t.userAgent),"number"==typeof t.errors&&(e.errors=t.errors),t.status&&(e.status=t.status)}const Ee="_sentrySpan";function Se(e,t){t?q(e,Ee,t):delete e[Ee]}function De(e){return e[Ee]}class Me{constructor(){this._notifyingListeners=!1,this._scopeListeners=[],this._eventProcessors=[],this._breadcrumbs=[],this._attachments=[],this._user={},this._tags={},this._extra={},this._contexts={},this._sdkProcessingMetadata={},this._propagationContext=ke()}clone(){const e=new Me;return e._breadcrumbs=[...this._breadcrumbs],e._tags={...this._tags},e._extra={...this._extra},e._contexts={...this._contexts},e._user=this._user,e._level=this._level,e._session=this._session,e._transactionName=this._transactionName,e._fingerprint=this._fingerprint,e._eventProcessors=[...this._eventProcessors],e._requestSession=this._requestSession,e._attachments=[...this._attachments],e._sdkProcessingMetadata={...this._sdkProcessingMetadata},e._propagationContext={...this._propagationContext},e._client=this._client,e._lastEventId=this._lastEventId,Se(e,De(this)),e}setClient(e){this._client=e}setLastEventId(e){this._lastEventId=e}getClient(){return this._client}lastEventId(){return this._lastEventId}addScopeListener(e){this._scopeListeners.push(e)}addEventProcessor(e){return this._eventProcessors.push(e),this}setUser(e){return this._user=e||{email:void 0,id:void 0,ip_address:void 0,username:void 0},this._session&&Ae(this._session,{user:e}),this._notifyScopeListeners(),this}getUser(){return this._user}getRequestSession(){return this._requestSession}setRequestSession(e){return this._requestSession=e,this}setTags(e){return this._tags={...this._tags,...e},this._notifyScopeListeners(),this}setTag(e,t){return this._tags={...this._tags,[e]:t},this._notifyScopeListeners(),this}setExtras(e){return this._extra={...this._extra,...e},this._notifyScopeListeners(),this}setExtra(e,t){return this._extra={...this._extra,[e]:t},this._notifyScopeListeners(),this}setFingerprint(e){return this._fingerprint=e,this._notifyScopeListeners(),this}setLevel(e){return this._level=e,this._notifyScopeListeners(),this}setTransactionName(e){return this._transactionName=e,this._notifyScopeListeners(),this}setContext(e,t){return null===t?delete this._contexts[e]:this._contexts[e]=t,this._notifyScopeListeners(),this}setSession(e){return e?this._session=e:delete this._session,this._notifyScopeListeners(),this}getSession(){return this._session}update(e){if(!e)return this;const t="function"==typeof e?e(this):e,[n,r]=t instanceof xe?[t.getScopeData(),t.getRequestSession()]:k(t)?[e,e.requestSession]:[],{tags:o,extra:i,user:a,contexts:s,level:l,fingerprint:c=[],propagationContext:u}=n||{};return this._tags={...this._tags,...o},this._extra={...this._extra,...i},this._contexts={...this._contexts,...s},a&&Object.keys(a).length&&(this._user=a),l&&(this._level=l),c.length&&(this._fingerprint=c),u&&(this._propagationContext=u),r&&(this._requestSession=r),this}clear(){return this._breadcrumbs=[],this._tags={},this._extra={},this._user={},this._contexts={},this._level=void 0,this._transactionName=void 0,this._fingerprint=void 0,this._requestSession=void 0,this._session=void 0,Se(this,void 0),this._attachments=[],this._propagationContext=ke(),this._notifyScopeListeners(),this}addBreadcrumb(e,t){const n="number"==typeof t?t:100;if(n<=0)return this;const r={timestamp:ye(),...e},o=this._breadcrumbs;return o.push(r),this._breadcrumbs=o.length>n?o.slice(-n):o,this._notifyScopeListeners(),this}getLastBreadcrumb(){return this._breadcrumbs[this._breadcrumbs.length-1]}clearBreadcrumbs(){return this._breadcrumbs=[],this._notifyScopeListeners(),this}addAttachment(e){return this._attachments.push(e),this}clearAttachments(){return this._attachments=[],this}getScopeData(){return{breadcrumbs:this._breadcrumbs,attachments:this._attachments,contexts:this._contexts,tags:this._tags,extra:this._extra,user:this._user,level:this._level,fingerprint:this._fingerprint||[],eventProcessors:this._eventProcessors,propagationContext:this._propagationContext,sdkProcessingMetadata:this._sdkProcessingMetadata,transactionName:this._transactionName,span:De(this)}}setSDKProcessingMetadata(e){return this._sdkProcessingMetadata={...this._sdkProcessingMetadata,...e},this}setPropagationContext(e){return this._propagationContext=e,this}getPropagationContext(){return this._propagationContext}captureException(e,t){const n=t&&t.event_id?t.event_id:se();if(!this._client)return W.warn("No client configured on scope - will not capture exception!"),n;const r=new Error("Sentry syntheticException");return this._client.captureException(e,{originalException:e,syntheticException:r,...t,event_id:n},this),n}captureMessage(e,t,n){const r=n&&n.event_id?n.event_id:se();if(!this._client)return W.warn("No client configured on scope - will not capture message!"),r;const o=new Error(e);return this._client.captureMessage(e,t,{originalException:e,syntheticException:o,...n,event_id:r},this),r}captureEvent(e,t){const n=t&&t.event_id?t.event_id:se();return this._client?(this._client.captureEvent(e,{...t,event_id:n},this),n):(W.warn("No client configured on scope - will not capture event!"),n)}_notifyScopeListeners(){this._notifyingListeners||(this._notifyingListeners=!0,this._scopeListeners.forEach((e=>{e(this)})),this._notifyingListeners=!1)}}const xe=Me;class Ne{constructor(e,t){let n,r;n=e||new xe,r=t||new xe,this._stack=[{scope:n}],this._isolationScope=r}withScope(e){const t=this._pushScope();let n;try{n=e(t)}catch(e){throw this._popScope(),e}return E(n)?n.then((e=>(this._popScope(),e)),(e=>{throw this._popScope(),e})):(this._popScope(),n)}getClient(){return this.getStackTop().client}getScope(){return this.getStackTop().scope}getIsolationScope(){return this._isolationScope}getStackTop(){return this._stack[this._stack.length-1]}_pushScope(){const e=this.getScope().clone();return this._stack.push({client:this.getClient(),scope:e}),e}_popScope(){return!(this._stack.length<=1||!this._stack.pop())}}function Ie(){const e=_e(Ce());return e.stack=e.stack||new Ne(N("defaultCurrentScope",(()=>new xe)),N("defaultIsolationScope",(()=>new xe)))}function Re(e){return Ie().withScope(e)}function Le(e,t){const n=Ie();return n.withScope((()=>(n.getStackTop().scope=e,t(e))))}function Te(e){return Ie().withScope((()=>e(Ie().getIsolationScope())))}function Pe(e){const t=_e(e);return t.acs?t.acs:{withIsolationScope:Te,withScope:Re,withSetScope:Le,withSetIsolationScope:(e,t)=>Te(t),getCurrentScope:()=>Ie().getScope(),getIsolationScope:()=>Ie().getIsolationScope()}}function Be(){return Pe(Ce()).getCurrentScope()}function Oe(){return Pe(Ce()).getIsolationScope()}function $e(){return N("globalScope",(()=>new xe))}function Fe(...e){const t=Pe(Ce());if(2===e.length){const[n,r]=e;return n?t.withSetScope(n,r):t.withScope(r)}return t.withScope(e[0])}function He(){return Be().getClient()}const We="_sentryMetrics";function Ge(e){const t=e[We];if(!t)return;const n={};for(const[,[e,r]]of t)(n[e]||(n[e]=[])).push(J(r));return n}const je="sentry.source",Ue="sentry.sample_rate",Ye="sentry.op",qe="sentry.origin",Xe="sentry.idle_span_finish_reason",ze="sentry.measurement_unit",Ve="sentry.measurement_value",Ze="sentry.exclusive_time",Ke=0,Je=1,Qe=2;function et(e,t){e.setAttribute("http.response.status_code",t);const n=function(e){if(e<400&&e>=100)return{code:Je};if(e>=400&&e<500)switch(e){case 401:return{code:Qe,message:"unauthenticated"};case 403:return{code:Qe,message:"permission_denied"};case 404:return{code:Qe,message:"not_found"};case 409:return{code:Qe,message:"already_exists"};case 413:return{code:Qe,message:"failed_precondition"};case 429:return{code:Qe,message:"resource_exhausted"};case 499:return{code:Qe,message:"cancelled"};default:return{code:Qe,message:"invalid_argument"}}if(e>=500&&e<600)switch(e){case 501:return{code:Qe,message:"unimplemented"};case 503:return{code:Qe,message:"unavailable"};case 504:return{code:Qe,message:"deadline_exceeded"};default:return{code:Qe,message:"internal_error"}}return{code:Qe,message:"unknown_error"}}(t);"unknown_error"!==n.message&&e.setStatus(n)}const tt=1;function nt(e){const{spanId:t,traceId:n}=e.spanContext(),{data:r,op:o,parent_span_id:i,status:a,origin:s}=st(e);return J({parent_span_id:i,span_id:t,trace_id:n,data:r,op:o,status:a,origin:s})}function rt(e){const{spanId:t,traceId:n}=e.spanContext(),{parent_span_id:r}=st(e);return J({parent_span_id:r,span_id:t,trace_id:n})}function ot(e){const{traceId:t,spanId:n}=e.spanContext();return fe(t,n,lt(e))}function it(e){return"number"==typeof e?at(e):Array.isArray(e)?e[0]+e[1]/1e9:e instanceof Date?at(e.getTime()):ve()}function at(e){return e>9999999999?e/1e3:e}function st(e){if(function(e){return"function"==typeof e.getSpanJSON}(e))return e.getSpanJSON();try{const{spanId:t,traceId:n}=e.spanContext();if(function(e){const t=e;return!!(t.attributes&&t.startTime&&t.name&&t.endTime&&t.status)}(e)){const{attributes:r,startTime:o,name:i,endTime:a,parentSpanId:s,status:l}=e;return J({span_id:t,trace_id:n,data:r,description:i,parent_span_id:s,start_timestamp:it(o),timestamp:it(a)||void 0,status:ct(l),op:r[Ye],origin:r[qe],_metrics_summary:Ge(e)})}return{span_id:t,trace_id:n}}catch(e){return{}}}function lt(e){const{traceFlags:t}=e.spanContext();return t===tt}function ct(e){if(e&&e.code!==Ke)return e.code===Je?"ok":e.message||"unknown_error"}const ut="_sentryChildSpans",dt="_sentryRootSpan";function ht(e,t){const n=e[dt]||e;q(t,dt,n),e[ut]?e[ut].add(t):q(e,ut,new Set([t]))}function mt(e){const t=new Set;return function e(n){if(!t.has(n)&&lt(n)){t.add(n);const r=n[ut]?Array.from(n[ut]):[];for(const t of r)e(t)}}(e),Array.from(t)}function pt(e){return e[dt]||e}function ft(){const e=Pe(Ce());return e.getActiveSpan?e.getActiveSpan():De(Be())}function gt(e){if("boolean"==typeof __SENTRY_TRACING__&&!__SENTRY_TRACING__)return!1;const t=He(),n=e||t&&t.getOptions();return!!n&&(n.enableTracing||"tracesSampleRate"in n||"tracesSampler"in n)}const yt="production",vt="_frozenDsc";function bt(e,t){q(e,vt,t)}function wt(e,t){const n=t.getOptions(),{publicKey:r}=t.getDsn()||{},o=J({environment:n.environment||yt,release:n.release,public_key:r,trace_id:e});return t.emit("createDsc",o),o}function Ct(e){const t=He();if(!t)return{};const n=wt(st(e).trace_id||"",t),r=pt(e),o=r[vt];if(o)return o;const i=r.spanContext().traceState,a=i&&i.get("sentry.dsc"),s=a&&oe(a);if(s)return s;const l=st(r),c=l.data||{},u=c[Ue];null!=u&&(n.sample_rate=`${u}`);const d=c[je],h=l.description;return"url"!==d&&h&&(n.transaction=h),n.sampled=String(lt(r)),t.emit("createDsc",n,r),n}const _t="undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__;function kt(e){if("boolean"==typeof e)return Number(e);const t="string"==typeof e?parseFloat(e):e;if(!("number"!=typeof t||isNaN(t)||t<0||t>1))return t;_t&&W.warn(`[Tracing] Given sample rate is invalid. Sample rate must be a boolean or a number between 0 and 1. Got ${JSON.stringify(e)} of type ${JSON.stringify(typeof e)}.`)}class At{constructor(e={}){this._traceId=e.traceId||se(),this._spanId=e.spanId||se().substring(16)}spanContext(){return{spanId:this._spanId,traceId:this._traceId,traceFlags:0}}end(e){}setAttribute(e,t){return this}setAttributes(e){return this}setStatus(e){return this}updateName(e){return this}isRecording(){return!1}addEvent(e,t,n){return this}addLink(e){return this}addLinks(e){return this}recordException(e,t){}}const Et=/^(?:(\w+):)\/\/(?:(\w+)(?::(\w+)?)?@)([\w.-]+)(?::(\d+))?\/(.+)/;function St(e,t=!1){const{host:n,path:r,pass:o,port:i,projectId:a,protocol:s,publicKey:l}=e;return`${s}://${l}${t&&o?`:${o}`:""}@${n}${i?`:${i}`:""}/${r?`${r}/`:r}${a}`}function Dt(e){return{protocol:e.protocol,publicKey:e.publicKey||"",pass:e.pass||"",host:e.host,port:e.port||"",path:e.path||"",projectId:e.projectId}}const Mt=50,xt="?",Nt=/\(error: (.*)\)/,It=/captureMessage|captureException/;function Rt(...e){const t=e.sort(((e,t)=>e[0]-t[0])).map((e=>e[1]));return(e,n=0,r=0)=>{const o=[],i=e.split("\n");for(let e=n;e<i.length;e++){const n=i[e];if(n.length>1024)continue;const a=Nt.test(n)?n.replace(Nt,"$1"):n;if(!a.match(/\S*Error: /)){for(const e of t){const t=e(a);if(t){o.push(t);break}}if(o.length>=Mt+r)break}}return function(e){if(!e.length)return[];const t=Array.from(e);return/sentryWrapped/.test(Lt(t).function||"")&&t.pop(),t.reverse(),It.test(Lt(t).function||"")&&(t.pop(),It.test(Lt(t).function||"")&&t.pop()),t.slice(0,Mt).map((e=>({...e,filename:e.filename||Lt(t).filename,function:e.function||xt})))}(o.slice(r))}}function Lt(e){return e[e.length-1]||{}}const Tt="<anonymous>";function Pt(e){try{return e&&"function"==typeof e&&e.name||Tt}catch(e){return Tt}}function Bt(e){const t=e.exception;if(t){const e=[];try{return t.values.forEach((t=>{t.stacktrace.frames&&e.push(...t.stacktrace.frames)})),e}catch(e){return}}}function Ot(e,t=100,n=1/0){try{return Ft("",e,t,n)}catch(e){return{ERROR:`**non-serializable** (${e})`}}}function $t(e,t=3,n=102400){const r=Ot(e,t);return o=r,function(e){return~-encodeURI(e).split(/%..|./).length}(JSON.stringify(o))>n?$t(e,t-1,n):r;var o}function Ft(e,t,n=1/0,r=1/0,o=function(){const e="function"==typeof WeakSet,t=e?new WeakSet:[];return[function(n){if(e)return!!t.has(n)||(t.add(n),!1);for(let e=0;e<t.length;e++)if(t[e]===n)return!0;return t.push(n),!1},function(n){if(e)t.delete(n);else for(let e=0;e<t.length;e++)if(t[e]===n){t.splice(e,1);break}}]}()){const[i,a]=o;if(null==t||["number","boolean","string"].includes(typeof t)&&!Number.isNaN(t))return t;const s=function(e,t){try{if("domain"===e&&t&&"object"==typeof t&&t._events)return"[Domain]";if("domainEmitter"===e)return"[DomainEmitter]";if("undefined"!=typeof global&&t===global)return"[Global]";if("undefined"!=typeof window&&t===window)return"[Window]";if("undefined"!=typeof document&&t===document)return"[Document]";if(D(t))return"[VueViewModel]";if(k(n=t)&&"nativeEvent"in n&&"preventDefault"in n&&"stopPropagation"in n)return"[SyntheticEvent]";if("number"==typeof t&&t!=t)return"[NaN]";if("function"==typeof t)return`[Function: ${Pt(t)}]`;if("symbol"==typeof t)return`[${String(t)}]`;if("bigint"==typeof t)return`[BigInt: ${String(t)}]`;const r=function(e){const t=Object.getPrototypeOf(e);return t?t.constructor.name:"null prototype"}(t);return/^HTML(\w*)Element$/.test(r)?`[HTMLElement: ${r}]`:`[object ${r}]`}catch(e){return`**non-serializable** (${e})`}var n}(e,t);if(!s.startsWith("[object "))return s;if(t.__sentry_skip_normalization__)return t;const l="number"==typeof t.__sentry_override_normalization_depth__?t.__sentry_override_normalization_depth__:n;if(0===l)return s.replace("object ","");if(i(t))return"[Circular ~]";const c=t;if(c&&"function"==typeof c.toJSON)try{return Ft("",c.toJSON(),l-1,r,o)}catch(e){}const u=Array.isArray(t)?[]:{};let d=0;const h=V(t);for(const e in h){if(!Object.prototype.hasOwnProperty.call(h,e))continue;if(d>=r){u[e]="[MaxProperties ~]";break}const t=h[e];u[e]=Ft(e,t,l-1,r,o),d++}return a(t),u}function Ht(e,t=[]){return[e,t]}function Wt(e,t){const[n,r]=e;return[n,[...r,t]]}function Gt(e,t){const n=e[1];for(const e of n)if(t(e,e[0].type))return!0;return!1}function jt(e){return x.__SENTRY__&&x.__SENTRY__.encodePolyfill?x.__SENTRY__.encodePolyfill(e):(new TextEncoder).encode(e)}function Ut(e){const[t,n]=e;let r=JSON.stringify(t);function o(e){"string"==typeof r?r="string"==typeof e?r+e:[jt(r),e]:r.push("string"==typeof e?jt(e):e)}for(const e of n){const[t,n]=e;if(o(`\n${JSON.stringify(t)}\n`),"string"==typeof n||n instanceof Uint8Array)o(n);else{let e;try{e=JSON.stringify(n)}catch(t){e=JSON.stringify(Ot(n))}o(e)}}return"string"==typeof r?r:function(e){const t=e.reduce(((e,t)=>e+t.length),0),n=new Uint8Array(t);let r=0;for(const t of e)n.set(t,r),r+=t.length;return n}(r)}function Yt(e){return[{type:"span"},e]}function qt(e){const t="string"==typeof e.data?jt(e.data):e.data;return[J({type:"attachment",length:t.length,filename:e.filename,content_type:e.contentType,attachment_type:e.attachmentType}),t]}const Xt={session:"session",sessions:"session",attachment:"attachment",transaction:"transaction",event:"error",client_report:"internal",user_report:"default",profile:"profile",profile_chunk:"profile",replay_event:"replay",replay_recording:"replay",check_in:"monitor",feedback:"feedback",span:"span",statsd:"metric_bucket"};function zt(e){return Xt[e]}function Vt(e){if(!e||!e.sdk)return;const{name:t,version:n}=e.sdk;return{name:t,version:n}}function Zt(e,t,n,r){const o=e.sdkProcessingMetadata&&e.sdkProcessingMetadata.dynamicSamplingContext;return{event_id:e.event_id,sent_at:(new Date).toISOString(),...t&&{sdk:t},...!!n&&r&&{dsn:St(r)},...o&&{trace:J({...o})}}}function Kt(e){if(!e||0===e.length)return;const t={};return e.forEach((e=>{const n=e.attributes||{},r=n[ze],o=n[Ve];"string"==typeof r&&"number"==typeof o&&(t[e.name]={value:o,unit:r})})),t}const Jt="_sentryScope",Qt="_sentryIsolationScope";function en(e){return{scope:e[Jt],isolationScope:e[Qt]}}class tn{constructor(e={}){this._traceId=e.traceId||se(),this._spanId=e.spanId||se().substring(16),this._startTime=e.startTimestamp||ve(),this._attributes={},this.setAttributes({[qe]:"manual",[Ye]:e.op,...e.attributes}),this._name=e.name,e.parentSpanId&&(this._parentSpanId=e.parentSpanId),"sampled"in e&&(this._sampled=e.sampled),e.endTimestamp&&(this._endTime=e.endTimestamp),this._events=[],this._isStandaloneSpan=e.isStandalone,this._endTime&&this._onSpanEnded()}addLink(e){return this}addLinks(e){return this}recordException(e,t){}spanContext(){const{_spanId:e,_traceId:t,_sampled:n}=this;return{spanId:e,traceId:t,traceFlags:n?tt:0}}setAttribute(e,t){return void 0===t?delete this._attributes[e]:this._attributes[e]=t,this}setAttributes(e){return Object.keys(e).forEach((t=>this.setAttribute(t,e[t]))),this}updateStartTime(e){this._startTime=it(e)}setStatus(e){return this._status=e,this}updateName(e){return this._name=e,this}end(e){this._endTime||(this._endTime=it(e),function(e){if(!_t)return;const{description:t="< unknown name >",op:n="< unknown op >"}=st(e),{spanId:r}=e.spanContext(),o=`[Tracing] Finishing "${n}" ${pt(e)===e?"root ":""}span "${t}" with ID ${r}`;W.log(o)}(this),this._onSpanEnded())}getSpanJSON(){return J({data:this._attributes,description:this._name,op:this._attributes[Ye],parent_span_id:this._parentSpanId,span_id:this._spanId,start_timestamp:this._startTime,status:ct(this._status),timestamp:this._endTime,trace_id:this._traceId,origin:this._attributes[qe],_metrics_summary:Ge(this),profile_id:this._attributes["sentry.profile_id"],exclusive_time:this._attributes[Ze],measurements:Kt(this._events),is_segment:this._isStandaloneSpan&&pt(this)===this||void 0,segment_id:this._isStandaloneSpan?pt(this).spanContext().spanId:void 0})}isRecording(){return!this._endTime&&!!this._sampled}addEvent(e,t,n){_t&&W.log("[Tracing] Adding an event to span:",e);const r=nn(t)?t:n||ve(),o=nn(t)?{}:t||{},i={name:e,time:it(r),attributes:o};return this._events.push(i),this}isStandaloneSpan(){return!!this._isStandaloneSpan}_onSpanEnded(){const e=He();if(e&&e.emit("spanEnd",this),!this._isStandaloneSpan&&this!==pt(this))return;if(this._isStandaloneSpan)return void(this._sampled?function(e){const t=He();if(!t)return;const n=e[1];if(!n||0===n.length)return void t.recordDroppedEvent("before_send","span");const r=t.getTransport();r&&r.send(e).then(null,(e=>{_t&&W.error("Error while sending span:",e)}))}(function(e,t){const n=Ct(e[0]),r=t&&t.getDsn(),o=t&&t.getOptions().tunnel,i={sent_at:(new Date).toISOString(),...function(e){return!!e.trace_id&&!!e.public_key}(n)&&{trace:n},...!!o&&r&&{dsn:St(r)}},a=t&&t.getOptions().beforeSendSpan,s=a?e=>a(st(e)):e=>st(e),l=[];for(const t of e){const e=s(t);e&&l.push(Yt(e))}return Ht(i,l)}([this],e)):(_t&&W.log("[Tracing] Discarding standalone span because its trace was not chosen to be sampled."),e&&e.recordDroppedEvent("sample_rate","span")));const t=this._convertSpanToTransaction();t&&(en(this).scope||Be()).captureEvent(t)}_convertSpanToTransaction(){if(!rn(st(this)))return;this._name||(_t&&W.warn("Transaction has no name, falling back to `<unlabeled transaction>`."),this._name="<unlabeled transaction>");const{scope:e,isolationScope:t}=en(this),n=(e||Be()).getClient()||He();if(!0!==this._sampled)return _t&&W.log("[Tracing] Discarding transaction because its trace was not chosen to be sampled."),void(n&&n.recordDroppedEvent("sample_rate","transaction"));const r=mt(this).filter((e=>e!==this&&!function(e){return e instanceof tn&&e.isStandaloneSpan()}(e))).map((e=>st(e))).filter(rn),o=this._attributes[je],i={contexts:{trace:nt(this)},spans:r.length>1e3?r.sort(((e,t)=>e.start_timestamp-t.start_timestamp)).slice(0,1e3):r,start_timestamp:this._startTime,timestamp:this._endTime,transaction:this._name,type:"transaction",sdkProcessingMetadata:{capturedSpanScope:e,capturedSpanIsolationScope:t,...J({dynamicSamplingContext:Ct(this)})},_metrics_summary:Ge(this),...o&&{transaction_info:{source:o}}},a=Kt(this._events);return a&&Object.keys(a).length&&(_t&&W.log("[Measurements] Adding measurements to transaction event",JSON.stringify(a,void 0,2)),i.measurements=a),i}}function nn(e){return e&&"number"==typeof e||e instanceof Date||Array.isArray(e)}function rn(e){return!!(e.start_timestamp&&e.timestamp&&e.span_id&&e.trace_id)}const on="__SENTRY_SUPPRESS_TRACING__";function an(e){const t=ln();if(t.startInactiveSpan)return t.startInactiveSpan(e);const n=function(e){const t={isStandalone:(e.experimental||{}).standalone,...e};if(e.startTime){const n={...t};return n.startTimestamp=it(e.startTime),delete n.startTime,n}return t}(e),{forceTransaction:r,parentSpan:o}=e;return(e.scope?t=>Fe(e.scope,t):void 0!==o?e=>sn(o,e):e=>e())((()=>{const t=Be(),o=function(e){const t=De(e);if(!t)return;const n=He();return(n?n.getOptions():{}).parentSpanIsAlwaysRootSpan?pt(t):t}(t);return e.onlyIfParent&&!o?new At:function({parentSpan:e,spanArguments:t,forceTransaction:n,scope:r}){if(!gt())return new At;const o=Oe();let i;if(e&&!n)i=function(e,t,n){const{spanId:r,traceId:o}=e.spanContext(),i=!t.getScopeData().sdkProcessingMetadata[on]&&lt(e),a=i?new tn({...n,parentSpanId:r,traceId:o,sampled:i}):new At({traceId:o});ht(e,a);const s=He();return s&&(s.emit("spanStart",a),n.endTimestamp&&s.emit("spanEnd",a)),a}(e,r,t),ht(e,i);else if(e){const n=Ct(e),{traceId:o,spanId:a}=e.spanContext(),s=lt(e);i=cn({traceId:o,parentSpanId:a,...t},r,s),bt(i,n)}else{const{traceId:e,dsc:n,parentSpanId:a,sampled:s}={...o.getPropagationContext(),...r.getPropagationContext()};i=cn({traceId:e,parentSpanId:a,...t},r,s),n&&bt(i,n)}return function(e){if(!_t)return;const{description:t="< unknown name >",op:n="< unknown op >",parent_span_id:r}=st(e),{spanId:o}=e.spanContext(),i=lt(e),a=pt(e),s=a===e,l=`[Tracing] Starting ${i?"sampled":"unsampled"} ${s?"root ":""}span`,c=[`op: ${n}`,`name: ${t}`,`ID: ${o}`];if(r&&c.push(`parent ID: ${r}`),!s){const{op:e,description:t}=st(a);c.push(`root ID: ${a.spanContext().spanId}`),e&&c.push(`root op: ${e}`),t&&c.push(`root description: ${t}`)}W.log(`${l}\n  ${c.join("\n  ")}`)}(i),function(e,t,n){e&&(q(e,Qt,n),q(e,Jt,t))}(i,r,o),i}({parentSpan:o,spanArguments:n,forceTransaction:r,scope:t})}))}function sn(e,t){const n=ln();return n.withActiveSpan?n.withActiveSpan(e,t):Fe((n=>(Se(n,e||void 0),t(n))))}function ln(){return Pe(Ce())}function cn(e,t,n){const r=He(),o=r&&r.getOptions()||{},{name:i="",attributes:a}=e,[s,l]=t.getScopeData().sdkProcessingMetadata[on]?[!1]:function(e,t){if(!gt(e))return[!1];let n;n="function"==typeof e.tracesSampler?e.tracesSampler(t):void 0!==t.parentSampled?t.parentSampled:void 0!==e.tracesSampleRate?e.tracesSampleRate:1;const r=kt(n);return void 0===r?(_t&&W.warn("[Tracing] Discarding transaction because of invalid sample rate."),[!1]):r?Math.random()<r?[!0,r]:(_t&&W.log(`[Tracing] Discarding transaction because it's not included in the random sample (sampling rate = ${Number(n)})`),[!1,r]):(_t&&W.log("[Tracing] Discarding transaction because "+("function"==typeof e.tracesSampler?"tracesSampler returned 0 or false":"a negative sampling decision was inherited or tracesSampleRate is set to 0")),[!1,r])}(o,{name:i,parentSampled:n,attributes:a,transactionContext:{name:i,parentSampled:n}}),c=new tn({...e,attributes:{[je]:"custom",...e.attributes},sampled:s});return void 0!==l&&c.setAttribute(Ue,l),r&&r.emit("spanStart",c),c}function un(e){if(!e)return{};const t=e.match(/^(([^:/?#]+):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?$/);if(!t)return{};const n=t[6]||"",r=t[8]||"";return{host:t[4],path:t[5],protocol:t[2],search:n,hash:r,relative:t[5]+n+r}}const dn="undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__,hn=x;function mn(e){let t,n=e[0],r=1;for(;r<e.length;){const o=e[r],i=e[r+1];if(r+=2,("optionalAccess"===o||"optionalCall"===o)&&null==n)return;"access"===o||"optionalAccess"===o?(t=n,n=i(n)):"call"!==o&&"optionalCall"!==o||(n=i(((...e)=>n.call(t,...e))),t=void 0)}return n}const pn=(e,t,n,r)=>{let o,i;return a=>{t.value>=0&&(a||r)&&(i=t.value-(o||0),(i||void 0===o)&&(o=t.value,t.delta=i,t.rating=((e,t)=>e>t[1]?"poor":e>t[0]?"needs-improvement":"good")(t.value,n),e(t)))}},fn=()=>hn.performance&&performance.getEntriesByType&&performance.getEntriesByType("navigation")[0],gn=()=>{const e=fn();return e&&e.activationStart||0},yn=(e,t)=>{const n=fn();let r="navigate";return n&&(hn.document&&hn.document.prerendering||gn()>0?r="prerender":hn.document&&hn.document.wasDiscarded?r="restore":n.type&&(r=n.type.replace(/_/g,"-"))),{name:e,value:void 0===t?-1:t,rating:"good",delta:0,entries:[],id:`v3-${Date.now()}-${Math.floor(8999999999999*Math.random())+1e12}`,navigationType:r}},vn=(e,t,n)=>{try{if(PerformanceObserver.supportedEntryTypes.includes(e)){const r=new PerformanceObserver((e=>{Promise.resolve().then((()=>{t(e.getEntries())}))}));return r.observe(Object.assign({type:e,buffered:!0},n||{})),r}}catch(e){}},bn=e=>{const t=t=>{("pagehide"===t.type||hn.document&&"hidden"===hn.document.visibilityState)&&e(t)};hn.document&&(addEventListener("visibilitychange",t,!0),addEventListener("pagehide",t,!0))},wn=e=>{let t=!1;return n=>{t||(e(n),t=!0)}};let Cn=-1;const _n=e=>{"hidden"===hn.document.visibilityState&&Cn>-1&&(Cn="visibilitychange"===e.type?e.timeStamp:0,removeEventListener("visibilitychange",_n,!0),removeEventListener("prerenderingchange",_n,!0))},kn=()=>(hn.document&&Cn<0&&(Cn="hidden"!==hn.document.visibilityState||hn.document.prerendering?1/0:0,addEventListener("visibilitychange",_n,!0),addEventListener("prerenderingchange",_n,!0)),{get firstHiddenTime(){return Cn}}),An=e=>{hn.document&&hn.document.prerendering?addEventListener("prerenderingchange",(()=>e()),!0):e()},En=[1800,3e3],Sn=[.1,.25],Dn=(e,t={})=>{((e,t={})=>{An((()=>{const n=kn(),r=yn("FCP");let o;const i=vn("paint",(e=>{e.forEach((e=>{"first-contentful-paint"===e.name&&(i.disconnect(),e.startTime<n.firstHiddenTime&&(r.value=Math.max(e.startTime-gn(),0),r.entries.push(e),o(!0)))}))}));i&&(o=pn(e,r,En,t.reportAllChanges))}))})(wn((()=>{const n=yn("CLS",0);let r,o=0,i=[];const a=e=>{e.forEach((e=>{if(!e.hadRecentInput){const t=i[0],n=i[i.length-1];o&&t&&n&&e.startTime-n.startTime<1e3&&e.startTime-t.startTime<5e3?(o+=e.value,i.push(e)):(o=e.value,i=[e])}})),o>n.value&&(n.value=o,n.entries=i,r())},s=vn("layout-shift",a);s&&(r=pn(e,n,Sn,t.reportAllChanges),bn((()=>{a(s.takeRecords()),r(!0)})),setTimeout(r,0))})))},Mn=[100,300],xn=(e,t={})=>{An((()=>{const n=kn(),r=yn("FID");let o;const i=e=>{e.startTime<n.firstHiddenTime&&(r.value=e.processingStart-e.startTime,r.entries.push(e),o(!0))},a=e=>{e.forEach(i)},s=vn("first-input",a);o=pn(e,r,Mn,t.reportAllChanges),s&&bn(wn((()=>{a(s.takeRecords()),s.disconnect()})))}))};let Nn=0,In=1/0,Rn=0;const Ln=e=>{e.forEach((e=>{e.interactionId&&(In=Math.min(In,e.interactionId),Rn=Math.max(Rn,e.interactionId),Nn=Rn?(Rn-In)/7+1:0)}))};let Tn;const Pn=()=>{"interactionCount"in performance||Tn||(Tn=vn("event",Ln,{type:"event",buffered:!0,durationThreshold:0}))},Bn=[200,500],On=()=>(Tn?Nn:performance.interactionCount||0)-0,$n=[],Fn={},Hn=e=>{const t=$n[$n.length-1],n=Fn[e.interactionId];if(n||$n.length<10||t&&e.duration>t.latency){if(n)n.entries.push(e),n.latency=Math.max(n.latency,e.duration);else{const t={id:e.interactionId,latency:e.duration,entries:[e]};Fn[t.id]=t,$n.push(t)}$n.sort(((e,t)=>t.latency-e.latency)),$n.splice(10).forEach((e=>{delete Fn[e.id]}))}},Wn=(e,t={})=>{An((()=>{Pn();const n=yn("INP");let r;const o=e=>{e.forEach((e=>{e.interactionId&&Hn(e),"first-input"===e.entryType&&!$n.some((t=>t.entries.some((t=>e.duration===t.duration&&e.startTime===t.startTime))))&&Hn(e)}));const t=(()=>{const e=Math.min($n.length-1,Math.floor(On()/50));return $n[e]})();t&&t.latency!==n.value&&(n.value=t.latency,n.entries=t.entries,r())},i=vn("event",o,{durationThreshold:null!=t.durationThreshold?t.durationThreshold:40});r=pn(e,n,Bn,t.reportAllChanges),i&&("PerformanceEventTiming"in hn&&"interactionId"in PerformanceEventTiming.prototype&&i.observe({type:"first-input",buffered:!0}),bn((()=>{o(i.takeRecords()),n.value<0&&On()>0&&(n.value=0,n.entries=[]),r(!0)})))}))},Gn=[2500,4e3],jn={},Un=(e,t={})=>{An((()=>{const n=kn(),r=yn("LCP");let o;const i=e=>{const t=e[e.length-1];t&&t.startTime<n.firstHiddenTime&&(r.value=Math.max(t.startTime-gn(),0),r.entries=[t],o())},a=vn("largest-contentful-paint",i);if(a){o=pn(e,r,Gn,t.reportAllChanges);const n=wn((()=>{jn[r.id]||(i(a.takeRecords()),a.disconnect(),jn[r.id]=!0,o(!0))}));["keydown","click"].forEach((e=>{hn.document&&addEventListener(e,(()=>setTimeout(n,0)),!0)})),bn(n)}}))},Yn=[800,1800],qn=e=>{hn.document&&hn.document.prerendering?An((()=>qn(e))):hn.document&&"complete"!==hn.document.readyState?addEventListener("load",(()=>qn(e)),!0):setTimeout(e,0)},Xn=(e,t={})=>{const n=yn("TTFB"),r=pn(e,n,Yn,t.reportAllChanges);qn((()=>{const e=fn();if(e){const t=e.responseStart;if(t<=0||t>performance.now())return;n.value=Math.max(t-gn(),0),n.entries=[e],r(!0)}}))},zn={},Vn={};let Zn,Kn,Jn,Qn,er;function tr(e,t=!1){return hr("cls",e,sr,Zn,t)}function nr(e,t=!1){return hr("lcp",e,cr,Jn,t)}function rr(e){return hr("fid",e,lr,Kn)}function or(e){return hr("inp",e,dr,er)}function ir(e,t){return mr(e,t),Vn[e]||(function(e){const t={};"event"===e&&(t.durationThreshold=0),vn(e,(t=>{ar(e,{entries:t})}),t)}(e),Vn[e]=!0),pr(e,t)}function ar(e,t){const n=zn[e];if(n&&n.length)for(const r of n)try{r(t)}catch(t){dn&&W.error(`Error while triggering instrumentation handler.\nType: ${e}\nName: ${Pt(r)}\nError:`,t)}}function sr(){return Dn((e=>{ar("cls",{metric:e}),Zn=e}),{reportAllChanges:!0})}function lr(){return xn((e=>{ar("fid",{metric:e}),Kn=e}))}function cr(){return Un((e=>{ar("lcp",{metric:e}),Jn=e}),{reportAllChanges:!0})}function ur(){return Xn((e=>{ar("ttfb",{metric:e}),Qn=e}))}function dr(){return Wn((e=>{ar("inp",{metric:e}),er=e}))}function hr(e,t,n,r,o=!1){let i;return mr(e,t),Vn[e]||(i=n(),Vn[e]=!0),r&&t({metric:r}),pr(e,t,o?i:void 0)}function mr(e,t){zn[e]=zn[e]||[],zn[e].push(t)}function pr(e,t,n){return()=>{n&&n();const r=zn[e];if(!r)return;const o=r.indexOf(t);-1!==o&&r.splice(o,1)}}function fr(e){return"number"==typeof e&&isFinite(e)}function gr(e,t,n,{...r}){const o=st(e).start_timestamp;return o&&o>t&&"function"==typeof e.updateStartTime&&e.updateStartTime(t),sn(e,(()=>{const e=an({startTime:t,...r});return e&&e.end(n),e}))}function yr(e){const t=He();if(!t)return;const{name:n,transaction:r,attributes:o,startTime:i}=e,{release:a,environment:s}=t.getOptions(),l=t.getIntegrationByName("Replay"),c=l&&l.getReplayId(),u=Be(),d=u.getUser(),h=void 0!==d?d.email||d.id||d.ip_address:void 0;let m;try{m=u.getScopeData().contexts.profile.profile_id}catch(e){}return an({name:n,attributes:{release:a,environment:s,user:h||void 0,profile_id:m||void 0,replay_id:c||void 0,transaction:r,"user_agent.original":hn.navigator&&hn.navigator.userAgent,...o},startTime:i,experimental:{standalone:!0}})}function vr(){return hn&&hn.addEventListener&&hn.performance}function br(e){return e/1e3}const wr=2147483647;let Cr,_r,kr=0,Ar={};function Er({recordClsStandaloneSpans:e}){const t=vr();if(t&&we){t.mark&&hn.performance.mark("sentry-tracing-init");const n=rr((({metric:e})=>{const t=e.entries[e.entries.length-1];if(!t)return;const n=br(we),r=br(t.startTime);dn&&W.log("[Measurements] Adding FID"),Ar.fid={value:e.value,unit:"millisecond"},Ar["mark.fid"]={value:n+r,unit:"second"}})),r=nr((({metric:e})=>{const t=e.entries[e.entries.length-1];t&&(dn&&W.log("[Measurements] Adding LCP"),Ar.lcp={value:e.value,unit:"millisecond"},Cr=t)}),!0),o=hr("ttfb",(({metric:e})=>{e.entries[e.entries.length-1]&&(dn&&W.log("[Measurements] Adding TTFB"),Ar.ttfb={value:e.value,unit:"millisecond"})}),ur,Qn),i=e?function(){let e,t,n=0;if(!function(){try{return mn([PerformanceObserver,"access",e=>e.supportedEntryTypes,"optionalAccess",e=>e.includes,"call",e=>e("layout-shift")])}catch(e){return!1}}())return;let r=!1;function o(){r||(r=!0,t&&function(e,t,n){dn&&W.log(`Sending CLS span (${e})`);const r=br(we)+(mn([t,"optionalAccess",e=>e.startTime])||0),o=br(mn([t,"optionalAccess",e=>e.duration])||0),i=Be().getScopeData().transactionName,a=yr({name:t?L(mn([t,"access",e=>e.sources,"access",e=>e[0],"optionalAccess",e=>e.node])):"Layout shift",transaction:i,attributes:J({[qe]:"auto.http.browser.cls",[Ye]:"ui.webvital.cls",[Ze]:mn([t,"optionalAccess",e=>e.duration])||0,"sentry.pageload.span_id":n}),startTime:r});mn([a,"optionalAccess",e=>e.addEvent,"call",t=>t("cls",{[ze]:"",[Ve]:e})]),mn([a,"optionalAccess",e=>e.end,"call",e=>e(r+o)])}(n,e,t),i())}const i=tr((({metric:t})=>{const r=t.entries[t.entries.length-1];r&&(n=t.value,e=r)}),!0);bn((()=>{o()})),setTimeout((()=>{const e=mn([He(),"optionalAccess",e=>e.on,"call",t=>t("startNavigationSpan",(()=>{o(),e&&e()}))]),n=ft(),r=n&&pt(n),i=r&&st(r);i&&"pageload"===i.op&&(t=r.spanContext().spanId)}),0)}():tr((({metric:e})=>{const t=e.entries[e.entries.length-1];t&&(dn&&W.log(`[Measurements] Adding CLS ${e.value}`),Ar.cls={value:e.value,unit:""},_r=t)}),!0);return()=>{n(),r(),o(),i&&i()}}return()=>{}}function Sr(e,t,n,r,o,i){const a=i?t[i]:t[`${n}End`],s=t[`${n}Start`];s&&a&&gr(e,r+br(s),r+br(a),{op:"browser",name:o||n,attributes:{[qe]:"auto.ui.browser.metrics"}})}function Dr(e,t,n,r){const o=t[n];null!=o&&o<wr&&(e[r]=o)}const Mr=[],xr=new Map;const Nr={click:"click",pointerdown:"click",pointerup:"click",mousedown:"click",mouseup:"click",touchstart:"click",touchend:"click",mouseover:"hover",mouseout:"hover",mouseenter:"hover",mouseleave:"hover",pointerover:"hover",pointerout:"hover",pointerenter:"hover",pointerleave:"hover",dragstart:"drag",dragend:"drag",drag:"drag",dragenter:"drag",dragleave:"drag",dragover:"drag",drop:"drag",keydown:"press",keyup:"press",keypress:"press",input:"press"},Ir={},Rr={};function Lr(e,t){Ir[e]=Ir[e]||[],Ir[e].push(t)}function Tr(e,t){Rr[e]||(t(),Rr[e]=!0)}function Pr(e,t){const n=e&&Ir[e];if(n)for(const r of n)try{r(t)}catch(t){O&&W.error(`Error while triggering instrumentation handler.\nType: ${e}\nName: ${Pt(r)}\nError:`,t)}}const Br=x;let Or;function $r(e){const t="history";Lr(t,e),Tr(t,Fr)}function Fr(){if(!function(){const e=Br.chrome,t=e&&e.app&&e.app.runtime,n="history"in Br&&!!Br.history.pushState&&!!Br.history.replaceState;return!t&&n}())return;const e=hn.onpopstate;function t(e){return function(...t){const n=t.length>2?t[2]:void 0;if(n){const e=Or,t=String(n);Or=t,Pr("history",{from:e,to:t})}return e.apply(this,t)}}hn.onpopstate=function(...t){const n=hn.location.href,r=Or;if(Or=n,Pr("history",{from:r,to:n}),e)try{return e.apply(this,t)}catch(e){}},Y(hn.history,"pushState",t),Y(hn.history,"replaceState",t)}const Hr={idleTimeout:1e3,finalTimeout:3e4,childSpanTimeout:15e3};function Wr(e,t={}){const n=new Map;let r,o=!1,i="externalFinish",a=!t.disableAutoFinish;const s=[],{idleTimeout:l=Hr.idleTimeout,finalTimeout:c=Hr.finalTimeout,childSpanTimeout:u=Hr.childSpanTimeout,beforeSpanEnd:d}=t,h=He();if(!h||!gt())return new At;const m=Be(),p=ft(),f=function(e){const t=an(e);return Se(Be(),t),_t&&W.log("[Tracing] Started span is an idle span"),t}(e);function g(){r&&(clearTimeout(r),r=void 0)}function y(e){g(),r=setTimeout((()=>{!o&&0===n.size&&a&&(i="idleTimeout",f.end(e))}),l)}function v(e){r=setTimeout((()=>{!o&&a&&(i="heartbeatFailed",f.end(e))}),u)}function b(e){o=!0,n.clear(),s.forEach((e=>e())),Se(m,p);const t=st(f),{start_timestamp:r}=t;if(!r)return;(t.data||{})[Xe]||f.setAttribute(Xe,i),W.log(`[Tracing] Idle span "${t.op}" finished`);const a=mt(f).filter((e=>e!==f));let u=0;a.forEach((t=>{t.isRecording()&&(t.setStatus({code:Qe,message:"cancelled"}),t.end(e),_t&&W.log("[Tracing] Cancelling span since span ended early",JSON.stringify(t,void 0,2)));const n=st(t),{timestamp:r=0,start_timestamp:o=0}=n,i=o<=e,a=r-o<=(c+l)/1e3;if(_t){const e=JSON.stringify(t,void 0,2);i?a||W.log("[Tracing] Discarding span since it finished after idle span final timeout",e):W.log("[Tracing] Discarding span since it happened after idle span was finished",e)}a&&i||(function(e,t){e[ut]&&e[ut].delete(t)}(f,t),u++)})),u>0&&f.setAttribute("sentry.idle_span_discarded_spans",u)}return f.end=new Proxy(f.end,{apply(e,t,n){d&&d(f);const[r,...o]=n,i=it(r||ve()),a=mt(f).filter((e=>e!==f));if(!a.length)return b(i),Reflect.apply(e,t,[i,...o]);const s=a.map((e=>st(e).timestamp)).filter((e=>!!e)),l=s.length?Math.max(...s):void 0,u=st(f).start_timestamp,h=Math.min(u?u+c/1e3:1/0,Math.max(u||-1/0,Math.min(i,l||1/0)));return b(h),Reflect.apply(e,t,[h,...o])}}),s.push(h.on("spanStart",(e=>{var t;o||e===f||st(e).timestamp||mt(f).includes(e)&&(t=e.spanContext().spanId,g(),n.set(t,!0),v(ve()+u/1e3))}))),s.push(h.on("spanEnd",(e=>{var t;o||(t=e.spanContext().spanId,n.has(t)&&n.delete(t),0===n.size&&y(ve()+l/1e3))}))),s.push(h.on("idleSpanEnableAutoFinish",(e=>{e===f&&(a=!0,y(),n.size&&v())}))),t.disableAutoFinish||y(),setTimeout((()=>{o||(f.setStatus({code:Qe,message:"deadline_exceeded"}),i="finalTimeout",f.end())}),c),f}let Gr=null;function jr(e){const t="error";Lr(t,e),Tr(t,Ur)}function Ur(){Gr=x.onerror,x.onerror=function(e,t,n,r,o){return Pr("error",{column:r,error:o,line:n,msg:e,url:t}),!(!Gr||Gr.__SENTRY_LOADER__)&&Gr.apply(this,arguments)},x.onerror.__SENTRY_INSTRUMENTED__=!0}let Yr=null;function qr(e){const t="unhandledrejection";Lr(t,e),Tr(t,Xr)}function Xr(){Yr=x.onunhandledrejection,x.onunhandledrejection=function(e){return Pr("unhandledrejection",e),!(Yr&&!Yr.__SENTRY_LOADER__)||Yr.apply(this,arguments)},x.onunhandledrejection.__SENTRY_INSTRUMENTED__=!0}let zr=!1;function Vr(){const e=ft(),t=e&&pt(e);if(t){const e="internal_error";_t&&W.log(`[Tracing] Root span: ${e} -> Global error occured`),t.setStatus({code:Qe,message:e})}}Vr.tag="sentry_tracingErrorCallback";const Zr="undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__;var Kr;function Jr(e){return new eo((t=>{t(e)}))}function Qr(e){return new eo(((t,n)=>{n(e)}))}!function(e){e[e.PENDING=0]="PENDING",e[e.RESOLVED=1]="RESOLVED",e[e.REJECTED=2]="REJECTED"}(Kr||(Kr={}));class eo{constructor(e){eo.prototype.__init.call(this),eo.prototype.__init2.call(this),eo.prototype.__init3.call(this),eo.prototype.__init4.call(this),this._state=Kr.PENDING,this._handlers=[];try{e(this._resolve,this._reject)}catch(e){this._reject(e)}}then(e,t){return new eo(((n,r)=>{this._handlers.push([!1,t=>{if(e)try{n(e(t))}catch(e){r(e)}else n(t)},e=>{if(t)try{n(t(e))}catch(e){r(e)}else r(e)}]),this._executeHandlers()}))}catch(e){return this.then((e=>e),e)}finally(e){return new eo(((t,n)=>{let r,o;return this.then((t=>{o=!1,r=t,e&&e()}),(t=>{o=!0,r=t,e&&e()})).then((()=>{o?n(r):t(r)}))}))}__init(){this._resolve=e=>{this._setResult(Kr.RESOLVED,e)}}__init2(){this._reject=e=>{this._setResult(Kr.REJECTED,e)}}__init3(){this._setResult=(e,t)=>{this._state===Kr.PENDING&&(E(t)?t.then(this._resolve,this._reject):(this._state=e,this._value=t,this._executeHandlers()))}}__init4(){this._executeHandlers=()=>{if(this._state===Kr.PENDING)return;const e=this._handlers.slice();this._handlers=[],e.forEach((e=>{e[0]||(this._state===Kr.RESOLVED&&e[1](this._value),this._state===Kr.REJECTED&&e[2](this._value),e[0]=!0)}))}}}function to(e,t,n,r=0){return new eo(((o,i)=>{const a=e[r];if(null===t||"function"!=typeof a)o(t);else{const s=a({...t},n);_t&&a.id&&null===s&&W.log(`Event processor "${a.id}" dropped event`),E(s)?s.then((t=>to(e,t,n,r+1).then(o))).then(null,i):to(e,s,n,r+1).then(o).then(null,i)}}))}function no(e,t){const{extra:n,tags:r,user:o,contexts:i,level:a,sdkProcessingMetadata:s,breadcrumbs:l,fingerprint:c,eventProcessors:u,attachments:d,propagationContext:h,transactionName:m,span:p}=t;ro(e,"extra",n),ro(e,"tags",r),ro(e,"user",o),ro(e,"contexts",i),ro(e,"sdkProcessingMetadata",s),a&&(e.level=a),m&&(e.transactionName=m),p&&(e.span=p),l.length&&(e.breadcrumbs=[...e.breadcrumbs,...l]),c.length&&(e.fingerprint=[...e.fingerprint,...c]),u.length&&(e.eventProcessors=[...e.eventProcessors,...u]),d.length&&(e.attachments=[...e.attachments,...d]),e.propagationContext={...e.propagationContext,...h}}function ro(e,t,n){if(n&&Object.keys(n).length){e[t]={...e[t]};for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[t][r]=n[r])}}function oo(e,t,n,r,o,i){const{normalizeDepth:a=3,normalizeMaxBreadth:s=1e3}=e,l={...t,event_id:t.event_id||n.event_id||se(),timestamp:t.timestamp||ye()},c=n.integrations||e.integrations.map((e=>e.name));!function(e,t){const{environment:n,release:r,dist:o,maxValueLength:i=250}=t;"environment"in e||(e.environment="environment"in t?n:yt),void 0===e.release&&void 0!==r&&(e.release=r),void 0===e.dist&&void 0!==o&&(e.dist=o),e.message&&(e.message=G(e.message,i));const a=e.exception&&e.exception.values&&e.exception.values[0];a&&a.value&&(a.value=G(a.value,i));const s=e.request;s&&s.url&&(s.url=G(s.url,i))}(l,e),function(e,t){t.length>0&&(e.sdk=e.sdk||{},e.sdk.integrations=[...e.sdk.integrations||[],...t])}(l,c),o&&o.emit("applyFrameMetadata",t),void 0===t.type&&function(e,t){const n=x._sentryDebugIds;if(!n)return;let r;const o=io.get(t);o?r=o:(r=new Map,io.set(t,r));const i=Object.entries(n).reduce(((e,[n,o])=>{let i;const a=r.get(n);a?i=a:(i=t(n),r.set(n,i));for(let t=i.length-1;t>=0;t--){const n=i[t];if(n.filename){e[n.filename]=o;break}}return e}),{});try{e.exception.values.forEach((e=>{e.stacktrace.frames.forEach((e=>{e.filename&&(e.debug_id=i[e.filename])}))}))}catch(e){}}(l,e.stackParser);const u=function(e,t){if(!t)return e;const n=e?e.clone():new xe;return n.update(t),n}(r,n.captureContext);n.mechanism&&de(l,n.mechanism);const d=o?o.getEventProcessors():[],h=$e().getScopeData();i&&no(h,i.getScopeData()),u&&no(h,u.getScopeData());const m=[...n.attachments||[],...h.attachments];return m.length&&(n.attachments=m),function(e,t){const{fingerprint:n,span:r,breadcrumbs:o,sdkProcessingMetadata:i}=t;!function(e,t){const{extra:n,tags:r,user:o,contexts:i,level:a,transactionName:s}=t,l=J(n);l&&Object.keys(l).length&&(e.extra={...l,...e.extra});const c=J(r);c&&Object.keys(c).length&&(e.tags={...c,...e.tags});const u=J(o);u&&Object.keys(u).length&&(e.user={...u,...e.user});const d=J(i);d&&Object.keys(d).length&&(e.contexts={...d,...e.contexts}),a&&(e.level=a),s&&"transaction"!==e.type&&(e.transaction=s)}(e,t),r&&function(e,t){e.contexts={trace:rt(t),...e.contexts},e.sdkProcessingMetadata={dynamicSamplingContext:Ct(t),...e.sdkProcessingMetadata};const n=st(pt(t)).description;n&&!e.transaction&&"transaction"===e.type&&(e.transaction=n)}(e,r),function(e,t){e.fingerprint=e.fingerprint?me(e.fingerprint):[],t&&(e.fingerprint=e.fingerprint.concat(t)),e.fingerprint&&!e.fingerprint.length&&delete e.fingerprint}(e,n),function(e,t){const n=[...e.breadcrumbs||[],...t];e.breadcrumbs=n.length?n:void 0}(e,o),function(e,t){e.sdkProcessingMetadata={...e.sdkProcessingMetadata,...t}}(e,i)}(l,h),to([...d,...h.eventProcessors],l,n).then((e=>(e&&function(e){const t={};try{e.exception.values.forEach((e=>{e.stacktrace.frames.forEach((e=>{e.debug_id&&(e.abs_path?t[e.abs_path]=e.debug_id:e.filename&&(t[e.filename]=e.debug_id),delete e.debug_id)}))}))}catch(e){}if(0===Object.keys(t).length)return;e.debug_meta=e.debug_meta||{},e.debug_meta.images=e.debug_meta.images||[];const n=e.debug_meta.images;Object.entries(t).forEach((([e,t])=>{n.push({type:"sourcemap",code_file:e,debug_id:t})}))}(e),"number"==typeof a&&a>0?function(e,t,n){if(!e)return null;const r={...e,...e.breadcrumbs&&{breadcrumbs:e.breadcrumbs.map((e=>({...e,...e.data&&{data:Ot(e.data,t,n)}})))},...e.user&&{user:Ot(e.user,t,n)},...e.contexts&&{contexts:Ot(e.contexts,t,n)},...e.extra&&{extra:Ot(e.extra,t,n)}};return e.contexts&&e.contexts.trace&&r.contexts&&(r.contexts.trace=e.contexts.trace,e.contexts.trace.data&&(r.contexts.trace.data=Ot(e.contexts.trace.data,t,n))),e.spans&&(r.spans=e.spans.map((e=>({...e,...e.data&&{data:Ot(e.data,t,n)}})))),r}(e,a,s):e)))}const io=new WeakMap;const ao=["user","level","extra","contexts","tags","fingerprint","requestSession","propagationContext"];function so(e,t){return Be().captureException(e,function(e){if(e)return function(e){return e instanceof xe||"function"==typeof e}(e)||function(e){return Object.keys(e).some((e=>ao.includes(e)))}(e)?{captureContext:e}:e}(t))}function lo(e,t){return Be().captureEvent(e,t)}function co(e){const t=He(),n=Oe(),r=Be(),{release:o,environment:i=yt}=t&&t.getOptions()||{},{userAgent:a}=x.navigator||{},s=function(e){const t=ve(),n={sid:se(),init:!0,timestamp:t,started:t,duration:0,status:"ok",errors:0,ignoreDuration:!1,toJSON:()=>function(e){return J({sid:`${e.sid}`,init:e.init,started:new Date(1e3*e.started).toISOString(),timestamp:new Date(1e3*e.timestamp).toISOString(),status:e.status,errors:e.errors,did:"number"==typeof e.did||"string"==typeof e.did?`${e.did}`:void 0,duration:e.duration,abnormal_mechanism:e.abnormal_mechanism,attrs:{release:e.release,environment:e.environment,ip_address:e.ipAddress,user_agent:e.userAgent}})}(n)};return e&&Ae(n,e),n}({release:o,environment:i,user:r.getUser()||n.getUser(),...a&&{userAgent:a},...e}),l=n.getSession();return l&&"ok"===l.status&&Ae(l,{status:"exited"}),uo(),n.setSession(s),r.setSession(s),s}function uo(){const e=Oe(),t=Be(),n=t.getSession()||e.getSession();n&&function(e,t){let n={};"ok"===e.status&&(n={status:"exited"}),Ae(e,n)}(n),ho(),e.setSession(),t.setSession()}function ho(){const e=Oe(),t=Be(),n=He(),r=t.getSession()||e.getSession();r&&n&&n.captureSession(r)}function mo(e=!1){e?uo():ho()}const po=x;let fo=0;function go(){return fo>0}function yo(e,t={},n){if("function"!=typeof e)return e;try{const t=e.__sentry_wrapped__;if(t)return t;if(z(e))return e}catch(t){return e}const r=function(){const r=Array.prototype.slice.call(arguments);try{n&&"function"==typeof n&&n.apply(this,arguments);const o=r.map((e=>yo(e,t)));return e.apply(this,o)}catch(e){throw fo++,setTimeout((()=>{fo--})),Fe((n=>{n.addEventProcessor((e=>(t.mechanism&&(ue(e,void 0,void 0),de(e,t.mechanism)),e.extra={...e.extra,arguments:r},e))),so(e)})),e}};try{for(const t in e)Object.prototype.hasOwnProperty.call(e,t)&&(r[t]=e[t])}catch(e){}X(r,e),q(e,"__sentry_wrapped__",r);try{Object.getOwnPropertyDescriptor(r,"name").configurable&&Object.defineProperty(r,"name",{get:()=>e.name})}catch(e){}return r}const vo="__sentry_xhr_v3__";function bo(e){Lr("xhr",e),Tr("xhr",wo)}function wo(){if(!hn.XMLHttpRequest)return;const e=XMLHttpRequest.prototype;Y(e,"open",(function(e){return function(...t){const n=1e3*ve(),r=w(t[0])?t[0].toUpperCase():void 0,o=function(e){if(w(e))return e;try{return e.toString()}catch(e){}}(t[1]);if(!r||!o)return e.apply(this,t);this[vo]={method:r,url:o,request_headers:{}},"POST"===r&&o.match(/sentry_key/)&&(this.__sentry_own_request__=!0);const i=()=>{const e=this[vo];if(e&&4===this.readyState){try{e.status_code=this.status}catch(e){}Pr("xhr",{endTimestamp:1e3*ve(),startTimestamp:n,xhr:this})}};return"onreadystatechange"in this&&"function"==typeof this.onreadystatechange?Y(this,"onreadystatechange",(function(e){return function(...t){return i(),e.apply(this,t)}})):this.addEventListener("readystatechange",i),Y(this,"setRequestHeader",(function(e){return function(...t){const[n,r]=t,o=this[vo];return o&&w(n)&&w(r)&&(o.request_headers[n.toLowerCase()]=r),e.apply(this,t)}})),e.apply(this,t)}})),Y(e,"send",(function(e){return function(...t){const n=this[vo];return n?(void 0!==t[0]&&(n.body=t[0]),Pr("xhr",{startTimestamp:1e3*ve(),xhr:this}),e.apply(this,t)):e.apply(this,t)}}))}const Co=x;function _o(){if(!("fetch"in Co))return!1;try{return new Headers,new Request("http://www.example.com"),new Response,!0}catch(e){return!1}}function ko(e){return e&&/^function\s+\w+\(\)\s+\{\s+\[native code\]\s+\}$/.test(e.toString())}function Ao(e,t){const n="fetch";Lr(n,e),Tr(n,(()=>Eo(void 0,t)))}function Eo(e,t=!1){t&&!function(){if("string"==typeof EdgeRuntime)return!0;if(!_o())return!1;if(ko(Co.fetch))return!0;let e=!1;const t=Co.document;if(t&&"function"==typeof t.createElement)try{const n=t.createElement("iframe");n.hidden=!0,t.head.appendChild(n),n.contentWindow&&n.contentWindow.fetch&&(e=ko(n.contentWindow.fetch)),t.head.removeChild(n)}catch(e){O&&W.warn("Could not create sandbox iframe for pure fetch check, bailing to window.fetch: ",e)}return e}()||Y(x,"fetch",(function(t){return function(...n){const{method:r,url:o}=function(e){if(0===e.length)return{method:"GET",url:""};if(2===e.length){const[t,n]=e;return{url:Mo(t),method:Do(n,"method")?String(n.method).toUpperCase():"GET"}}const t=e[0];return{url:Mo(t),method:Do(t,"method")?String(t.method).toUpperCase():"GET"}}(n),i={args:n,fetchData:{method:r,url:o},startTimestamp:1e3*ve()};e||Pr("fetch",{...i});const a=(new Error).stack;return t.apply(x,n).then((async t=>(e?e(t):Pr("fetch",{...i,endTimestamp:1e3*ve(),response:t}),t)),(e=>{throw Pr("fetch",{...i,endTimestamp:1e3*ve(),error:e}),g(e)&&void 0===e.stack&&(e.stack=a,q(e,"framesToPop",1)),e}))}}))}async function So(e){let t;try{t=e.clone()}catch(e){return}await async function(t,n){if(t&&t.body&&t.body.getReader){const r=t.body.getReader();async function o({done:e}){if(e)return Promise.resolve();try{const e=await Promise.race([r.read(),new Promise((e=>{setTimeout((()=>{e({done:!0})}),5e3)}))]);await o(e)}catch(e){}}return r.read().then(o).then((()=>{Pr("fetch-body-resolved",{endTimestamp:1e3*ve(),response:e})})).catch((()=>{}))}}(t)}function Do(e,t){return!!e&&"object"==typeof e&&!!e[t]}function Mo(e){return"string"==typeof e?e:e?Do(e,"url")?e.url:e.toString?e.toString():"":""}const xo=new WeakMap,No=new Map,Io={traceFetch:!0,traceXHR:!0,enableHTTPTimings:!0};function Ro(e,t){const{traceFetch:n,traceXHR:r,shouldCreateSpanForRequest:o,enableHTTPTimings:i,tracePropagationTargets:a}={traceFetch:Io.traceFetch,traceXHR:Io.traceXHR,...t},s="function"==typeof o?o:e=>!0,l=e=>function(e,t){const n=po.location&&po.location.href;if(n){let r,o;try{r=new URL(e,n),o=new URL(n).origin}catch(e){return!1}const i=r.origin===o;return t?U(r.toString(),t)||i&&U(r.pathname,t):i}{const n=!!e.match(/^\/(?!\/)/);return t?U(e,t):n}}(e,a),c={};n&&(e.addEventProcessor((e=>("transaction"===e.type&&e.spans&&e.spans.forEach((e=>{if("http.client"===e.op){const t=No.get(e.span_id);t&&(e.timestamp=t/1e3,No.delete(e.span_id))}})),e))),function(e){const t="fetch-body-resolved";Lr(t,(e=>{if(e.response){const t=xo.get(e.response);t&&e.endTimestamp&&No.set(t,e.endTimestamp)}})),Tr(t,(()=>Eo(So)))}(),Ao((e=>{const t=function(e,t,n,r,o="auto.http.browser"){if(!e.fetchData)return;const i=gt()&&t(e.fetchData.url);if(e.endTimestamp&&i){const t=e.fetchData.__span;if(!t)return;const n=r[t];return void(n&&(function(e,t){if(t.response){et(e,t.response.status);const n=t.response&&t.response.headers&&t.response.headers.get("content-length");if(n){const t=parseInt(n);t>0&&e.setAttribute("http.response_content_length",t)}}else t.error&&e.setStatus({code:Qe,message:"internal_error"});e.end()}(n,e),delete r[t]))}const a=Be(),s=He(),{method:l,url:c}=e.fetchData,u=function(e){try{return new URL(e).href}catch(e){return}}(c),d=u?un(u).host:void 0,h=!!ft(),m=i&&h?an({name:`${l} ${c}`,attributes:{url:c,type:"fetch","http.method":l,"http.url":u,"server.address":d,[qe]:o,[Ye]:"http.client"}}):new At;if(e.fetchData.__span=m.spanContext().spanId,r[m.spanContext().spanId]=m,n(e.fetchData.url)&&s){const t=e.args[0];e.args[1]=e.args[1]||{};const n=e.args[1];n.headers=function(e,t,n,r,o){const i=Oe(),{traceId:a,spanId:s,sampled:l,dsc:c}={...i.getPropagationContext(),...n.getPropagationContext()},u=o?ot(o):fe(a,s,l),d=ie(c||(o?Ct(o):wt(a,t))),h=r.headers||("undefined"!=typeof Request&&S(e,Request)?e.headers:void 0);if(h){if("undefined"!=typeof Headers&&S(h,Headers)){const e=new Headers(h);return e.append("sentry-trace",u),d&&e.append(ee,d),e}if(Array.isArray(h)){const e=[...h,["sentry-trace",u]];return d&&e.push([ee,d]),e}{const e="baggage"in h?h.baggage:void 0,t=[];return Array.isArray(e)?t.push(...e):e&&t.push(e),d&&t.push(d),{...h,"sentry-trace":u,baggage:t.length>0?t.join(","):void 0}}}return{"sentry-trace":u,baggage:d}}(t,s,a,n,gt()&&h?m:void 0)}return m}(e,s,l,c);if(e.response&&e.fetchData.__span&&xo.set(e.response,e.fetchData.__span),t){const n=Po(e.fetchData.url),r=n?un(n).host:void 0;t.setAttributes({"http.url":n,"server.address":r})}i&&t&&Lo(t)}))),r&&bo((e=>{const t=function(e,t,n,r){const o=e.xhr,i=o&&o[vo];if(!o||o.__sentry_own_request__||!i)return;const a=gt()&&t(i.url);if(e.endTimestamp&&a){const e=o.__sentry_xhr_span_id__;if(!e)return;const t=r[e];return void(t&&void 0!==i.status_code&&(et(t,i.status_code),t.end(),delete r[e]))}const s=Po(i.url),l=s?un(s).host:void 0,c=!!ft(),u=a&&c?an({name:`${i.method} ${i.url}`,attributes:{type:"xhr","http.method":i.method,"http.url":s,url:i.url,"server.address":l,[qe]:"auto.http.browser",[Ye]:"http.client"}}):new At;o.__sentry_xhr_span_id__=u.spanContext().spanId,r[o.__sentry_xhr_span_id__]=u;const d=He();return o.setRequestHeader&&n(i.url)&&d&&function(e,t,n){const r=Be(),o=Oe(),{traceId:i,spanId:a,sampled:s,dsc:l}={...o.getPropagationContext(),...r.getPropagationContext()};!function(e,t,n){try{e.setRequestHeader("sentry-trace",t),n&&e.setRequestHeader(ee,n)}catch(e){}}(e,n&&gt()?ot(n):fe(i,a,s),ie(l||(n?Ct(n):wt(i,t))))}(o,d,gt()&&c?u:void 0),u}(e,s,l,c);i&&t&&Lo(t)}))}function Lo(e){const{url:t}=st(e).data||{};if(!t||"string"!=typeof t)return;const n=ir("resource",(({entries:r})=>{r.forEach((r=>{(function(e){return"resource"===e.entryType&&"initiatorType"in e&&"string"==typeof e.nextHopProtocol&&("fetch"===e.initiatorType||"xmlhttprequest"===e.initiatorType)})(r)&&r.name.endsWith(t)&&(function(e){const{name:t,version:n}=function(e){let t="unknown",n="unknown",r="";for(const o of e){if("/"===o){[t,n]=e.split("/");break}if(!isNaN(Number(o))){t="h"===r?"http":r,n=e.split(r)[1];break}r+=o}return r===e&&(t=r),{name:t,version:n}}(e.nextHopProtocol),r=[];return r.push(["network.protocol.version",n],["network.protocol.name",t]),we?[...r,["http.request.redirect_start",To(e.redirectStart)],["http.request.fetch_start",To(e.fetchStart)],["http.request.domain_lookup_start",To(e.domainLookupStart)],["http.request.domain_lookup_end",To(e.domainLookupEnd)],["http.request.connect_start",To(e.connectStart)],["http.request.secure_connection_start",To(e.secureConnectionStart)],["http.request.connection_end",To(e.connectEnd)],["http.request.request_start",To(e.requestStart)],["http.request.response_start",To(e.responseStart)],["http.request.response_end",To(e.responseEnd)]]:r}(r).forEach((t=>e.setAttribute(...t))),setTimeout(n))}))}))}function To(e=0){return((we||performance.timeOrigin)+e)/1e3}function Po(e){try{return new URL(e,po.location.origin).href}catch(e){return}}const Bo={...Hr,instrumentNavigation:!0,instrumentPageLoad:!0,markBackgroundSpan:!0,enableLongTask:!0,enableLongAnimationFrame:!0,enableInp:!0,_experiments:{},...Io};function Oo(e){const t=(n=`meta[name=${e}]`,I.document&&I.document.querySelector?I.document.querySelector(n):null);var n;return t?t.getAttribute("content"):void 0}const $o=[];function Fo(e){const t=e.defaultIntegrations||[],n=e.integrations;let r;t.forEach((e=>{e.isDefaultInstance=!0})),r=Array.isArray(n)?[...t,...n]:"function"==typeof n?me(n(t)):t;const o=function(e){const t={};return e.forEach((e=>{const{name:n}=e,r=t[n];r&&!r.isDefaultInstance&&e.isDefaultInstance||(t[n]=e)})),Object.values(t)}(r),i=o.findIndex((e=>"Debug"===e.name));if(i>-1){const[e]=o.splice(i,1);o.push(e)}return o}function Ho(e,t){for(const n of t)n&&n.afterAllSetup&&n.afterAllSetup(e)}function Wo(e,t,n){if(n[t.name])_t&&W.log(`Integration skipped because it was already installed: ${t.name}`);else{if(n[t.name]=t,-1===$o.indexOf(t.name)&&"function"==typeof t.setupOnce&&(t.setupOnce(),$o.push(t.name)),t.setup&&"function"==typeof t.setup&&t.setup(e),"function"==typeof t.preprocessEvent){const n=t.preprocessEvent.bind(t);e.on("preprocessEvent",((t,r)=>n(t,r,e)))}if("function"==typeof t.processEvent){const n=t.processEvent.bind(t),r=Object.assign(((t,r)=>n(t,r,e)),{id:t.name});e.addEventProcessor(r)}_t&&W.log(`Integration installed: ${t.name}`)}}const Go=1e6,jo=String(0),Uo="main";let Yo="",qo="",Xo="",zo=po.navigator&&po.navigator.userAgent||"",Vo="";const Zo=po.navigator&&po.navigator.language||po.navigator&&po.navigator.languages&&po.navigator.languages[0]||"",Ko=po.navigator&&po.navigator.userAgentData;var Jo;function Qo(e,t,n,r){if("transaction"!==r.type)throw new TypeError("Profiling events may only be attached to transactions, this should never occur.");if(null==n)throw new TypeError(`Cannot construct profiling event envelope without a valid profile. Got ${n} instead.`);const o=function(e){const t=e&&e.contexts&&e.contexts.trace&&e.contexts.trace.trace_id;return"string"==typeof t&&32!==t.length&&Zr&&W.log(`[Profiling] Invalid traceId: ${t} on profiled event`),"string"!=typeof t?"":t}(r),i=function(e){return!("thread_metadata"in e)}(l=n)?function(e){let t,n=0;const r={samples:[],stacks:[],frames:[],thread_metadata:{[jo]:{name:Uo}}},o=e.samples[0];if(!o)return r;const i=o.timestamp,a="number"==typeof performance.timeOrigin?performance.timeOrigin:we||0,s=a-(we||a);return e.samples.forEach(((o,a)=>{if(void 0===o.stackId)return void 0===t&&(t=n,r.stacks[t]=[],n++),void(r.samples[a]={elapsed_since_start_ns:((o.timestamp+s-i)*Go).toFixed(0),stack_id:t,thread_id:jo});let l=e.stacks[o.stackId];const c=[];for(;l;){c.push(l.frameId);const t=e.frames[l.frameId];t&&void 0===r.frames[l.frameId]&&(r.frames[l.frameId]={function:t.name,abs_path:"number"==typeof t.resourceId?e.resources[t.resourceId]:void 0,lineno:t.line,colno:t.column}),l=void 0===l.parentId?void 0:e.stacks[l.parentId]}const u={elapsed_since_start_ns:((o.timestamp+s-i)*Go).toFixed(0),stack_id:n,thread_id:jo};r.stacks[n]=c,r.samples[a]=u,n++})),r}(l):l,a=t||("number"==typeof r.start_timestamp?1e3*r.start_timestamp:1e3*ve()),s="number"==typeof r.timestamp?1e3*r.timestamp:1e3*ve();var l;return{event_id:e,timestamp:new Date(a).toISOString(),platform:"javascript",version:"1",release:r.release||"",environment:r.environment||yt,runtime:{name:"javascript",version:po.navigator.userAgent},os:{name:Yo,version:qo,build_number:zo},device:{locale:Zo,model:Vo,manufacturer:zo,architecture:Xo,is_emulator:!1},debug_meta:{images:ni(n.resources)},profile:i,transactions:[{name:r.transaction||"",id:r.event_id||se(),trace_id:o,active_thread_id:jo,relative_start_ns:"0",relative_end_ns:(1e6*(s-a)).toFixed(0)}]}}function ei(e){return"pageload"===st(e).op}"object"==typeof(Jo=Ko)&&null!==Jo&&"getHighEntropyValues"in Jo&&Ko.getHighEntropyValues(["architecture","model","platform","platformVersion","fullVersionList"]).then((e=>{if(Yo=e.platform||"",Xo=e.architecture||"",Vo=e.model||"",qo=e.platformVersion||"",e.fullVersionList&&e.fullVersionList.length>0){const t=e.fullVersionList[e.fullVersionList.length-1];zo=`${t.brand} ${t.version}`}})).catch((e=>{}));const ti=new WeakMap;function ni(e){const t=x._sentryDebugIds;if(!t)return[];const n=He(),r=n&&n.getOptions(),o=r&&r.stackParser;if(!o)return[];let i;const a=ti.get(o);a?i=a:(i=new Map,ti.set(o,i));const s=Object.keys(t).reduce(((e,n)=>{let r;const a=i.get(n);a?r=a:(r=o(n),i.set(n,r));for(let o=r.length-1;o>=0;o--){const i=r[o],a=i&&i.filename;if(i&&a){e[a]=t[n];break}}return e}),{}),l=[];for(const t of e)t&&s[t]&&l.push({type:"sourcemap",code_file:t,debug_id:s[t]});return l}let ri=!1;function oi(e){if(ri)return Zr&&W.log("[Profiling] Profiling has been disabled for the duration of the current user session."),!1;if(!e.isRecording())return Zr&&W.log("[Profiling] Discarding profile because transaction was not sampled."),!1;const t=He(),n=t&&t.getOptions();if(!n)return Zr&&W.log("[Profiling] Profiling disabled, no options found."),!1;const r=n.profilesSampleRate;return("number"!=typeof(o=r)&&"boolean"!=typeof o||"number"==typeof o&&isNaN(o)?(Zr&&W.warn(`[Profiling] Invalid sample rate. Sample rate must be a boolean or a number between 0 and 1. Got ${JSON.stringify(o)} of type ${JSON.stringify(typeof o)}.`),0):!0===o||!1===o||!(o<0||o>1)||(Zr&&W.warn(`[Profiling] Invalid sample rate. Sample rate must be between 0 and 1. Got ${o}.`),0))?r?!!(!0===r||Math.random()<r)||(Zr&&W.log(`[Profiling] Discarding profile because it's not included in the random sample (sampling rate = ${Number(r)})`),!1):(Zr&&W.log("[Profiling] Discarding profile because a negative sampling decision was inherited or profileSampleRate is set to 0"),!1):(Zr&&W.warn("[Profiling] Discarding profile because of invalid sample rate."),!1);var o}function ii(e,t,n,r){return function(e){return e.samples.length<2?(Zr&&W.log("[Profiling] Discarding profile because it contains less than 2 samples"),!1):!!e.frames.length||(Zr&&W.log("[Profiling] Discarding profile because it contains no frames"),!1)}(n)?Qo(e,t,n,r):null}const ai=new Map;function si(e){const t=ai.get(e);return t&&ai.delete(e),t}function li(e){let t;ei(e)&&(t=1e3*ve());const n=function(){const e=po.Profiler;if("function"!=typeof e)return void(Zr&&W.log("[Profiling] Profiling is not supported by this browser, Profiler interface missing on window object."));const t=Math.floor(3e3);try{return new e({sampleInterval:10,maxBufferSize:t})}catch(e){Zr&&(W.log("[Profiling] Failed to initialize the Profiling constructor, this is likely due to a missing 'Document-Policy': 'js-profiling' header."),W.log("[Profiling] Disabling profiling for current user session.")),ri=!0}}();if(!n)return;Zr&&W.log(`[Profiling] started profiling span: ${st(e).description}`);const r=se();async function o(){if(e&&n)return n.stop().then((t=>{i&&(po.clearTimeout(i),i=void 0),Zr&&W.log(`[Profiling] stopped profiling of span: ${st(e).description}`),t?function(e,t){if(ai.set(e,t),ai.size>30){const e=ai.keys().next().value;ai.delete(e)}}(r,t):Zr&&W.log(`[Profiling] profiler returned null profile for: ${st(e).description}`,"this may indicate an overlapping span or a call to stopProfiling with a profile title that was never started")})).catch((e=>{Zr&&W.log("[Profiling] error while stopping profiler:",e)}))}Be().setContext("profile",{profile_id:r,start_timestamp:t});let i=po.setTimeout((()=>{Zr&&W.log("[Profiling] max profile duration elapsed, stopping profiling for:",st(e).description),o()}),3e4);const a=e.end.bind(e);e.end=function(){return e?(o().then((()=>{a()}),(()=>{a()})),e):a()}}const ci=100;function ui(e,t){const n=He(),r=Oe();if(!n)return;const{beforeBreadcrumb:o=null,maxBreadcrumbs:i=ci}=n.getOptions();if(i<=0)return;const a={timestamp:ye(),...e},s=o?H((()=>o(a,t))):a;null!==s&&(n.emit&&n.emit("beforeAddBreadcrumb",s,t),r.addBreadcrumb(s,i))}function di(e){return"/"===e[e.length-1]?e.slice(0,-1):e}const hi=6e4;function mi(e,t,n=Date.now()){return function(e,t){return e[t]||e.all||0}(e,t)>n}function pi(e,{statusCode:t,headers:n},r=Date.now()){const o={...e},i=n&&n["x-sentry-rate-limits"],a=n&&n["retry-after"];if(i)for(const e of i.trim().split(",")){const[t,n,,,i]=e.split(":",5),a=parseInt(t,10),s=1e3*(isNaN(a)?60:a);if(n)for(const e of n.split(";"))"metric_bucket"===e&&i&&!i.split(";").includes("custom")||(o[e]=r+s);else o.all=r+s}else a?o.all=r+function(e,t=Date.now()){const n=parseInt(`${e}`,10);if(!isNaN(n))return 1e3*n;const r=Date.parse(`${e}`);return isNaN(r)?hi:r-t}(a,r):429===t&&(o.all=r+6e4);return o}function fi(){return"undefined"!=typeof window&&(!(("undefined"==typeof __SENTRY_BROWSER_BUNDLE__||!__SENTRY_BROWSER_BUNDLE__)&&"[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0))||void 0!==x.process&&"renderer"===x.process.type)}const gi={};function yi(e){const t=gi[e];if(t)return t;let n=hn[e];if(ko(n))return gi[e]=n.bind(hn);const r=hn.document;if(r&&"function"==typeof r.createElement)try{const t=r.createElement("iframe");t.hidden=!0,r.head.appendChild(t);const o=t.contentWindow;o&&o[e]&&(n=o[e]),r.head.removeChild(t)}catch(t){dn&&W.warn(`Could not create sandbox iframe for ${e} check, bailing to window.${e}: `,t)}return n?gi[e]=n.bind(hn):n}function vi(e){gi[e]=void 0}function bi(...e){return yi("setTimeout")(...e)}const wi=1e3;let Ci,_i,ki;function Ai(e){Lr("dom",e),Tr("dom",Ei)}function Ei(){if(!hn.document)return;const e=Pr.bind(null,"dom"),t=Si(e,!0);hn.document.addEventListener("click",t,!1),hn.document.addEventListener("keypress",t,!1),["EventTarget","Node"].forEach((t=>{const n=hn[t]&&hn[t].prototype;n&&n.hasOwnProperty&&n.hasOwnProperty("addEventListener")&&(Y(n,"addEventListener",(function(t){return function(n,r,o){if("click"===n||"keypress"==n)try{const r=this,i=r.__sentry_instrumentation_handlers__=r.__sentry_instrumentation_handlers__||{},a=i[n]=i[n]||{refCount:0};if(!a.handler){const r=Si(e);a.handler=r,t.call(this,n,r,o)}a.refCount++}catch(e){}return t.call(this,n,r,o)}})),Y(n,"removeEventListener",(function(e){return function(t,n,r){if("click"===t||"keypress"==t)try{const n=this,o=n.__sentry_instrumentation_handlers__||{},i=o[t];i&&(i.refCount--,i.refCount<=0&&(e.call(this,t,i.handler,r),i.handler=void 0,delete o[t]),0===Object.keys(o).length&&delete n.__sentry_instrumentation_handlers__)}catch(e){}return e.call(this,t,n,r)}})))}))}function Si(e,t=!1){return n=>{if(!n||n._sentryCaptured)return;const r=function(e){try{return e.target}catch(e){return null}}(n);if(function(e,t){return"keypress"===e&&(!t||!t.tagName||"INPUT"!==t.tagName&&"TEXTAREA"!==t.tagName&&!t.isContentEditable)}(n.type,r))return;q(n,"_sentryCaptured",!0),r&&!r._sentryId&&q(r,"_sentryId",se());const o="keypress"===n.type?"input":n.type;(function(e){if(e.type!==_i)return!1;try{if(!e.target||e.target._sentryId!==ki)return!1}catch(e){}return!0})(n)||(e({event:n,name:o,global:t}),_i=n.type,ki=r?r._sentryId:void 0),clearTimeout(Ci),Ci=hn.setTimeout((()=>{ki=void 0,_i=void 0}),wi)}}const Di=x,Mi="sentryReplaySession",xi="replay_event",Ni="Unable to send Replay",Ii=15e4,Ri=5e3,Li=2e7;function Ti(e,t){return null!=e?e:t()}function Pi(e){let t,n=e[0],r=1;for(;r<e.length;){const o=e[r],i=e[r+1];if(r+=2,("optionalAccess"===o||"optionalCall"===o)&&null==n)return;"access"===o||"optionalAccess"===o?(t=n,n=i(n)):"call"!==o&&"optionalCall"!==o||(n=i(((...e)=>n.call(t,...e))),t=void 0)}return n}var Bi;function Oi(e){const t=Pi([e,"optionalAccess",e=>e.host]);return Boolean(Pi([t,"optionalAccess",e=>e.shadowRoot])===e)}function $i(e){return"[object ShadowRoot]"===Object.prototype.toString.call(e)}function Fi(e){try{const n=e.rules||e.cssRules;return n?((t=Array.from(n,Hi).join("")).includes(" background-clip: text;")&&!t.includes(" -webkit-background-clip: text;")&&(t=t.replace(" background-clip: text;"," -webkit-background-clip: text; background-clip: text;")),t):null}catch(e){return null}var t}function Hi(e){let t;if(function(e){return"styleSheet"in e}(e))try{t=Fi(e.styleSheet)||function(e){const{cssText:t}=e;if(t.split('"').length<3)return t;const n=["@import",`url(${JSON.stringify(e.href)})`];return""===e.layerName?n.push("layer"):e.layerName&&n.push(`layer(${e.layerName})`),e.supportsText&&n.push(`supports(${e.supportsText})`),e.media.length&&n.push(e.media.mediaText),n.join(" ")+";"}(e)}catch(e){}else if(function(e){return"selectorText"in e}(e)&&e.selectorText.includes(":"))return e.cssText.replace(/(\[(?:[\w-]+)[^\\])(:(?:[\w-]+)\])/gm,"$1\\$2");return t||e.cssText}!function(e){e[e.Document=0]="Document",e[e.DocumentType=1]="DocumentType",e[e.Element=2]="Element",e[e.Text=3]="Text",e[e.CDATA=4]="CDATA",e[e.Comment=5]="Comment"}(Bi||(Bi={}));class Wi{constructor(){this.idNodeMap=new Map,this.nodeMetaMap=new WeakMap}getId(e){return e?Ti(Pi([this,"access",e=>e.getMeta,"call",t=>t(e),"optionalAccess",e=>e.id]),(()=>-1)):-1}getNode(e){return this.idNodeMap.get(e)||null}getIds(){return Array.from(this.idNodeMap.keys())}getMeta(e){return this.nodeMetaMap.get(e)||null}removeNodeFromMap(e){const t=this.getId(e);this.idNodeMap.delete(t),e.childNodes&&e.childNodes.forEach((e=>this.removeNodeFromMap(e)))}has(e){return this.idNodeMap.has(e)}hasNode(e){return this.nodeMetaMap.has(e)}add(e,t){const n=t.id;this.idNodeMap.set(n,e),this.nodeMetaMap.set(e,t)}replace(e,t){const n=this.getNode(e);if(n){const e=this.nodeMetaMap.get(n);e&&this.nodeMetaMap.set(t,e)}this.idNodeMap.set(e,t)}reset(){this.idNodeMap=new Map,this.nodeMetaMap=new WeakMap}}function Gi({maskInputOptions:e,tagName:t,type:n}){return"OPTION"===t&&(t="SELECT"),Boolean(e[t.toLowerCase()]||n&&e[n]||"password"===n||"INPUT"===t&&!n&&e.text)}function ji({isMasked:e,element:t,value:n,maskInputFn:r}){let o=n||"";return e?(r&&(o=r(o,t)),"*".repeat(o.length)):o}function Ui(e){return e.toLowerCase()}function Yi(e){return e.toUpperCase()}const qi="__rrweb_original__";function Xi(e){const t=e.type;return e.hasAttribute("data-rr-is-password")?"password":t?Ui(t):null}function zi(e,t,n){return"INPUT"!==t||"radio"!==n&&"checkbox"!==n?e.value:e.getAttribute("value")||""}function Vi(e,t){let n;try{n=new URL(e,Ti(t,(()=>window.location.href)))}catch(e){return null}return Ti(Pi([n.pathname.match(/\.([0-9a-z]+)(?:$)/i),"optionalAccess",e=>e[1]]),(()=>null))}const Zi={};function Ki(e){const t=Zi[e];if(t)return t;const n=window.document;let r=window[e];if(n&&"function"==typeof n.createElement)try{const t=n.createElement("iframe");t.hidden=!0,n.head.appendChild(t);const o=t.contentWindow;o&&o[e]&&(r=o[e]),n.head.removeChild(t)}catch(e){}return Zi[e]=r.bind(window)}function Ji(...e){return Ki("setTimeout")(...e)}function Qi(...e){return Ki("clearTimeout")(...e)}let ea=1;const ta=new RegExp("[^a-z0-9-_:]"),na=-2;function ra(){return ea++}let oa,ia;const aa=/url\((?:(')([^']*)'|(")(.*?)"|([^)]*))\)/gm,sa=/^(?:[a-z+]+:)?\/\//i,la=/^www\..*/i,ca=/^(data:)([^,]*),(.*)/i;function ua(e,t){return(e||"").replace(aa,((e,n,r,o,i,a)=>{const s=r||i||a,l=n||o||"";if(!s)return e;if(sa.test(s)||la.test(s))return`url(${l}${s}${l})`;if(ca.test(s))return`url(${l}${s}${l})`;if("/"===s[0])return`url(${l}${function(e){let t="";return t=e.indexOf("//")>-1?e.split("/").slice(0,3).join("/"):e.split("/")[0],t=t.split("?")[0],t}(t)+s}${l})`;const c=t.split("/"),u=s.split("/");c.pop();for(const e of u)"."!==e&&(".."===e?c.pop():c.push(e));return`url(${l}${c.join("/")}${l})`}))}const da=/^[^ \t\n\r\u000c]+/,ha=/^[, \t\n\r\u000c]+/;function ma(e,t){if(!t||""===t.trim())return t;const n=e.createElement("a");return n.href=t,n.href}function pa(){const e=document.createElement("a");return e.href="",e.href}function fa(e,t,n,r,o,i){return r?"src"===n||"href"===n&&("use"!==t||"#"!==r[0])||"xlink:href"===n&&"#"!==r[0]?ma(e,r):"background"!==n||"table"!==t&&"td"!==t&&"th"!==t?"srcset"===n?function(e,t){if(""===t.trim())return t;let n=0;function r(e){let r;const o=e.exec(t.substring(n));return o?(r=o[0],n+=r.length,r):""}const o=[];for(;r(ha),!(n>=t.length);){let i=r(da);if(","===i.slice(-1))i=ma(e,i.substring(0,i.length-1)),o.push(i);else{let r="";i=ma(e,i);let a=!1;for(;;){const e=t.charAt(n);if(""===e){o.push((i+r).trim());break}if(a)")"===e&&(a=!1);else{if(","===e){n+=1,o.push((i+r).trim());break}"("===e&&(a=!0)}r+=e,n+=1}}}return o.join(", ")}(e,r):"style"===n?ua(r,pa()):"object"===t&&"data"===n?ma(e,r):"function"==typeof i?i(n,r,o):r:ma(e,r):r}function ga(e,t,n){return("video"===e||"audio"===e)&&"autoplay"===t}function ya(e,t,n=1/0,r=0){return e?e.nodeType!==e.ELEMENT_NODE||r>n?-1:t(e)?r:ya(e.parentNode,t,n,r+1):-1}function va(e,t){return n=>{const r=n;if(null===r)return!1;try{if(e)if("string"==typeof e){if(r.matches(`.${e}`))return!0}else if(function(e,t){for(let n=e.classList.length;n--;){const r=e.classList[n];if(t.test(r))return!0}return!1}(r,e))return!0;return!(!t||!r.matches(t))}catch(e){return!1}}}function ba(e,t,n,r,o,i){try{const a=e.nodeType===e.ELEMENT_NODE?e:e.parentElement;if(null===a)return!1;if("INPUT"===a.tagName){const e=a.getAttribute("autocomplete");if(["current-password","new-password","cc-number","cc-exp","cc-exp-month","cc-exp-year","cc-csc"].includes(e))return!0}let s=-1,l=-1;if(i){if(l=ya(a,va(r,o)),l<0)return!0;s=ya(a,va(t,n),l>=0?l:1/0)}else{if(s=ya(a,va(t,n)),s<0)return!1;l=ya(a,va(r,o),s>=0?s:1/0)}return s>=0?!(l>=0)||s<=l:!(l>=0||!i)}catch(e){}return!!i}function wa(e){return null==e?"":e.toLowerCase()}function Ca(e,t){const{doc:n,mirror:r,blockClass:o,blockSelector:i,unblockSelector:a,maskAllText:s,maskTextClass:l,unmaskTextClass:c,maskTextSelector:u,unmaskTextSelector:d,skipChild:h=!1,inlineStylesheet:m=!0,maskInputOptions:p={},maskAttributeFn:f,maskTextFn:g,maskInputFn:y,slimDOMOptions:v,dataURLOptions:b={},inlineImages:w=!1,recordCanvas:C=!1,onSerialize:_,onIframeLoad:k,iframeLoadTimeout:A=5e3,onStylesheetLoad:E,stylesheetLoadTimeout:S=5e3,keepIframeSrcFn:D=(()=>!1),newlyAddedElement:M=!1}=t;let{preserveWhiteSpace:x=!0}=t;const N=function(e,t){const{doc:n,mirror:r,blockClass:o,blockSelector:i,unblockSelector:a,maskAllText:s,maskAttributeFn:l,maskTextClass:c,unmaskTextClass:u,maskTextSelector:d,unmaskTextSelector:h,inlineStylesheet:m,maskInputOptions:p={},maskTextFn:f,maskInputFn:g,dataURLOptions:y={},inlineImages:v,recordCanvas:b,keepIframeSrcFn:w,newlyAddedElement:C=!1}=t,_=function(e,t){if(!t.hasNode(e))return;const n=t.getId(e);return 1===n?void 0:n}(n,r);switch(e.nodeType){case e.DOCUMENT_NODE:return"CSS1Compat"!==e.compatMode?{type:Bi.Document,childNodes:[],compatMode:e.compatMode}:{type:Bi.Document,childNodes:[]};case e.DOCUMENT_TYPE_NODE:return{type:Bi.DocumentType,name:e.name,publicId:e.publicId,systemId:e.systemId,rootId:_};case e.ELEMENT_NODE:return function(e,t){const{doc:n,blockClass:r,blockSelector:o,unblockSelector:i,inlineStylesheet:a,maskInputOptions:s={},maskAttributeFn:l,maskInputFn:c,dataURLOptions:u={},inlineImages:d,recordCanvas:h,keepIframeSrcFn:m,newlyAddedElement:p=!1,rootId:f,maskAllText:g,maskTextClass:y,unmaskTextClass:v,maskTextSelector:b,unmaskTextSelector:w}=t,C=function(e,t,n,r){try{if(r&&e.matches(r))return!1;if("string"==typeof t){if(e.classList.contains(t))return!0}else for(let n=e.classList.length;n--;){const r=e.classList[n];if(t.test(r))return!0}if(n)return e.matches(n)}catch(e){}return!1}(e,r,o,i),_=function(e){if(e instanceof HTMLFormElement)return"form";const t=Ui(e.tagName);return ta.test(t)?"div":t}(e);let k={};const A=e.attributes.length;for(let t=0;t<A;t++){const r=e.attributes[t];r.name&&!ga(_,r.name,r.value)&&(k[r.name]=fa(n,_,Ui(r.name),r.value,e,l))}if("link"===_&&a){const t=Array.from(n.styleSheets).find((t=>t.href===e.href));let r=null;t&&(r=Fi(t)),r&&(delete k.rel,delete k.href,k._cssText=ua(r,t.href))}if("style"===_&&e.sheet&&!(e.innerText||e.textContent||"").trim().length){const t=Fi(e.sheet);t&&(k._cssText=ua(t,pa()))}if("input"===_||"textarea"===_||"select"===_||"option"===_){const t=e,n=Xi(t),r=zi(t,Yi(_),n),o=t.checked;if("submit"!==n&&"button"!==n&&r){const e=ba(t,y,b,v,w,Gi({type:n,tagName:Yi(_),maskInputOptions:s}));k.value=ji({isMasked:e,element:t,value:r,maskInputFn:c})}o&&(k.checked=o)}if("option"===_&&(e.selected&&!s.select?k.selected=!0:delete k.selected),"canvas"===_&&h)if("2d"===e.__context)(function(e){const t=e.getContext("2d");if(!t)return!0;for(let n=0;n<e.width;n+=50)for(let r=0;r<e.height;r+=50){const o=t.getImageData,i=qi in o?o[qi]:o;if(new Uint32Array(i.call(t,n,r,Math.min(50,e.width-n),Math.min(50,e.height-r)).data.buffer).some((e=>0!==e)))return!1}return!0})(e)||(k.rr_dataURL=e.toDataURL(u.type,u.quality));else if(!("__context"in e)){const t=e.toDataURL(u.type,u.quality),n=document.createElement("canvas");n.width=e.width,n.height=e.height,t!==n.toDataURL(u.type,u.quality)&&(k.rr_dataURL=t)}if("img"===_&&d){oa||(oa=n.createElement("canvas"),ia=oa.getContext("2d"));const t=e,r=t.crossOrigin;t.crossOrigin="anonymous";const o=()=>{t.removeEventListener("load",o);try{oa.width=t.naturalWidth,oa.height=t.naturalHeight,ia.drawImage(t,0,0),k.rr_dataURL=oa.toDataURL(u.type,u.quality)}catch(e){console.warn(`Cannot inline img src=${t.currentSrc}! Error: ${e}`)}r?k.crossOrigin=r:t.removeAttribute("crossorigin")};t.complete&&0!==t.naturalWidth?o():t.addEventListener("load",o)}if("audio"!==_&&"video"!==_||(k.rr_mediaState=e.paused?"paused":"played",k.rr_mediaCurrentTime=e.currentTime),p||(e.scrollLeft&&(k.rr_scrollLeft=e.scrollLeft),e.scrollTop&&(k.rr_scrollTop=e.scrollTop)),C){const{width:t,height:n}=e.getBoundingClientRect();k={class:k.class,rr_width:`${t}px`,rr_height:`${n}px`}}let E;"iframe"!==_||m(k.src)||(C||e.contentDocument||(k.rr_src=k.src),delete k.src);try{customElements.get(_)&&(E=!0)}catch(e){}return{type:Bi.Element,tagName:_,attributes:k,childNodes:[],isSVG:(S=e,Boolean("svg"===S.tagName||S.ownerSVGElement)||void 0),needBlock:C,rootId:f,isCustom:E};var S}(e,{doc:n,blockClass:o,blockSelector:i,unblockSelector:a,inlineStylesheet:m,maskAttributeFn:l,maskInputOptions:p,maskInputFn:g,dataURLOptions:y,inlineImages:v,recordCanvas:b,keepIframeSrcFn:w,newlyAddedElement:C,rootId:_,maskAllText:s,maskTextClass:c,unmaskTextClass:u,maskTextSelector:d,unmaskTextSelector:h});case e.TEXT_NODE:return function(e,t){const{maskAllText:n,maskTextClass:r,unmaskTextClass:o,maskTextSelector:i,unmaskTextSelector:a,maskTextFn:s,maskInputOptions:l,maskInputFn:c,rootId:u}=t,d=e.parentNode&&e.parentNode.tagName;let h=e.textContent;const m="STYLE"===d||void 0,p="SCRIPT"===d||void 0,f="TEXTAREA"===d||void 0;if(m&&h){try{e.nextSibling||e.previousSibling||Pi([e,"access",e=>e.parentNode,"access",e=>e.sheet,"optionalAccess",e=>e.cssRules])&&(h=Fi(e.parentNode.sheet))}catch(t){console.warn(`Cannot get CSS styles from text's parentNode. Error: ${t}`,e)}h=ua(h,pa())}p&&(h="SCRIPT_PLACEHOLDER");const g=ba(e,r,i,o,a,n);return m||p||f||!h||!g||(h=s?s(h,e.parentElement):h.replace(/[\S]/g,"*")),f&&h&&(l.textarea||g)&&(h=c?c(h,e.parentNode):h.replace(/[\S]/g,"*")),"OPTION"===d&&h&&(h=ji({isMasked:ba(e,r,i,o,a,Gi({type:null,tagName:d,maskInputOptions:l})),element:e,value:h,maskInputFn:c})),{type:Bi.Text,textContent:h||"",isStyle:m,rootId:u}}(e,{maskAllText:s,maskTextClass:c,unmaskTextClass:u,maskTextSelector:d,unmaskTextSelector:h,maskTextFn:f,maskInputOptions:p,maskInputFn:g,rootId:_});case e.CDATA_SECTION_NODE:return{type:Bi.CDATA,textContent:"",rootId:_};case e.COMMENT_NODE:return{type:Bi.Comment,textContent:e.textContent||"",rootId:_};default:return!1}}(e,{doc:n,mirror:r,blockClass:o,blockSelector:i,maskAllText:s,unblockSelector:a,maskTextClass:l,unmaskTextClass:c,maskTextSelector:u,unmaskTextSelector:d,inlineStylesheet:m,maskInputOptions:p,maskAttributeFn:f,maskTextFn:g,maskInputFn:y,dataURLOptions:b,inlineImages:w,recordCanvas:C,keepIframeSrcFn:D,newlyAddedElement:M});if(!N)return console.warn(e,"not serialized"),null;let I;I=r.hasNode(e)?r.getId(e):!function(e,t){if(t.comment&&e.type===Bi.Comment)return!0;if(e.type===Bi.Element){if(t.script&&("script"===e.tagName||"link"===e.tagName&&("preload"===e.attributes.rel||"modulepreload"===e.attributes.rel)&&"script"===e.attributes.as||"link"===e.tagName&&"prefetch"===e.attributes.rel&&"string"==typeof e.attributes.href&&"js"===Vi(e.attributes.href)))return!0;if(t.headFavicon&&("link"===e.tagName&&"shortcut icon"===e.attributes.rel||"meta"===e.tagName&&(wa(e.attributes.name).match(/^msapplication-tile(image|color)$/)||"application-name"===wa(e.attributes.name)||"icon"===wa(e.attributes.rel)||"apple-touch-icon"===wa(e.attributes.rel)||"shortcut icon"===wa(e.attributes.rel))))return!0;if("meta"===e.tagName){if(t.headMetaDescKeywords&&wa(e.attributes.name).match(/^description|keywords$/))return!0;if(t.headMetaSocial&&(wa(e.attributes.property).match(/^(og|twitter|fb):/)||wa(e.attributes.name).match(/^(og|twitter):/)||"pinterest"===wa(e.attributes.name)))return!0;if(t.headMetaRobots&&("robots"===wa(e.attributes.name)||"googlebot"===wa(e.attributes.name)||"bingbot"===wa(e.attributes.name)))return!0;if(t.headMetaHttpEquiv&&void 0!==e.attributes["http-equiv"])return!0;if(t.headMetaAuthorship&&("author"===wa(e.attributes.name)||"generator"===wa(e.attributes.name)||"framework"===wa(e.attributes.name)||"publisher"===wa(e.attributes.name)||"progid"===wa(e.attributes.name)||wa(e.attributes.property).match(/^article:/)||wa(e.attributes.property).match(/^product:/)))return!0;if(t.headMetaVerification&&("google-site-verification"===wa(e.attributes.name)||"yandex-verification"===wa(e.attributes.name)||"csrf-token"===wa(e.attributes.name)||"p:domain_verify"===wa(e.attributes.name)||"verify-v1"===wa(e.attributes.name)||"verification"===wa(e.attributes.name)||"shopify-checkout-api-token"===wa(e.attributes.name)))return!0}}return!1}(N,v)&&(x||N.type!==Bi.Text||N.isStyle||N.textContent.replace(/^\s+|\s+$/gm,"").length)?ra():na;const R=Object.assign(N,{id:I});if(r.add(e,R),I===na)return null;_&&_(e);let L=!h;if(R.type===Bi.Element){L=L&&!R.needBlock,delete R.needBlock;const t=e.shadowRoot;t&&$i(t)&&(R.isShadowHost=!0)}if((R.type===Bi.Document||R.type===Bi.Element)&&L){v.headWhitespace&&R.type===Bi.Element&&"head"===R.tagName&&(x=!1);const t={doc:n,mirror:r,blockClass:o,blockSelector:i,maskAllText:s,unblockSelector:a,maskTextClass:l,unmaskTextClass:c,maskTextSelector:u,unmaskTextSelector:d,skipChild:h,inlineStylesheet:m,maskInputOptions:p,maskAttributeFn:f,maskTextFn:g,maskInputFn:y,slimDOMOptions:v,dataURLOptions:b,inlineImages:w,recordCanvas:C,preserveWhiteSpace:x,onSerialize:_,onIframeLoad:k,iframeLoadTimeout:A,onStylesheetLoad:E,stylesheetLoadTimeout:S,keepIframeSrcFn:D};for(const n of Array.from(e.childNodes)){const e=Ca(n,t);e&&R.childNodes.push(e)}if(function(e){return e.nodeType===e.ELEMENT_NODE}(e)&&e.shadowRoot)for(const n of Array.from(e.shadowRoot.childNodes)){const r=Ca(n,t);r&&($i(e.shadowRoot)&&(r.isShadow=!0),R.childNodes.push(r))}}return e.parentNode&&Oi(e.parentNode)&&$i(e.parentNode)&&(R.isShadow=!0),R.type===Bi.Element&&"iframe"===R.tagName&&function(e,t,n){const r=e.contentWindow;if(!r)return;let o,i=!1;try{o=r.document.readyState}catch(e){return}if("complete"!==o){const r=Ji((()=>{i||(t(),i=!0)}),n);return void e.addEventListener("load",(()=>{Qi(r),i=!0,t()}))}const a="about:blank";if(r.location.href!==a||e.src===a||""===e.src)return Ji(t,0),e.addEventListener("load",t);e.addEventListener("load",t)}(e,(()=>{const t=e.contentDocument;if(t&&k){const n=Ca(t,{doc:t,mirror:r,blockClass:o,blockSelector:i,unblockSelector:a,maskAllText:s,maskTextClass:l,unmaskTextClass:c,maskTextSelector:u,unmaskTextSelector:d,skipChild:!1,inlineStylesheet:m,maskInputOptions:p,maskAttributeFn:f,maskTextFn:g,maskInputFn:y,slimDOMOptions:v,dataURLOptions:b,inlineImages:w,recordCanvas:C,preserveWhiteSpace:x,onSerialize:_,onIframeLoad:k,iframeLoadTimeout:A,onStylesheetLoad:E,stylesheetLoadTimeout:S,keepIframeSrcFn:D});n&&k(e,n)}}),A),R.type===Bi.Element&&"link"===R.tagName&&"string"==typeof R.attributes.rel&&("stylesheet"===R.attributes.rel||"preload"===R.attributes.rel&&"string"==typeof R.attributes.href&&"css"===Vi(R.attributes.href))&&function(e,t,n){let r,o=!1;try{r=e.sheet}catch(e){return}if(r)return;const i=Ji((()=>{o||(t(),o=!0)}),n);e.addEventListener("load",(()=>{Qi(i),o=!0,t()}))}(e,(()=>{if(E){const t=Ca(e,{doc:n,mirror:r,blockClass:o,blockSelector:i,unblockSelector:a,maskAllText:s,maskTextClass:l,unmaskTextClass:c,maskTextSelector:u,unmaskTextSelector:d,skipChild:!1,inlineStylesheet:m,maskInputOptions:p,maskAttributeFn:f,maskTextFn:g,maskInputFn:y,slimDOMOptions:v,dataURLOptions:b,inlineImages:w,recordCanvas:C,preserveWhiteSpace:x,onSerialize:_,onIframeLoad:k,iframeLoadTimeout:A,onStylesheetLoad:E,stylesheetLoadTimeout:S,keepIframeSrcFn:D});t&&E(e,t)}}),S),R}function _a(e){let t,n=e[0],r=1;for(;r<e.length;){const o=e[r],i=e[r+1];if(r+=2,("optionalAccess"===o||"optionalCall"===o)&&null==n)return;"access"===o||"optionalAccess"===o?(t=n,n=i(n)):"call"!==o&&"optionalCall"!==o||(n=i(((...e)=>n.call(t,...e))),t=void 0)}return n}function ka(e,t,n=document){const r={capture:!0,passive:!0};return n.addEventListener(e,t,r),()=>n.removeEventListener(e,t,r)}const Aa="Please stop import mirror directly. Instead of that,\r\nnow you can use replayer.getMirror() to access the mirror instance of a replayer,\r\nor you can use record.mirror to access the mirror instance during recording.";let Ea={map:{},getId:()=>(console.error(Aa),-1),getNode:()=>(console.error(Aa),null),removeNodeFromMap(){console.error(Aa)},has:()=>(console.error(Aa),!1),reset(){console.error(Aa)}};function Sa(e,t,n={}){let r=null,o=0;return function(...i){const a=Date.now();o||!1!==n.leading||(o=a);const s=t-(a-o),l=this;s<=0||s>t?(r&&(function(...e){Ya("clearTimeout")(...e)}(r),r=null),o=a,e.apply(l,i)):r||!1===n.trailing||(r=qa((()=>{o=!1===n.leading?0:Date.now(),r=null,e.apply(l,i)}),s))}}function Da(e,t,n,r,o=window){const i=o.Object.getOwnPropertyDescriptor(e,t);return o.Object.defineProperty(e,t,r?n:{set(e){qa((()=>{n.set.call(this,e)}),0),i&&i.set&&i.set.call(this,e)}}),()=>Da(e,t,i||{},!0)}function Ma(e,t,n){try{if(!(t in e))return()=>{};const r=e[t],o=n(r);return"function"==typeof o&&(o.prototype=o.prototype||{},Object.defineProperties(o,{__rrweb_original__:{enumerable:!1,value:r}})),e[t]=o,()=>{e[t]=r}}catch(e){return()=>{}}}"undefined"!=typeof window&&window.Proxy&&window.Reflect&&(Ea=new Proxy(Ea,{get:(e,t,n)=>("map"===t&&console.error(Aa),Reflect.get(e,t,n))}));let xa=Date.now;function Na(e){const t=e.document;return{left:t.scrollingElement?t.scrollingElement.scrollLeft:void 0!==e.pageXOffset?e.pageXOffset:_a([t,"optionalAccess",e=>e.documentElement,"access",e=>e.scrollLeft])||_a([t,"optionalAccess",e=>e.body,"optionalAccess",e=>e.parentElement,"optionalAccess",e=>e.scrollLeft])||_a([t,"optionalAccess",e=>e.body,"optionalAccess",e=>e.scrollLeft])||0,top:t.scrollingElement?t.scrollingElement.scrollTop:void 0!==e.pageYOffset?e.pageYOffset:_a([t,"optionalAccess",e=>e.documentElement,"access",e=>e.scrollTop])||_a([t,"optionalAccess",e=>e.body,"optionalAccess",e=>e.parentElement,"optionalAccess",e=>e.scrollTop])||_a([t,"optionalAccess",e=>e.body,"optionalAccess",e=>e.scrollTop])||0}}function Ia(){return window.innerHeight||document.documentElement&&document.documentElement.clientHeight||document.body&&document.body.clientHeight}function Ra(){return window.innerWidth||document.documentElement&&document.documentElement.clientWidth||document.body&&document.body.clientWidth}function La(e){return e?e.nodeType===e.ELEMENT_NODE?e:e.parentElement:null}function Ta(e,t,n,r,o){if(!e)return!1;const i=La(e);if(!i)return!1;const a=va(t,n);if(!o){const e=r&&i.matches(r);return a(i)&&!e}const s=ya(i,a);let l=-1;return!(s<0)&&(r&&(l=ya(i,va(null,r))),s>-1&&l<0||s<l)}function Pa(e,t){return t.getId(e)===na}function Ba(e,t){if(Oi(e))return!1;const n=t.getId(e);return!t.has(n)||(!e.parentNode||e.parentNode.nodeType!==e.DOCUMENT_NODE)&&(!e.parentNode||Ba(e.parentNode,t))}function Oa(e){return Boolean(e.changedTouches)}function $a(e,t){return Boolean("IFRAME"===e.nodeName&&t.getMeta(e))}function Fa(e,t){return Boolean("LINK"===e.nodeName&&e.nodeType===e.ELEMENT_NODE&&e.getAttribute&&"stylesheet"===e.getAttribute("rel")&&t.getMeta(e))}function Ha(e){return Boolean(_a([e,"optionalAccess",e=>e.shadowRoot]))}/[1-9][0-9]{12}/.test(Date.now().toString())||(xa=()=>(new Date).getTime());class Wa{constructor(){this.id=1,this.styleIDMap=new WeakMap,this.idStyleMap=new Map}getId(e){return()=>-1,null!=(t=this.styleIDMap.get(e))?t:-1;var t}has(e){return this.styleIDMap.has(e)}add(e,t){if(this.has(e))return this.getId(e);let n;return n=void 0===t?this.id++:t,this.styleIDMap.set(e,n),this.idStyleMap.set(n,e),n}getStyle(e){return this.idStyleMap.get(e)||null}reset(){this.styleIDMap=new WeakMap,this.idStyleMap=new Map,this.id=1}generateId(){return this.id++}}function Ga(e){let t=null;return _a([e,"access",e=>e.getRootNode,"optionalCall",e=>e(),"optionalAccess",e=>e.nodeType])===Node.DOCUMENT_FRAGMENT_NODE&&e.getRootNode().host&&(t=e.getRootNode().host),t}function ja(e){const t=e.ownerDocument;return!!t&&(t.contains(e)||function(e){const t=e.ownerDocument;if(!t)return!1;const n=function(e){let t,n=e;for(;t=Ga(n);)n=t;return n}(e);return t.contains(n)}(e))}const Ua={};function Ya(e){const t=Ua[e];if(t)return t;const n=window.document;let r=window[e];if(n&&"function"==typeof n.createElement)try{const t=n.createElement("iframe");t.hidden=!0,n.head.appendChild(t);const o=t.contentWindow;o&&o[e]&&(r=o[e]),n.head.removeChild(t)}catch(e){}return Ua[e]=r.bind(window)}function qa(...e){return Ya("setTimeout")(...e)}var Xa=(e=>(e[e.DomContentLoaded=0]="DomContentLoaded",e[e.Load=1]="Load",e[e.FullSnapshot=2]="FullSnapshot",e[e.IncrementalSnapshot=3]="IncrementalSnapshot",e[e.Meta=4]="Meta",e[e.Custom=5]="Custom",e[e.Plugin=6]="Plugin",e))(Xa||{}),za=(e=>(e[e.Mutation=0]="Mutation",e[e.MouseMove=1]="MouseMove",e[e.MouseInteraction=2]="MouseInteraction",e[e.Scroll=3]="Scroll",e[e.ViewportResize=4]="ViewportResize",e[e.Input=5]="Input",e[e.TouchMove=6]="TouchMove",e[e.MediaInteraction=7]="MediaInteraction",e[e.StyleSheetRule=8]="StyleSheetRule",e[e.CanvasMutation=9]="CanvasMutation",e[e.Font=10]="Font",e[e.Log=11]="Log",e[e.Drag=12]="Drag",e[e.StyleDeclaration=13]="StyleDeclaration",e[e.Selection=14]="Selection",e[e.AdoptedStyleSheet=15]="AdoptedStyleSheet",e[e.CustomElement=16]="CustomElement",e))(za||{}),Va=(e=>(e[e.MouseUp=0]="MouseUp",e[e.MouseDown=1]="MouseDown",e[e.Click=2]="Click",e[e.ContextMenu=3]="ContextMenu",e[e.DblClick=4]="DblClick",e[e.Focus=5]="Focus",e[e.Blur=6]="Blur",e[e.TouchStart=7]="TouchStart",e[e.TouchMove_Departed=8]="TouchMove_Departed",e[e.TouchEnd=9]="TouchEnd",e[e.TouchCancel=10]="TouchCancel",e))(Va||{}),Za=(e=>(e[e.Mouse=0]="Mouse",e[e.Pen=1]="Pen",e[e.Touch=2]="Touch",e))(Za||{});function Ka(e){let t,n=e[0],r=1;for(;r<e.length;){const o=e[r],i=e[r+1];if(r+=2,("optionalAccess"===o||"optionalCall"===o)&&null==n)return;"access"===o||"optionalAccess"===o?(t=n,n=i(n)):"call"!==o&&"optionalCall"!==o||(n=i(((...e)=>n.call(t,...e))),t=void 0)}return n}function Ja(e){return"__ln"in e}class Qa{constructor(){this.length=0,this.head=null,this.tail=null}get(e){if(e>=this.length)throw new Error("Position outside of list range");let t=this.head;for(let n=0;n<e;n++)t=Ka([t,"optionalAccess",e=>e.next])||null;return t}addNode(e){const t={value:e,previous:null,next:null};if(e.__ln=t,e.previousSibling&&Ja(e.previousSibling)){const n=e.previousSibling.__ln.next;t.next=n,t.previous=e.previousSibling.__ln,e.previousSibling.__ln.next=t,n&&(n.previous=t)}else if(e.nextSibling&&Ja(e.nextSibling)&&e.nextSibling.__ln.previous){const n=e.nextSibling.__ln.previous;t.previous=n,t.next=e.nextSibling.__ln,e.nextSibling.__ln.previous=t,n&&(n.next=t)}else this.head&&(this.head.previous=t),t.next=this.head,this.head=t;null===t.next&&(this.tail=t),this.length++}removeNode(e){const t=e.__ln;this.head&&(t.previous?(t.previous.next=t.next,t.next?t.next.previous=t.previous:this.tail=t.previous):(this.head=t.next,this.head?this.head.previous=null:this.tail=null),e.__ln&&delete e.__ln,this.length--)}}const es=(e,t)=>`${e}@${t}`;class ts{constructor(){this.frozen=!1,this.locked=!1,this.texts=[],this.attributes=[],this.attributeMap=new WeakMap,this.removes=[],this.mapRemoves=[],this.movedMap={},this.addedSet=new Set,this.movedSet=new Set,this.droppedSet=new Set,this.processMutations=e=>{e.forEach(this.processMutation),this.emit()},this.emit=()=>{if(this.frozen||this.locked)return;const e=[],t=new Set,n=new Qa,r=e=>{let t=e,n=na;for(;n===na;)t=t&&t.nextSibling,n=t&&this.mirror.getId(t);return n},o=o=>{if(!o.parentNode||!ja(o))return;const i=Oi(o.parentNode)?this.mirror.getId(Ga(o)):this.mirror.getId(o.parentNode),a=r(o);if(-1===i||-1===a)return n.addNode(o);const s=Ca(o,{doc:this.doc,mirror:this.mirror,blockClass:this.blockClass,blockSelector:this.blockSelector,maskAllText:this.maskAllText,unblockSelector:this.unblockSelector,maskTextClass:this.maskTextClass,unmaskTextClass:this.unmaskTextClass,maskTextSelector:this.maskTextSelector,unmaskTextSelector:this.unmaskTextSelector,skipChild:!0,newlyAddedElement:!0,inlineStylesheet:this.inlineStylesheet,maskInputOptions:this.maskInputOptions,maskAttributeFn:this.maskAttributeFn,maskTextFn:this.maskTextFn,maskInputFn:this.maskInputFn,slimDOMOptions:this.slimDOMOptions,dataURLOptions:this.dataURLOptions,recordCanvas:this.recordCanvas,inlineImages:this.inlineImages,onSerialize:e=>{$a(e,this.mirror)&&this.iframeManager.addIframe(e),Fa(e,this.mirror)&&this.stylesheetManager.trackLinkElement(e),Ha(o)&&this.shadowDomManager.addShadowRoot(o.shadowRoot,this.doc)},onIframeLoad:(e,t)=>{this.iframeManager.attachIframe(e,t),e.contentWindow&&this.canvasManager.addWindow(e.contentWindow),this.shadowDomManager.observeAttachShadow(e)},onStylesheetLoad:(e,t)=>{this.stylesheetManager.attachLinkElement(e,t)}});s&&(e.push({parentId:i,nextId:a,node:s}),t.add(s.id))};for(;this.mapRemoves.length;)this.mirror.removeNodeFromMap(this.mapRemoves.shift());for(const e of this.movedSet)rs(this.removes,e,this.mirror)&&!this.movedSet.has(e.parentNode)||o(e);for(const e of this.addedSet)is(this.droppedSet,e)||rs(this.removes,e,this.mirror)?is(this.movedSet,e)?o(e):this.droppedSet.add(e):o(e);let i=null;for(;n.length;){let e=null;if(i){const t=this.mirror.getId(i.value.parentNode),n=r(i.value);-1!==t&&-1!==n&&(e=i)}if(!e){let t=n.tail;for(;t;){const n=t;if(t=t.previous,n){const t=this.mirror.getId(n.value.parentNode);if(-1===r(n.value))continue;if(-1!==t){e=n;break}{const t=n.value;if(t.parentNode&&t.parentNode.nodeType===Node.DOCUMENT_FRAGMENT_NODE){const r=t.parentNode.host;if(-1!==this.mirror.getId(r)){e=n;break}}}}}}if(!e){for(;n.head;)n.removeNode(n.head.value);break}i=e.previous,n.removeNode(e.value),o(e.value)}const a={texts:this.texts.map((e=>({id:this.mirror.getId(e.node),value:e.value}))).filter((e=>!t.has(e.id))).filter((e=>this.mirror.has(e.id))),attributes:this.attributes.map((e=>{const{attributes:t}=e;if("string"==typeof t.style){const n=JSON.stringify(e.styleDiff),r=JSON.stringify(e._unchangedStyles);n.length<t.style.length&&(n+r).split("var(").length===t.style.split("var(").length&&(t.style=e.styleDiff)}return{id:this.mirror.getId(e.node),attributes:t}})).filter((e=>!t.has(e.id))).filter((e=>this.mirror.has(e.id))),removes:this.removes,adds:e};(a.texts.length||a.attributes.length||a.removes.length||a.adds.length)&&(this.texts=[],this.attributes=[],this.attributeMap=new WeakMap,this.removes=[],this.addedSet=new Set,this.movedSet=new Set,this.droppedSet=new Set,this.movedMap={},this.mutationCb(a))},this.processMutation=e=>{if(!Pa(e.target,this.mirror))switch(e.type){case"characterData":{const t=e.target.textContent;Ta(e.target,this.blockClass,this.blockSelector,this.unblockSelector,!1)||t===e.oldValue||this.texts.push({value:ba(e.target,this.maskTextClass,this.maskTextSelector,this.unmaskTextClass,this.unmaskTextSelector,this.maskAllText)&&t?this.maskTextFn?this.maskTextFn(t,La(e.target)):t.replace(/[\S]/g,"*"):t,node:e.target});break}case"attributes":{const t=e.target;let n=e.attributeName,r=e.target.getAttribute(n);if("value"===n){const n=Xi(t),o=t.tagName;r=zi(t,o,n);const i=Gi({maskInputOptions:this.maskInputOptions,tagName:o,type:n});r=ji({isMasked:ba(e.target,this.maskTextClass,this.maskTextSelector,this.unmaskTextClass,this.unmaskTextSelector,i),element:t,value:r,maskInputFn:this.maskInputFn})}if(Ta(e.target,this.blockClass,this.blockSelector,this.unblockSelector,!1)||r===e.oldValue)return;let o=this.attributeMap.get(e.target);if("IFRAME"===t.tagName&&"src"===n&&!this.keepIframeSrcFn(r)){if(t.contentDocument)return;n="rr_src"}if(o||(o={node:e.target,attributes:{},styleDiff:{},_unchangedStyles:{}},this.attributes.push(o),this.attributeMap.set(e.target,o)),"type"===n&&"INPUT"===t.tagName&&"password"===(e.oldValue||"").toLowerCase()&&t.setAttribute("data-rr-is-password","true"),!ga(t.tagName,n)&&(o.attributes[n]=fa(this.doc,Ui(t.tagName),Ui(n),r,t,this.maskAttributeFn),"style"===n)){if(!this.unattachedDoc)try{this.unattachedDoc=document.implementation.createHTMLDocument()}catch(e){this.unattachedDoc=this.doc}const n=this.unattachedDoc.createElement("span");e.oldValue&&n.setAttribute("style",e.oldValue);for(const e of Array.from(t.style)){const r=t.style.getPropertyValue(e),i=t.style.getPropertyPriority(e);r!==n.style.getPropertyValue(e)||i!==n.style.getPropertyPriority(e)?o.styleDiff[e]=""===i?r:[r,i]:o._unchangedStyles[e]=[r,i]}for(const e of Array.from(n.style))""===t.style.getPropertyValue(e)&&(o.styleDiff[e]=!1)}break}case"childList":if(Ta(e.target,this.blockClass,this.blockSelector,this.unblockSelector,!0))return;e.addedNodes.forEach((t=>this.genAdds(t,e.target))),e.removedNodes.forEach((t=>{const n=this.mirror.getId(t),r=Oi(e.target)?this.mirror.getId(e.target.host):this.mirror.getId(e.target);Ta(e.target,this.blockClass,this.blockSelector,this.unblockSelector,!1)||Pa(t,this.mirror)||!function(e,t){return-1!==t.getId(e)}(t,this.mirror)||(this.addedSet.has(t)?(ns(this.addedSet,t),this.droppedSet.add(t)):this.addedSet.has(e.target)&&-1===n||Ba(e.target,this.mirror)||(this.movedSet.has(t)&&this.movedMap[es(n,r)]?ns(this.movedSet,t):this.removes.push({parentId:r,id:n,isShadow:!(!Oi(e.target)||!$i(e.target))||void 0})),this.mapRemoves.push(t))}))}},this.genAdds=(e,t)=>{if(!this.processedNodeManager.inOtherBuffer(e,this)&&!this.addedSet.has(e)&&!this.movedSet.has(e)){if(this.mirror.hasNode(e)){if(Pa(e,this.mirror))return;this.movedSet.add(e);let n=null;t&&this.mirror.hasNode(t)&&(n=this.mirror.getId(t)),n&&-1!==n&&(this.movedMap[es(this.mirror.getId(e),n)]=!0)}else this.addedSet.add(e),this.droppedSet.delete(e);Ta(e,this.blockClass,this.blockSelector,this.unblockSelector,!1)||(e.childNodes.forEach((e=>this.genAdds(e))),Ha(e)&&e.shadowRoot.childNodes.forEach((t=>{this.processedNodeManager.add(t,this),this.genAdds(t,e)})))}}}init(e){["mutationCb","blockClass","blockSelector","unblockSelector","maskAllText","maskTextClass","unmaskTextClass","maskTextSelector","unmaskTextSelector","inlineStylesheet","maskInputOptions","maskAttributeFn","maskTextFn","maskInputFn","keepIframeSrcFn","recordCanvas","inlineImages","slimDOMOptions","dataURLOptions","doc","mirror","iframeManager","stylesheetManager","shadowDomManager","canvasManager","processedNodeManager"].forEach((t=>{this[t]=e[t]}))}freeze(){this.frozen=!0,this.canvasManager.freeze()}unfreeze(){this.frozen=!1,this.canvasManager.unfreeze(),this.emit()}isFrozen(){return this.frozen}lock(){this.locked=!0,this.canvasManager.lock()}unlock(){this.locked=!1,this.canvasManager.unlock(),this.emit()}reset(){this.shadowDomManager.reset(),this.canvasManager.reset()}}function ns(e,t){e.delete(t),t.childNodes.forEach((t=>ns(e,t)))}function rs(e,t,n){return 0!==e.length&&os(e,t,n)}function os(e,t,n){const{parentNode:r}=t;if(!r)return!1;const o=n.getId(r);return!!e.some((e=>e.id===o))||os(e,r,n)}function is(e,t){return 0!==e.size&&as(e,t)}function as(e,t){const{parentNode:n}=t;return!!n&&(!!e.has(n)||as(e,n))}let ss;function ls(e){ss=e}function cs(){ss=void 0}const us=e=>ss?(...t)=>{try{return e(...t)}catch(e){if(ss&&!0===ss(e))return()=>{};throw e}}:e;function ds(e){let t,n=e[0],r=1;for(;r<e.length;){const o=e[r],i=e[r+1];if(r+=2,("optionalAccess"===o||"optionalCall"===o)&&null==n)return;"access"===o||"optionalAccess"===o?(t=n,n=i(n)):"call"!==o&&"optionalCall"!==o||(n=i(((...e)=>n.call(t,...e))),t=void 0)}return n}const hs=[];function ms(e){try{if("composedPath"in e){const t=e.composedPath();if(t.length)return t[0]}else if("path"in e&&e.path.length)return e.path[0]}catch(e){}return e&&e.target}function ps(e,t){const n=new ts;hs.push(n),n.init(e);let r=window.MutationObserver||window.__rrMutationObserver;const o=ds([window,"optionalAccess",e=>e.Zone,"optionalAccess",e=>e.__symbol__,"optionalCall",e=>e("MutationObserver")]);o&&window[o]&&(r=window[o]);const i=new r(us((t=>{e.onMutation&&!1===e.onMutation(t)||n.processMutations.bind(n)(t)})));return i.observe(t,{attributes:!0,attributeOldValue:!0,characterData:!0,characterDataOldValue:!0,childList:!0,subtree:!0}),i}function fs({scrollCb:e,doc:t,mirror:n,blockClass:r,blockSelector:o,unblockSelector:i,sampling:a}){return ka("scroll",us(Sa(us((a=>{const s=ms(a);if(!s||Ta(s,r,o,i,!0))return;const l=n.getId(s);if(s===t&&t.defaultView){const n=Na(t.defaultView);e({id:l,x:n.left,y:n.top})}else e({id:l,x:s.scrollLeft,y:s.scrollTop})})),a.scroll||100)),t)}const gs=["INPUT","TEXTAREA","SELECT"],ys=new WeakMap;function vs({inputCb:e,doc:t,mirror:n,blockClass:r,blockSelector:o,unblockSelector:i,ignoreClass:a,ignoreSelector:s,maskInputOptions:l,maskInputFn:c,sampling:u,userTriggeredOnInput:d,maskTextClass:h,unmaskTextClass:m,maskTextSelector:p,unmaskTextSelector:f}){function g(e){let n=ms(e);const u=e.isTrusted,g=n&&Yi(n.tagName);if("OPTION"===g&&(n=n.parentElement),!n||!g||gs.indexOf(g)<0||Ta(n,r,o,i,!0))return;const v=n;if(v.classList.contains(a)||s&&v.matches(s))return;const b=Xi(n);let w=zi(v,g,b),C=!1;const _=Gi({maskInputOptions:l,tagName:g,type:b}),k=ba(n,h,p,m,f,_);"radio"!==b&&"checkbox"!==b||(C=n.checked),w=ji({isMasked:k,element:n,value:w,maskInputFn:c}),y(n,d?{text:w,isChecked:C,userTriggered:u}:{text:w,isChecked:C});const A=n.name;"radio"===b&&A&&C&&t.querySelectorAll(`input[type="radio"][name="${A}"]`).forEach((e=>{if(e!==n){const t=ji({isMasked:k,element:e,value:zi(e,g,b),maskInputFn:c});y(e,d?{text:t,isChecked:!C,userTriggered:!1}:{text:t,isChecked:!C})}}))}function y(t,r){const o=ys.get(t);if(!o||o.text!==r.text||o.isChecked!==r.isChecked){ys.set(t,r);const o=n.getId(t);us(e)({...r,id:o})}}const v=("last"===u.input?["change"]:["input","change"]).map((e=>ka(e,us(g),t))),b=t.defaultView;if(!b)return()=>{v.forEach((e=>e()))};const w=b.Object.getOwnPropertyDescriptor(b.HTMLInputElement.prototype,"value"),C=[[b.HTMLInputElement.prototype,"value"],[b.HTMLInputElement.prototype,"checked"],[b.HTMLSelectElement.prototype,"value"],[b.HTMLTextAreaElement.prototype,"value"],[b.HTMLSelectElement.prototype,"selectedIndex"],[b.HTMLOptionElement.prototype,"selected"]];return w&&w.set&&v.push(...C.map((e=>Da(e[0],e[1],{set(){us(g)({target:this,isTrusted:!1})}},!1,b)))),us((()=>{v.forEach((e=>e()))}))}function bs(e){return function(e,t){if(ks("CSSGroupingRule")&&e.parentRule instanceof CSSGroupingRule||ks("CSSMediaRule")&&e.parentRule instanceof CSSMediaRule||ks("CSSSupportsRule")&&e.parentRule instanceof CSSSupportsRule||ks("CSSConditionRule")&&e.parentRule instanceof CSSConditionRule){const n=Array.from(e.parentRule.cssRules).indexOf(e);t.unshift(n)}else if(e.parentStyleSheet){const n=Array.from(e.parentStyleSheet.cssRules).indexOf(e);t.unshift(n)}return t}(e,[])}function ws(e,t,n){let r,o;return e?(e.ownerNode?r=t.getId(e.ownerNode):o=n.getId(e),{styleId:o,id:r}):{}}function Cs({mirror:e,stylesheetManager:t},n){let r=null;r="#document"===n.nodeName?e.getId(n):e.getId(n.host);const o="#document"===n.nodeName?ds([n,"access",e=>e.defaultView,"optionalAccess",e=>e.Document]):ds([n,"access",e=>e.ownerDocument,"optionalAccess",e=>e.defaultView,"optionalAccess",e=>e.ShadowRoot]),i=ds([o,"optionalAccess",e=>e.prototype])?Object.getOwnPropertyDescriptor(ds([o,"optionalAccess",e=>e.prototype]),"adoptedStyleSheets"):void 0;return null!==r&&-1!==r&&o&&i?(Object.defineProperty(n,"adoptedStyleSheets",{configurable:i.configurable,enumerable:i.enumerable,get(){return ds([i,"access",e=>e.get,"optionalAccess",e=>e.call,"call",e=>e(this)])},set(e){const n=ds([i,"access",e=>e.set,"optionalAccess",e=>e.call,"call",t=>t(this,e)]);if(null!==r&&-1!==r)try{t.adoptStyleSheets(e,r)}catch(e){}return n}}),us((()=>{Object.defineProperty(n,"adoptedStyleSheets",{configurable:i.configurable,enumerable:i.enumerable,get:i.get,set:i.set})}))):()=>{}}function _s(e,t={}){const n=e.doc.defaultView;if(!n)return()=>{};let r;e.recordDOM&&(r=ps(e,e.doc));const o=function({mousemoveCb:e,sampling:t,doc:n,mirror:r}){if(!1===t.mousemove)return()=>{};const o="number"==typeof t.mousemove?t.mousemove:50,i="number"==typeof t.mousemoveCallback?t.mousemoveCallback:500;let a,s=[];const l=Sa(us((t=>{const n=Date.now()-a;e(s.map((e=>(e.timeOffset-=n,e))),t),s=[],a=null})),i),c=us(Sa(us((e=>{const t=ms(e),{clientX:n,clientY:o}=Oa(e)?e.changedTouches[0]:e;a||(a=xa()),s.push({x:n,y:o,id:r.getId(t),timeOffset:xa()-a}),l("undefined"!=typeof DragEvent&&e instanceof DragEvent?za.Drag:e instanceof MouseEvent?za.MouseMove:za.TouchMove)})),o,{trailing:!1})),u=[ka("mousemove",c,n),ka("touchmove",c,n),ka("drag",c,n)];return us((()=>{u.forEach((e=>e()))}))}(e),i=function({mouseInteractionCb:e,doc:t,mirror:n,blockClass:r,blockSelector:o,unblockSelector:i,sampling:a}){if(!1===a.mouseInteraction)return()=>{};const s=!0===a.mouseInteraction||void 0===a.mouseInteraction?{}:a.mouseInteraction,l=[];let c=null;return Object.keys(Va).filter((e=>Number.isNaN(Number(e))&&!e.endsWith("_Departed")&&!1!==s[e])).forEach((a=>{let s=Ui(a);const u=(t=>a=>{const s=ms(a);if(Ta(s,r,o,i,!0))return;let l=null,u=t;if("pointerType"in a){switch(a.pointerType){case"mouse":l=Za.Mouse;break;case"touch":l=Za.Touch;break;case"pen":l=Za.Pen}l===Za.Touch?Va[t]===Va.MouseDown?u="TouchStart":Va[t]===Va.MouseUp&&(u="TouchEnd"):Za.Pen}else Oa(a)&&(l=Za.Touch);null!==l?(c=l,(u.startsWith("Touch")&&l===Za.Touch||u.startsWith("Mouse")&&l===Za.Mouse)&&(l=null)):Va[t]===Va.Click&&(l=c,c=null);const d=Oa(a)?a.changedTouches[0]:a;if(!d)return;const h=n.getId(s),{clientX:m,clientY:p}=d;us(e)({type:Va[u],id:h,x:m,y:p,...null!==l&&{pointerType:l}})})(a);if(window.PointerEvent)switch(Va[a]){case Va.MouseDown:case Va.MouseUp:s=s.replace("mouse","pointer");break;case Va.TouchStart:case Va.TouchEnd:return}l.push(ka(s,u,t))})),us((()=>{l.forEach((e=>e()))}))}(e),a=fs(e),s=function({viewportResizeCb:e},{win:t}){let n=-1,r=-1;return ka("resize",us(Sa(us((()=>{const t=Ia(),o=Ra();n===t&&r===o||(e({width:Number(o),height:Number(t)}),n=t,r=o)})),200)),t)}(e,{win:n}),l=vs(e),c=function({mediaInteractionCb:e,blockClass:t,blockSelector:n,unblockSelector:r,mirror:o,sampling:i,doc:a}){const s=us((a=>Sa(us((i=>{const s=ms(i);if(!s||Ta(s,t,n,r,!0))return;const{currentTime:l,volume:c,muted:u,playbackRate:d}=s;e({type:a,id:o.getId(s),currentTime:l,volume:c,muted:u,playbackRate:d})})),i.media||500))),l=[ka("play",s(0),a),ka("pause",s(1),a),ka("seeked",s(2),a),ka("volumechange",s(3),a),ka("ratechange",s(4),a)];return us((()=>{l.forEach((e=>e()))}))}(e);let u=()=>{},d=()=>{},h=()=>{},m=()=>{};e.recordDOM&&(u=function({styleSheetRuleCb:e,mirror:t,stylesheetManager:n},{win:r}){if(!r.CSSStyleSheet||!r.CSSStyleSheet.prototype)return()=>{};const o=r.CSSStyleSheet.prototype.insertRule;r.CSSStyleSheet.prototype.insertRule=new Proxy(o,{apply:us(((r,o,i)=>{const[a,s]=i,{id:l,styleId:c}=ws(o,t,n.styleMirror);return(l&&-1!==l||c&&-1!==c)&&e({id:l,styleId:c,adds:[{rule:a,index:s}]}),r.apply(o,i)}))});const i=r.CSSStyleSheet.prototype.deleteRule;let a,s;r.CSSStyleSheet.prototype.deleteRule=new Proxy(i,{apply:us(((r,o,i)=>{const[a]=i,{id:s,styleId:l}=ws(o,t,n.styleMirror);return(s&&-1!==s||l&&-1!==l)&&e({id:s,styleId:l,removes:[{index:a}]}),r.apply(o,i)}))}),r.CSSStyleSheet.prototype.replace&&(a=r.CSSStyleSheet.prototype.replace,r.CSSStyleSheet.prototype.replace=new Proxy(a,{apply:us(((r,o,i)=>{const[a]=i,{id:s,styleId:l}=ws(o,t,n.styleMirror);return(s&&-1!==s||l&&-1!==l)&&e({id:s,styleId:l,replace:a}),r.apply(o,i)}))})),r.CSSStyleSheet.prototype.replaceSync&&(s=r.CSSStyleSheet.prototype.replaceSync,r.CSSStyleSheet.prototype.replaceSync=new Proxy(s,{apply:us(((r,o,i)=>{const[a]=i,{id:s,styleId:l}=ws(o,t,n.styleMirror);return(s&&-1!==s||l&&-1!==l)&&e({id:s,styleId:l,replaceSync:a}),r.apply(o,i)}))}));const l={};As("CSSGroupingRule")?l.CSSGroupingRule=r.CSSGroupingRule:(As("CSSMediaRule")&&(l.CSSMediaRule=r.CSSMediaRule),As("CSSConditionRule")&&(l.CSSConditionRule=r.CSSConditionRule),As("CSSSupportsRule")&&(l.CSSSupportsRule=r.CSSSupportsRule));const c={};return Object.entries(l).forEach((([r,o])=>{c[r]={insertRule:o.prototype.insertRule,deleteRule:o.prototype.deleteRule},o.prototype.insertRule=new Proxy(c[r].insertRule,{apply:us(((r,o,i)=>{const[a,s]=i,{id:l,styleId:c}=ws(o.parentStyleSheet,t,n.styleMirror);return(l&&-1!==l||c&&-1!==c)&&e({id:l,styleId:c,adds:[{rule:a,index:[...bs(o),s||0]}]}),r.apply(o,i)}))}),o.prototype.deleteRule=new Proxy(c[r].deleteRule,{apply:us(((r,o,i)=>{const[a]=i,{id:s,styleId:l}=ws(o.parentStyleSheet,t,n.styleMirror);return(s&&-1!==s||l&&-1!==l)&&e({id:s,styleId:l,removes:[{index:[...bs(o),a]}]}),r.apply(o,i)}))})})),us((()=>{r.CSSStyleSheet.prototype.insertRule=o,r.CSSStyleSheet.prototype.deleteRule=i,a&&(r.CSSStyleSheet.prototype.replace=a),s&&(r.CSSStyleSheet.prototype.replaceSync=s),Object.entries(l).forEach((([e,t])=>{t.prototype.insertRule=c[e].insertRule,t.prototype.deleteRule=c[e].deleteRule}))}))}(e,{win:n}),d=Cs(e,e.doc),h=function({styleDeclarationCb:e,mirror:t,ignoreCSSAttributes:n,stylesheetManager:r},{win:o}){const i=o.CSSStyleDeclaration.prototype.setProperty;o.CSSStyleDeclaration.prototype.setProperty=new Proxy(i,{apply:us(((o,a,s)=>{const[l,c,u]=s;if(n.has(l))return i.apply(a,[l,c,u]);const{id:d,styleId:h}=ws(ds([a,"access",e=>e.parentRule,"optionalAccess",e=>e.parentStyleSheet]),t,r.styleMirror);return(d&&-1!==d||h&&-1!==h)&&e({id:d,styleId:h,set:{property:l,value:c,priority:u},index:bs(a.parentRule)}),o.apply(a,s)}))});const a=o.CSSStyleDeclaration.prototype.removeProperty;return o.CSSStyleDeclaration.prototype.removeProperty=new Proxy(a,{apply:us(((o,i,s)=>{const[l]=s;if(n.has(l))return a.apply(i,[l]);const{id:c,styleId:u}=ws(ds([i,"access",e=>e.parentRule,"optionalAccess",e=>e.parentStyleSheet]),t,r.styleMirror);return(c&&-1!==c||u&&-1!==u)&&e({id:c,styleId:u,remove:{property:l},index:bs(i.parentRule)}),o.apply(i,s)}))}),us((()=>{o.CSSStyleDeclaration.prototype.setProperty=i,o.CSSStyleDeclaration.prototype.removeProperty=a}))}(e,{win:n}),e.collectFonts&&(m=function({fontCb:e,doc:t}){const n=t.defaultView;if(!n)return()=>{};const r=[],o=new WeakMap,i=n.FontFace;n.FontFace=function(e,t,n){const r=new i(e,t,n);return o.set(r,{family:e,buffer:"string"!=typeof t,descriptors:n,fontSource:"string"==typeof t?t:JSON.stringify(Array.from(new Uint8Array(t)))}),r};const a=Ma(t.fonts,"add",(function(t){return function(n){return qa(us((()=>{const t=o.get(n);t&&(e(t),o.delete(n))})),0),t.apply(this,[n])}}));return r.push((()=>{n.FontFace=i})),r.push(a),us((()=>{r.forEach((e=>e()))}))}(e)));const p=function(e){const{doc:t,mirror:n,blockClass:r,blockSelector:o,unblockSelector:i,selectionCb:a}=e;let s=!0;const l=us((()=>{const e=t.getSelection();if(!e||s&&ds([e,"optionalAccess",e=>e.isCollapsed]))return;s=e.isCollapsed||!1;const l=[],c=e.rangeCount||0;for(let t=0;t<c;t++){const a=e.getRangeAt(t),{startContainer:s,startOffset:c,endContainer:u,endOffset:d}=a;Ta(s,r,o,i,!0)||Ta(u,r,o,i,!0)||l.push({start:n.getId(s),startOffset:c,end:n.getId(u),endOffset:d})}a({ranges:l})}));return l(),ka("selectionchange",l)}(e),f=function({doc:e,customElementCb:t}){const n=e.defaultView;return n&&n.customElements?Ma(n.customElements,"define",(function(e){return function(n,r,o){try{t({define:{name:n}})}catch(e){}return e.apply(this,[n,r,o])}})):()=>{}}(e),g=[];for(const t of e.plugins)g.push(t.observer(t.callback,n,t.options));return us((()=>{hs.forEach((e=>e.reset())),ds([r,"optionalAccess",e=>e.disconnect,"call",e=>e()]),o(),i(),a(),s(),l(),c(),u(),d(),h(),m(),p(),f(),g.forEach((e=>e()))}))}function ks(e){return void 0!==window[e]}function As(e){return Boolean(void 0!==window[e]&&window[e].prototype&&"insertRule"in window[e].prototype&&"deleteRule"in window[e].prototype)}class Es{constructor(e){this.generateIdFn=e,this.iframeIdToRemoteIdMap=new WeakMap,this.iframeRemoteIdToIdMap=new WeakMap}getId(e,t,n,r){const o=n||this.getIdToRemoteIdMap(e),i=r||this.getRemoteIdToIdMap(e);let a=o.get(t);return a||(a=this.generateIdFn(),o.set(t,a),i.set(a,t)),a}getIds(e,t){const n=this.getIdToRemoteIdMap(e),r=this.getRemoteIdToIdMap(e);return t.map((t=>this.getId(e,t,n,r)))}getRemoteId(e,t,n){const r=n||this.getRemoteIdToIdMap(e);if("number"!=typeof t)return t;return r.get(t)||-1}getRemoteIds(e,t){const n=this.getRemoteIdToIdMap(e);return t.map((t=>this.getRemoteId(e,t,n)))}reset(e){if(!e)return this.iframeIdToRemoteIdMap=new WeakMap,void(this.iframeRemoteIdToIdMap=new WeakMap);this.iframeIdToRemoteIdMap.delete(e),this.iframeRemoteIdToIdMap.delete(e)}getIdToRemoteIdMap(e){let t=this.iframeIdToRemoteIdMap.get(e);return t||(t=new Map,this.iframeIdToRemoteIdMap.set(e,t)),t}getRemoteIdToIdMap(e){let t=this.iframeRemoteIdToIdMap.get(e);return t||(t=new Map,this.iframeRemoteIdToIdMap.set(e,t)),t}}function Ss(e){let t,n=e[0],r=1;for(;r<e.length;){const o=e[r],i=e[r+1];if(r+=2,("optionalAccess"===o||"optionalCall"===o)&&null==n)return;"access"===o||"optionalAccess"===o?(t=n,n=i(n)):"call"!==o&&"optionalCall"!==o||(n=i(((...e)=>n.call(t,...e))),t=void 0)}return n}class Ds{constructor(){this.crossOriginIframeMirror=new Es(ra),this.crossOriginIframeRootIdMap=new WeakMap}addIframe(){}addLoadListener(){}attachIframe(){}}class Ms{constructor(e){this.iframes=new WeakMap,this.crossOriginIframeMap=new WeakMap,this.crossOriginIframeMirror=new Es(ra),this.crossOriginIframeRootIdMap=new WeakMap,this.mutationCb=e.mutationCb,this.wrappedEmit=e.wrappedEmit,this.stylesheetManager=e.stylesheetManager,this.recordCrossOriginIframes=e.recordCrossOriginIframes,this.crossOriginIframeStyleMirror=new Es(this.stylesheetManager.styleMirror.generateId.bind(this.stylesheetManager.styleMirror)),this.mirror=e.mirror,this.recordCrossOriginIframes&&window.addEventListener("message",this.handleMessage.bind(this))}addIframe(e){this.iframes.set(e,!0),e.contentWindow&&this.crossOriginIframeMap.set(e.contentWindow,e)}addLoadListener(e){this.loadListener=e}attachIframe(e,t){this.mutationCb({adds:[{parentId:this.mirror.getId(e),nextId:null,node:t}],removes:[],texts:[],attributes:[],isAttachIframe:!0}),Ss([this,"access",e=>e.loadListener,"optionalCall",t=>t(e)]),e.contentDocument&&e.contentDocument.adoptedStyleSheets&&e.contentDocument.adoptedStyleSheets.length>0&&this.stylesheetManager.adoptStyleSheets(e.contentDocument.adoptedStyleSheets,this.mirror.getId(e.contentDocument))}handleMessage(e){const t=e;if("rrweb"!==t.data.type||t.origin!==t.data.origin)return;if(!e.source)return;const n=this.crossOriginIframeMap.get(e.source);if(!n)return;const r=this.transformCrossOriginEvent(n,t.data.event);r&&this.wrappedEmit(r,t.data.isCheckout)}transformCrossOriginEvent(e,t){switch(t.type){case Xa.FullSnapshot:{this.crossOriginIframeMirror.reset(e),this.crossOriginIframeStyleMirror.reset(e),this.replaceIdOnNode(t.data.node,e);const n=t.data.node.id;return this.crossOriginIframeRootIdMap.set(e,n),this.patchRootIdOnNode(t.data.node,n),{timestamp:t.timestamp,type:Xa.IncrementalSnapshot,data:{source:za.Mutation,adds:[{parentId:this.mirror.getId(e),nextId:null,node:t.data.node}],removes:[],texts:[],attributes:[],isAttachIframe:!0}}}case Xa.Meta:case Xa.Load:case Xa.DomContentLoaded:return!1;case Xa.Plugin:return t;case Xa.Custom:return this.replaceIds(t.data.payload,e,["id","parentId","previousId","nextId"]),t;case Xa.IncrementalSnapshot:switch(t.data.source){case za.Mutation:return t.data.adds.forEach((t=>{this.replaceIds(t,e,["parentId","nextId","previousId"]),this.replaceIdOnNode(t.node,e);const n=this.crossOriginIframeRootIdMap.get(e);n&&this.patchRootIdOnNode(t.node,n)})),t.data.removes.forEach((t=>{this.replaceIds(t,e,["parentId","id"])})),t.data.attributes.forEach((t=>{this.replaceIds(t,e,["id"])})),t.data.texts.forEach((t=>{this.replaceIds(t,e,["id"])})),t;case za.Drag:case za.TouchMove:case za.MouseMove:return t.data.positions.forEach((t=>{this.replaceIds(t,e,["id"])})),t;case za.ViewportResize:return!1;case za.MediaInteraction:case za.MouseInteraction:case za.Scroll:case za.CanvasMutation:case za.Input:return this.replaceIds(t.data,e,["id"]),t;case za.StyleSheetRule:case za.StyleDeclaration:return this.replaceIds(t.data,e,["id"]),this.replaceStyleIds(t.data,e,["styleId"]),t;case za.Font:return t;case za.Selection:return t.data.ranges.forEach((t=>{this.replaceIds(t,e,["start","end"])})),t;case za.AdoptedStyleSheet:return this.replaceIds(t.data,e,["id"]),this.replaceStyleIds(t.data,e,["styleIds"]),Ss([t,"access",e=>e.data,"access",e=>e.styles,"optionalAccess",e=>e.forEach,"call",t=>t((t=>{this.replaceStyleIds(t,e,["styleId"])}))]),t}}return!1}replace(e,t,n,r){for(const o of r)(Array.isArray(t[o])||"number"==typeof t[o])&&(Array.isArray(t[o])?t[o]=e.getIds(n,t[o]):t[o]=e.getId(n,t[o]));return t}replaceIds(e,t,n){return this.replace(this.crossOriginIframeMirror,e,t,n)}replaceStyleIds(e,t,n){return this.replace(this.crossOriginIframeStyleMirror,e,t,n)}replaceIdOnNode(e,t){this.replaceIds(e,t,["id","rootId"]),"childNodes"in e&&e.childNodes.forEach((e=>{this.replaceIdOnNode(e,t)}))}patchRootIdOnNode(e,t){e.type===Bi.Document||e.rootId||(e.rootId=t),"childNodes"in e&&e.childNodes.forEach((e=>{this.patchRootIdOnNode(e,t)}))}}class xs{init(){}addShadowRoot(){}observeAttachShadow(){}reset(){}}class Ns{constructor(e){this.shadowDoms=new WeakSet,this.restoreHandlers=[],this.mutationCb=e.mutationCb,this.scrollCb=e.scrollCb,this.bypassOptions=e.bypassOptions,this.mirror=e.mirror,this.init()}init(){this.reset(),this.patchAttachShadow(Element,document)}addShadowRoot(e,t){if(!$i(e))return;if(this.shadowDoms.has(e))return;this.shadowDoms.add(e),this.bypassOptions.canvasManager.addShadowRoot(e);const n=ps({...this.bypassOptions,doc:t,mutationCb:this.mutationCb,mirror:this.mirror,shadowDomManager:this},e);this.restoreHandlers.push((()=>n.disconnect())),this.restoreHandlers.push(fs({...this.bypassOptions,scrollCb:this.scrollCb,doc:e,mirror:this.mirror})),qa((()=>{e.adoptedStyleSheets&&e.adoptedStyleSheets.length>0&&this.bypassOptions.stylesheetManager.adoptStyleSheets(e.adoptedStyleSheets,this.mirror.getId(e.host)),this.restoreHandlers.push(Cs({mirror:this.mirror,stylesheetManager:this.bypassOptions.stylesheetManager},e))}),0)}observeAttachShadow(e){e.contentWindow&&e.contentDocument&&this.patchAttachShadow(e.contentWindow.Element,e.contentDocument)}patchAttachShadow(e,t){const n=this;this.restoreHandlers.push(Ma(e.prototype,"attachShadow",(function(e){return function(r){const o=e.call(this,r);return this.shadowRoot&&ja(this)&&n.addShadowRoot(this.shadowRoot,t),o}})))}reset(){this.restoreHandlers.forEach((e=>{try{e()}catch(e){}})),this.restoreHandlers=[],this.shadowDoms=new WeakSet,this.bypassOptions.canvasManager.resetShadowRoots()}}class Is{reset(){}freeze(){}unfreeze(){}lock(){}unlock(){}snapshot(){}addWindow(){}addShadowRoot(){}resetShadowRoots(){}}class Rs{constructor(e){this.trackedLinkElements=new WeakSet,this.styleMirror=new Wa,this.mutationCb=e.mutationCb,this.adoptedStyleSheetCb=e.adoptedStyleSheetCb}attachLinkElement(e,t){"_cssText"in t.attributes&&this.mutationCb({adds:[],removes:[],texts:[],attributes:[{id:t.id,attributes:t.attributes}]}),this.trackLinkElement(e)}trackLinkElement(e){this.trackedLinkElements.has(e)||(this.trackedLinkElements.add(e),this.trackStylesheetInLinkElement(e))}adoptStyleSheets(e,t){if(0===e.length)return;const n={id:t,styleIds:[]},r=[];for(const t of e){let e;this.styleMirror.has(t)?e=this.styleMirror.getId(t):(e=this.styleMirror.add(t),r.push({styleId:e,rules:Array.from(t.rules||CSSRule,((e,t)=>({rule:Hi(e),index:t})))})),n.styleIds.push(e)}r.length>0&&(n.styles=r),this.adoptedStyleSheetCb(n)}reset(){this.styleMirror.reset(),this.trackedLinkElements=new WeakSet}trackStylesheetInLinkElement(e){}}class Ls{constructor(){this.nodeMap=new WeakMap,this.loop=!0,this.periodicallyClear()}periodicallyClear(){!function(...e){Ya("requestAnimationFrame")(...e)}((()=>{this.clear(),this.loop&&this.periodicallyClear()}))}inOtherBuffer(e,t){const n=this.nodeMap.get(e);return n&&Array.from(n).some((e=>e!==t))}add(e,t){this.nodeMap.set(e,(this.nodeMap.get(e)||new Set).add(t))}clear(){this.nodeMap=new WeakMap}destroy(){this.loop=!1}}let Ts,Ps;try{if(2!==Array.from([1],(e=>2*e))[0]){const e=document.createElement("iframe");document.body.appendChild(e),Array.from=mn([e,"access",e=>e.contentWindow,"optionalAccess",e=>e.Array,"access",e=>e.from])||Array.from,document.body.removeChild(e)}}catch(e){console.debug("Unable to override Array.from",e)}const Bs=new Wi;function Os(e={}){const{emit:t,checkoutEveryNms:n,checkoutEveryNth:r,blockClass:o="rr-block",blockSelector:i=null,unblockSelector:a=null,ignoreClass:s="rr-ignore",ignoreSelector:l=null,maskAllText:c=!1,maskTextClass:u="rr-mask",unmaskTextClass:d=null,maskTextSelector:h=null,unmaskTextSelector:m=null,inlineStylesheet:p=!0,maskAllInputs:f,maskInputOptions:g,slimDOMOptions:y,maskAttributeFn:v,maskInputFn:b,maskTextFn:w,maxCanvasSize:C=null,packFn:_,sampling:k={},dataURLOptions:A={},mousemoveWait:E,recordDOM:S=!0,recordCanvas:D=!1,recordCrossOriginIframes:M=!1,recordAfter:x=("DOMContentLoaded"===e.recordAfter?e.recordAfter:"load"),userTriggeredOnInput:N=!1,collectFonts:I=!1,inlineImages:R=!1,plugins:L,keepIframeSrcFn:T=(()=>!1),ignoreCSSAttributes:P=new Set([]),errorHandler:B,onMutation:O,getCanvasManager:$}=e;ls(B);const F=!M||window.parent===window;let H=!1;if(!F)try{window.parent.document&&(H=!1)}catch(e){H=!0}if(F&&!t)throw new Error("emit function is required");void 0!==E&&void 0===k.mousemove&&(k.mousemove=E),Bs.reset();const W=!0===f?{color:!0,date:!0,"datetime-local":!0,email:!0,month:!0,number:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0,textarea:!0,select:!0,radio:!0,checkbox:!0}:void 0!==g?g:{},G=!0===y||"all"===y?{script:!0,comment:!0,headFavicon:!0,headWhitespace:!0,headMetaSocial:!0,headMetaRobots:!0,headMetaHttpEquiv:!0,headMetaVerification:!0,headMetaAuthorship:"all"===y,headMetaDescKeywords:"all"===y}:y||{};let j;!function(e=window){"NodeList"in e&&!e.NodeList.prototype.forEach&&(e.NodeList.prototype.forEach=Array.prototype.forEach),"DOMTokenList"in e&&!e.DOMTokenList.prototype.forEach&&(e.DOMTokenList.prototype.forEach=Array.prototype.forEach),Node.prototype.contains||(Node.prototype.contains=(...e)=>{let t=e[0];if(!(0 in e))throw new TypeError("1 argument is required");do{if(this===t)return!0}while(t=t&&t.parentNode);return!1})}();let U=0;const Y=e=>{for(const t of L||[])t.eventProcessor&&(e=t.eventProcessor(e));return _&&!H&&(e=_(e)),e};Ts=(e,o)=>{const i=e;if(i.timestamp=xa(),!mn([hs,"access",e=>e[0],"optionalAccess",e=>e.isFrozen,"call",e=>e()])||i.type===Xa.FullSnapshot||i.type===Xa.IncrementalSnapshot&&i.data.source===za.Mutation||hs.forEach((e=>e.unfreeze())),F)mn([t,"optionalCall",e=>e(Y(i),o)]);else if(H){const e={type:"rrweb",event:Y(i),origin:window.location.origin,isCheckout:o};window.parent.postMessage(e,"*")}if(i.type===Xa.FullSnapshot)j=i,U=0;else if(i.type===Xa.IncrementalSnapshot){if(i.data.source===za.Mutation&&i.data.isAttachIframe)return;U++;const e=r&&U>=r,t=n&&j&&i.timestamp-j.timestamp>n;(e||t)&&ee(!0)}};const q=e=>{Ts({type:Xa.IncrementalSnapshot,data:{source:za.Mutation,...e}})},X=e=>Ts({type:Xa.IncrementalSnapshot,data:{source:za.Scroll,...e}}),z=e=>Ts({type:Xa.IncrementalSnapshot,data:{source:za.CanvasMutation,...e}}),V=new Rs({mutationCb:q,adoptedStyleSheetCb:e=>Ts({type:Xa.IncrementalSnapshot,data:{source:za.AdoptedStyleSheet,...e}})}),Z="boolean"==typeof __RRWEB_EXCLUDE_IFRAME__&&__RRWEB_EXCLUDE_IFRAME__?new Ds:new Ms({mirror:Bs,mutationCb:q,stylesheetManager:V,recordCrossOriginIframes:M,wrappedEmit:Ts});for(const e of L||[])e.getMirror&&e.getMirror({nodeMirror:Bs,crossOriginIframeMirror:Z.crossOriginIframeMirror,crossOriginIframeStyleMirror:Z.crossOriginIframeStyleMirror});const K=new Ls,J=function(e,t){try{return e?e(t):new Is}catch(e){return console.warn("Unable to initialize CanvasManager"),new Is}}($,{mirror:Bs,win:window,mutationCb:e=>Ts({type:Xa.IncrementalSnapshot,data:{source:za.CanvasMutation,...e}}),recordCanvas:D,blockClass:o,blockSelector:i,unblockSelector:a,maxCanvasSize:C,sampling:k.canvas,dataURLOptions:A,errorHandler:B}),Q="boolean"==typeof __RRWEB_EXCLUDE_SHADOW_DOM__&&__RRWEB_EXCLUDE_SHADOW_DOM__?new xs:new Ns({mutationCb:q,scrollCb:X,bypassOptions:{onMutation:O,blockClass:o,blockSelector:i,unblockSelector:a,maskAllText:c,maskTextClass:u,unmaskTextClass:d,maskTextSelector:h,unmaskTextSelector:m,inlineStylesheet:p,maskInputOptions:W,dataURLOptions:A,maskAttributeFn:v,maskTextFn:w,maskInputFn:b,recordCanvas:D,inlineImages:R,sampling:k,slimDOMOptions:G,iframeManager:Z,stylesheetManager:V,canvasManager:J,keepIframeSrcFn:T,processedNodeManager:K},mirror:Bs}),ee=(e=!1)=>{if(!S)return;Ts({type:Xa.Meta,data:{href:window.location.href,width:Ra(),height:Ia()}},e),V.reset(),Q.init(),hs.forEach((e=>e.lock()));const t=function(e,t){const{mirror:n=new Wi,blockClass:r="rr-block",blockSelector:o=null,unblockSelector:i=null,maskAllText:a=!1,maskTextClass:s="rr-mask",unmaskTextClass:l=null,maskTextSelector:c=null,unmaskTextSelector:u=null,inlineStylesheet:d=!0,inlineImages:h=!1,recordCanvas:m=!1,maskAllInputs:p=!1,maskAttributeFn:f,maskTextFn:g,maskInputFn:y,slimDOM:v=!1,dataURLOptions:b,preserveWhiteSpace:w,onSerialize:C,onIframeLoad:_,iframeLoadTimeout:k,onStylesheetLoad:A,stylesheetLoadTimeout:E,keepIframeSrcFn:S=(()=>!1)}=t||{};return Ca(e,{doc:e,mirror:n,blockClass:r,blockSelector:o,unblockSelector:i,maskAllText:a,maskTextClass:s,unmaskTextClass:l,maskTextSelector:c,unmaskTextSelector:u,skipChild:!1,inlineStylesheet:d,maskInputOptions:!0===p?{color:!0,date:!0,"datetime-local":!0,email:!0,month:!0,number:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0,textarea:!0,select:!0}:!1===p?{}:p,maskAttributeFn:f,maskTextFn:g,maskInputFn:y,slimDOMOptions:!0===v||"all"===v?{script:!0,comment:!0,headFavicon:!0,headWhitespace:!0,headMetaDescKeywords:"all"===v,headMetaSocial:!0,headMetaRobots:!0,headMetaHttpEquiv:!0,headMetaAuthorship:!0,headMetaVerification:!0}:!1===v?{}:v,dataURLOptions:b,inlineImages:h,recordCanvas:m,preserveWhiteSpace:w,onSerialize:C,onIframeLoad:_,iframeLoadTimeout:k,onStylesheetLoad:A,stylesheetLoadTimeout:E,keepIframeSrcFn:S,newlyAddedElement:!1})}(document,{mirror:Bs,blockClass:o,blockSelector:i,unblockSelector:a,maskAllText:c,maskTextClass:u,unmaskTextClass:d,maskTextSelector:h,unmaskTextSelector:m,inlineStylesheet:p,maskAllInputs:W,maskAttributeFn:v,maskInputFn:b,maskTextFn:w,slimDOM:G,dataURLOptions:A,recordCanvas:D,inlineImages:R,onSerialize:e=>{$a(e,Bs)&&Z.addIframe(e),Fa(e,Bs)&&V.trackLinkElement(e),Ha(e)&&Q.addShadowRoot(e.shadowRoot,document)},onIframeLoad:(e,t)=>{Z.attachIframe(e,t),e.contentWindow&&J.addWindow(e.contentWindow),Q.observeAttachShadow(e)},onStylesheetLoad:(e,t)=>{V.attachLinkElement(e,t)},keepIframeSrcFn:T});if(!t)return console.warn("Failed to snapshot the document");Ts({type:Xa.FullSnapshot,data:{node:t,initialOffset:Na(window)}}),hs.forEach((e=>e.unlock())),document.adoptedStyleSheets&&document.adoptedStyleSheets.length>0&&V.adoptStyleSheets(document.adoptedStyleSheets,Bs.getId(document))};Ps=ee;try{const e=[],t=e=>us(_s)({onMutation:O,mutationCb:q,mousemoveCb:(e,t)=>Ts({type:Xa.IncrementalSnapshot,data:{source:t,positions:e}}),mouseInteractionCb:e=>Ts({type:Xa.IncrementalSnapshot,data:{source:za.MouseInteraction,...e}}),scrollCb:X,viewportResizeCb:e=>Ts({type:Xa.IncrementalSnapshot,data:{source:za.ViewportResize,...e}}),inputCb:e=>Ts({type:Xa.IncrementalSnapshot,data:{source:za.Input,...e}}),mediaInteractionCb:e=>Ts({type:Xa.IncrementalSnapshot,data:{source:za.MediaInteraction,...e}}),styleSheetRuleCb:e=>Ts({type:Xa.IncrementalSnapshot,data:{source:za.StyleSheetRule,...e}}),styleDeclarationCb:e=>Ts({type:Xa.IncrementalSnapshot,data:{source:za.StyleDeclaration,...e}}),canvasMutationCb:z,fontCb:e=>Ts({type:Xa.IncrementalSnapshot,data:{source:za.Font,...e}}),selectionCb:e=>{Ts({type:Xa.IncrementalSnapshot,data:{source:za.Selection,...e}})},customElementCb:e=>{Ts({type:Xa.IncrementalSnapshot,data:{source:za.CustomElement,...e}})},blockClass:o,ignoreClass:s,ignoreSelector:l,maskAllText:c,maskTextClass:u,unmaskTextClass:d,maskTextSelector:h,unmaskTextSelector:m,maskInputOptions:W,inlineStylesheet:p,sampling:k,recordDOM:S,recordCanvas:D,inlineImages:R,userTriggeredOnInput:N,collectFonts:I,doc:e,maskAttributeFn:v,maskInputFn:b,maskTextFn:w,keepIframeSrcFn:T,blockSelector:i,unblockSelector:a,slimDOMOptions:G,dataURLOptions:A,mirror:Bs,iframeManager:Z,stylesheetManager:V,shadowDomManager:Q,processedNodeManager:K,canvasManager:J,ignoreCSSAttributes:P,plugins:mn([L,"optionalAccess",e=>e.filter,"call",e=>e((e=>e.observer)),"optionalAccess",e=>e.map,"call",e=>e((e=>({observer:e.observer,options:e.options,callback:t=>Ts({type:Xa.Plugin,data:{plugin:e.name,payload:t}})})))])||[]},{});Z.addLoadListener((n=>{try{e.push(t(n.contentDocument))}catch(e){console.warn(e)}}));const n=()=>{ee(),e.push(t(document))};return"interactive"===document.readyState||"complete"===document.readyState?n():(e.push(ka("DOMContentLoaded",(()=>{Ts({type:Xa.DomContentLoaded,data:{}}),"DOMContentLoaded"===x&&n()}))),e.push(ka("load",(()=>{Ts({type:Xa.Load,data:{}}),"load"===x&&n()}),window))),()=>{e.forEach((e=>e())),K.destroy(),Ps=void 0,cs()}}catch(e){console.warn(e)}}Os.mirror=Bs,Os.takeFullSnapshot=function(e){if(!Ps)throw new Error("please take full snapshot after start recording");Ps(e)};const $s="undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__,Fs=["info","warn","error","log"],Hs="[Replay] ";function Ws(e,t="info"){ui({category:"console",data:{logger:"replay"},level:t,message:`${Hs}${e}`},{level:t})}const Gs=function(){let e=!1,t=!1;const n={exception:()=>{},infoTick:()=>{},setConfig:n=>{e=n.captureExceptions,t=n.traceInternals}};return $s?(Fs.forEach((e=>{n[e]=(...n)=>{W[e](Hs,...n),t&&Ws(n[0])}})),n.exception=(r,...o)=>{n.error&&n.error(...o),W.error(Hs,r),e?so(r):t&&Ws(r)},n.infoTick=(...e)=>{W.info(Hs,...e),t&&setTimeout((()=>Ws(e[0])),0)}):Fs.forEach((e=>{n[e]=()=>{}})),n}(),js=3;function Us(e){return e>9999999999?e:1e3*e}function Ys(e){return e>9999999999?e/1e3:e}function qs(e,t){"sentry.transaction"!==t.category&&(["ui.click","ui.input"].includes(t.category)?e.triggerUserActivity():e.checkAndHandleExpiredSession(),e.addUpdate((()=>(e.throttledAddEvent({type:Xa.Custom,timestamp:1e3*(t.timestamp||0),data:{tag:"breadcrumb",payload:Ot(t,10,1e3)}}),"console"===t.category))))}const Xs="button,a";function zs(e){return e.closest(Xs)||e}function Vs(e){const t=Zs(e);return t&&t instanceof Element?zs(t):t}function Zs(e){return function(e){return"object"==typeof e&&!!e&&"target"in e}(e)?e.target:e}let Ks;class Js{constructor(e,t,n=qs){this._lastMutation=0,this._lastScroll=0,this._clicks=[],this._timeout=t.timeout/1e3,this._threshold=t.threshold/1e3,this._scollTimeout=t.scrollTimeout/1e3,this._replay=e,this._ignoreSelector=t.ignoreSelector,this._addBreadcrumbEvent=n}addListeners(){const e=(t=()=>{this._lastMutation=el()},Ks||(Ks=[],Y(Di,"open",(function(e){return function(...t){if(Ks)try{Ks.forEach((e=>e()))}catch(e){}return e.apply(Di,t)}}))),Ks.push(t),()=>{const e=Ks?Ks.indexOf(t):-1;e>-1&&Ks.splice(e,1)});var t;this._teardown=()=>{e(),this._clicks=[],this._lastMutation=0,this._lastScroll=0}}removeListeners(){this._teardown&&this._teardown(),this._checkClickTimeout&&clearTimeout(this._checkClickTimeout)}handleClick(e,t){if(function(e,t){return!Qs.includes(e.tagName)||("INPUT"===e.tagName&&!["submit","button"].includes(e.getAttribute("type")||"")||(!("A"!==e.tagName||!(e.hasAttribute("download")||e.hasAttribute("target")&&"_self"!==e.getAttribute("target")))||!(!t||!e.matches(t))))}(t,this._ignoreSelector)||!function(e){return!(!e.data||"number"!=typeof e.data.nodeId||!e.timestamp)}(e))return;const n={timestamp:Ys(e.timestamp),clickBreadcrumb:e,clickCount:0,node:t};this._clicks.some((e=>e.node===n.node&&Math.abs(e.timestamp-n.timestamp)<1))||(this._clicks.push(n),1===this._clicks.length&&this._scheduleCheckClicks())}registerMutation(e=Date.now()){this._lastMutation=Ys(e)}registerScroll(e=Date.now()){this._lastScroll=Ys(e)}registerClick(e){const t=zs(e);this._handleMultiClick(t)}_handleMultiClick(e){this._getClicks(e).forEach((e=>{e.clickCount++}))}_getClicks(e){return this._clicks.filter((t=>t.node===e))}_checkClicks(){const e=[],t=el();this._clicks.forEach((n=>{!n.mutationAfter&&this._lastMutation&&(n.mutationAfter=n.timestamp<=this._lastMutation?this._lastMutation-n.timestamp:void 0),!n.scrollAfter&&this._lastScroll&&(n.scrollAfter=n.timestamp<=this._lastScroll?this._lastScroll-n.timestamp:void 0),n.timestamp+this._timeout<=t&&e.push(n)}));for(const t of e){const e=this._clicks.indexOf(t);e>-1&&(this._generateBreadcrumbs(t),this._clicks.splice(e,1))}this._clicks.length&&this._scheduleCheckClicks()}_generateBreadcrumbs(e){const t=this._replay,n=e.scrollAfter&&e.scrollAfter<=this._scollTimeout,r=e.mutationAfter&&e.mutationAfter<=this._threshold,o=!n&&!r,{clickCount:i,clickBreadcrumb:a}=e;if(o){const n=1e3*Math.min(e.mutationAfter||this._timeout,this._timeout),r=n<1e3*this._timeout?"mutation":"timeout",o={type:"default",message:a.message,timestamp:a.timestamp,category:"ui.slowClickDetected",data:{...a.data,url:Di.location.href,route:t.getCurrentRoute(),timeAfterClickMs:n,endReason:r,clickCount:i||1}};this._addBreadcrumbEvent(t,o)}else if(i>1){const e={type:"default",message:a.message,timestamp:a.timestamp,category:"ui.multiClick",data:{...a.data,url:Di.location.href,route:t.getCurrentRoute(),clickCount:i,metric:!0}};this._addBreadcrumbEvent(t,e)}}_scheduleCheckClicks(){this._checkClickTimeout&&clearTimeout(this._checkClickTimeout),this._checkClickTimeout=bi((()=>this._checkClicks()),1e3)}}const Qs=["A","BUTTON","INPUT"];function el(){return Date.now()/1e3}function tl(e){return{timestamp:Date.now()/1e3,type:"default",...e}}var nl;!function(e){e[e.Document=0]="Document",e[e.DocumentType=1]="DocumentType",e[e.Element=2]="Element",e[e.Text=3]="Text",e[e.CDATA=4]="CDATA",e[e.Comment=5]="Comment"}(nl||(nl={}));const rl=new Set(["id","class","aria-label","role","name","alt","title","data-test-id","data-testid","disabled","aria-disabled","data-sentry-component"]);function ol(e){const t={};!e["data-sentry-component"]&&e["data-sentry-element"]&&(e["data-sentry-component"]=e["data-sentry-element"]);for(const n in e)if(rl.has(n)){let r=n;"data-testid"!==n&&"data-test-id"!==n||(r="testId"),t[r]=e[n]}return t}function il(e,t){const n=Os.mirror.getId(e),r=n&&Os.mirror.getNode(n),o=r&&Os.mirror.getMeta(r),i=o&&function(e){return e.type===nl.Element}(o)?o:null;return{message:t,data:i?{nodeId:n,node:{id:n,tagName:i.tagName,textContent:Array.from(i.childNodes).map((e=>e.type===nl.Text&&e.textContent)).filter(Boolean).map((e=>e.trim())).join(""),attributes:ol(i.attributes)}}:{}}}const al={resource:function(e){const{entryType:t,initiatorType:n,name:r,responseEnd:o,startTime:i,decodedBodySize:a,encodedBodySize:s,responseStatus:l,transferSize:c}=e;return["fetch","xmlhttprequest"].includes(n)?null:{type:`${t}.${n}`,start:cl(i),end:cl(o),name:r,data:{size:c,statusCode:l,decodedBodySize:a,encodedBodySize:s}}},paint:function(e){const{duration:t,entryType:n,name:r,startTime:o}=e,i=cl(o);return{type:n,name:r,start:i,end:i+t,data:void 0}},navigation:function(e){const{entryType:t,name:n,decodedBodySize:r,duration:o,domComplete:i,encodedBodySize:a,domContentLoadedEventStart:s,domContentLoadedEventEnd:l,domInteractive:c,loadEventStart:u,loadEventEnd:d,redirectCount:h,startTime:m,transferSize:p,type:f}=e;return 0===o?null:{type:`${t}.${f}`,start:cl(m),end:cl(i),name:n,data:{size:p,decodedBodySize:r,encodedBodySize:a,duration:o,domInteractive:c,domContentLoadedEventStart:s,domContentLoadedEventEnd:l,loadEventStart:u,loadEventEnd:d,domComplete:i,redirectCount:h}}}};function sl(e,t){return({metric:n})=>{t.replayPerformanceEntries.push(e(n))}}function ll(e){const t=al[e.entryType];return t?t(e):null}function cl(e){return((we||Di.performance.timeOrigin)+e)/1e3}function ul(e){const t=e.entries[e.entries.length-1];return pl(e,"largest-contentful-paint",t&&t.element?[t.element]:void 0)}function dl(e){const t=e.entries[e.entries.length-1],n=[];if(t&&t.sources)for(const e of t.sources)e.node&&n.push(e.node);return pl(e,"cumulative-layout-shift",n)}function hl(e){const t=e.entries[e.entries.length-1];return pl(e,"first-input-delay",t&&t.target?[t.target]:void 0)}function ml(e){const t=e.entries[e.entries.length-1];return pl(e,"interaction-to-next-paint",t&&t.target?[t.target]:void 0)}function pl(e,t,n){const r=e.value,o=e.rating,i=cl(r);return{type:"web-vital",name:t,start:i,end:i,data:{value:r,size:r,rating:o,nodeIds:n?n.map((e=>Os.mirror.getId(e))):void 0}}}class fl extends Error{constructor(){super("Event buffer exceeded maximum size of 20000000.")}}class gl{constructor(){this.events=[],this._totalSize=0,this.hasCheckout=!1}get hasEvents(){return this.events.length>0}get type(){return"sync"}destroy(){this.events=[]}async addEvent(e){const t=JSON.stringify(e).length;if(this._totalSize+=t,this._totalSize>Li)throw new fl;this.events.push(e)}finish(){return new Promise((e=>{const t=this.events;this.clear(),e(JSON.stringify(t))}))}clear(){this.events=[],this._totalSize=0,this.hasCheckout=!1}getEarliestTimestamp(){const e=this.events.map((e=>e.timestamp)).sort()[0];return e?Us(e):null}}class yl{constructor(e){this._worker=e,this._id=0}ensureReady(){return this._ensureReadyPromise||(this._ensureReadyPromise=new Promise(((e,t)=>{this._worker.addEventListener("message",(({data:n})=>{n.success?e():t()}),{once:!0}),this._worker.addEventListener("error",(e=>{t(e)}),{once:!0})}))),this._ensureReadyPromise}destroy(){$s&&Gs.info("Destroying compression worker"),this._worker.terminate()}postMessage(e,t){const n=this._getAndIncrementId();return new Promise(((r,o)=>{const i=({data:t})=>{const a=t;if(a.method===e&&a.id===n){if(this._worker.removeEventListener("message",i),!a.success)return $s&&Gs.error("Error in compression worker: ",a.response),void o(new Error("Error in compression worker"));r(a.response)}};this._worker.addEventListener("message",i),this._worker.postMessage({id:n,method:e,arg:t})}))}_getAndIncrementId(){return this._id++}}class vl{constructor(e){this._worker=new yl(e),this._earliestTimestamp=null,this._totalSize=0,this.hasCheckout=!1}get hasEvents(){return!!this._earliestTimestamp}get type(){return"worker"}ensureReady(){return this._worker.ensureReady()}destroy(){this._worker.destroy()}addEvent(e){const t=Us(e.timestamp);(!this._earliestTimestamp||t<this._earliestTimestamp)&&(this._earliestTimestamp=t);const n=JSON.stringify(e);return this._totalSize+=n.length,this._totalSize>Li?Promise.reject(new fl):this._sendEventToWorker(n)}finish(){return this._finishRequest()}clear(){this._earliestTimestamp=null,this._totalSize=0,this.hasCheckout=!1,this._worker.postMessage("clear").then(null,(e=>{$s&&Gs.exception(e,'Sending "clear" message to worker failed',e)}))}getEarliestTimestamp(){return this._earliestTimestamp}_sendEventToWorker(e){return this._worker.postMessage("addEvent",e)}async _finishRequest(){const e=await this._worker.postMessage("finish");return this._earliestTimestamp=null,this._totalSize=0,e}}class bl{constructor(e){this._fallback=new gl,this._compression=new vl(e),this._used=this._fallback,this._ensureWorkerIsLoadedPromise=this._ensureWorkerIsLoaded()}get type(){return this._used.type}get hasEvents(){return this._used.hasEvents}get hasCheckout(){return this._used.hasCheckout}set hasCheckout(e){this._used.hasCheckout=e}destroy(){this._fallback.destroy(),this._compression.destroy()}clear(){return this._used.clear()}getEarliestTimestamp(){return this._used.getEarliestTimestamp()}addEvent(e){return this._used.addEvent(e)}async finish(){return await this.ensureWorkerIsLoaded(),this._used.finish()}ensureWorkerIsLoaded(){return this._ensureWorkerIsLoadedPromise}async _ensureWorkerIsLoaded(){try{await this._compression.ensureReady()}catch(e){return void($s&&Gs.exception(e,"Failed to load the compression worker, falling back to simple buffer"))}await this._switchToCompressionWorker()}async _switchToCompressionWorker(){const{events:e,hasCheckout:t}=this._fallback,n=[];for(const t of e)n.push(this._compression.addEvent(t));this._compression.hasCheckout=t,this._used=this._compression;try{await Promise.all(n)}catch(e){$s&&Gs.exception(e,"Failed to add events when switching buffers.")}}}function wl(){try{return"sessionStorage"in Di&&!!Di.sessionStorage}catch(e){return!1}}function Cl(e){return void 0!==e&&Math.random()<e}function _l(e){const t=Date.now();return{id:e.id||se(),started:e.started||t,lastActivity:e.lastActivity||t,segmentId:e.segmentId||0,sampled:e.sampled,previousSessionId:e.previousSessionId}}function kl(e){if(wl())try{Di.sessionStorage.setItem(Mi,JSON.stringify(e))}catch(e){}}function Al({sessionSampleRate:e,allowBuffering:t,stickySession:n=!1},{previousSessionId:r}={}){const o=function(e,t){return Cl(e)?"session":!!t&&"buffer"}(e,t),i=_l({sampled:o,previousSessionId:r});return n&&kl(i),i}function El(e,t,n=+new Date){return null===e||void 0===t||t<0||0!==t&&e+t<=n}function Sl(e,{maxReplayDuration:t,sessionIdleExpire:n,targetTime:r=Date.now()}){return El(e.started,t,r)||El(e.lastActivity,n,r)}function Dl(e,{sessionIdleExpire:t,maxReplayDuration:n}){return!!Sl(e,{sessionIdleExpire:t,maxReplayDuration:n})&&("buffer"!==e.sampled||0!==e.segmentId)}function Ml({sessionIdleExpire:e,maxReplayDuration:t,previousSessionId:n},r){const o=r.stickySession&&function(){if(!wl())return null;try{const e=Di.sessionStorage.getItem(Mi);if(!e)return null;const t=JSON.parse(e);return $s&&Gs.infoTick("Loading existing session"),_l(t)}catch(e){return null}}();return o?Dl(o,{sessionIdleExpire:e,maxReplayDuration:t})?($s&&Gs.infoTick("Session in sessionStorage is expired, creating new one..."),Al(r,{previousSessionId:o.id})):o:($s&&Gs.infoTick("Creating new session"),Al(r,{previousSessionId:n}))}function xl(e,t,n){return!!Il(e,t)&&(Nl(e,t,n),!0)}async function Nl(e,t,n){if(!e.eventBuffer)return null;try{n&&"buffer"===e.recordingMode&&e.eventBuffer.clear(),n&&(e.eventBuffer.hasCheckout=!0);const r=function(e,t){try{if("function"==typeof t&&function(e){return e.type===Xa.Custom}(e))return t(e)}catch(e){return $s&&Gs.exception(e,"An error occured in the `beforeAddRecordingEvent` callback, skipping the event..."),null}return e}(t,e.getOptions().beforeAddRecordingEvent);if(!r)return;return await e.eventBuffer.addEvent(r)}catch(t){const n=t&&t instanceof fl?"addEventSizeExceeded":"addEvent";e.handleException(t),await e.stop({reason:n});const r=He();r&&r.recordDroppedEvent("internal_sdk_error","replay")}}function Il(e,t){if(!e.eventBuffer||e.isPaused()||!e.isEnabled())return!1;const n=Us(t.timestamp);return!(n+e.timeouts.sessionIdlePause<Date.now()||n>e.getContext().initialTimestamp+e.getOptions().maxReplayDuration&&($s&&Gs.infoTick(`Skipping event with timestamp ${n} because it is after maxReplayDuration`),1))}function Rl(e){return!e.type}function Ll(e){return"transaction"===e.type}function Tl(e){return"feedback"===e.type}function Pl(e){return!!e.category}function Bl(e,t){return t.map((({type:t,start:n,end:r,name:o,data:i})=>{const a=e.throttledAddEvent({type:Xa.Custom,timestamp:n,data:{tag:"performanceSpan",payload:{op:t,description:o,startTimestamp:n,endTimestamp:r,data:i}}});return"string"==typeof a?Promise.resolve(null):a}))}function Ol(e,t){e.isEnabled()&&null!==t&&(function(e,t){return(!$s||!e.getOptions()._experiments.traceInternals)&&function(e,t){const n=t&&t.getDsn(),r=t&&t.getOptions().tunnel;return function(e,t){return!!t&&e.includes(t.host)}(e,n)||function(e,t){return!!t&&di(e)===di(t)}(e,r)}(t,He())}(e,t.name)||e.addUpdate((()=>(Bl(e,[t]),!0))))}function $l(e){if(!e)return;const t=new TextEncoder;try{if("string"==typeof e)return t.encode(e).length;if(e instanceof URLSearchParams)return t.encode(e.toString()).length;if(e instanceof FormData){const n=ql(e);return t.encode(n).length}if(e instanceof Blob)return e.size;if(e instanceof ArrayBuffer)return e.byteLength}catch(e){}}function Fl(e){if(!e)return;const t=parseInt(e,10);return isNaN(t)?void 0:t}function Hl(e){try{if("string"==typeof e)return[e];if(e instanceof URLSearchParams)return[e.toString()];if(e instanceof FormData)return[ql(e)];if(!e)return[void 0]}catch(t){return $s&&Gs.exception(t,"Failed to serialize body",e),[void 0,"BODY_PARSE_ERROR"]}return $s&&Gs.info("Skipping network body because of body type",e),[void 0,"UNPARSEABLE_BODY_TYPE"]}function Wl(e,t){if(!e)return{headers:{},size:void 0,_meta:{warnings:[t]}};const n={...e._meta},r=n.warnings||[];return n.warnings=[...r,t],e._meta=n,e}function Gl(e,t){if(!t)return null;const{startTimestamp:n,endTimestamp:r,url:o,method:i,statusCode:a,request:s,response:l}=t;return{type:e,start:n/1e3,end:r/1e3,name:o,data:J({method:i,statusCode:a,request:s,response:l})}}function jl(e){return{headers:{},size:e,_meta:{warnings:["URL_SKIPPED"]}}}function Ul(e,t,n){if(!t&&0===Object.keys(e).length)return;if(!t)return{headers:e};if(!n)return{headers:e,size:t};const r={headers:e,size:t},{body:o,warnings:i}=function(e){if(!e||"string"!=typeof e)return{body:e};const t=e.length>Ii,n=function(e){const t=e[0],n=e[e.length-1];return"["===t&&"]"===n||"{"===t&&"}"===n}(e);if(t){const t=e.slice(0,Ii);return n?{body:t,warnings:["MAYBE_JSON_TRUNCATED"]}:{body:`${t}`,warnings:["TEXT_TRUNCATED"]}}if(n)try{return{body:JSON.parse(e)}}catch(e){}return{body:e}}(n);return r.body=o,i&&i.length>0&&(r._meta={warnings:i}),r}function Yl(e,t){return Object.entries(e).reduce(((n,[r,o])=>{const i=r.toLowerCase();return t.includes(i)&&e[r]&&(n[i]=o),n}),{})}function ql(e){return new URLSearchParams(e).toString()}function Xl(e,t){const n=function(e,t=Di.document.baseURI){if(e.startsWith("http://")||e.startsWith("https://")||e.startsWith(Di.location.origin))return e;const n=new URL(e,t);if(n.origin!==new URL(t).origin)return e;const r=n.href;return!e.endsWith("/")&&r.endsWith("/")?r.slice(0,-1):r}(e);return U(n,t)}function zl(e=[]){if(2===e.length&&"object"==typeof e[1])return e[1].body}function Vl(e,t){const n={};return t.forEach((t=>{e.get(t)&&(n[t]=e.get(t))})),n}function Zl(e,t){if(!e)return{};const n=e.headers;return n?n instanceof Headers?Vl(n,t):Array.isArray(n)?{}:Yl(n,t):{}}function Kl(e){const t=He();try{const{networkDetailAllowUrls:n,networkDetailDenyUrls:r,networkCaptureBodies:o,networkRequestHeaders:i,networkResponseHeaders:a}=e.getOptions(),s={replay:e,networkDetailAllowUrls:n,networkDetailDenyUrls:r,networkCaptureBodies:o,networkRequestHeaders:i,networkResponseHeaders:a};t&&t.on("beforeAddBreadcrumb",((e,t)=>function(e,t,n){if(t.data)try{(function(e){return"xhr"===e.category})(t)&&function(e){return e&&e.xhr}(n)&&(function(e,t){const{xhr:n,input:r}=t;if(!n)return;const o=$l(r),i=n.getResponseHeader("content-length")?Fl(n.getResponseHeader("content-length")):function(e,t){try{return $l("json"===t&&e&&"object"==typeof e?JSON.stringify(e):e)}catch(e){return}}(n.response,n.responseType);void 0!==o&&(e.data.request_body_size=o),void 0!==i&&(e.data.response_body_size=i)}(t,n),async function(e,t,n){try{const r=function(e,t,n){const r=Date.now(),{startTimestamp:o=r,endTimestamp:i=r,input:a,xhr:s}=t,{url:l,method:c,status_code:u=0,request_body_size:d,response_body_size:h}=e.data;if(!l)return null;if(!s||!Xl(l,n.networkDetailAllowUrls)||Xl(l,n.networkDetailDenyUrls))return{startTimestamp:o,endTimestamp:i,url:l,method:c,statusCode:u,request:jl(d),response:jl(h)};const m=s[vo],p=m?Yl(m.request_headers,n.networkRequestHeaders):{},f=Yl(function(e){const t=e.getAllResponseHeaders();return t?t.split("\r\n").reduce(((e,t)=>{const[n,r]=t.split(": ");return r&&(e[n.toLowerCase()]=r),e}),{}):{}}(s),n.networkResponseHeaders),[g,y]=n.networkCaptureBodies?Hl(a):[void 0],[v,b]=n.networkCaptureBodies?function(e){const t=[];try{return[e.responseText]}catch(e){t.push(e)}try{return function(e,t){try{if("string"==typeof e)return[e];if(e instanceof Document)return[e.body.outerHTML];if("json"===t&&e&&"object"==typeof e)return[JSON.stringify(e)];if(!e)return[void 0]}catch(t){return $s&&Gs.exception(t,"Failed to serialize body",e),[void 0,"BODY_PARSE_ERROR"]}return $s&&Gs.info("Skipping network body because of body type",e),[void 0,"UNPARSEABLE_BODY_TYPE"]}(e.response,e.responseType)}catch(e){t.push(e)}return $s&&Gs.warn("Failed to get xhr response body",...t),[void 0]}(s):[void 0],w=Ul(p,d,g),C=Ul(f,h,v);return{startTimestamp:o,endTimestamp:i,url:l,method:c,statusCode:u,request:y?Wl(w,y):w,response:b?Wl(C,b):C}}(e,t,n),o=Gl("resource.xhr",r);Ol(n.replay,o)}catch(e){$s&&Gs.exception(e,"Failed to capture xhr breadcrumb")}}(t,n,e)),function(e){return"fetch"===e.category}(t)&&function(e){return e&&e.response}(n)&&(function(e,t){const{input:n,response:r}=t,o=$l(n?zl(n):void 0),i=r?Fl(r.headers.get("content-length")):void 0;void 0!==o&&(e.data.request_body_size=o),void 0!==i&&(e.data.response_body_size=i)}(t,n),async function(e,t,n){try{const r=await async function(e,t,n){const r=Date.now(),{startTimestamp:o=r,endTimestamp:i=r}=t,{url:a,method:s,status_code:l=0,request_body_size:c,response_body_size:u}=e.data,d=Xl(a,n.networkDetailAllowUrls)&&!Xl(a,n.networkDetailDenyUrls),h=d?function({networkCaptureBodies:e,networkRequestHeaders:t},n,r){const o=n?(a=t,1===(i=n).length&&"string"!=typeof i[0]?Zl(i[0],a):2===i.length?Zl(i[1],a):{}):{};var i,a;if(!e)return Ul(o,r,void 0);const s=zl(n),[l,c]=Hl(s),u=Ul(o,r,l);return c?Wl(u,c):u}(n,t.input,c):jl(c),m=await async function(e,{networkCaptureBodies:t,networkResponseHeaders:n},r,o){if(!e&&void 0!==o)return jl(o);const i=r?Vl(r.headers,n):{};if(!r||!t&&void 0!==o)return Ul(i,o,void 0);const[a,s]=await async function(e){const t=function(e){try{return e.clone()}catch(e){$s&&Gs.exception(e,"Failed to clone response body")}}(e);if(!t)return[void 0,"BODY_PARSE_ERROR"];try{const e=await function(e){return new Promise(((t,n)=>{const r=bi((()=>n(new Error("Timeout while trying to read response body"))),500);(async function(e){return await e.text()})(e).then((e=>t(e)),(e=>n(e))).finally((()=>clearTimeout(r)))}))}(t);return[e]}catch(e){return $s&&Gs.exception(e,"Failed to get text body from response"),[void 0,"BODY_PARSE_ERROR"]}}(r),l=function(e,{networkCaptureBodies:t,responseBodySize:n,captureDetails:r,headers:o}){try{const i=e&&e.length&&void 0===n?$l(e):n;return r?Ul(o,i,t?e:void 0):jl(i)}catch(e){return $s&&Gs.exception(e,"Failed to serialize response body"),Ul(o,n,void 0)}}(a,{networkCaptureBodies:t,responseBodySize:o,captureDetails:e,headers:i});return s?Wl(l,s):l}(d,n,t.response,u);return{startTimestamp:o,endTimestamp:i,url:a,method:s,statusCode:l,request:h,response:m}}(e,t,n),o=Gl("resource.fetch",r);Ol(n.replay,o)}catch(e){$s&&Gs.exception(e,"Failed to capture fetch breadcrumb")}}(t,n,e))}catch(e){$s&&Gs.exception(e,"Error when enriching network breadcrumb")}}(s,e,t)))}catch(e){}}function Jl(e){const t=He();Ai((e=>t=>{if(!e.isEnabled())return;const n=function(e){const{target:t,message:n}=function(e){const t="click"===e.name;let n,r=null;try{r=t?Vs(e.event):Zs(e.event),n=L(r,{maxStringLength:200})||"<unknown>"}catch(e){n="<unknown>"}return{target:r,message:n}}(e);return tl({category:`ui.${e.name}`,...il(t,n)})}(t);if(!n)return;const r="click"===t.name,o=r?t.event:void 0;var i,a,s;!(r&&e.clickDetector&&o&&o.target)||o.altKey||o.metaKey||o.ctrlKey||o.shiftKey||(i=e.clickDetector,a=n,s=Vs(t.event),i.handleClick(a,s)),qs(e,n)})(e)),$r(function(e){return t=>{if(!e.isEnabled())return;const n=function(e){const{from:t,to:n}=e,r=Date.now()/1e3;return{type:"navigation.push",start:r,end:r,name:n,data:{previous:t}}}(t);null!==n&&(e.getContext().urls.push(n.name),e.triggerUserActivity(),e.addUpdate((()=>(Bl(e,[n]),!1))))}}(e)),function(e){const t=He();t&&t.on("beforeAddBreadcrumb",(t=>function(e,t){if(!e.isEnabled()||!Pl(t))return;const n=function(e){return!Pl(e)||["fetch","xhr","sentry.event","sentry.transaction"].includes(e.category)||e.category.startsWith("ui.")?null:"console"===e.category?function(e){const t=e.data&&e.data.arguments;if(!Array.isArray(t)||0===t.length)return tl(e);let n=!1;const r=t.map((e=>{if(!e)return e;if("string"==typeof e)return e.length>Ri?(n=!0,`${e.slice(0,Ri)}`):e;if("object"==typeof e)try{const t=Ot(e,7);return JSON.stringify(t).length>Ri?(n=!0,`${JSON.stringify(t,null,2).slice(0,Ri)}`):t}catch(e){}return e}));return tl({...e,data:{...e.data,arguments:r,...n?{_meta:{warnings:["CONSOLE_ARG_TRUNCATED"]}}:{}}})}(e):tl(e)}(t);n&&qs(e,n)}(e,t)))}(e),Kl(e);const n=function(e){return Object.assign(((t,n)=>{if(!e.isEnabled())return t;if(function(e){return"replay_event"===e.type}(t))return delete t.breadcrumbs,t;if(!Rl(t)&&!Ll(t)&&!Tl(t))return t;if(!e.checkAndHandleExpiredSession())return t;if(Tl(t))return e.flush(),t.contexts.feedback.replay_id=e.getSessionId(),function(e,t){e.triggerUserActivity(),e.addUpdate((()=>!t.timestamp||(e.throttledAddEvent({type:Xa.Custom,timestamp:1e3*t.timestamp,data:{tag:"breadcrumb",payload:{timestamp:t.timestamp,type:"default",category:"sentry.feedback",data:{feedbackId:t.event_id}}}}),!1)))}(e,t),t;if(function(e,t){return!(e.type||!e.exception||!e.exception.values||!e.exception.values.length||!t.originalException||!t.originalException.__rrweb__)}(t,n)&&!e.getOptions()._experiments.captureExceptions)return $s&&Gs.log("Ignoring error from rrweb internals",t),null;const r=function(e,t){return"buffer"===e.recordingMode&&t.message!==Ni&&!(!t.exception||t.type)&&Cl(e.getOptions().errorSampleRate)}(e,t);return(r||"session"===e.recordingMode)&&(t.tags={...t.tags,replayId:e.getSessionId()}),t}),{id:"Replay"})}(e);var r;r=n,Oe().addEventProcessor(r),t&&(t.on("beforeSendEvent",function(e){return t=>{e.isEnabled()&&Rl(t)&&function(e,t){const n=t.exception&&t.exception.values&&t.exception.values[0]&&t.exception.values[0].value;"string"==typeof n&&(n.match(/(reactjs\.org\/docs\/error-decoder\.html\?invariant=|react\.dev\/errors\/)(418|419|422|423|425)/)||n.match(/(does not match server-rendered HTML|Hydration failed because)/i))&&qs(e,tl({category:"replay.hydrate-error",data:{url:P()}}))}(e,t)}}(e)),t.on("afterSendEvent",function(e){return(t,n)=>{if(!e.isEnabled()||!Rl(t)&&!Ll(t))return;const r=n&&n.statusCode;!r||r<200||r>=300||(Ll(t)?function(e,t){const n=e.getContext();t.contexts&&t.contexts.trace&&t.contexts.trace.trace_id&&n.traceIds.size<100&&n.traceIds.add(t.contexts.trace.trace_id)}(e,t):function(e,t){const n=e.getContext();if(t.event_id&&n.errorIds.size<100&&n.errorIds.add(t.event_id),"buffer"!==e.recordingMode||!t.tags||!t.tags.replayId)return;const{beforeErrorSampling:r}=e.getOptions();("function"!=typeof r||r(t))&&bi((()=>{e.sendBufferedReplayOrFlush()}))}(e,t))}}(e)),t.on("createDsc",(t=>{const n=e.getSessionId();n&&e.isEnabled()&&"session"===e.recordingMode&&e.checkAndHandleExpiredSession()&&(t.replay_id=n)})),t.on("spanStart",(t=>{e.lastActiveSpan=t})),t.on("spanEnd",(t=>{e.lastActiveSpan=t})),t.on("beforeSendFeedback",((t,n)=>{const r=e.getSessionId();n&&n.includeReplay&&e.isEnabled()&&r&&t.contexts&&t.contexts.feedback&&(t.contexts.feedback.replay_id=r)})))}function Ql(e){const{jsHeapSizeLimit:t,totalJSHeapSize:n,usedJSHeapSize:r}=e,o=Date.now()/1e3;return{type:"memory",name:"memory",start:o,end:o,data:{memory:{jsHeapSizeLimit:t,totalJSHeapSize:n,usedJSHeapSize:r}}}}function ec(e){let t=!1;return(n,r)=>{if(!e.checkAndHandleExpiredSession())return void($s&&Gs.warn("Received replay event after session expired."));const o=r||!t;t=!0,e.clickDetector&&function(e,t){try{if(!function(e){return e.type===js}(t))return;const{source:n}=t.data;if(n===za.Mutation&&e.registerMutation(t.timestamp),n===za.Scroll&&e.registerScroll(t.timestamp),function(e){return e.data.source===za.MouseInteraction}(t)){const{type:n,id:r}=t.data,o=Os.mirror.getNode(r);o instanceof HTMLElement&&n===Va.Click&&e.registerClick(o)}}catch(e){}}(e.clickDetector,n),e.addUpdate((()=>{if("buffer"===e.recordingMode&&o&&e.setInitialState(),!xl(e,n,o))return!0;if(!o)return!1;if(function(e,t){t&&e.session&&0===e.session.segmentId&&xl(e,function(e){const t=e.getOptions();return{type:Xa.Custom,timestamp:Date.now(),data:{tag:"options",payload:{shouldRecordCanvas:e.isRecordingCanvas(),sessionSampleRate:t.sessionSampleRate,errorSampleRate:t.errorSampleRate,useCompressionOption:t.useCompression,blockAllMedia:t.blockAllMedia,maskAllText:t.maskAllText,maskAllInputs:t.maskAllInputs,useCompression:!!e.eventBuffer&&"worker"===e.eventBuffer.type,networkDetailHasUrls:t.networkDetailAllowUrls.length>0,networkCaptureBodies:t.networkCaptureBodies,networkRequestHasHeaders:t.networkRequestHeaders.length>0,networkResponseHasHeaders:t.networkResponseHeaders.length>0}}}}(e),!1)}(e,o),e.session&&e.session.previousSessionId)return!0;if("buffer"===e.recordingMode&&e.session&&e.eventBuffer){const t=e.eventBuffer.getEarliestTimestamp();t&&($s&&Gs.info(`Updating session start time to earliest event in buffer to ${new Date(t)}`),e.session.started=t,e.getOptions().stickySession&&kl(e.session))}return"session"===e.recordingMode&&e.flush(),!0}))}}class tc extends Error{constructor(e){super(`Transport returned status code ${e}`)}}class nc extends Error{constructor(e){super("Rate limit hit"),this.rateLimits=e}}async function rc(e,t={count:0,interval:5e3}){const{recordingData:n,options:r}=e;var o;if(n.length)try{return await async function({recordingData:e,replayId:t,segmentId:n,eventContext:r,timestamp:o,session:i}){const a=function({recordingData:e,headers:t}){let n;const r=`${JSON.stringify(t)}\n`;if("string"==typeof e)n=`${r}${e}`;else{const t=(new TextEncoder).encode(r);n=new Uint8Array(t.length+e.length),n.set(t),n.set(e,t.length)}return n}({recordingData:e,headers:{segment_id:n}}),{urls:s,errorIds:l,traceIds:c,initialTimestamp:u}=r,d=He(),h=Be(),m=d&&d.getTransport(),p=d&&d.getDsn();if(!(d&&m&&p&&i.sampled))return Jr({});const f={type:xi,replay_start_timestamp:u/1e3,timestamp:o/1e3,error_ids:l,trace_ids:c,urls:s,replay_id:t,segment_id:n,replay_type:i.sampled},g=await async function({client:e,scope:t,replayId:n,event:r}){const o={event_id:n,integrations:"object"!=typeof e._integrations||null===e._integrations||Array.isArray(e._integrations)?void 0:Object.keys(e._integrations)};e.emit("preprocessEvent",r,o);const i=await oo(e.getOptions(),r,o,t,e,Oe());if(!i)return null;i.platform=i.platform||"javascript";const a=e.getSdkMetadata(),{name:s,version:l}=a&&a.sdk||{};return i.sdk={...i.sdk,name:s||"sentry.javascript.unknown",version:l||"0.0.0"},i}({scope:h,client:d,replayId:t,event:f});if(!g)return d.recordDroppedEvent("event_processor","replay",f),$s&&Gs.info("An event processor returned `null`, will not send event."),Jr({});delete g.sdkProcessingMetadata;const y=function(e,t,n,r){return Ht(Zt(e,Vt(e),r,n),[[{type:"replay_event"},e],[{type:"replay_recording",length:"string"==typeof t?(new TextEncoder).encode(t).length:t.length},t]])}(g,a,p,d.getOptions().tunnel);let v;try{v=await m.send(y)}catch(e){const t=new Error(Ni);try{t.cause=e}catch(e){}throw t}if("number"==typeof v.statusCode&&(v.statusCode<200||v.statusCode>=300))throw new tc(v.statusCode);const b=pi({},v);if(mi(b,"replay"))throw new nc(b);return v}(e),!0}catch(n){if(n instanceof tc||n instanceof nc)throw n;if("Replays",o={_retryCount:t.count},Oe().setContext("Replays",o),$s&&r._experiments&&r._experiments.captureExceptions&&so(n),t.count>=3){const e=new Error(`${Ni} - max retries exceeded`);try{e.cause=n}catch(e){}throw e}return t.interval*=++t.count,new Promise(((n,r)=>{bi((async()=>{try{await rc(e,t),n(!0)}catch(e){r(e)}}),t.interval)}))}}const oc="__THROTTLED";class ic{constructor({options:e,recordingOptions:t}){ic.prototype.__init.call(this),ic.prototype.__init2.call(this),ic.prototype.__init3.call(this),ic.prototype.__init4.call(this),ic.prototype.__init5.call(this),ic.prototype.__init6.call(this),this.eventBuffer=null,this.performanceEntries=[],this.replayPerformanceEntries=[],this.recordingMode="session",this.timeouts={sessionIdlePause:3e5,sessionIdleExpire:9e5},this._lastActivity=Date.now(),this._isEnabled=!1,this._isPaused=!1,this._requiresManualStart=!1,this._hasInitializedCoreListeners=!1,this._context={errorIds:new Set,traceIds:new Set,urls:[],initialTimestamp:Date.now(),initialUrl:""},this._recordingOptions=t,this._options=e,this._debouncedFlush=function(e,t,n){let r,o,i;const a=n&&n.maxWait?Math.max(n.maxWait,t):0;function s(){return l(),r=e(),r}function l(){void 0!==o&&clearTimeout(o),void 0!==i&&clearTimeout(i),o=i=void 0}function c(){return o&&clearTimeout(o),o=bi(s,t),a&&void 0===i&&(i=bi(s,a)),r}return c.cancel=l,c.flush=function(){return void 0!==o||void 0!==i?s():r},c}((()=>this._flush()),this._options.flushMinDelay,{maxWait:this._options.flushMaxDelay}),this._throttledAddEvent=function(e,t,n){const r=new Map;let o=!1;return(...i)=>{const a=Math.floor(Date.now()/1e3);if((e=>{const t=e-n;r.forEach(((e,n)=>{n<t&&r.delete(n)}))})(a),[...r.values()].reduce(((e,t)=>e+t),0)>=t){const e=o;return o=!0,e?"__SKIPPED":oc}o=!1;const s=r.get(a)||0;return r.set(a,s+1),e(...i)}}(((e,t)=>function(e,t,n){return Il(e,t)?Nl(e,t,n):Promise.resolve(null)}(this,e,t)),300,5);const{slowClickTimeout:n,slowClickIgnoreSelectors:r}=this.getOptions(),o=n?{threshold:Math.min(3e3,n),timeout:n,scrollTimeout:300,ignoreSelector:r?r.join(","):""}:void 0;if(o&&(this.clickDetector=new Js(this,o)),$s){const t=e._experiments;Gs.setConfig({captureExceptions:!!t.captureExceptions,traceInternals:!!t.traceInternals})}}getContext(){return this._context}isEnabled(){return this._isEnabled}isPaused(){return this._isPaused}isRecordingCanvas(){return Boolean(this._canvas)}getOptions(){return this._options}handleException(e){$s&&Gs.exception(e)}initializeSampling(e){const{errorSampleRate:t,sessionSampleRate:n}=this._options,r=t<=0&&n<=0;this._requiresManualStart=r,r||(this._initializeSessionForSampling(e),this.session?!1!==this.session.sampled&&(this.recordingMode="buffer"===this.session.sampled&&0===this.session.segmentId?"buffer":"session",$s&&Gs.infoTick(`Starting replay in ${this.recordingMode} mode`),this._initializeRecording()):$s&&Gs.exception(new Error("Unable to initialize and create session")))}start(){if(this._isEnabled&&"session"===this.recordingMode)return void($s&&Gs.info("Recording is already in progress"));if(this._isEnabled&&"buffer"===this.recordingMode)return void($s&&Gs.info("Buffering is in progress, call `flush()` to save the replay"));$s&&Gs.infoTick("Starting replay in session mode"),this._updateUserActivity();const e=Ml({maxReplayDuration:this._options.maxReplayDuration,sessionIdleExpire:this.timeouts.sessionIdleExpire},{stickySession:this._options.stickySession,sessionSampleRate:1,allowBuffering:!1});this.session=e,this._initializeRecording()}startBuffering(){if(this._isEnabled)return void($s&&Gs.info("Buffering is in progress, call `flush()` to save the replay"));$s&&Gs.infoTick("Starting replay in buffer mode");const e=Ml({sessionIdleExpire:this.timeouts.sessionIdleExpire,maxReplayDuration:this._options.maxReplayDuration},{stickySession:this._options.stickySession,sessionSampleRate:0,allowBuffering:!0});this.session=e,this.recordingMode="buffer",this._initializeRecording()}startRecording(){try{const e=this._canvas;this._stopRecording=Os({...this._recordingOptions,..."buffer"===this.recordingMode&&{checkoutEveryNms:6e4},emit:ec(this),onMutation:this._onMutationHandler,...e?{recordCanvas:e.recordCanvas,getCanvasManager:e.getCanvasManager,sampling:e.sampling,dataURLOptions:e.dataURLOptions}:{}})}catch(e){this.handleException(e)}}stopRecording(){try{return this._stopRecording&&(this._stopRecording(),this._stopRecording=void 0),!0}catch(e){return this.handleException(e),!1}}async stop({forceFlush:e=!1,reason:t}={}){if(this._isEnabled){this._isEnabled=!1;try{$s&&Gs.info("Stopping Replay"+(t?` triggered by ${t}`:"")),this._removeListeners(),this.stopRecording(),this._debouncedFlush.cancel(),e&&await this._flush({force:!0}),this.eventBuffer&&this.eventBuffer.destroy(),this.eventBuffer=null,n=this,function(){if(wl())try{Di.sessionStorage.removeItem(Mi)}catch(e){}}(),n.session=void 0}catch(e){this.handleException(e)}}var n}pause(){this._isPaused||(this._isPaused=!0,this.stopRecording(),$s&&Gs.info("Pausing replay"))}resume(){this._isPaused&&this._checkSession()&&(this._isPaused=!1,this.startRecording(),$s&&Gs.info("Resuming replay"))}async sendBufferedReplayOrFlush({continueRecording:e=!0}={}){if("session"===this.recordingMode)return this.flushImmediate();const t=Date.now();$s&&Gs.info("Converting buffer to session"),await this.flushImmediate();const n=this.stopRecording();e&&n&&"session"!==this.recordingMode&&(this.recordingMode="session",this.session&&(this._updateUserActivity(t),this._updateSessionActivity(t),this._maybeSaveSession()),this.startRecording())}addUpdate(e){const t=e();"buffer"!==this.recordingMode&&!0!==t&&this._debouncedFlush()}triggerUserActivity(){if(this._updateUserActivity(),this._stopRecording)this.checkAndHandleExpiredSession(),this._updateSessionActivity();else{if(!this._checkSession())return;this.resume()}}updateUserActivity(){this._updateUserActivity(),this._updateSessionActivity()}conditionalFlush(){return"buffer"===this.recordingMode?Promise.resolve():this.flushImmediate()}flush(){return this._debouncedFlush()}flushImmediate(){return this._debouncedFlush(),this._debouncedFlush.flush()}cancelFlush(){this._debouncedFlush.cancel()}getSessionId(){return this.session&&this.session.id}checkAndHandleExpiredSession(){if(!(this._lastActivity&&El(this._lastActivity,this.timeouts.sessionIdlePause)&&this.session&&"session"===this.session.sampled))return!!this._checkSession();this.pause()}setInitialState(){const e=`${Di.location.pathname}${Di.location.hash}${Di.location.search}`,t=`${Di.location.origin}${e}`;this.performanceEntries=[],this.replayPerformanceEntries=[],this._clearContext(),this._context.initialUrl=t,this._context.initialTimestamp=Date.now(),this._context.urls.push(t)}throttledAddEvent(e,t){const n=this._throttledAddEvent(e,t);if(n===oc){const e=tl({category:"replay.throttled"});this.addUpdate((()=>!xl(this,{type:5,timestamp:e.timestamp||0,data:{tag:"breadcrumb",payload:e,metric:!0}})))}return n}getCurrentRoute(){const e=this.lastActiveSpan||ft(),t=e&&pt(e),n=(t&&st(t).data||{})[je];if(t&&n&&["route","custom"].includes(n))return st(t).description}_initializeRecording(){this.setInitialState(),this._updateSessionActivity(),this.eventBuffer=function({useCompression:e,workerUrl:t}){if(e&&window.Worker){const e=function(e){try{const t=e||("undefined"!=typeof __SENTRY_EXCLUDE_REPLAY_WORKER__&&__SENTRY_EXCLUDE_REPLAY_WORKER__?"":function(){const e=new Blob(['var t=Uint8Array,n=Uint16Array,r=Int32Array,e=new t([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),i=new t([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),a=new t([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),s=function(t,e){for(var i=new n(31),a=0;a<31;++a)i[a]=e+=1<<t[a-1];var s=new r(i[30]);for(a=1;a<30;++a)for(var o=i[a];o<i[a+1];++o)s[o]=o-i[a]<<5|a;return{b:i,r:s}},o=s(e,2),f=o.b,h=o.r;f[28]=258,h[258]=28;for(var l=s(i,0).r,u=new n(32768),c=0;c<32768;++c){var v=(43690&c)>>1|(21845&c)<<1;v=(61680&(v=(52428&v)>>2|(13107&v)<<2))>>4|(3855&v)<<4,u[c]=((65280&v)>>8|(255&v)<<8)>>1}var d=function(t,r,e){for(var i=t.length,a=0,s=new n(r);a<i;++a)t[a]&&++s[t[a]-1];var o,f=new n(r);for(a=1;a<r;++a)f[a]=f[a-1]+s[a-1]<<1;if(e){o=new n(1<<r);var h=15-r;for(a=0;a<i;++a)if(t[a])for(var l=a<<4|t[a],c=r-t[a],v=f[t[a]-1]++<<c,d=v|(1<<c)-1;v<=d;++v)o[u[v]>>h]=l}else for(o=new n(i),a=0;a<i;++a)t[a]&&(o[a]=u[f[t[a]-1]++]>>15-t[a]);return o},g=new t(288);for(c=0;c<144;++c)g[c]=8;for(c=144;c<256;++c)g[c]=9;for(c=256;c<280;++c)g[c]=7;for(c=280;c<288;++c)g[c]=8;var w=new t(32);for(c=0;c<32;++c)w[c]=5;var p=d(g,9,0),y=d(w,5,0),m=function(t){return(t+7)/8|0},b=function(n,r,e){return(null==r||r<0)&&(r=0),(null==e||e>n.length)&&(e=n.length),new t(n.subarray(r,e))},M=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],E=function(t,n,r){var e=new Error(n||M[t]);if(e.code=t,Error.captureStackTrace&&Error.captureStackTrace(e,E),!r)throw e;return e},z=function(t,n,r){r<<=7&n;var e=n/8|0;t[e]|=r,t[e+1]|=r>>8},A=function(t,n,r){r<<=7&n;var e=n/8|0;t[e]|=r,t[e+1]|=r>>8,t[e+2]|=r>>16},_=function(r,e){for(var i=[],a=0;a<r.length;++a)r[a]&&i.push({s:a,f:r[a]});var s=i.length,o=i.slice();if(!s)return{t:F,l:0};if(1==s){var f=new t(i[0].s+1);return f[i[0].s]=1,{t:f,l:1}}i.sort((function(t,n){return t.f-n.f})),i.push({s:-1,f:25001});var h=i[0],l=i[1],u=0,c=1,v=2;for(i[0]={s:-1,f:h.f+l.f,l:h,r:l};c!=s-1;)h=i[i[u].f<i[v].f?u++:v++],l=i[u!=c&&i[u].f<i[v].f?u++:v++],i[c++]={s:-1,f:h.f+l.f,l:h,r:l};var d=o[0].s;for(a=1;a<s;++a)o[a].s>d&&(d=o[a].s);var g=new n(d+1),w=x(i[c-1],g,0);if(w>e){a=0;var p=0,y=w-e,m=1<<y;for(o.sort((function(t,n){return g[n.s]-g[t.s]||t.f-n.f}));a<s;++a){var b=o[a].s;if(!(g[b]>e))break;p+=m-(1<<w-g[b]),g[b]=e}for(p>>=y;p>0;){var M=o[a].s;g[M]<e?p-=1<<e-g[M]++-1:++a}for(;a>=0&&p;--a){var E=o[a].s;g[E]==e&&(--g[E],++p)}w=e}return{t:new t(g),l:w}},x=function(t,n,r){return-1==t.s?Math.max(x(t.l,n,r+1),x(t.r,n,r+1)):n[t.s]=r},D=function(t){for(var r=t.length;r&&!t[--r];);for(var e=new n(++r),i=0,a=t[0],s=1,o=function(t){e[i++]=t},f=1;f<=r;++f)if(t[f]==a&&f!=r)++s;else{if(!a&&s>2){for(;s>138;s-=138)o(32754);s>2&&(o(s>10?s-11<<5|28690:s-3<<5|12305),s=0)}else if(s>3){for(o(a),--s;s>6;s-=6)o(8304);s>2&&(o(s-3<<5|8208),s=0)}for(;s--;)o(a);s=1,a=t[f]}return{c:e.subarray(0,i),n:r}},T=function(t,n){for(var r=0,e=0;e<n.length;++e)r+=t[e]*n[e];return r},k=function(t,n,r){var e=r.length,i=m(n+2);t[i]=255&e,t[i+1]=e>>8,t[i+2]=255^t[i],t[i+3]=255^t[i+1];for(var a=0;a<e;++a)t[i+a+4]=r[a];return 8*(i+4+e)},C=function(t,r,s,o,f,h,l,u,c,v,m){z(r,m++,s),++f[256];for(var b=_(f,15),M=b.t,E=b.l,x=_(h,15),C=x.t,U=x.l,F=D(M),I=F.c,S=F.n,L=D(C),O=L.c,j=L.n,q=new n(19),B=0;B<I.length;++B)++q[31&I[B]];for(B=0;B<O.length;++B)++q[31&O[B]];for(var G=_(q,7),H=G.t,J=G.l,K=19;K>4&&!H[a[K-1]];--K);var N,P,Q,R,V=v+5<<3,W=T(f,g)+T(h,w)+l,X=T(f,M)+T(h,C)+l+14+3*K+T(q,H)+2*q[16]+3*q[17]+7*q[18];if(c>=0&&V<=W&&V<=X)return k(r,m,t.subarray(c,c+v));if(z(r,m,1+(X<W)),m+=2,X<W){N=d(M,E,0),P=M,Q=d(C,U,0),R=C;var Y=d(H,J,0);z(r,m,S-257),z(r,m+5,j-1),z(r,m+10,K-4),m+=14;for(B=0;B<K;++B)z(r,m+3*B,H[a[B]]);m+=3*K;for(var Z=[I,O],$=0;$<2;++$){var tt=Z[$];for(B=0;B<tt.length;++B){var nt=31&tt[B];z(r,m,Y[nt]),m+=H[nt],nt>15&&(z(r,m,tt[B]>>5&127),m+=tt[B]>>12)}}}else N=p,P=g,Q=y,R=w;for(B=0;B<u;++B){var rt=o[B];if(rt>255){A(r,m,N[(nt=rt>>18&31)+257]),m+=P[nt+257],nt>7&&(z(r,m,rt>>23&31),m+=e[nt]);var et=31&rt;A(r,m,Q[et]),m+=R[et],et>3&&(A(r,m,rt>>5&8191),m+=i[et])}else A(r,m,N[rt]),m+=P[rt]}return A(r,m,N[256]),m+P[256]},U=new r([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),F=new t(0),I=function(){for(var t=new Int32Array(256),n=0;n<256;++n){for(var r=n,e=9;--e;)r=(1&r&&-306674912)^r>>>1;t[n]=r}return t}(),S=function(){var t=-1;return{p:function(n){for(var r=t,e=0;e<n.length;++e)r=I[255&r^n[e]]^r>>>8;t=r},d:function(){return~t}}},L=function(){var t=1,n=0;return{p:function(r){for(var e=t,i=n,a=0|r.length,s=0;s!=a;){for(var o=Math.min(s+2655,a);s<o;++s)i+=e+=r[s];e=(65535&e)+15*(e>>16),i=(65535&i)+15*(i>>16)}t=e,n=i},d:function(){return(255&(t%=65521))<<24|(65280&t)<<8|(255&(n%=65521))<<8|n>>8}}},O=function(a,s,o,f,u){if(!u&&(u={l:1},s.dictionary)){var c=s.dictionary.subarray(-32768),v=new t(c.length+a.length);v.set(c),v.set(a,c.length),a=v,u.w=c.length}return function(a,s,o,f,u,c){var v=c.z||a.length,d=new t(f+v+5*(1+Math.ceil(v/7e3))+u),g=d.subarray(f,d.length-u),w=c.l,p=7&(c.r||0);if(s){p&&(g[0]=c.r>>3);for(var y=U[s-1],M=y>>13,E=8191&y,z=(1<<o)-1,A=c.p||new n(32768),_=c.h||new n(z+1),x=Math.ceil(o/3),D=2*x,T=function(t){return(a[t]^a[t+1]<<x^a[t+2]<<D)&z},F=new r(25e3),I=new n(288),S=new n(32),L=0,O=0,j=c.i||0,q=0,B=c.w||0,G=0;j+2<v;++j){var H=T(j),J=32767&j,K=_[H];if(A[J]=K,_[H]=J,B<=j){var N=v-j;if((L>7e3||q>24576)&&(N>423||!w)){p=C(a,g,0,F,I,S,O,q,G,j-G,p),q=L=O=0,G=j;for(var P=0;P<286;++P)I[P]=0;for(P=0;P<30;++P)S[P]=0}var Q=2,R=0,V=E,W=J-K&32767;if(N>2&&H==T(j-W))for(var X=Math.min(M,N)-1,Y=Math.min(32767,j),Z=Math.min(258,N);W<=Y&&--V&&J!=K;){if(a[j+Q]==a[j+Q-W]){for(var $=0;$<Z&&a[j+$]==a[j+$-W];++$);if($>Q){if(Q=$,R=W,$>X)break;var tt=Math.min(W,$-2),nt=0;for(P=0;P<tt;++P){var rt=j-W+P&32767,et=rt-A[rt]&32767;et>nt&&(nt=et,K=rt)}}}W+=(J=K)-(K=A[J])&32767}if(R){F[q++]=268435456|h[Q]<<18|l[R];var it=31&h[Q],at=31&l[R];O+=e[it]+i[at],++I[257+it],++S[at],B=j+Q,++L}else F[q++]=a[j],++I[a[j]]}}for(j=Math.max(j,B);j<v;++j)F[q++]=a[j],++I[a[j]];p=C(a,g,w,F,I,S,O,q,G,j-G,p),w||(c.r=7&p|g[p/8|0]<<3,p-=7,c.h=_,c.p=A,c.i=j,c.w=B)}else{for(j=c.w||0;j<v+w;j+=65535){var st=j+65535;st>=v&&(g[p/8|0]=w,st=v),p=k(g,p+1,a.subarray(j,st))}c.i=v}return b(d,0,f+m(p)+u)}(a,null==s.level?6:s.level,null==s.mem?Math.ceil(1.5*Math.max(8,Math.min(13,Math.log(a.length)))):12+s.mem,o,f,u)},j=function(t,n,r){for(;r;++n)t[n]=r,r>>>=8},q=function(t,n){var r=n.filename;if(t[0]=31,t[1]=139,t[2]=8,t[8]=n.level<2?4:9==n.level?2:0,t[9]=3,0!=n.mtime&&j(t,4,Math.floor(new Date(n.mtime||Date.now())/1e3)),r){t[3]=8;for(var e=0;e<=r.length;++e)t[e+10]=r.charCodeAt(e)}},B=function(t){return 10+(t.filename?t.filename.length+1:0)},G=function(){function n(n,r){if("function"==typeof n&&(r=n,n={}),this.ondata=r,this.o=n||{},this.s={l:0,i:32768,w:32768,z:32768},this.b=new t(98304),this.o.dictionary){var e=this.o.dictionary.subarray(-32768);this.b.set(e,32768-e.length),this.s.i=32768-e.length}}return n.prototype.p=function(t,n){this.ondata(O(t,this.o,0,0,this.s),n)},n.prototype.push=function(n,r){this.ondata||E(5),this.s.l&&E(4);var e=n.length+this.s.z;if(e>this.b.length){if(e>2*this.b.length-32768){var i=new t(-32768&e);i.set(this.b.subarray(0,this.s.z)),this.b=i}var a=this.b.length-this.s.z;a&&(this.b.set(n.subarray(0,a),this.s.z),this.s.z=this.b.length,this.p(this.b,!1)),this.b.set(this.b.subarray(-32768)),this.b.set(n.subarray(a),32768),this.s.z=n.length-a+32768,this.s.i=32766,this.s.w=32768}else this.b.set(n,this.s.z),this.s.z+=n.length;this.s.l=1&r,(this.s.z>this.s.w+8191||r)&&(this.p(this.b,r||!1),this.s.w=this.s.i,this.s.i-=2)},n}();var H=function(){function t(t,n){this.c=L(),this.v=1,G.call(this,t,n)}return t.prototype.push=function(t,n){this.c.p(t),G.prototype.push.call(this,t,n)},t.prototype.p=function(t,n){var r=O(t,this.o,this.v&&(this.o.dictionary?6:2),n&&4,this.s);this.v&&(function(t,n){var r=n.level,e=0==r?0:r<6?1:9==r?3:2;if(t[0]=120,t[1]=e<<6|(n.dictionary&&32),t[1]|=31-(t[0]<<8|t[1])%31,n.dictionary){var i=L();i.p(n.dictionary),j(t,2,i.d())}}(r,this.o),this.v=0),n&&j(r,r.length-4,this.c.d()),this.ondata(r,n)},t}(),J="undefined"!=typeof TextEncoder&&new TextEncoder,K="undefined"!=typeof TextDecoder&&new TextDecoder;try{K.decode(F,{stream:!0})}catch(t){}var N=function(){function t(t){this.ondata=t}return t.prototype.push=function(t,n){this.ondata||E(5),this.d&&E(4),this.ondata(P(t),this.d=n||!1)},t}();function P(n,r){if(r){for(var e=new t(n.length),i=0;i<n.length;++i)e[i]=n.charCodeAt(i);return e}if(J)return J.encode(n);var a=n.length,s=new t(n.length+(n.length>>1)),o=0,f=function(t){s[o++]=t};for(i=0;i<a;++i){if(o+5>s.length){var h=new t(o+8+(a-i<<1));h.set(s),s=h}var l=n.charCodeAt(i);l<128||r?f(l):l<2048?(f(192|l>>6),f(128|63&l)):l>55295&&l<57344?(f(240|(l=65536+(1047552&l)|1023&n.charCodeAt(++i))>>18),f(128|l>>12&63),f(128|l>>6&63),f(128|63&l)):(f(224|l>>12),f(128|l>>6&63),f(128|63&l))}return b(s,0,o)}function Q(t){return function(t,n){n||(n={});var r=S(),e=t.length;r.p(t);var i=O(t,n,B(n),8),a=i.length;return q(i,n),j(i,a-8,r.d()),j(i,a-4,e),i}(P(t))}const R=new class{constructor(){this._init()}clear(){this._init()}addEvent(t){if(!t)throw new Error("Adding invalid event");const n=this._hasEvents?",":"";this.stream.push(n+t),this._hasEvents=!0}finish(){this.stream.push("]",!0);const t=function(t){let n=0;for(const r of t)n+=r.length;const r=new Uint8Array(n);for(let n=0,e=0,i=t.length;n<i;n++){const i=t[n];r.set(i,e),e+=i.length}return r}(this._deflatedData);return this._init(),t}_init(){this._hasEvents=!1,this._deflatedData=[],this.deflate=new H,this.deflate.ondata=(t,n)=>{this._deflatedData.push(t)},this.stream=new N(((t,n)=>{this.deflate.push(t,n)})),this.stream.push("[")}},V={clear:()=>{R.clear()},addEvent:t=>R.addEvent(t),finish:()=>R.finish(),compress:t=>Q(t)};addEventListener("message",(function(t){const n=t.data.method,r=t.data.id,e=t.data.arg;if(n in V&&"function"==typeof V[n])try{const t=V[n](e);postMessage({id:r,method:n,success:!0,response:t})}catch(t){postMessage({id:r,method:n,success:!1,response:t.message}),console.error(t)}})),postMessage({id:void 0,method:"init",success:!0,response:void 0});']);return URL.createObjectURL(e)}());if(!t)return;$s&&Gs.info("Using compression worker"+(e?` from ${e}`:""));const n=new Worker(t);return new bl(n)}catch(e){$s&&Gs.exception(e,"Failed to create compression worker")}}(t);if(e)return e}return $s&&Gs.info("Using simple buffer"),new gl}({useCompression:this._options.useCompression,workerUrl:this._options.workerUrl}),this._removeListeners(),this._addListeners(),this._isEnabled=!0,this._isPaused=!1,this.startRecording()}_initializeSessionForSampling(e){const t=this._options.errorSampleRate>0,n=Ml({sessionIdleExpire:this.timeouts.sessionIdleExpire,maxReplayDuration:this._options.maxReplayDuration,previousSessionId:e},{stickySession:this._options.stickySession,sessionSampleRate:this._options.sessionSampleRate,allowBuffering:t});this.session=n}_checkSession(){if(!this.session)return!1;const e=this.session;return!Dl(e,{sessionIdleExpire:this.timeouts.sessionIdleExpire,maxReplayDuration:this._options.maxReplayDuration})||(this._refreshSession(e),!1)}async _refreshSession(e){this._isEnabled&&(await this.stop({reason:"refresh session"}),this.initializeSampling(e.id))}_addListeners(){try{Di.document.addEventListener("visibilitychange",this._handleVisibilityChange),Di.addEventListener("blur",this._handleWindowBlur),Di.addEventListener("focus",this._handleWindowFocus),Di.addEventListener("keydown",this._handleKeyboardEvent),this.clickDetector&&this.clickDetector.addListeners(),this._hasInitializedCoreListeners||(Jl(this),this._hasInitializedCoreListeners=!0)}catch(e){this.handleException(e)}this._performanceCleanupCallback=function(e){function t(t){e.performanceEntries.includes(t)||e.performanceEntries.push(t)}function n({entries:e}){e.forEach(t)}const r=[];return["navigation","paint","resource"].forEach((e=>{r.push(ir(e,n))})),r.push(nr(sl(ul,e)),tr(sl(dl,e)),rr(sl(hl,e)),or(sl(ml,e))),()=>{r.forEach((e=>e()))}}(this)}_removeListeners(){try{Di.document.removeEventListener("visibilitychange",this._handleVisibilityChange),Di.removeEventListener("blur",this._handleWindowBlur),Di.removeEventListener("focus",this._handleWindowFocus),Di.removeEventListener("keydown",this._handleKeyboardEvent),this.clickDetector&&this.clickDetector.removeListeners(),this._performanceCleanupCallback&&this._performanceCleanupCallback()}catch(e){this.handleException(e)}}__init(){this._handleVisibilityChange=()=>{"visible"===Di.document.visibilityState?this._doChangeToForegroundTasks():this._doChangeToBackgroundTasks()}}__init2(){this._handleWindowBlur=()=>{const e=tl({category:"ui.blur"});this._doChangeToBackgroundTasks(e)}}__init3(){this._handleWindowFocus=()=>{const e=tl({category:"ui.focus"});this._doChangeToForegroundTasks(e)}}__init4(){this._handleKeyboardEvent=e=>{!function(e,t){if(!e.isEnabled())return;e.updateUserActivity();const n=function(e){const{metaKey:t,shiftKey:n,ctrlKey:r,altKey:o,key:i,target:a}=e;if(!a||function(e){return"INPUT"===e.tagName||"TEXTAREA"===e.tagName||e.isContentEditable}(a)||!i)return null;const s=t||r||o,l=1===i.length;if(!s&&l)return null;const c=L(a,{maxStringLength:200})||"<unknown>";return tl({category:"ui.keyDown",message:c,data:{...il(a,c).data,metaKey:t,shiftKey:n,ctrlKey:r,altKey:o,key:i}})}(t);n&&qs(e,n)}(this,e)}}_doChangeToBackgroundTasks(e){this.session&&(Sl(this.session,{maxReplayDuration:this._options.maxReplayDuration,sessionIdleExpire:this.timeouts.sessionIdleExpire})||(e&&this._createCustomBreadcrumb(e),this.conditionalFlush()))}_doChangeToForegroundTasks(e){this.session&&(this.checkAndHandleExpiredSession()?e&&this._createCustomBreadcrumb(e):$s&&Gs.info("Document has become active, but session has expired"))}_updateUserActivity(e=Date.now()){this._lastActivity=e}_updateSessionActivity(e=Date.now()){this.session&&(this.session.lastActivity=e,this._maybeSaveSession())}_createCustomBreadcrumb(e){this.addUpdate((()=>{this.throttledAddEvent({type:Xa.Custom,timestamp:e.timestamp||0,data:{tag:"breadcrumb",payload:e}})}))}_addPerformanceEntries(){const e=(t=this.performanceEntries,t.map(ll).filter(Boolean)).concat(this.replayPerformanceEntries);var t;return this.performanceEntries=[],this.replayPerformanceEntries=[],Promise.all(Bl(this,e))}_clearContext(){this._context.errorIds.clear(),this._context.traceIds.clear(),this._context.urls=[]}_updateInitialTimestampFromEventBuffer(){const{session:e,eventBuffer:t}=this;if(!e||!t||this._requiresManualStart)return;if(e.segmentId)return;const n=t.getEarliestTimestamp();n&&n<this._context.initialTimestamp&&(this._context.initialTimestamp=n)}_popEventContext(){const e={initialTimestamp:this._context.initialTimestamp,initialUrl:this._context.initialUrl,errorIds:Array.from(this._context.errorIds),traceIds:Array.from(this._context.traceIds),urls:this._context.urls};return this._clearContext(),e}async _runFlush(){const e=this.getSessionId();if(this.session&&this.eventBuffer&&e){if(await this._addPerformanceEntries(),this.eventBuffer&&this.eventBuffer.hasEvents&&(await async function(e){try{return Promise.all(Bl(e,[Ql(Di.performance.memory)]))}catch(e){return[]}}(this),this.eventBuffer&&e===this.getSessionId()))try{this._updateInitialTimestampFromEventBuffer();const t=Date.now();if(t-this._context.initialTimestamp>this._options.maxReplayDuration+3e4)throw new Error("Session is too long, not sending replay");const n=this._popEventContext(),r=this.session.segmentId++;this._maybeSaveSession();const o=await this.eventBuffer.finish();await rc({replayId:e,recordingData:o,segmentId:r,eventContext:n,session:this.session,options:this.getOptions(),timestamp:t})}catch(e){this.handleException(e),this.stop({reason:"sendReplay"});const t=He();t&&t.recordDroppedEvent("send_error","replay")}}else $s&&Gs.error("No session or eventBuffer found to flush.")}__init5(){this._flush=async({force:e=!1}={})=>{if(!this._isEnabled&&!e)return;if(!this.checkAndHandleExpiredSession())return void($s&&Gs.error("Attempting to finish replay event after session expired."));if(!this.session)return;const t=this.session.started,n=Date.now()-t;this._debouncedFlush.cancel();const r=n<this._options.minReplayDuration,o=n>this._options.maxReplayDuration+5e3;if(r||o)return $s&&Gs.info(`Session duration (${Math.floor(n/1e3)}s) is too ${r?"short":"long"}, not sending replay.`),void(r&&this._debouncedFlush());const i=this.eventBuffer;if(i&&0===this.session.segmentId&&!i.hasCheckout&&$s&&Gs.info("Flushing initial segment without checkout."),!this._flushLock)return this._flushLock=this._runFlush(),await this._flushLock,void(this._flushLock=void 0);try{await this._flushLock}catch(e){$s&&Gs.error(e)}finally{this._debouncedFlush()}}}_maybeSaveSession(){this.session&&this._options.stickySession&&kl(this.session)}__init6(){this._onMutationHandler=e=>{const t=e.length,n=this._options.mutationLimit,r=n&&t>n;if(t>this._options.mutationBreadcrumbLimit||r){const e=tl({category:"replay.mutations",data:{count:t,limit:r}});this._createCustomBreadcrumb(e)}return!r||(this.stop({reason:"mutationLimit",forceFlush:"session"===this.recordingMode}),!1)}}}function ac(e,t){return[...e,...t].join(",")}const sc='img,image,svg,video,object,picture,embed,map,audio,link[rel="icon"],link[rel="apple-touch-icon"]',lc=["content-length","content-type","accept"];let cc=!1;class uc{static __initStatic(){this.id="Replay"}constructor({flushMinDelay:e=5e3,flushMaxDelay:t=5500,minReplayDuration:n=4999,maxReplayDuration:r=36e5,stickySession:o=!0,useCompression:i=!0,workerUrl:a,_experiments:s={},maskAllText:l=!0,maskAllInputs:c=!0,blockAllMedia:u=!0,mutationBreadcrumbLimit:d=750,mutationLimit:h=1e4,slowClickTimeout:m=7e3,slowClickIgnoreSelectors:p=[],networkDetailAllowUrls:f=[],networkDetailDenyUrls:g=[],networkCaptureBodies:y=!0,networkRequestHeaders:v=[],networkResponseHeaders:b=[],mask:w=[],maskAttributes:C=["title","placeholder"],unmask:_=[],block:k=[],unblock:A=[],ignore:E=[],maskFn:S,beforeAddRecordingEvent:D,beforeErrorSampling:M}={}){this.name=uc.id;const x=function({mask:e,unmask:t,block:n,unblock:r,ignore:o}){return{maskTextSelector:ac(e,[".sentry-mask","[data-sentry-mask]"]),unmaskTextSelector:ac(t,[]),blockSelector:ac(n,[".sentry-block","[data-sentry-block]",'base[href="/"]']),unblockSelector:ac(r,[]),ignoreSelector:ac(o,[".sentry-ignore","[data-sentry-ignore]",'input[type="file"]'])}}({mask:w,unmask:_,block:k,unblock:A,ignore:E});if(this._recordingOptions={maskAllInputs:c,maskAllText:l,maskInputOptions:{password:!0},maskTextFn:S,maskInputFn:S,maskAttributeFn:(e,t,n)=>function({el:e,key:t,maskAttributes:n,maskAllText:r,privacyOptions:o,value:i}){return r?o.unmaskTextSelector&&e.matches(o.unmaskTextSelector)?i:n.includes(t)||"value"===t&&"INPUT"===e.tagName&&["submit","button"].includes(e.getAttribute("type")||"")?i.replace(/[\S]/g,"*"):i:i}({maskAttributes:C,maskAllText:l,privacyOptions:x,key:e,value:t,el:n}),...x,slimDOMOptions:"all",inlineStylesheet:!0,inlineImages:!1,collectFonts:!0,errorHandler:e=>{try{e.__rrweb__=!0}catch(e){}}},this._initialOptions={flushMinDelay:e,flushMaxDelay:t,minReplayDuration:Math.min(n,15e3),maxReplayDuration:Math.min(r,36e5),stickySession:o,useCompression:i,workerUrl:a,blockAllMedia:u,maskAllInputs:c,maskAllText:l,mutationBreadcrumbLimit:d,mutationLimit:h,slowClickTimeout:m,slowClickIgnoreSelectors:p,networkDetailAllowUrls:f,networkDetailDenyUrls:g,networkCaptureBodies:y,networkRequestHeaders:dc(v),networkResponseHeaders:dc(b),beforeAddRecordingEvent:D,beforeErrorSampling:M,_experiments:s},this._initialOptions.blockAllMedia&&(this._recordingOptions.blockSelector=this._recordingOptions.blockSelector?`${this._recordingOptions.blockSelector},${sc}`:sc),this._isInitialized&&fi())throw new Error("Multiple Sentry Session Replay instances are not supported");this._isInitialized=!0}get _isInitialized(){return cc}set _isInitialized(e){cc=e}afterAllSetup(e){fi()&&!this._replay&&(this._setup(e),this._initialize(e))}start(){this._replay&&this._replay.start()}startBuffering(){this._replay&&this._replay.startBuffering()}stop(){return this._replay?this._replay.stop({forceFlush:"session"===this._replay.recordingMode}):Promise.resolve()}flush(e){return this._replay?this._replay.isEnabled()?this._replay.sendBufferedReplayOrFlush(e):(this._replay.start(),Promise.resolve()):Promise.resolve()}getReplayId(){if(this._replay&&this._replay.isEnabled())return this._replay.getSessionId()}_initialize(e){this._replay&&(this._maybeLoadFromReplayCanvasIntegration(e),this._replay.initializeSampling())}_setup(e){const t=function(e,t){const n=t.getOptions(),r={sessionSampleRate:0,errorSampleRate:0,...J(e)},o=kt(n.replaysSessionSampleRate),i=kt(n.replaysOnErrorSampleRate);return null==o&&null==i&&H((()=>{console.warn("Replay is disabled because neither `replaysSessionSampleRate` nor `replaysOnErrorSampleRate` are set.")})),null!=o&&(r.sessionSampleRate=o),null!=i&&(r.errorSampleRate=i),r}(this._initialOptions,e);this._replay=new ic({options:t,recordingOptions:this._recordingOptions})}_maybeLoadFromReplayCanvasIntegration(e){try{const t=e.getIntegrationByName("ReplayCanvas");if(!t)return;this._replay._canvas=t.getOptions()}catch(e){}}}function dc(e){return[...lc,...e.map((e=>e.toLowerCase()))]}uc.__initStatic();const hc=x,mc=hc.document,pc=hc.navigator,fc="Report a Bug",gc="widget",yc=(e,t={includeReplay:!0})=>{if(!e.message)throw new Error("Unable to submit feedback with empty message");const n=He();if(!n)throw new Error("No client setup, cannot send feedback.");e.tags&&Object.keys(e.tags).length&&Be().setTags(e.tags);const r=function(e,t={},n=Be()){const{message:r,name:o,email:i,url:a,source:s,associatedEventId:l,tags:c}=e,u={contexts:{feedback:J({contact_email:i,name:o,message:r,url:a,source:s,associated_event_id:l})},type:"feedback",level:"info",tags:c},d=n&&n.getClient()||He();return d&&d.emit("beforeSendFeedback",u,t),n.captureEvent(u,t)}({source:"api",url:P(),...e},t);return new Promise(((e,t)=>{const o=setTimeout((()=>t("Unable to determine if Feedback was correctly sent.")),5e3),i=n.on("afterSendEvent",((n,a)=>{if(n.event_id===r)return clearTimeout(o),i(),a&&"number"==typeof a.statusCode&&a.statusCode>=200&&a.statusCode<300&&e(r),a&&"number"==typeof a.statusCode&&0===a.statusCode?t("Unable to send Feedback. This is because of network issues, or because you are using an ad-blocker."):t("Unable to send Feedback. This could be because of network issues, or because you are using an ad-blocker")}))}))},vc="undefined"==typeof __SENTRY_DEBUG__||__SENTRY_DEBUG__;function bc(e,t){return{...e,...t,tags:{...e.tags,...t.tags},onFormOpen:()=>{t.onFormOpen&&t.onFormOpen(),e.onFormOpen&&e.onFormOpen()},onFormClose:()=>{t.onFormClose&&t.onFormClose(),e.onFormClose&&e.onFormClose()},onSubmitSuccess:n=>{t.onSubmitSuccess&&t.onSubmitSuccess(n),e.onSubmitSuccess&&e.onSubmitSuccess(n)},onSubmitError:n=>{t.onSubmitError&&t.onSubmitError(n),e.onSubmitError&&e.onSubmitError(n)},onFormSubmitted:()=>{t.onFormSubmitted&&t.onFormSubmitted(),e.onFormSubmitted&&e.onFormSubmitted()},themeDark:{...e.themeDark,...t.themeDark},themeLight:{...e.themeLight,...t.themeLight}}}function wc(e,t){return Object.entries(t).forEach((([t,n])=>{e.setAttributeNS(null,t,n)})),e}const Cc="rgba(88, 74, 192, 1)",_c={foreground:"#2b2233",background:"#ffffff",accentForeground:"white",accentBackground:Cc,successColor:"#268d75",errorColor:"#df3338",border:"1.5px solid rgba(41, 35, 47, 0.13)",boxShadow:"0px 4px 24px 0px rgba(43, 34, 51, 0.12)",outline:"1px auto var(--accent-background)",interactiveFilter:"brightness(95%)"},kc={foreground:"#ebe6ef",background:"#29232f",accentForeground:"white",accentBackground:Cc,successColor:"#2da98c",errorColor:"#f55459",border:"1.5px solid rgba(235, 230, 239, 0.15)",boxShadow:"0px 4px 24px 0px rgba(43, 34, 51, 0.12)",outline:"1px auto var(--accent-background)",interactiveFilter:"brightness(150%)"};function Ac(e){return`\n  --foreground: ${e.foreground};\n  --background: ${e.background};\n  --accent-foreground: ${e.accentForeground};\n  --accent-background: ${e.accentBackground};\n  --success-color: ${e.successColor};\n  --error-color: ${e.errorColor};\n  --border: ${e.border};\n  --box-shadow: ${e.boxShadow};\n  --outline: ${e.outline};\n  --interactive-filter: ${e.interactiveFilter};\n  `}var Ec,Sc,Dc,Mc,xc,Nc,Ic,Rc={},Lc=[],Tc=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,Pc=Array.isArray;function Bc(e,t){for(var n in t)e[n]=t[n];return e}function Oc(e){var t=e.parentNode;t&&t.removeChild(e)}function $c(e,t,n){var r,o,i,a={};for(i in t)"key"==i?r=t[i]:"ref"==i?o=t[i]:a[i]=t[i];if(arguments.length>2&&(a.children=arguments.length>3?Ec.call(arguments,2):n),"function"==typeof e&&null!=e.defaultProps)for(i in e.defaultProps)void 0===a[i]&&(a[i]=e.defaultProps[i]);return Fc(e,a,r,o,null)}function Fc(e,t,n,r,o){var i={type:e,props:t,key:n,ref:r,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,constructor:void 0,__v:null==o?++Dc:o,__i:-1,__u:0};return null==o&&null!=Sc.vnode&&Sc.vnode(i),i}function Hc(e){return e.children}function Wc(e,t){this.props=e,this.context=t}function Gc(e,t){if(null==t)return e.__?Gc(e.__,e.__i+1):null;for(var n;t<e.__k.length;t++)if(null!=(n=e.__k[t])&&null!=n.__e)return n.__e;return"function"==typeof e.type?Gc(e):null}function jc(e,t,n){var r,o=e.__v,i=o.__e,a=e.__P;if(a)return(r=Bc({},o)).__v=o.__v+1,Sc.vnode&&Sc.vnode(r),eu(a,r,o,e.__n,void 0!==a.ownerSVGElement,32&o.__u?[i]:null,t,null==i?Gc(o):i,!!(32&o.__u),n),r.__.__k[r.__i]=r,r.__d=void 0,r.__e!=i&&Uc(r),r}function Uc(e){var t,n;if(null!=(e=e.__)&&null!=e.__c){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if(null!=(n=e.__k[t])&&null!=n.__e){e.__e=e.__c.base=n.__e;break}return Uc(e)}}function Yc(e){(!e.__d&&(e.__d=!0)&&Mc.push(e)&&!qc.__r++||xc!==Sc.debounceRendering)&&((xc=Sc.debounceRendering)||Nc)(qc)}function qc(){var e,t,n,r=[],o=[];for(Mc.sort(Ic);e=Mc.shift();)e.__d&&(n=Mc.length,t=jc(e,r,o)||t,0===n||Mc.length>n?(tu(r,t,o),o.length=r.length=0,t=void 0,Mc.sort(Ic)):t&&Sc.__c&&Sc.__c(t,Lc));t&&tu(r,t,o),qc.__r=0}function Xc(e,t,n,r,o,i,a,s,l,c,u){var d,h,m,p,f,g=r&&r.__k||Lc,y=t.length;for(n.__d=l,function(e,t,n){var r,o,i,a,s,l=t.length,c=n.length,u=c,d=0;for(e.__k=[],r=0;r<l;r++)null!=(o=e.__k[r]=null==(o=t[r])||"boolean"==typeof o||"function"==typeof o?null:"string"==typeof o||"number"==typeof o||"bigint"==typeof o||o.constructor==String?Fc(null,o,null,null,o):Pc(o)?Fc(Hc,{children:o},null,null,null):void 0===o.constructor&&o.__b>0?Fc(o.type,o.props,o.key,o.ref?o.ref:null,o.__v):o)?(o.__=e,o.__b=e.__b+1,s=Vc(o,n,a=r+d,u),o.__i=s,i=null,-1!==s&&(u--,(i=n[s])&&(i.__u|=131072)),null==i||null===i.__v?(-1==s&&d--,"function"!=typeof o.type&&(o.__u|=65536)):s!==a&&(s===a+1?d++:s>a?u>l-a?d+=s-a:d--:d=s<a&&s==a-1?s-a:0,s!==r+d&&(o.__u|=65536))):(i=n[r])&&null==i.key&&i.__e&&(i.__e==e.__d&&(e.__d=Gc(i)),ou(i,i,!1),n[r]=null,u--);if(u)for(r=0;r<c;r++)null!=(i=n[r])&&0==(131072&i.__u)&&(i.__e==e.__d&&(e.__d=Gc(i)),ou(i,i))}(n,t,g),l=n.__d,d=0;d<y;d++)null!=(m=n.__k[d])&&"boolean"!=typeof m&&"function"!=typeof m&&(h=-1===m.__i?Rc:g[m.__i]||Rc,m.__i=d,eu(e,m,h,o,i,a,s,l,c,u),p=m.__e,m.ref&&h.ref!=m.ref&&(h.ref&&ru(h.ref,null,m),u.push(m.ref,m.__c||p,m)),null==f&&null!=p&&(f=p),65536&m.__u||h.__k===m.__k?l=zc(m,l,e):"function"==typeof m.type&&void 0!==m.__d?l=m.__d:p&&(l=p.nextSibling),m.__d=void 0,m.__u&=-196609);n.__d=l,n.__e=f}function zc(e,t,n){var r,o;if("function"==typeof e.type){for(r=e.__k,o=0;r&&o<r.length;o++)r[o]&&(r[o].__=e,t=zc(r[o],t,n));return t}e.__e!=t&&(n.insertBefore(e.__e,t||null),t=e.__e);do{t=t&&t.nextSibling}while(null!=t&&8===t.nodeType);return t}function Vc(e,t,n,r){var o=e.key,i=e.type,a=n-1,s=n+1,l=t[n];if(null===l||l&&o==l.key&&i===l.type)return n;if(r>(null!=l&&0==(131072&l.__u)?1:0))for(;a>=0||s<t.length;){if(a>=0){if((l=t[a])&&0==(131072&l.__u)&&o==l.key&&i===l.type)return a;a--}if(s<t.length){if((l=t[s])&&0==(131072&l.__u)&&o==l.key&&i===l.type)return s;s++}}return-1}function Zc(e,t,n){"-"===t[0]?e.setProperty(t,null==n?"":n):e[t]=null==n?"":"number"!=typeof n||Tc.test(t)?n:n+"px"}function Kc(e,t,n,r,o){var i;e:if("style"===t)if("string"==typeof n)e.style.cssText=n;else{if("string"==typeof r&&(e.style.cssText=r=""),r)for(t in r)n&&t in n||Zc(e.style,t,"");if(n)for(t in n)r&&n[t]===r[t]||Zc(e.style,t,n[t])}else if("o"===t[0]&&"n"===t[1])i=t!==(t=t.replace(/(PointerCapture)$|Capture$/i,"$1")),t=t.toLowerCase()in e?t.toLowerCase().slice(2):t.slice(2),e.l||(e.l={}),e.l[t+i]=n,n?r?n.u=r.u:(n.u=Date.now(),e.addEventListener(t,i?Qc:Jc,i)):e.removeEventListener(t,i?Qc:Jc,i);else{if(o)t=t.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if("width"!==t&&"height"!==t&&"href"!==t&&"list"!==t&&"form"!==t&&"tabIndex"!==t&&"download"!==t&&"rowSpan"!==t&&"colSpan"!==t&&"role"!==t&&t in e)try{e[t]=null==n?"":n;break e}catch(e){}"function"==typeof n||(null==n||!1===n&&"-"!==t[4]?e.removeAttribute(t):e.setAttribute(t,n))}}function Jc(e){if(this.l){var t=this.l[e.type+!1];if(e.t){if(e.t<=t.u)return}else e.t=Date.now();return t(Sc.event?Sc.event(e):e)}}function Qc(e){if(this.l)return this.l[e.type+!0](Sc.event?Sc.event(e):e)}function eu(e,t,n,r,o,i,a,s,l,c){var u,d,h,m,p,f,g,y,v,b,w,C,_,k,A,E=t.type;if(void 0!==t.constructor)return null;128&n.__u&&(l=!!(32&n.__u),i=[s=t.__e=n.__e]),(u=Sc.__b)&&u(t);e:if("function"==typeof E)try{if(y=t.props,v=(u=E.contextType)&&r[u.__c],b=u?v?v.props.value:u.__:r,n.__c?g=(d=t.__c=n.__c).__=d.__E:("prototype"in E&&E.prototype.render?t.__c=d=new E(y,b):(t.__c=d=new Wc(y,b),d.constructor=E,d.render=iu),v&&v.sub(d),d.props=y,d.state||(d.state={}),d.context=b,d.__n=r,h=d.__d=!0,d.__h=[],d._sb=[]),null==d.__s&&(d.__s=d.state),null!=E.getDerivedStateFromProps&&(d.__s==d.state&&(d.__s=Bc({},d.__s)),Bc(d.__s,E.getDerivedStateFromProps(y,d.__s))),m=d.props,p=d.state,d.__v=t,h)null==E.getDerivedStateFromProps&&null!=d.componentWillMount&&d.componentWillMount(),null!=d.componentDidMount&&d.__h.push(d.componentDidMount);else{if(null==E.getDerivedStateFromProps&&y!==m&&null!=d.componentWillReceiveProps&&d.componentWillReceiveProps(y,b),!d.__e&&(null!=d.shouldComponentUpdate&&!1===d.shouldComponentUpdate(y,d.__s,b)||t.__v===n.__v)){for(t.__v!==n.__v&&(d.props=y,d.state=d.__s,d.__d=!1),t.__e=n.__e,t.__k=n.__k,t.__k.forEach((function(e){e&&(e.__=t)})),w=0;w<d._sb.length;w++)d.__h.push(d._sb[w]);d._sb=[],d.__h.length&&a.push(d);break e}null!=d.componentWillUpdate&&d.componentWillUpdate(y,d.__s,b),null!=d.componentDidUpdate&&d.__h.push((function(){d.componentDidUpdate(m,p,f)}))}if(d.context=b,d.props=y,d.__P=e,d.__e=!1,C=Sc.__r,_=0,"prototype"in E&&E.prototype.render){for(d.state=d.__s,d.__d=!1,C&&C(t),u=d.render(d.props,d.state,d.context),k=0;k<d._sb.length;k++)d.__h.push(d._sb[k]);d._sb=[]}else do{d.__d=!1,C&&C(t),u=d.render(d.props,d.state,d.context),d.state=d.__s}while(d.__d&&++_<25);d.state=d.__s,null!=d.getChildContext&&(r=Bc(Bc({},r),d.getChildContext())),h||null==d.getSnapshotBeforeUpdate||(f=d.getSnapshotBeforeUpdate(m,p)),Xc(e,Pc(A=null!=u&&u.type===Hc&&null==u.key?u.props.children:u)?A:[A],t,n,r,o,i,a,s,l,c),d.base=t.__e,t.__u&=-161,d.__h.length&&a.push(d),g&&(d.__E=d.__=null)}catch(e){t.__v=null,l||null!=i?(t.__e=s,t.__u|=l?160:32,i[i.indexOf(s)]=null):(t.__e=n.__e,t.__k=n.__k),Sc.__e(e,t,n)}else null==i&&t.__v===n.__v?(t.__k=n.__k,t.__e=n.__e):t.__e=nu(n.__e,t,n,r,o,i,a,l,c);(u=Sc.diffed)&&u(t)}function tu(e,t,n){for(var r=0;r<n.length;r++)ru(n[r],n[++r],n[++r]);Sc.__c&&Sc.__c(t,e),e.some((function(t){try{e=t.__h,t.__h=[],e.some((function(e){e.call(t)}))}catch(e){Sc.__e(e,t.__v)}}))}function nu(e,t,n,r,o,i,a,s,l){var c,u,d,h,m,p,f,g=n.props,y=t.props,v=t.type;if("svg"===v&&(o=!0),null!=i)for(c=0;c<i.length;c++)if((m=i[c])&&"setAttribute"in m==!!v&&(v?m.localName===v:3===m.nodeType)){e=m,i[c]=null;break}if(null==e){if(null===v)return document.createTextNode(y);e=o?document.createElementNS("http://www.w3.org/2000/svg",v):document.createElement(v,y.is&&y),i=null,s=!1}if(null===v)g===y||s&&e.data===y||(e.data=y);else{if(i=i&&Ec.call(e.childNodes),g=n.props||Rc,!s&&null!=i)for(g={},c=0;c<e.attributes.length;c++)g[(m=e.attributes[c]).name]=m.value;for(c in g)m=g[c],"children"==c||("dangerouslySetInnerHTML"==c?d=m:"key"===c||c in y||Kc(e,c,null,m,o));for(c in y)m=y[c],"children"==c?h=m:"dangerouslySetInnerHTML"==c?u=m:"value"==c?p=m:"checked"==c?f=m:"key"===c||s&&"function"!=typeof m||g[c]===m||Kc(e,c,m,g[c],o);if(u)s||d&&(u.__html===d.__html||u.__html===e.innerHTML)||(e.innerHTML=u.__html),t.__k=[];else if(d&&(e.innerHTML=""),Xc(e,Pc(h)?h:[h],t,n,r,o&&"foreignObject"!==v,i,a,i?i[0]:n.__k&&Gc(n,0),s,l),null!=i)for(c=i.length;c--;)null!=i[c]&&Oc(i[c]);s||(c="value",void 0!==p&&(p!==e[c]||"progress"===v&&!p||"option"===v&&p!==g[c])&&Kc(e,c,p,g[c],!1),c="checked",void 0!==f&&f!==e[c]&&Kc(e,c,f,g[c],!1))}return e}function ru(e,t,n){try{"function"==typeof e?e(t):e.current=t}catch(e){Sc.__e(e,n)}}function ou(e,t,n){var r,o;if(Sc.unmount&&Sc.unmount(e),(r=e.ref)&&(r.current&&r.current!==e.__e||ru(r,null,t)),null!=(r=e.__c)){if(r.componentWillUnmount)try{r.componentWillUnmount()}catch(e){Sc.__e(e,t)}r.base=r.__P=null,e.__c=void 0}if(r=e.__k)for(o=0;o<r.length;o++)r[o]&&ou(r[o],t,n||"function"!=typeof e.type);n||null==e.__e||Oc(e.__e),e.__=e.__e=e.__d=void 0}function iu(e,t,n){return this.constructor(e,n)}Ec=Lc.slice,Sc={__e:function(e,t,n,r){for(var o,i,a;t=t.__;)if((o=t.__c)&&!o.__)try{if((i=o.constructor)&&null!=i.getDerivedStateFromError&&(o.setState(i.getDerivedStateFromError(e)),a=o.__d),null!=o.componentDidCatch&&(o.componentDidCatch(e,r||{}),a=o.__d),a)return o.__E=o}catch(t){e=t}throw e}},Dc=0,Wc.prototype.setState=function(e,t){var n;n=null!=this.__s&&this.__s!==this.state?this.__s:this.__s=Bc({},this.state),"function"==typeof e&&(e=e(Bc({},n),this.props)),e&&Bc(n,e),null!=e&&this.__v&&(t&&this._sb.push(t),Yc(this))},Wc.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),Yc(this))},Wc.prototype.render=Hc,Mc=[],Nc="function"==typeof Promise?Promise.prototype.then.bind(Promise.resolve()):setTimeout,Ic=function(e,t){return e.__v.__b-t.__v.__b},qc.__r=0;var au,su,lu,cu,uu=0,du=[],hu=[],mu=Sc,pu=mu.__b,fu=mu.__r,gu=mu.diffed,yu=mu.__c,vu=mu.unmount,bu=mu.__;function wu(e,t){mu.__h&&mu.__h(su,e,uu||t),uu=0;var n=su.__H||(su.__H={__:[],__h:[]});return e>=n.__.length&&n.__.push({__V:hu}),n.__[e]}function Cu(e){return uu=1,_u(Ru,e)}function _u(e,t,n){var r=wu(au++,2);if(r.t=e,!r.__c&&(r.__=[n?n(t):Ru(void 0,t),function(e){var t=r.__N?r.__N[0]:r.__[0],n=r.t(t,e);t!==n&&(r.__N=[n,r.__[1]],r.__c.setState({}))}],r.__c=su,!su.u)){var o=function(e,t,n){if(!r.__c.__H)return!0;var o=r.__c.__H.__.filter((function(e){return!!e.__c}));if(o.every((function(e){return!e.__N})))return!i||i.call(this,e,t,n);var a=!1;return o.forEach((function(e){if(e.__N){var t=e.__[0];e.__=e.__N,e.__N=void 0,t!==e.__[0]&&(a=!0)}})),!(!a&&r.__c.props===e)&&(!i||i.call(this,e,t,n))};su.u=!0;var i=su.shouldComponentUpdate,a=su.componentWillUpdate;su.componentWillUpdate=function(e,t,n){if(this.__e){var r=i;i=void 0,o(e,t,n),i=r}a&&a.call(this,e,t,n)},su.shouldComponentUpdate=o}return r.__N||r.__}function ku(e,t){var n=wu(au++,4);!mu.__s&&Iu(n.__H,t)&&(n.__=e,n.i=t,su.__h.push(n))}function Au(e,t){var n=wu(au++,7);return Iu(n.__H,t)?(n.__V=e(),n.i=t,n.__h=e,n.__V):n.__}function Eu(e,t){return uu=8,Au((function(){return e}),t)}function Su(){for(var e;e=du.shift();)if(e.__P&&e.__H)try{e.__H.__h.forEach(xu),e.__H.__h.forEach(Nu),e.__H.__h=[]}catch(t){e.__H.__h=[],mu.__e(t,e.__v)}}mu.__b=function(e){su=null,pu&&pu(e)},mu.__=function(e,t){t.__k&&t.__k.__m&&(e.__m=t.__k.__m),bu&&bu(e,t)},mu.__r=function(e){fu&&fu(e),au=0;var t=(su=e.__c).__H;t&&(lu===su?(t.__h=[],su.__h=[],t.__.forEach((function(e){e.__N&&(e.__=e.__N),e.__V=hu,e.__N=e.i=void 0}))):(t.__h.forEach(xu),t.__h.forEach(Nu),t.__h=[],au=0)),lu=su},mu.diffed=function(e){gu&&gu(e);var t=e.__c;t&&t.__H&&(t.__H.__h.length&&(1!==du.push(t)&&cu===mu.requestAnimationFrame||((cu=mu.requestAnimationFrame)||Mu)(Su)),t.__H.__.forEach((function(e){e.i&&(e.__H=e.i),e.__V!==hu&&(e.__=e.__V),e.i=void 0,e.__V=hu}))),lu=su=null},mu.__c=function(e,t){t.some((function(e){try{e.__h.forEach(xu),e.__h=e.__h.filter((function(e){return!e.__||Nu(e)}))}catch(n){t.some((function(e){e.__h&&(e.__h=[])})),t=[],mu.__e(n,e.__v)}})),yu&&yu(e,t)},mu.unmount=function(e){vu&&vu(e);var t,n=e.__c;n&&n.__H&&(n.__H.__.forEach((function(e){try{xu(e)}catch(e){t=e}})),n.__H=void 0,t&&mu.__e(t,n.__v))};var Du="function"==typeof requestAnimationFrame;function Mu(e){var t,n=function(){clearTimeout(r),Du&&cancelAnimationFrame(t),setTimeout(e)},r=setTimeout(n,100);Du&&(t=requestAnimationFrame(n))}function xu(e){var t=su,n=e.__c;"function"==typeof n&&(e.__c=void 0,n()),su=t}function Nu(e){var t=su;e.__c=e.__(),su=t}function Iu(e,t){return!e||e.length!==t.length||t.some((function(t,n){return t!==e[n]}))}function Ru(e,t){return"function"==typeof t?t(e):t}const Lu={__proto__:null,useCallback:Eu,useContext:function(e){var t=su.context[e.__c],n=wu(au++,9);return n.c=e,t?(null==n.__&&(n.__=!0,t.sub(su)),t.props.value):e.__},useDebugValue:function(e,t){mu.useDebugValue&&mu.useDebugValue(t?t(e):e)},useEffect:function(e,t){var n=wu(au++,3);!mu.__s&&Iu(n.__H,t)&&(n.__=e,n.i=t,su.__H.__h.push(n))},useErrorBoundary:function(e){var t=wu(au++,10),n=Cu();return t.__=e,su.componentDidCatch||(su.componentDidCatch=function(e,r){t.__&&t.__(e,r),n[1](e)}),[n[0],function(){n[1](void 0)}]},useId:function(){var e=wu(au++,11);if(!e.__){for(var t=su.__v;null!==t&&!t.__m&&null!==t.__;)t=t.__;var n=t.__m||(t.__m=[0,0]);e.__="P"+n[0]+"-"+n[1]++}return e.__},useImperativeHandle:function(e,t,n){uu=6,ku((function(){return"function"==typeof e?(e(t()),function(){return e(null)}):e?(e.current=t(),function(){return e.current=null}):void 0}),null==n?n:n.concat(e))},useLayoutEffect:ku,useMemo:Au,useReducer:_u,useRef:function(e){return uu=5,Au((function(){return{current:e}}),[])},useState:Cu},Tu="http://www.w3.org/2000/svg";function Pu(){const e=e=>mc.createElementNS(Tu,e),t=wc(e("svg"),{width:"32",height:"30",viewBox:"0 0 72 66",fill:"inherit"}),n=wc(e("path"),{transform:"translate(11, 11)",d:"M29,2.26a4.67,4.67,0,0,0-8,0L14.42,13.53A32.21,32.21,0,0,1,32.17,40.19H27.55A27.68,27.68,0,0,0,12.09,17.47L6,28a15.92,15.92,0,0,1,9.23,12.17H4.62A.76.76,0,0,1,4,39.06l2.94-5a10.74,10.74,0,0,0-3.36-1.9l-2.91,5a4.54,4.54,0,0,0,1.69,6.24A4.66,4.66,0,0,0,4.62,44H19.15a19.4,19.4,0,0,0-8-17.31l2.31-4A23.87,23.87,0,0,1,23.76,44H36.07a35.88,35.88,0,0,0-16.41-31.8l4.67-8a.77.77,0,0,1,1.05-.27c.53.29,20.29,34.77,20.66,35.17a.76.76,0,0,1-.68,1.13H40.6q.09,1.91,0,3.81h4.78A4.59,4.59,0,0,0,50,39.43a4.49,4.49,0,0,0-.62-2.28Z"});return t.appendChild(n),t}const Bu="/home/runner/work/sentry-javascript/sentry-javascript/packages/feedback/src/modal/components/DialogHeader.tsx";function Ou({options:e}){const t=Au((()=>({__html:Pu().outerHTML})),[]);return $c("h2",{class:"dialog__header",__self:this,__source:{fileName:Bu,lineNumber:16}},e.formTitle,e.showBranding?$c("a",{class:"brand-link",target:"_blank",href:"https://sentry.io/welcome/",title:"Powered by Sentry",rel:"noopener noreferrer",dangerouslySetInnerHTML:t,__self:this,__source:{fileName:Bu,lineNumber:19}}):null)}const $u="/home/runner/work/sentry-javascript/sentry-javascript/packages/feedback/src/modal/components/Form.tsx";function Fu(e,t){const n=e.get(t);return"string"==typeof n?n.trim():""}function Hu({options:e,defaultEmail:t,defaultName:n,onFormClose:r,onSubmit:o,onSubmitSuccess:i,onSubmitError:a,showEmail:s,showName:l,screenshotInput:c}){const{tags:u,addScreenshotButtonLabel:d,removeScreenshotButtonLabel:h,cancelButtonLabel:m,emailLabel:p,emailPlaceholder:f,isEmailRequired:g,isNameRequired:y,messageLabel:v,messagePlaceholder:b,nameLabel:w,namePlaceholder:C,submitButtonLabel:_,isRequiredLabel:k}=e,[A,E]=Cu(null),[S,D]=Cu(!1),M=c&&c.input,[x,N]=Cu(null),I=Eu((e=>{N(e),D(!1)}),[]),R=Eu((e=>{const t=function(e,t){const n=[];return t.isNameRequired&&!e.name&&n.push(t.nameLabel),t.isEmailRequired&&!e.email&&n.push(t.emailLabel),e.message||n.push(t.messageLabel),n}(e,{emailLabel:p,isEmailRequired:g,isNameRequired:y,messageLabel:v,nameLabel:w});return t.length>0?E(`Please enter in the following required fields: ${t.join(", ")}`):E(null),0===t.length}),[p,g,y,v,w]),L=Eu((async e=>{try{if(e.preventDefault(),!(e.target instanceof HTMLFormElement))return;const t=new FormData(e.target),n=await(c&&S?c.value():void 0),r={name:Fu(t,"name"),email:Fu(t,"email"),message:Fu(t,"message"),attachments:n?[n]:void 0};if(!R(r))return;try{await o({name:r.name,email:r.email,message:r.message,source:gc,tags:u},{attachments:r.attachments}),i(r)}catch(e){vc&&W.error(e),E(e),a(e)}}catch(e){}}),[c&&S,i,a]);return $c("form",{class:"form",onSubmit:L,__self:this,__source:{fileName:$u,lineNumber:144}},M&&S?$c(M,{onError:I,__self:this,__source:{fileName:$u,lineNumber:146}}):null,$c("div",{class:"form__right","data-sentry-feedback":!0,__self:this,__source:{fileName:$u,lineNumber:149}},$c("div",{class:"form__top",__self:this,__source:{fileName:$u,lineNumber:150}},A?$c("div",{class:"form__error-container",__self:this,__source:{fileName:$u,lineNumber:151}},A):null,l?$c("label",{for:"name",class:"form__label",__self:this,__source:{fileName:$u,lineNumber:154}},$c(Wu,{label:w,isRequiredLabel:k,isRequired:y,__self:this,__source:{fileName:$u,lineNumber:155}}),$c("input",{class:"form__input",defaultValue:n,id:"name",name:"name",placeholder:C,required:y,type:"text",__self:this,__source:{fileName:$u,lineNumber:156}})):$c("input",{"aria-hidden":!0,value:n,name:"name",type:"hidden",__self:this,__source:{fileName:$u,lineNumber:167}}),s?$c("label",{for:"email",class:"form__label",__self:this,__source:{fileName:$u,lineNumber:171}},$c(Wu,{label:p,isRequiredLabel:k,isRequired:g,__self:this,__source:{fileName:$u,lineNumber:172}}),$c("input",{class:"form__input",defaultValue:t,id:"email",name:"email",placeholder:f,required:g,type:"email",__self:this,__source:{fileName:$u,lineNumber:173}})):$c("input",{"aria-hidden":!0,value:t,name:"email",type:"hidden",__self:this,__source:{fileName:$u,lineNumber:184}}),$c("label",{for:"message",class:"form__label",__self:this,__source:{fileName:$u,lineNumber:187}},$c(Wu,{label:v,isRequiredLabel:k,isRequired:!0,__self:this,__source:{fileName:$u,lineNumber:188}}),$c("textarea",{autoFocus:!0,class:"form__input form__input--textarea",id:"message",name:"message",placeholder:b,required:!0,rows:5,__self:this,__source:{fileName:$u,lineNumber:189}})),M?$c("label",{for:"screenshot",class:"form__label",__self:this,__source:{fileName:$u,lineNumber:201}},$c("button",{class:"btn btn--default",type:"button",onClick:()=>{N(null),D((e=>!e))},__self:this,__source:{fileName:$u,lineNumber:202}},S?h:d),x?$c("div",{class:"form__error-container",__self:this,__source:{fileName:$u,lineNumber:212}},x.message):null):null),$c("div",{class:"btn-group",__self:this,__source:{fileName:$u,lineNumber:216}},$c("button",{class:"btn btn--primary",type:"submit",__self:this,__source:{fileName:$u,lineNumber:217}},_),$c("button",{class:"btn btn--default",type:"button",onClick:r,__self:this,__source:{fileName:$u,lineNumber:220}},m))))}function Wu({label:e,isRequired:t,isRequiredLabel:n}){return $c("span",{class:"form__label__text",__self:this,__source:{fileName:$u,lineNumber:239}},e,t&&$c("span",{class:"form__label__text--required",__self:this,__source:{fileName:$u,lineNumber:241}},n))}const Gu=16,ju=17,Uu="http://www.w3.org/2000/svg";function Yu(){const e=e=>hc.document.createElementNS(Uu,e),t=wc(e("svg"),{width:`${Gu}`,height:`${ju}`,viewBox:`0 0 ${Gu} ${ju}`,fill:"inherit"}),n=wc(e("g"),{clipPath:"url(#clip0_57_156)"}),r=wc(e("path"),{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M3.55544 15.1518C4.87103 16.0308 6.41775 16.5 8 16.5C10.1217 16.5 12.1566 15.6571 13.6569 14.1569C15.1571 12.6566 16 10.6217 16 8.5C16 6.91775 15.5308 5.37103 14.6518 4.05544C13.7727 2.73985 12.5233 1.71447 11.0615 1.10897C9.59966 0.503466 7.99113 0.34504 6.43928 0.653721C4.88743 0.962403 3.46197 1.72433 2.34315 2.84315C1.22433 3.96197 0.462403 5.38743 0.153721 6.93928C-0.15496 8.49113 0.00346625 10.0997 0.608967 11.5615C1.21447 13.0233 2.23985 14.2727 3.55544 15.1518ZM4.40546 3.1204C5.46945 2.40946 6.72036 2.03 8 2.03C9.71595 2.03 11.3616 2.71166 12.575 3.92502C13.7883 5.13838 14.47 6.78405 14.47 8.5C14.47 9.77965 14.0905 11.0306 13.3796 12.0945C12.6687 13.1585 11.6582 13.9878 10.476 14.4775C9.29373 14.9672 7.99283 15.0953 6.73777 14.8457C5.48271 14.596 4.32987 13.9798 3.42502 13.075C2.52018 12.1701 1.90397 11.0173 1.65432 9.76224C1.40468 8.50718 1.5328 7.20628 2.0225 6.02404C2.5122 4.8418 3.34148 3.83133 4.40546 3.1204Z"}),o=wc(e("path"),{d:"M6.68775 12.4297C6.78586 12.4745 6.89218 12.4984 7 12.5C7.11275 12.4955 7.22315 12.4664 7.32337 12.4145C7.4236 12.3627 7.51121 12.2894 7.58 12.2L12 5.63999C12.0848 5.47724 12.1071 5.28902 12.0625 5.11098C12.0178 4.93294 11.9095 4.77744 11.7579 4.67392C11.6064 4.57041 11.4221 4.52608 11.24 4.54931C11.0579 4.57254 10.8907 4.66173 10.77 4.79999L6.88 10.57L5.13 8.56999C5.06508 8.49566 4.98613 8.43488 4.89768 8.39111C4.80922 8.34735 4.713 8.32148 4.61453 8.31498C4.51605 8.30847 4.41727 8.32147 4.32382 8.35322C4.23038 8.38497 4.14413 8.43484 4.07 8.49999C3.92511 8.63217 3.83692 8.81523 3.82387 9.01092C3.81083 9.2066 3.87393 9.39976 4 9.54999L6.43 12.24C6.50187 12.3204 6.58964 12.385 6.68775 12.4297Z"});t.appendChild(n).append(o,r);const i=e("defs"),a=wc(e("clipPath"),{id:"clip0_57_156"}),s=wc(e("rect"),{width:`${Gu}`,height:`${Gu}`,fill:"white",transform:"translate(0 0.5)"});return a.appendChild(s),i.appendChild(a),t.appendChild(i).appendChild(a).appendChild(s),t}const qu="/home/runner/work/sentry-javascript/sentry-javascript/packages/feedback/src/modal/components/Dialog.tsx";function Xu({open:e,onFormSubmitted:t,...n}){const r=n.options,o=Au((()=>({__html:Yu().outerHTML})),[]),[i,a]=Cu(null),s=Eu((()=>{i&&(clearTimeout(i),a(null)),t()}),[i]),l=Eu((e=>{n.onSubmitSuccess(e),a(setTimeout((()=>{t(),a(null)}),5e3))}),[t]);return $c(Hc,{__self:this,__source:{fileName:qu,lineNumber:48}},i?$c("div",{class:"success__position",onClick:s,__self:this,__source:{fileName:qu,lineNumber:50}},$c("div",{class:"success__content",__self:this,__source:{fileName:qu,lineNumber:51}},r.successMessageText,$c("span",{class:"success__icon",dangerouslySetInnerHTML:o,__self:this,__source:{fileName:qu,lineNumber:53}}))):$c("dialog",{class:"dialog",onClick:r.onFormClose,open:e,__self:this,__source:{fileName:qu,lineNumber:57}},$c("div",{class:"dialog__position",__self:this,__source:{fileName:qu,lineNumber:58}},$c("div",{class:"dialog__content",onClick:e=>{e.stopPropagation()},__self:this,__source:{fileName:qu,lineNumber:59}},$c(Ou,{options:r,__self:this,__source:{fileName:qu,lineNumber:66}}),$c(Hu,{...n,onSubmitSuccess:l,__self:this,__source:{fileName:qu,lineNumber:67}})))))}const zu=()=>({name:"FeedbackModal",setupOnce(){},createDialog:({options:e,screenshotIntegration:t,sendFeedback:n,shadow:r})=>{const o=r,i=e.useSentryUser,a=function(){const e=Be().getUser(),t=Oe().getUser(),n=$e().getUser();return e&&Object.keys(e).length?e:t&&Object.keys(t).length?t:n}(),s=mc.createElement("div"),l=function(){const e=mc.createElement("style");return e.textContent="\n:host {\n  --dialog-inset: var(--inset);\n}\n\n\n.dialog {\n  position: fixed;\n  z-index: var(--z-index);\n  margin: 0;\n  inset: 0;\n\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 0;\n  height: 100vh;\n  width: 100vw;\n\n  color: var(--dialog-color, var(--foreground));\n  fill: var(--dialog-color, var(--foreground));\n  line-height: 1.75em;\n\n  background-color: rgba(0, 0, 0, 0.05);\n  border: none;\n  inset: 0;\n  opacity: 1;\n  transition: opacity 0.2s ease-in-out;\n}\n\n.dialog__position {\n  position: fixed;\n  z-index: var(--z-index);\n  inset: var(--dialog-inset);\n  padding: var(--page-margin);\n  display: flex;\n  max-height: calc(100vh - (2 * var(--page-margin)));\n}\n@media (max-width: 600px) {\n  .dialog__position {\n    inset: var(--page-margin);\n    padding: 0;\n  }\n}\n\n.dialog__position:has(.editor) {\n  inset: var(--page-margin);\n  padding: 0;\n}\n\n.dialog:not([open]) {\n  opacity: 0;\n  pointer-events: none;\n  visibility: hidden;\n}\n.dialog:not([open]) .dialog__content {\n  transform: translate(0, -16px) scale(0.98);\n}\n\n.dialog__content {\n  display: flex;\n  flex-direction: column;\n  gap: 16px;\n  padding: var(--dialog-padding, 24px);\n  max-width: 100%;\n  width: 100%;\n  max-height: 100%;\n  overflow: auto;\n\n  background: var(--dialog-background, var(--background));\n  border-radius: var(--dialog-border-radius, 20px);\n  border: var(--dialog-border, var(--border));\n  box-shadow: var(--dialog-box-shadow, var(--box-shadow));\n  transform: translate(0, 0) scale(1);\n  transition: transform 0.2s ease-in-out;\n}\n\n\n.dialog__header {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  font-weight: var(--dialog-header-weight, 600);\n  margin: 0;\n}\n\n.brand-link {\n  display: inline-flex;\n}\n.brand-link:focus-visible {\n  outline: var(--outline);\n}\n\n\n.form {\n  display: flex;\n  overflow: auto;\n  flex-direction: row;\n  gap: 16px;\n  flex: 1 0;\n}\n\n.form__right {\n  flex: 0 0 var(--form-width, 272px);\n  width: var(--form-width, 272px);\n  display: flex;\n  overflow: auto;\n  flex-direction: column;\n  justify-content: space-between;\n  gap: 20px;\n}\n\n@media (max-width: 600px) {\n  .form__right {\n    width: auto;\n  }\n}\n\n.form__top {\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n}\n\n.form__error-container {\n  color: var(--error-color);\n  fill: var(--error-color);\n}\n\n.form__label {\n  display: flex;\n  flex-direction: column;\n  gap: 4px;\n  margin: 0px;\n}\n\n.form__label__text {\n  display: flex;\n  gap: 4px;\n  align-items: center;\n}\n\n.form__label__text--required {\n  font-size: 0.85em;\n}\n\n.form__input {\n  font-family: inherit;\n  line-height: inherit;\n  background: transparent;\n  box-sizing: border-box;\n  border: var(--input-border, var(--border));\n  border-radius: var(--input-border-radius, 6px);\n  color: var(--input-color, inherit);\n  fill: var(--input-color, inherit);\n  font-size: var(--input-font-size, inherit);\n  font-weight: var(--input-font-weight, 500);\n  padding: 6px 12px;\n}\n\n.form__input::placeholder {\n  opacity: 0.65;\n  color: var(--input-placeholder-color, inherit);\n  filter: var(--interactive-filter);\n}\n\n.form__input:focus-visible {\n  outline: var(--input-focus-outline, var(--outline));\n}\n\n.form__input--textarea {\n  font-family: inherit;\n  resize: vertical;\n}\n\n.error {\n  color: var(--error-color);\n  fill: var(--error-color);\n}\n\n\n.btn-group {\n  display: grid;\n  gap: 8px;\n}\n\n.btn {\n  line-height: inherit;\n  border: var(--button-border, var(--border));\n  border-radius: var(--button-border-radius, 6px);\n  cursor: pointer;\n  font-family: inherit;\n  font-size: var(--button-font-size, inherit);\n  font-weight: var(--button-font-weight, 600);\n  padding: var(--button-padding, 6px 16px);\n}\n.btn[disabled] {\n  opacity: 0.6;\n  pointer-events: none;\n}\n\n.btn--primary {\n  color: var(--button-primary-color, var(--accent-foreground));\n  fill: var(--button-primary-color, var(--accent-foreground));\n  background: var(--button-primary-background, var(--accent-background));\n  border: var(--button-primary-border, var(--border));\n  border-radius: var(--button-primary-border-radius, 6px);\n  font-weight: var(--button-primary-font-weight, 500);\n}\n.btn--primary:hover {\n  color: var(--button-primary-hover-color, var(--accent-foreground));\n  fill: var(--button-primary-hover-color, var(--accent-foreground));\n  background: var(--button-primary-hover-background, var(--accent-background));\n  filter: var(--interactive-filter);\n}\n.btn--primary:focus-visible {\n  background: var(--button-primary-hover-background, var(--accent-background));\n  filter: var(--interactive-filter);\n  outline: var(--button-primary-focus-outline, var(--outline));\n}\n\n.btn--default {\n  color: var(--button-color, var(--foreground));\n  fill: var(--button-color, var(--foreground));\n  background: var(--button-background, var(--background));\n  border: var(--button-border, var(--border));\n  border-radius: var(--button-border-radius, 6px);\n  font-weight: var(--button-font-weight, 500);\n}\n.btn--default:hover {\n  color: var(--button-color, var(--foreground));\n  fill: var(--button-color, var(--foreground));\n  background: var(--button-hover-background, var(--background));\n  filter: var(--interactive-filter);\n}\n.btn--default:focus-visible {\n  background: var(--button-hover-background, var(--background));\n  filter: var(--interactive-filter);\n  outline: var(--button-focus-outline, var(--outline));\n}\n\n\n.success__position {\n  position: fixed;\n  inset: var(--dialog-inset);\n  padding: var(--page-margin);\n  z-index: var(--z-index);\n}\n.success__content {\n  background: var(--success-background, var(--background));\n  border: var(--success-border, var(--border));\n  border-radius: var(--success-border-radius, 1.7em/50%);\n  box-shadow: var(--success-box-shadow, var(--box-shadow));\n  font-weight: var(--success-font-weight, 600);\n  color: var(--success-color);\n  fill: var(--success-color);\n  padding: 12px 24px;\n  line-height: 1.75em;\n\n  display: grid;\n  align-items: center;\n  grid-auto-flow: column;\n  gap: 6px;\n  cursor: default;\n}\n\n.success__icon {\n  display: flex;\n}\n\n",e}();let c="";const u={get el(){return s},appendToDom(){o.contains(l)||o.contains(s)||(o.appendChild(l),o.appendChild(s))},removeFromDom(){o.removeChild(s),o.removeChild(l),mc.body.style.overflow=c},open(){h(!0),e.onFormOpen&&e.onFormOpen(),c=mc.body.style.overflow,mc.body.style.overflow="hidden"},close(){h(!1),mc.body.style.overflow=c}},d=t&&t.createInput({h:$c,hooks:Lu,dialog:u,options:e}),h=t=>{!function(e,t,n){var r,o,i,a;Sc.__&&Sc.__(e,t),o=(r=!1)?null:t.__k,i=[],a=[],eu(t,e=t.__k=$c(Hc,null,[e]),o||Rc,Rc,void 0!==t.ownerSVGElement,o?null:t.firstChild?Ec.call(t.childNodes):null,i,o?o.__e:t.firstChild,r,a),e.__d=void 0,tu(i,e,a)}($c(Xu,{options:e,screenshotInput:d,showName:e.showName||e.isNameRequired,showEmail:e.showEmail||e.isEmailRequired,defaultName:i&&a&&a[i.name]||"",defaultEmail:i&&a&&a[i.email]||"",onFormClose:()=>{h(!1),e.onFormClose&&e.onFormClose()},onSubmit:n,onSubmitSuccess:t=>{h(!1),e.onSubmitSuccess&&e.onSubmitSuccess(t)},onSubmitError:t=>{e.onSubmitError&&e.onSubmitError(t)},onFormSubmitted:()=>{e.onFormSubmitted&&e.onFormSubmitted()},open:t,__self:void 0,__source:{fileName:"/home/runner/work/sentry-javascript/sentry-javascript/packages/feedback/src/modal/integration.tsx",lineNumber:67}}),s)};return u}});function Vu(){const e=mc.createElement("style"),t="#1A141F",n="#302735";return e.textContent=`\n.editor {\n  padding: 10px;\n  padding-top: 65px;\n  padding-bottom: 65px;\n  flex-grow: 1;\n\n  background-color: ${t};\n  background-image: repeating-linear-gradient(\n      -145deg,\n      transparent,\n      transparent 8px,\n      ${t} 8px,\n      ${t} 11px\n    ),\n    repeating-linear-gradient(\n      -45deg,\n      transparent,\n      transparent 15px,\n      ${n} 15px,\n      ${n} 16px\n    );\n}\n\n.editor__canvas-container {\n  width: 100%;\n  height: 100%;\n  position: relative;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.editor__canvas-container canvas {\n  object-fit: contain;\n  position: relative;\n}\n\n.editor__crop-btn-group {\n  padding: 8px;\n  gap: 8px;\n  border-radius: var(--menu-border-radius, 6px);\n  background: var(--button-primary-background, var(--background));\n  width: 175px;\n  position: absolute;\n}\n\n.editor__crop-corner {\n  width: 30px;\n  height: 30px;\n  position: absolute;\n  background: none;\n  border: 3px solid #ffffff;\n}\n\n.editor__crop-corner--top-left {\n  cursor: nwse-resize;\n  border-right: none;\n  border-bottom: none;\n}\n.editor__crop-corner--top-right {\n  cursor: nesw-resize;\n  border-left: none;\n  border-bottom: none;\n}\n.editor__crop-corner--bottom-left {\n  cursor: nesw-resize;\n  border-right: none;\n  border-top: none;\n}\n.editor__crop-corner--bottom-right {\n  cursor: nwse-resize;\n  border-left: none;\n  border-top: none;\n}\n`,e}const Zu="/home/runner/work/sentry-javascript/sentry-javascript/packages/feedback/src/screenshot/components/ScreenshotEditor.tsx",Ku=33,Ju=hc.devicePixelRatio,Qu=e=>({x:Math.min(e.startX,e.endX),y:Math.min(e.startY,e.endY),width:Math.abs(e.startX-e.endX),height:Math.abs(e.startY-e.endY)}),ed=e=>{const t=e.clientHeight,n=e.clientWidth,r=e.width/e.height;let o=t*r,i=t;o>n&&(o=n,i=n/r);const a=(n-o)/2,s=(t-i)/2;return{startX:a,startY:s,endX:o+a,endY:i+s}};function td({h:e,hooks:t,imageBuffer:n,dialog:r,options:o}){const i=function({hooks:e}){return function({onBeforeScreenshot:t,onScreenshot:n,onAfterScreenshot:r,onError:o}){e.useEffect((()=>{(async()=>{t();const e=await pc.mediaDevices.getDisplayMedia({video:{width:hc.innerWidth*hc.devicePixelRatio,height:hc.innerHeight*hc.devicePixelRatio},audio:!1,monitorTypeSurfaces:"exclude",preferCurrentTab:!0,selfBrowserSurface:"include",surfaceSwitching:"exclude"}),o=mc.createElement("video");await new Promise(((t,r)=>{o.srcObject=e,o.onloadedmetadata=()=>{n(o),e.getTracks().forEach((e=>e.stop())),t()},o.play().catch(r)})),r()})().catch(o)}),[])}}({hooks:t});return function({onError:a}){const s=t.useMemo((()=>({__html:Vu().innerText})),[]),l=function({h:e}){return function({top:t,left:n,corner:r,onGrabButton:o}){return e("button",{class:`editor__crop-corner editor__crop-corner--${r} `,style:{top:t,left:n},onMouseDown:e=>{e.preventDefault(),o(e,r)},onClick:e=>{e.preventDefault()},__self:this,__source:{fileName:"/home/runner/work/sentry-javascript/sentry-javascript/packages/feedback/src/screenshot/components/CropCorner.tsx",lineNumber:22}})}}({h:e}),c=t.useRef(null),u=t.useRef(null),d=t.useRef(null),[h,m]=t.useState({startX:0,startY:0,endX:0,endY:0}),[p,f]=t.useState(!1),[g,y]=t.useState(!1);function v(){const e=d.current,t=Qu(ed(n));if(e){e.width=t.width*Ju,e.height=t.height*Ju,e.style.width=`${t.width}px`,e.style.height=`${t.height}px`;const n=e.getContext("2d");n&&n.scale(Ju,Ju)}const r=u.current;r&&(r.style.width=`${t.width}px`,r.style.height=`${t.height}px`),m({startX:0,startY:0,endX:t.width,endY:t.height})}function b(e,t){f(!1),y(!0);const n=w(t),r=()=>{mc.removeEventListener("mousemove",n),mc.removeEventListener("mouseup",r),f(!0),y(!1)};mc.addEventListener("mouseup",r),mc.addEventListener("mousemove",n)}t.useEffect((()=>{hc.addEventListener("resize",v,!1)}),[]),t.useEffect((()=>{const e=d.current;if(!e)return;const t=e.getContext("2d");if(!t)return;const r=Qu(ed(n)),o=Qu(h);t.clearRect(0,0,r.width,r.height),t.fillStyle="rgba(0, 0, 0, 0.5)",t.fillRect(0,0,r.width,r.height),t.clearRect(o.x,o.y,o.width,o.height),t.strokeStyle="#ffffff",t.lineWidth=3,t.strokeRect(o.x+1,o.y+1,o.width-2,o.height-2),t.strokeStyle="#000000",t.lineWidth=1,t.strokeRect(o.x+3,o.y+3,o.width-6,o.height-6)}),[h]);const w=t.useCallback((e=>function(t){if(!d.current)return;const n=d.current,r=n.getBoundingClientRect(),o=t.clientX-r.x,i=t.clientY-r.y;switch(e){case"top-left":m((e=>({...e,startX:Math.min(Math.max(0,o),e.endX-Ku),startY:Math.min(Math.max(0,i),e.endY-Ku)})));break;case"top-right":m((e=>({...e,endX:Math.max(Math.min(o,n.width/Ju),e.startX+Ku),startY:Math.min(Math.max(0,i),e.endY-Ku)})));break;case"bottom-left":m((e=>({...e,startX:Math.min(Math.max(0,o),e.endX-Ku),endY:Math.max(Math.min(i,n.height/Ju),e.startY+Ku)})));break;case"bottom-right":m((e=>({...e,endX:Math.max(Math.min(o,n.width/Ju),e.startX+Ku),endY:Math.max(Math.min(i,n.height/Ju),e.startY+Ku)})))}}),[]),C=t.useRef({initialX:0,initialY:0});return i({onBeforeScreenshot:t.useCallback((()=>{r.el.style.display="none"}),[]),onScreenshot:t.useCallback((e=>{const t=n.getContext("2d");if(!t)throw new Error("Could not get canvas context");n.width=e.videoWidth,n.height=e.videoHeight,n.style.width="100%",n.style.height="100%",t.drawImage(e,0,0)}),[n]),onAfterScreenshot:t.useCallback((()=>{r.el.style.display="block";const e=c.current;e&&e.appendChild(n),v()}),[]),onError:t.useCallback((e=>{r.el.style.display="block",a(e)}),[])}),e("div",{class:"editor",__self:this,__source:{fileName:Zu,lineNumber:315}},e("style",{dangerouslySetInnerHTML:s,__self:this,__source:{fileName:Zu,lineNumber:316}}),e("div",{class:"editor__canvas-container",ref:c,__self:this,__source:{fileName:Zu,lineNumber:317}},e("div",{class:"editor__crop-container",style:{position:"absolute",zIndex:1},ref:u,__self:this,__source:{fileName:Zu,lineNumber:318}},e("canvas",{onMouseDown:function(e){if(g)return;C.current={initialX:e.clientX,initialY:e.clientY};const t=e=>{const t=d.current;if(!t)return;const n=e.clientX-C.current.initialX,r=e.clientY-C.current.initialY;m((o=>{const i=Math.max(0,Math.min(o.startX+n,t.width/Ju-(o.endX-o.startX))),a=Math.max(0,Math.min(o.startY+r,t.height/Ju-(o.endY-o.startY))),s=i+(o.endX-o.startX),l=a+(o.endY-o.startY);return C.current.initialX=e.clientX,C.current.initialY=e.clientY,{startX:i,startY:a,endX:s,endY:l}}))},n=()=>{mc.removeEventListener("mousemove",t),mc.removeEventListener("mouseup",n)};mc.addEventListener("mousemove",t),mc.addEventListener("mouseup",n)},style:{position:"absolute",cursor:p?"move":"auto"},ref:d,__self:this,__source:{fileName:Zu,lineNumber:319}}),e(l,{left:h.startX-3,top:h.startY-3,onGrabButton:b,corner:"top-left",__self:this,__source:{fileName:Zu,lineNumber:324}}),e(l,{left:h.endX-30+3,top:h.startY-3,onGrabButton:b,corner:"top-right",__self:this,__source:{fileName:Zu,lineNumber:330}}),e(l,{left:h.startX-3,top:h.endY-30+3,onGrabButton:b,corner:"bottom-left",__self:this,__source:{fileName:Zu,lineNumber:336}}),e(l,{left:h.endX-30+3,top:h.endY-30+3,onGrabButton:b,corner:"bottom-right",__self:this,__source:{fileName:Zu,lineNumber:342}}),e("div",{style:{left:Math.max(0,h.endX-191),top:Math.max(0,h.endY+8),display:p?"flex":"none"},class:"editor__crop-btn-group",__self:this,__source:{fileName:Zu,lineNumber:348}},e("button",{onClick:e=>{e.preventDefault(),d.current&&m({startX:0,startY:0,endX:d.current.width/Ju,endY:d.current.height/Ju}),f(!1)},class:"btn btn--default",__self:this,__source:{fileName:Zu,lineNumber:356}},o.cancelButtonLabel),e("button",{onClick:e=>{e.preventDefault(),function(){const e=mc.createElement("canvas"),t=Qu(ed(n)),r=Qu(h);e.width=r.width*Ju,e.height=r.height*Ju;const o=e.getContext("2d");o&&n&&o.drawImage(n,r.x/t.width*n.width,r.y/t.height*n.height,r.width/t.width*n.width,r.height/t.height*n.height,0,0,e.width,e.height);const i=n.getContext("2d");i&&(i.clearRect(0,0,n.width,n.height),n.width=e.width,n.height=e.height,n.style.width=`${r.width}px`,n.style.height=`${r.height}px`,i.drawImage(e,0,0),v())}(),f(!1)},class:"btn btn--primary",__self:this,__source:{fileName:Zu,lineNumber:373}},o.confirmButtonLabel)))))}}const nd=()=>({name:"FeedbackScreenshot",setupOnce(){},createInput:({h:e,hooks:t,dialog:n,options:r})=>{const o=mc.createElement("canvas");return{input:td({h:e,hooks:t,imageBuffer:o,dialog:n,options:r}),value:async()=>{const e=await new Promise((e=>{o.toBlob(e,"image/png")}));if(e)return{data:new Uint8Array(await e.arrayBuffer()),filename:"screenshot.png",contentType:"application/png"}}}}}),rd={replayIntegration:"replay",replayCanvasIntegration:"replay-canvas",feedbackIntegration:"feedback",feedbackModalIntegration:"feedback-modal",feedbackScreenshotIntegration:"feedback-screenshot",captureConsoleIntegration:"captureconsole",contextLinesIntegration:"contextlines",linkedErrorsIntegration:"linkederrors",debugIntegration:"debug",dedupeIntegration:"dedupe",extraErrorDataIntegration:"extraerrordata",httpClientIntegration:"httpclient",reportingObserverIntegration:"reportingobserver",rewriteFramesIntegration:"rewriteframes",sessionTimingIntegration:"sessiontiming",browserProfilingIntegration:"browserprofiling"},od=po,id=(({lazyLoadIntegration:e,getModalIntegration:t,getScreenshotIntegration:n})=>({id:r="sentry-feedback",autoInject:o=!0,showBranding:i=!0,isEmailRequired:a=!1,isNameRequired:s=!1,showEmail:l=!0,showName:c=!0,enableScreenshot:u=!0,useSentryUser:d={email:"email",name:"username"},tags:h,colorScheme:m="system",themeLight:p={},themeDark:f={},addScreenshotButtonLabel:g="Add a screenshot",cancelButtonLabel:y="Cancel",confirmButtonLabel:v="Confirm",emailLabel:b="Email",emailPlaceholder:w="your.email@example.org",formTitle:C="Report a Bug",isRequiredLabel:_="(required)",messageLabel:k="Description",messagePlaceholder:A="What's the bug? What did you expect?",nameLabel:E="Name",namePlaceholder:S="Your Name",removeScreenshotButtonLabel:D="Remove screenshot",submitButtonLabel:M="Send Bug Report",successMessageText:x="Thank you for your report!",triggerLabel:N=fc,triggerAriaLabel:I="",onFormOpen:R,onFormClose:L,onSubmitSuccess:T,onSubmitError:P,onFormSubmitted:B}={})=>{const O={id:r,autoInject:o,showBranding:i,isEmailRequired:a,isNameRequired:s,showEmail:l,showName:c,enableScreenshot:u,useSentryUser:d,tags:h,colorScheme:m,themeDark:f,themeLight:p,triggerLabel:N,triggerAriaLabel:I,cancelButtonLabel:y,submitButtonLabel:M,confirmButtonLabel:v,formTitle:C,emailLabel:b,emailPlaceholder:w,messageLabel:k,messagePlaceholder:A,nameLabel:E,namePlaceholder:S,successMessageText:x,isRequiredLabel:_,addScreenshotButtonLabel:g,removeScreenshotButtonLabel:D,onFormClose:L,onFormOpen:R,onSubmitError:P,onSubmitSuccess:T,onFormSubmitted:B};let $=null,F=[];const H=e=>{if(!$){const t=mc.createElement("div");t.id=String(e.id),mc.body.appendChild(t),$=t.attachShadow({mode:"open"}),$.appendChild(function({colorScheme:e,themeDark:t,themeLight:n}){const r=mc.createElement("style");return r.textContent=`\n:host {\n  --font-family: system-ui, 'Helvetica Neue', Arial, sans-serif;\n  --font-size: 14px;\n  --z-index: 100000;\n\n  --page-margin: 16px;\n  --inset: auto 0 0 auto;\n  --actor-inset: var(--inset);\n\n  font-family: var(--font-family);\n  font-size: var(--font-size);\n\n  ${"system"!==e?"color-scheme: only light;":""}\n\n  ${Ac("dark"===e?{...kc,...t}:{..._c,...n})}\n}\n\n${"system"===e?`\n@media (prefers-color-scheme: dark) {\n  :host {\n    ${Ac({...kc,...t})}\n  }\n}`:""}\n}\n`,r}(e))}return $},G=async(t,n,r)=>{const o=He(),i=o&&o.getIntegrationByName(t);if(i)return i;const a=(n&&n()||await e(r))();return o&&o.addIntegration(a),a},j=async e=>{const r=e.enableScreenshot&&!(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(pc.userAgent)||/Macintosh/i.test(pc.userAgent)&&pc.maxTouchPoints&&pc.maxTouchPoints>1||!isSecureContext),[o,i]=await Promise.all([G("FeedbackModal",t,"feedbackModalIntegration"),r?G("FeedbackScreenshot",n,"feedbackScreenshotIntegration"):void 0]);if(!o)throw vc&&W.error("[Feedback] Missing feedback modal integration. Try using `feedbackSyncIntegration` in your `Sentry.init`."),new Error("[Feedback] Missing feedback modal integration!");r&&!i&&vc&&W.error("[Feedback] Missing feedback screenshot integration. Proceeding without screenshots.");const a=o.createDialog({options:{...e,onFormClose:()=>{a&&a.close(),e.onFormClose&&e.onFormClose()},onFormSubmitted:()=>{a&&a.close(),e.onFormSubmitted&&e.onFormSubmitted()}},screenshotIntegration:r?i:void 0,sendFeedback:yc,shadow:H(e)});return a},U=(e,t={})=>{const n=bc(O,t),r="string"==typeof e?mc.querySelector(e):"function"==typeof e.addEventListener?e:null;if(!r)throw vc&&W.error("[Feedback] Unable to attach to target element"),new Error("Unable to attach to target element");let o=null;const i=async()=>{o||(o=await j({...n,onFormSubmitted:()=>{o&&o.removeFromDom(),n.onFormSubmitted&&n.onFormSubmitted()}})),o.appendToDom(),o.open()};r.addEventListener("click",i);const a=()=>{F=F.filter((e=>e!==a)),o&&o.removeFromDom(),o=null,r.removeEventListener("click",i)};return F.push(a),a},Y=(e={})=>{const t=bc(O,e),n=H(t),r=function({triggerLabel:e,triggerAriaLabel:t,shadow:n}){const r=mc.createElement("button");if(r.type="button",r.className="widget__actor",r.ariaHidden="false",r.ariaLabel=t||e||fc,r.appendChild(function(){const e=e=>hc.document.createElementNS("http://www.w3.org/2000/svg",e),t=wc(e("svg"),{width:"20",height:"20",viewBox:"0 0 20 20",fill:"var(--foreground)"}),n=wc(e("g"),{clipPath:"url(#clip0_57_80)"}),r=wc(e("path"),{"fill-rule":"evenodd","clip-rule":"evenodd",d:"M15.6622 15H12.3997C12.2129 14.9959 12.031 14.9396 11.8747 14.8375L8.04965 12.2H7.49956V19.1C7.4875 19.3348 7.3888 19.5568 7.22256 19.723C7.05632 19.8892 6.83435 19.9879 6.59956 20H2.04956C1.80193 19.9968 1.56535 19.8969 1.39023 19.7218C1.21511 19.5467 1.1153 19.3101 1.11206 19.0625V12.2H0.949652C0.824431 12.2017 0.700142 12.1783 0.584123 12.1311C0.468104 12.084 0.362708 12.014 0.274155 11.9255C0.185602 11.8369 0.115689 11.7315 0.0685419 11.6155C0.0213952 11.4995 -0.00202913 11.3752 -0.00034808 11.25V3.75C-0.00900498 3.62067 0.0092504 3.49095 0.0532651 3.36904C0.0972798 3.24712 0.166097 3.13566 0.255372 3.04168C0.344646 2.94771 0.452437 2.87327 0.571937 2.82307C0.691437 2.77286 0.82005 2.74798 0.949652 2.75H8.04965L11.8747 0.1625C12.031 0.0603649 12.2129 0.00407221 12.3997 0H15.6622C15.9098 0.00323746 16.1464 0.103049 16.3215 0.278167C16.4966 0.453286 16.5964 0.689866 16.5997 0.9375V3.25269C17.3969 3.42959 18.1345 3.83026 18.7211 4.41679C19.5322 5.22788 19.9878 6.32796 19.9878 7.47502C19.9878 8.62209 19.5322 9.72217 18.7211 10.5333C18.1345 11.1198 17.3969 11.5205 16.5997 11.6974V14.0125C16.6047 14.1393 16.5842 14.2659 16.5395 14.3847C16.4948 14.5035 16.4268 14.6121 16.3394 14.7042C16.252 14.7962 16.147 14.8698 16.0307 14.9206C15.9144 14.9714 15.7891 14.9984 15.6622 15ZM1.89695 10.325H1.88715V4.625H8.33715C8.52423 4.62301 8.70666 4.56654 8.86215 4.4625L12.6872 1.875H14.7247V13.125H12.6872L8.86215 10.4875C8.70666 10.3835 8.52423 10.327 8.33715 10.325H2.20217C2.15205 10.3167 2.10102 10.3125 2.04956 10.3125C1.9981 10.3125 1.94708 10.3167 1.89695 10.325ZM2.98706 12.2V18.1625H5.66206V12.2H2.98706ZM16.5997 9.93612V5.01393C16.6536 5.02355 16.7072 5.03495 16.7605 5.04814C17.1202 5.13709 17.4556 5.30487 17.7425 5.53934C18.0293 5.77381 18.2605 6.06912 18.4192 6.40389C18.578 6.73866 18.6603 7.10452 18.6603 7.47502C18.6603 7.84552 18.578 8.21139 18.4192 8.54616C18.2605 8.88093 18.0293 9.17624 17.7425 9.41071C17.4556 9.64518 17.1202 9.81296 16.7605 9.90191C16.7072 9.91509 16.6536 9.9265 16.5997 9.93612Z"});t.appendChild(n).appendChild(r);const o=e("defs"),i=wc(e("clipPath"),{id:"clip0_57_80"}),a=wc(e("rect"),{width:"20",height:"20",fill:"white"});return i.appendChild(a),o.appendChild(i),t.appendChild(o).appendChild(i).appendChild(a),t}()),e){const t=mc.createElement("span");t.appendChild(mc.createTextNode(e)),r.appendChild(t)}const o=function(){const e=mc.createElement("style");return e.textContent='\n.widget__actor {\n  position: fixed;\n  z-index: var(--z-index);\n  margin: var(--page-margin);\n  inset: var(--actor-inset);\n\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  padding: 16px;\n\n  font-family: inherit;\n  font-size: var(--font-size);\n  font-weight: 600;\n  line-height: 1.14em;\n  text-decoration: none;\n\n  background: var(--actor-background, var(--background));\n  border-radius: var(--actor-border-radius, 1.7em/50%);\n  border: var(--actor-border, var(--border));\n  box-shadow: var(--actor-box-shadow, var(--box-shadow));\n  color: var(--actor-color, var(--foreground));\n  fill: var(--actor-color, var(--foreground));\n  cursor: pointer;\n  opacity: 1;\n  transition: transform 0.2s ease-in-out;\n  transform: translate(0, 0) scale(1);\n}\n.widget__actor[aria-hidden="true"] {\n  opacity: 0;\n  pointer-events: none;\n  visibility: hidden;\n  transform: translate(0, 16px) scale(0.98);\n}\n\n.widget__actor:hover {\n  background: var(--actor-hover-background, var(--background));\n  filter: var(--interactive-filter);\n}\n\n.widget__actor svg {\n  width: 1.14em;\n  height: 1.14em;\n}\n\n@media (max-width: 600px) {\n  .widget__actor span {\n    display: none;\n  }\n}\n',e}();return{el:r,appendToDom(){n.appendChild(o),n.appendChild(r)},removeFromDom(){n.removeChild(r),n.removeChild(o)},show(){r.ariaHidden="false"},hide(){r.ariaHidden="true"}}}({triggerLabel:t.triggerLabel,triggerAriaLabel:t.triggerAriaLabel,shadow:n});return U(r.el,{...t,onFormOpen(){r.hide()},onFormClose(){r.show()},onFormSubmitted(){r.show()}}),r};return{name:"Feedback",setupOnce(){fi()&&O.autoInject&&("loading"===mc.readyState?mc.addEventListener("DOMContentLoaded",(()=>Y().appendToDom())):Y().appendToDom())},attachTo:U,createWidget(e={}){const t=Y(bc(O,e));return t.appendToDom(),t},createForm:async(e={})=>j(bc(O,e)),remove(){$&&($.parentElement&&$.parentElement.remove(),$=null),F.forEach((e=>e())),F=[]}}})({lazyLoadIntegration:async function(e){const t=rd[e],n=od.Sentry=od.Sentry||{};if(!t)throw new Error(`Cannot lazy load integration: ${e}`);const r=n[e];if("function"==typeof r&&!("_isShim"in r))return r;const o=function(e){const t=He(),n=t&&t.getOptions(),r=n&&n.cdnBaseUrl||"https://browser.sentry-cdn.com";return new URL(`/${M}/${e}.min.js`,r).toString()}(t),i=po.document.createElement("script");i.src=o,i.crossOrigin="anonymous",i.referrerPolicy="origin";const a=new Promise(((e,t)=>{i.addEventListener("load",(()=>e())),i.addEventListener("error",t)}));po.document.body.appendChild(i);try{await a}catch(t){throw new Error(`Error when loading integration: ${e}`)}const s=n[e];if("function"!=typeof s)throw new Error(`Could not load integration: ${e}`);return s},getModalIntegration:()=>zu,getScreenshotIntegration:()=>nd}),ad="1.0.2-STRICT-6585254c",sd=37685,ld=["R101"],cd=["ULTRAbc","BCTweaks","BC Tools"],ud=["versions","safeword","unlock","lscg","wcegotoroom","whisper","leave","safewordspecific","wardrobe"],dd={dsn:"https://55ab768d8a3f2e0278b494ae6876f982@o4507753726214144.ingest.de.sentry.io/4507753729163344",maxBreadcrumbs:50,debug:!1,release:"1.0.2-STRICT-6585254c",environment:"devel",integrations:[((e={})=>{zr||(zr=!0,jr(Vr),qr(Vr));const{enableInp:t,enableLongTask:n,enableLongAnimationFrame:r,_experiments:{enableInteractions:o,enableStandaloneClsSpans:i},beforeStartSpan:a,idleTimeout:s,finalTimeout:l,childSpanTimeout:c,markBackgroundSpan:u,traceFetch:d,traceXHR:h,shouldCreateSpanForRequest:m,enableHTTPTimings:p,instrumentPageLoad:f,instrumentNavigation:g}={...Bo,...e},y=Er({recordClsStandaloneSpans:i||!1});t&&function(){if(vr()&&we){const e=or((({metric:e})=>{if(null==e.value)return;const t=e.entries.find((t=>t.duration===e.value&&Nr[t.name]));if(!t)return;const{interactionId:n}=t,r=Nr[t.name],o=br(we+t.startTime),i=br(e.value),a=ft(),s=a?pt(a):void 0,l=(null!=n?xr.get(n):void 0)||s,c=l?st(l).description:Be().getScopeData().transactionName,u=yr({name:L(t.target),transaction:c,attributes:J({[qe]:"auto.http.browser.inp",[Ye]:`ui.interaction.${r}`,[Ze]:t.duration}),startTime:o});mn([u,"optionalAccess",e=>e.addEvent,"call",t=>t("inp",{[ze]:"millisecond",[Ve]:e.value})]),mn([u,"optionalAccess",e=>e.end,"call",e=>e(o+i)])}));return()=>{e()}}}(),r&&x.PerformanceObserver&&PerformanceObserver.supportedEntryTypes.includes("long-animation-frame")?new PerformanceObserver((e=>{if(ft())for(const t of e.getEntries()){if(!t.scripts[0])continue;const e=br(we+t.startTime),n=br(t.duration),r={[qe]:"auto.ui.browser.metrics"},o=t.scripts[0],{invoker:i,invokerType:a,sourceURL:s,sourceFunctionName:l,sourceCharPosition:c}=o;r["browser.script.invoker"]=i,r["browser.script.invoker_type"]=a,s&&(r["code.filepath"]=s),l&&(r["code.function"]=l),-1!==c&&(r["browser.script.source_char_position"]=c);const u=an({name:"Main UI thread blocked",op:"ui.long-animation-frame",startTime:e,attributes:r});u&&u.end(e+n)}})).observe({type:"long-animation-frame",buffered:!0}):n&&ir("longtask",(({entries:e})=>{if(ft())for(const t of e){const e=br(we+t.startTime),n=br(t.duration),r=an({name:"Main UI thread blocked",op:"ui.long-task",startTime:e,attributes:{[qe]:"auto.ui.browser.metrics"}});r&&r.end(e+n)}})),o&&ir("event",(({entries:e})=>{if(ft())for(const t of e)if("click"===t.name){const e=br(we+t.startTime),n=br(t.duration),r={name:L(t.target),op:`ui.interaction.${t.name}`,startTime:e,attributes:{[qe]:"auto.ui.browser.metrics"}},o=B(t.target);o&&(r.attributes["ui.component_name"]=o);const i=an(r);i&&i.end(e+n)}}));const v={name:void 0,source:void 0};function b(e,t){const n="pageload"===t.op,r=a?a(t):t,o=r.attributes||{};t.name!==r.name&&(o[je]="custom",r.attributes=o),v.name=r.name,v.source=o[je];const u=Wr(r,{idleTimeout:s,finalTimeout:l,childSpanTimeout:c,disableAutoFinish:n,beforeSpanEnd:e=>{y(),function(e,t){const n=vr();if(!n||!hn.performance.getEntries||!we)return;dn&&W.log("[Tracing] Adding & adjusting spans using Performance API");const r=br(we),o=n.getEntries(),{op:i,start_timestamp:a}=st(e);if(o.slice(kr).forEach((t=>{const n=br(t.startTime),o=br(Math.max(0,t.duration));if(!("navigation"===i&&a&&r+n<a))switch(t.entryType){case"navigation":!function(e,t,n){["unloadEvent","redirect","domContentLoadedEvent","loadEvent","connect"].forEach((r=>{Sr(e,t,r,n)})),Sr(e,t,"secureConnection",n,"TLS/SSL","connectEnd"),Sr(e,t,"fetch",n,"cache","domainLookupStart"),Sr(e,t,"domainLookup",n,"DNS"),function(e,t,n){const r=n+br(t.requestStart),o=n+br(t.responseEnd),i=n+br(t.responseStart);t.responseEnd&&(gr(e,r,o,{op:"browser",name:"request",attributes:{[qe]:"auto.ui.browser.metrics"}}),gr(e,i,o,{op:"browser",name:"response",attributes:{[qe]:"auto.ui.browser.metrics"}}))}(e,t,n)}(e,t,r);break;case"mark":case"paint":case"measure":{!function(e,t,n,r,o){const i=fn(),a=br(i?i.requestStart:0),s=o+Math.max(n,a),l=o+n,c=l+r,u={[qe]:"auto.resource.browser.metrics"};s!==l&&(u["sentry.browser.measure_happened_before_request"]=!0,u["sentry.browser.measure_start_time"]=s),gr(e,s,c,{name:t.name,op:t.entryType,attributes:u})}(e,t,n,o,r);const i=kn(),a=t.startTime<i.firstHiddenTime;"first-paint"===t.name&&a&&(dn&&W.log("[Measurements] Adding FP"),Ar.fp={value:t.startTime,unit:"millisecond"}),"first-contentful-paint"===t.name&&a&&(dn&&W.log("[Measurements] Adding FCP"),Ar.fcp={value:t.startTime,unit:"millisecond"});break}case"resource":!function(e,t,n,r,o,i){if("xmlhttprequest"===t.initiatorType||"fetch"===t.initiatorType)return;const a=un(n),s={[qe]:"auto.resource.browser.metrics"};Dr(s,t,"transferSize","http.response_transfer_size"),Dr(s,t,"encodedBodySize","http.response_content_length"),Dr(s,t,"decodedBodySize","http.decoded_response_content_length"),"renderBlockingStatus"in t&&(s["resource.render_blocking_status"]=t.renderBlockingStatus),a.protocol&&(s["url.scheme"]=a.protocol.split(":").pop()),a.host&&(s["server.address"]=a.host),s["url.same_origin"]=n.includes(hn.location.origin);const l=i+r;gr(e,l,l+o,{name:n.replace(hn.location.origin,""),op:t.initiatorType?`resource.${t.initiatorType}`:"resource.other",attributes:s})}(e,t,t.name,n,o,r)}})),kr=Math.max(o.length-1,0),function(e){const t=hn.navigator;if(!t)return;const n=t.connection;n&&(n.effectiveType&&e.setAttribute("effectiveConnectionType",n.effectiveType),n.type&&e.setAttribute("connectionType",n.type),fr(n.rtt)&&(Ar["connection.rtt"]={value:n.rtt,unit:"millisecond"})),fr(t.deviceMemory)&&e.setAttribute("deviceMemory",`${t.deviceMemory} GB`),fr(t.hardwareConcurrency)&&e.setAttribute("hardwareConcurrency",String(t.hardwareConcurrency))}(e),"pageload"===i){!function(e){const t=fn();if(!t)return;const{responseStart:n,requestStart:r}=t;r<=n&&(dn&&W.log("[Measurements] Adding TTFB Request Time"),e["ttfb.requestTime"]={value:n-r,unit:"millisecond"})}(Ar),["fcp","fp","lcp"].forEach((e=>{const t=Ar[e];if(!t||!a||r>=a)return;const n=t.value,o=r+br(n),i=Math.abs(1e3*(o-a)),s=i-n;dn&&W.log(`[Measurements] Normalized ${e} from ${n} to ${i} (${s})`),t.value=i}));const n=Ar["mark.fid"];n&&Ar.fid&&(gr(e,n.value,n.value+br(Ar.fid.value),{name:"first input delay",op:"ui.action",attributes:{[qe]:"auto.ui.browser.metrics"}}),delete Ar["mark.fid"]),"fcp"in Ar&&t.recordClsOnPageloadSpan||delete Ar.cls,Object.entries(Ar).forEach((([e,t])=>{!function(e,t,n){const r=ft(),o=r&&pt(r);o&&o.addEvent(e,{[Ve]:t,[ze]:n})}(e,t.value,t.unit)})),function(e){Cr&&(dn&&W.log("[Measurements] Adding LCP Data"),Cr.element&&e.setAttribute("lcp.element",L(Cr.element)),Cr.id&&e.setAttribute("lcp.id",Cr.id),Cr.url&&e.setAttribute("lcp.url",Cr.url.trim().slice(0,200)),e.setAttribute("lcp.size",Cr.size)),_r&&_r.sources&&(dn&&W.log("[Measurements] Adding CLS Data"),_r.sources.forEach(((t,n)=>e.setAttribute(`cls.source.${n+1}`,L(t.node)))))}(e)}Cr=void 0,_r=void 0,Ar={}}(e,{recordClsOnPageloadSpan:!i})}});function d(){["interactive","complete"].includes(po.document.readyState)&&e.emit("idleSpanEnableAutoFinish",u)}return n&&po.document&&(po.document.addEventListener("readystatechange",(()=>{d()})),d()),u}return{name:"BrowserTracing",afterAllSetup(e){let n,r=po.location&&po.location.href;e.on("startNavigationSpan",(t=>{He()===e&&(n&&!st(n).timestamp&&(Zr&&W.log(`[Tracing] Finishing current root span with op: ${st(n).op}`),n.end()),n=b(e,{op:"navigation",...t}))})),e.on("startPageLoadSpan",((t,r={})=>{if(He()!==e)return;n&&!st(n).timestamp&&(Zr&&W.log(`[Tracing] Finishing current root span with op: ${st(n).op}`),n.end());const o=function(e,t){const n=function(e){if(!e)return;const t=e.match(pe);if(!t)return;let n;return"1"===t[3]?n=!0:"0"===t[3]&&(n=!1),{traceId:t[1],parentSampled:n,parentSpanId:t[2]}}(e),r=oe(t),{traceId:o,parentSpanId:i,parentSampled:a}=n||{};return n?{traceId:o||se(),parentSpanId:i||se().substring(16),spanId:se().substring(16),sampled:a,dsc:r||{}}:{traceId:o||se(),spanId:se().substring(16)}}(r.sentryTrace||Oo("sentry-trace"),r.baggage||Oo("baggage"));Be().setPropagationContext(o),n=b(e,{op:"pageload",...t})})),e.on("spanEnd",(e=>{const t=st(e).op;if(e!==pt(e)||"navigation"!==t&&"pageload"!==t)return;const n=Be(),r=n.getPropagationContext();n.setPropagationContext({...r,sampled:void 0!==r.sampled?r.sampled:lt(e),dsc:r.dsc||Ct(e)})})),po.location&&(f&&function(e,t,n){e.emit("startPageLoadSpan",t,void 0),Be().setTransactionName(t.name);const r=ft();r&&st(r).op}(e,{name:po.location.pathname,startTime:we?we/1e3:void 0,attributes:{[je]:"url",[qe]:"auto.pageload.browser"}}),g&&$r((({to:t,from:n})=>{void 0===n&&r&&-1!==r.indexOf(t)?r=void 0:n!==t&&(r=void 0,function(e,t){Oe().setPropagationContext(ke()),Be().setPropagationContext(ke()),e.emit("startNavigationSpan",t),Be().setTransactionName(t.name);const n=ft();n&&st(n).op}(e,{name:po.location.pathname,attributes:{[je]:"url",[qe]:"auto.navigation.browser"}}))}))),u&&(po&&po.document?po.document.addEventListener("visibilitychange",(()=>{const e=ft();if(!e)return;const t=pt(e);if(po.document.hidden&&t){const e="cancelled",{op:n,status:r}=st(t);Zr&&W.log(`[Tracing] Transaction: ${e} -> since tab moved to the background, op: ${n}`),r||t.setStatus({code:Qe,message:e}),t.setAttribute("sentry.cancellation_reason","document.hidden"),t.end()}})):Zr&&W.warn("[Tracing] Could not set up background tab detection due to lack of global document")),o&&function(e,t,n,r){let o;po.document&&addEventListener("click",(()=>{const i="ui.action.click",a=ft(),s=a&&pt(a);if(s){const e=st(s).op;if(["navigation","pageload"].includes(e))return void(Zr&&W.warn(`[Tracing] Did not create ${i} span because a pageload or navigation span is in progress.`))}o&&(o.setAttribute(Xe,"interactionInterrupted"),o.end(),o=void 0),r.name?o=Wr({name:r.name,op:i,attributes:{[je]:r.source||"url"}},{idleTimeout:e,finalTimeout:t,childSpanTimeout:n}):Zr&&W.warn(`[Tracing] Did not create ${i} transaction because _latestRouteName is missing.`)}),{once:!1,capture:!0})}(s,l,c,v),t&&function(e){const t=({entries:e})=>{const t=ft(),n=t&&pt(t);e.forEach((e=>{if(!function(e){return"duration"in e}(e)||!n)return;const t=e.interactionId;if(null!=t&&!xr.has(t)){if(Mr.length>10){const e=Mr.shift();xr.delete(e)}Mr.push(t),xr.set(t,n)}}))};ir("event",t),ir("first-input",t)}(),Ro(e,{traceFetch:d,traceXHR:h,tracePropagationTargets:e.getOptions().tracePropagationTargets,shouldCreateSpanForRequest:m,enableHTTPTimings:p})}}})(),{name:"BrowserProfiling",setup(e){const t=ft(),n=t&&pt(t);n&&ei(n)&&oi(n)&&li(n),e.on("spanStart",(e=>{e===pt(e)&&oi(e)&&li(e)})),e.on("beforeEnvelope",(e=>{if(!ai.size)return;const t=function(e){const t=[];return Gt(e,((e,n)=>{if("transaction"===n)for(let n=1;n<e.length;n++){const r=e[n];r&&r.contexts&&r.contexts.profile&&r.contexts.profile.profile_id&&t.push(e[n])}})),t}(e);if(!t.length)return;const n=[];for(const e of t){const t=e&&e.contexts,r=t&&t.profile&&t.profile.profile_id,o=t&&t.profile&&t.profile.start_timestamp;if("string"!=typeof r){Zr&&W.log("[Profiling] cannot find profile for a span without a profile context");continue}if(!r){Zr&&W.log("[Profiling] cannot find profile for a span without a profile context");continue}t&&t.profile&&delete t.profile;const i=si(r);if(!i){Zr&&W.log(`[Profiling] Could not retrieve profile for span: ${r}`);continue}const a=ii(r,o,i,e);a&&n.push(a)}!function(e,t){if(!t.length)return e;for(const n of t)e[1].push([{type:"profile"},n])}(e,n)}))}},new uc(undefined),id({colorScheme:"system",isNameRequired:!0})],tracesSampleRate:1,tracePropagationTargets:["localhost",/^https:\/\/www.bondage - europe.com/],replaysSessionSampleRate:.1,replaysOnErrorSampleRate:1,profilesSampleRate:1};var hd,md;!function(e){e[e.dominant=0]="dominant",e[e.switch=1]="switch",e[e.submissive=2]="submissive",e[e.slave=3]="slave"}(hd||(hd={})),function(e){e[e.Global=0]="Global",e[e.Authority=1]="Authority",e[e.Log=2]="Log",e[e.Curses=3]="Curses",e[e.Rules=4]="Rules",e[e.Commands=5]="Commands",e[e.Relationships=6]="Relationships",e[e.ExportImport=88]="ExportImport",e[e.Misc=99]="Misc"}(md||(md={}));const pd={[md.Global]:"Global",[md.Authority]:"Authority",[md.Log]:"Behaviour Log",[md.Curses]:"Curses",[md.Rules]:"Rules",[md.Commands]:"Commands",[md.Relationships]:"Relationships",[md.ExportImport]:"Export-Import",[md.Misc]:"Miscellaneous"},fd={[md.Global]:"Icons/General.png",[md.Authority]:"Icons/Security.png",[md.Log]:"Icons/Title.png",[md.Curses]:"Icons/Struggle.png",[md.Rules]:i,[md.Commands]:"Icons/Use.png",[md.Relationships]:"Icons/FriendList.png",[md.ExportImport]:"Icons/Save.png",[md.Misc]:"Icons/Random.png"},gd=[md.Log,md.Curses,md.Rules,md.Commands,md.Relationships,md.Global];var yd,vd,bd;!function(e){e[e.construct=0]="construct",e[e.init=1]="init",e[e.load=2]="load",e[e.ready=3]="ready",e[e.destroy=4]="destroy"}(yd||(yd={})),function(e){e[e.BlockRandomEvents=0]="BlockRandomEvents",e[e.CantLoseMistress=1]="CantLoseMistress",e[e.GiveMistressKey=2]="GiveMistressKey",e[e.GivePandoraKey=3]="GivePandoraKey"}(vd||(vd={})),function(e){e[e.normal=0]="normal",e[e.limited=1]="limited",e[e.blocked=2]="blocked"}(bd||(bd={}));const wd={Effect:[]};class Cd{init(){}load(e){}run(){}unload(){}reload(e){}applyPreset(e){}}const _d=new TextEncoder;function kd(e){let t=-1;for(const n of _d.encode(e)){let e=255&(t^n);for(let t=0;t<8;t++)e=1&e?-306674912^e>>>1:e>>>1;t=t>>>8^e}return((-1^t)>>>0).toString(16).padStart(8,"0").toUpperCase()}function Ad(e){try{if("string"!=typeof e&&(e=JSON.stringify(e)||""),"string"==typeof e)return _d.encode(e).byteLength}catch(e){}return 0}function Ed(e){return!!e&&"object"==typeof e&&!Array.isArray(e)}function Sd(e){return Object.entries(e)}function Dd(e){return Object.keys(e)}function Md(e){if(0===e.length)return"";e=e.slice().sort();let t=0;for(;t<e[0].length&&e[0][t]===e[e.length-1][t];)t++;return e[0].substring(0,t)}function xd(e){const t=new Set;return e.filter((e=>!t.has(e)&&t.add(e)))}function Nd(e){return e.charAt(0).toLocaleUpperCase()+e.slice(1)}const Id=Boolean(navigator.clipboard);function Rd(e,t,n){return Math.min(Math.max(e,t),n)}function Ld(e,t,n){return e<t?n:e>n?t:e}function Td(e,t="full"){let n="";e<0&&(n="-",e*=-1);const r=Math.floor(e/1e3),o=Math.floor(r/60),i=Math.floor(o/60),a=Math.floor(i/24);return"full"===t||void 0===t?(a>0&&(n+=`${a} days, `),i>0&&(n+=i%24+" hours, "),o>0&&(n+=o%60+" minutes, "),r>0&&(n+=r%60+" seconds")):"short"===t&&(a>1?n+=`${a}d`:i>1?n+=`${i}h`:o>1?n+=`${o}m`:r>0&&(n+=`${r}s`)),n}function Pd(e,t){for(const[n,r]of Object.entries({PLAYER_NAME:Player.Name,...t}))e=e.replaceAll(n,r);return e}function Bd(e,t){const n=document.createElement("input");return n.type=e,t&&(n.maxLength=t),n.addEventListener("keydown",GameKeyDown),n.className="HideOnPopup",n}function Od(e,t,n,r,o){const i=MainCanvas.canvas.clientHeight/1e3,a=MainCanvas.canvas.clientWidth/2e3,s=MainCanvas.canvas.clientWidth<=2*MainCanvas.canvas.clientHeight?MainCanvas.canvas.clientWidth/50:MainCanvas.canvas.clientHeight/25,l=o?o*i:1.15*s,c=r*a-18,u=MainCanvas.canvas.offsetTop+n*i-l/2,d=MainCanvas.canvas.offsetLeft+(t-r/2)*a;Object.assign(e.style,{fontSize:`${s}px`,fontFamily:CommonGetFontName(),position:"fixed",left:`${d}px`,top:`${u}px`,width:`${c}px`,height:`${l}px`,display:"inline"})}function $d(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Fd(e){const t=/^(\d+).(\d+).(\d+)-(DEV-\d+)$/.exec(e);if(t)return{major:Number.parseInt(t[1],10),minor:Number.parseInt(t[2],10),patch:Number.parseInt(t[3],10),extra:t[4],dev:!0,strict:!1};const n=/^(\d+).(\d+).(\d+)-STRICT-([0-f]+)$/.exec(e);if(n)return{major:Number.parseInt(n[1],10),minor:Number.parseInt(n[2],10),patch:Number.parseInt(n[3],10),extra:n[4],dev:!1,strict:!0};const r=/^(\d+).(\d+).(\d+)-([0-f]+)$/.exec(e);return r?{major:Number.parseInt(r[1],10),minor:Number.parseInt(r[2],10),patch:Number.parseInt(r[3],10),extra:r[4],dev:!1,strict:!1}:null}function Hd(e,t){var n,r,o,i;return e.major!==t.major?e.major-t.major:e.minor!==t.minor?e.minor-t.minor:e.patch!==t.patch?e.patch-t.patch:(null!==(n=e.dev)&&void 0!==n&&n)!==(null!==(r=t.dev)&&void 0!==r&&r)?e.dev?1:-1:(null!==(o=e.strict)&&void 0!==o&&o)!==(null!==(i=t.strict)&&void 0!==i&&i)?e.strict?1:-1:0}function Wd(e){let t=`${e.major}.${e.minor}.${e.patch}`;return e.extra&&(t+=`-${e.extra}`),e.strict&&(t+="-STRICT"),t}const Gd=(()=>{const e=Fd("1.0.2-STRICT-6585254c");if(!e)throw Error("Failed to parse own version");return e})();var jd=n(531),Ud=n.n(jd);const Yd=Ud().registerMod({name:"BCX",fullName:"Bondage Club Extended",version:"1.0.2-STRICT-6585254c",repository:"https://github.com/Jomshir98/bondage-club-extended"});Ud().errorReporterHooks.hookEnter=(e,t)=>{const n=m(`Function ${e} hook from ${t}`,{modArea:t});return()=>{n.end()}},Ud().errorReporterHooks.hookChainExit=(e,t)=>{const n=m(`Function ${e} hook chain exit`,{modArea:0===t.size?"":"[Presence of patches prevents identifying source]",extraInfo:()=>t.size>0?`Patched by: ${Array.from(t).join(", ")}`:""});return()=>{n.end()}},"apiEndpointEnter"in Ud().errorReporterHooks&&(Ud().errorReporterHooks.apiEndpointEnter=(e,t)=>{const n=m(`ModSDK ${e} by ${t}`,{modArea:t});return()=>{n.end()}});const qd=new Map;let Xd=!1;function zd(e){if(Xd)throw new Error("Cannot init patchable function after unload");let t=qd.get(e);if(!t){const n=Yd.getOriginalHash(e);console.debug(`HardCoreClub: Initialized ${e} for patching, hash ${n}`),t={name:e,originalHash:n,hooks:[]},qd.set(e,t)}return t}function Vd(e){zd(e)}function Zd(e,t,n,r=null){const o=zd(e);if(o.hooks.some((e=>e.hook===n)))return void console.error(`HardCoreClub: Duplicate hook for "${e}"`,n);const i=Yd.hookFunction(e,t,n);o.hooks.push({hook:n,priority:t,module:r,removeCallback:i}),o.hooks.sort(((e,t)=>t.priority-e.priority))}function Kd(e){for(const t of qd.values())for(let n=t.hooks.length-1;n>=0;n--)t.hooks[n].module===e&&(t.hooks[n].removeCallback(),t.hooks.splice(n,1));return!0}function Jd(e,t){zd(e),Yd.patchFunction(e,t)}function Qd(e,t,n=new Set){if((Ed(t)||Array.isArray(t))&&!n.has(t))if(n.add(t),Array.isArray(t))for(let r=0;r<t.length;r++)Qd(`${e}[${r}]`,t[r],n);else if(Ed(t)){!function(e,t){const n=new Map;for(const[e,t]of Ud().getPatchingInfo())t.original&&t.sdkEntrypoint&&n.set(t.original,[e,t.sdkEntrypoint]);for(const[r,o]of Object.entries(t)){if("function"!=typeof o)continue;const i=n.get(o);i&&(console.debug(`HardCoreClub: Replacing referenced function "${i[0]}", found at ${e}.${r}`),t[r]=i[1])}}(e,t);for(const[r,o]of Object.entries(t))Qd(`${e}.${r}`,o,n)}}function eh(e,t,n){return Yd.callOriginal(e,t,n)}function th(e){return Array.from(qd.entries()).map((e=>[e[0],e[1].originalHash])).filter((t=>e||!1))}const nh=function(e,t){return e===t||e!=e&&t!=t},rh=function(e,t){for(var n=e.length;n--;)if(nh(e[n][0],t))return n;return-1};var oh=Array.prototype.splice;function ih(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}ih.prototype.clear=function(){this.__data__=[],this.size=0},ih.prototype.delete=function(e){var t=this.__data__,n=rh(t,e);return!(n<0||(n==t.length-1?t.pop():oh.call(t,n,1),--this.size,0))},ih.prototype.get=function(e){var t=this.__data__,n=rh(t,e);return n<0?void 0:t[n][1]},ih.prototype.has=function(e){return rh(this.__data__,e)>-1},ih.prototype.set=function(e,t){var n=this.__data__,r=rh(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this};const ah=ih,sh="object"==typeof global&&global&&global.Object===Object&&global;var lh="object"==typeof self&&self&&self.Object===Object&&self;const ch=sh||lh||Function("return this")(),uh=ch.Symbol;var dh=Object.prototype,hh=dh.hasOwnProperty,mh=dh.toString,ph=uh?uh.toStringTag:void 0;var fh=Object.prototype.toString;var gh=uh?uh.toStringTag:void 0;const yh=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":gh&&gh in Object(e)?function(e){var t=hh.call(e,ph),n=e[ph];try{e[ph]=void 0;var r=!0}catch(e){}var o=mh.call(e);return r&&(t?e[ph]=n:delete e[ph]),o}(e):function(e){return fh.call(e)}(e)},vh=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)},bh=function(e){if(!vh(e))return!1;var t=yh(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t},wh=ch["__core-js_shared__"];var Ch,_h=(Ch=/[^.]+$/.exec(wh&&wh.keys&&wh.keys.IE_PROTO||""))?"Symbol(src)_1."+Ch:"";var kh=Function.prototype.toString;const Ah=function(e){if(null!=e){try{return kh.call(e)}catch(e){}try{return e+""}catch(e){}}return""};var Eh=/^\[object .+?Constructor\]$/,Sh=Function.prototype,Dh=Object.prototype,Mh=Sh.toString,xh=Dh.hasOwnProperty,Nh=RegExp("^"+Mh.call(xh).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");const Ih=function(e){return!(!vh(e)||(t=e,_h&&_h in t))&&(bh(e)?Nh:Eh).test(Ah(e));var t},Rh=function(e,t){var n=function(e,t){return null==e?void 0:e[t]}(e,t);return Ih(n)?n:void 0},Lh=Rh(ch,"Map"),Th=Rh(Object,"create");var Ph=Object.prototype.hasOwnProperty;var Bh=Object.prototype.hasOwnProperty;function Oh(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}Oh.prototype.clear=function(){this.__data__=Th?Th(null):{},this.size=0},Oh.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},Oh.prototype.get=function(e){var t=this.__data__;if(Th){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return Ph.call(t,e)?t[e]:void 0},Oh.prototype.has=function(e){var t=this.__data__;return Th?void 0!==t[e]:Bh.call(t,e)},Oh.prototype.set=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=Th&&void 0===t?"__lodash_hash_undefined__":t,this};const $h=Oh,Fh=function(e,t){var n,r,o=e.__data__;return("string"==(r=typeof(n=t))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?o["string"==typeof t?"string":"hash"]:o.map};function Hh(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}Hh.prototype.clear=function(){this.size=0,this.__data__={hash:new $h,map:new(Lh||ah),string:new $h}},Hh.prototype.delete=function(e){var t=Fh(this,e).delete(e);return this.size-=t?1:0,t},Hh.prototype.get=function(e){return Fh(this,e).get(e)},Hh.prototype.has=function(e){return Fh(this,e).has(e)},Hh.prototype.set=function(e,t){var n=Fh(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this};const Wh=Hh;function Gh(e){var t=this.__data__=new ah(e);this.size=t.size}Gh.prototype.clear=function(){this.__data__=new ah,this.size=0},Gh.prototype.delete=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n},Gh.prototype.get=function(e){return this.__data__.get(e)},Gh.prototype.has=function(e){return this.__data__.has(e)},Gh.prototype.set=function(e,t){var n=this.__data__;if(n instanceof ah){var r=n.__data__;if(!Lh||r.length<199)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new Wh(r)}return n.set(e,t),this.size=n.size,this};const jh=Gh,Uh=function(){try{var e=Rh(Object,"defineProperty");return e({},"",{}),e}catch(e){}}(),Yh=function(e,t,n){"__proto__"==t&&Uh?Uh(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n};var qh=Object.prototype.hasOwnProperty;const Xh=function(e,t,n){var r=e[t];qh.call(e,t)&&nh(r,n)&&(void 0!==n||t in e)||Yh(e,t,n)},zh=function(e,t,n,r){var o=!n;n||(n={});for(var i=-1,a=t.length;++i<a;){var s=t[i],l=r?r(n[s],e[s],s,n,e):void 0;void 0===l&&(l=e[s]),o?Yh(n,s,l):Xh(n,s,l)}return n},Vh=function(e){return null!=e&&"object"==typeof e},Zh=function(e){return Vh(e)&&"[object Arguments]"==yh(e)};var Kh=Object.prototype,Jh=Kh.hasOwnProperty,Qh=Kh.propertyIsEnumerable;const em=Zh(function(){return arguments}())?Zh:function(e){return Vh(e)&&Jh.call(e,"callee")&&!Qh.call(e,"callee")},tm=Array.isArray;var nm="object"==typeof exports&&exports&&!exports.nodeType&&exports,rm=nm&&"object"==typeof module&&module&&!module.nodeType&&module,om=rm&&rm.exports===nm?ch.Buffer:void 0;const im=(om?om.isBuffer:void 0)||function(){return!1};var am=/^(?:0|[1-9]\d*)$/;const sm=function(e,t){var n=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==n||"symbol"!=n&&am.test(e))&&e>-1&&e%1==0&&e<t},lm=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991};var cm={};cm["[object Float32Array]"]=cm["[object Float64Array]"]=cm["[object Int8Array]"]=cm["[object Int16Array]"]=cm["[object Int32Array]"]=cm["[object Uint8Array]"]=cm["[object Uint8ClampedArray]"]=cm["[object Uint16Array]"]=cm["[object Uint32Array]"]=!0,cm["[object Arguments]"]=cm["[object Array]"]=cm["[object ArrayBuffer]"]=cm["[object Boolean]"]=cm["[object DataView]"]=cm["[object Date]"]=cm["[object Error]"]=cm["[object Function]"]=cm["[object Map]"]=cm["[object Number]"]=cm["[object Object]"]=cm["[object RegExp]"]=cm["[object Set]"]=cm["[object String]"]=cm["[object WeakMap]"]=!1;const um=function(e){return function(t){return e(t)}};var dm="object"==typeof exports&&exports&&!exports.nodeType&&exports,hm=dm&&"object"==typeof module&&module&&!module.nodeType&&module,mm=hm&&hm.exports===dm&&sh.process;const pm=function(){try{return hm&&hm.require&&hm.require("util").types||mm&&mm.binding&&mm.binding("util")}catch(e){}}();var fm=pm&&pm.isTypedArray;const gm=fm?um(fm):function(e){return Vh(e)&&lm(e.length)&&!!cm[yh(e)]};var ym=Object.prototype.hasOwnProperty;const vm=function(e,t){var n=tm(e),r=!n&&em(e),o=!n&&!r&&im(e),i=!n&&!r&&!o&&gm(e),a=n||r||o||i,s=a?function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}(e.length,String):[],l=s.length;for(var c in e)!t&&!ym.call(e,c)||a&&("length"==c||o&&("offset"==c||"parent"==c)||i&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||sm(c,l))||s.push(c);return s};var bm=Object.prototype;const wm=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||bm)},Cm=function(e,t){return function(n){return e(t(n))}},_m=Cm(Object.keys,Object);var km=Object.prototype.hasOwnProperty;const Am=function(e){return null!=e&&lm(e.length)&&!bh(e)},Em=function(e){return Am(e)?vm(e):function(e){if(!wm(e))return _m(e);var t=[];for(var n in Object(e))km.call(e,n)&&"constructor"!=n&&t.push(n);return t}(e)};var Sm=Object.prototype.hasOwnProperty;const Dm=function(e){if(!vh(e))return function(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t}(e);var t=wm(e),n=[];for(var r in e)("constructor"!=r||!t&&Sm.call(e,r))&&n.push(r);return n},Mm=function(e){return Am(e)?vm(e,!0):Dm(e)};var xm="object"==typeof exports&&exports&&!exports.nodeType&&exports,Nm=xm&&"object"==typeof module&&module&&!module.nodeType&&module,Im=Nm&&Nm.exports===xm?ch.Buffer:void 0,Rm=Im?Im.allocUnsafe:void 0;const Lm=function(){return[]};var Tm=Object.prototype.propertyIsEnumerable,Pm=Object.getOwnPropertySymbols;const Bm=Pm?function(e){return null==e?[]:(e=Object(e),function(e,t){for(var n=-1,r=null==e?0:e.length,o=0,i=[];++n<r;){var a=e[n];t(a,n,e)&&(i[o++]=a)}return i}(Pm(e),(function(t){return Tm.call(e,t)})))}:Lm,Om=function(e,t){for(var n=-1,r=t.length,o=e.length;++n<r;)e[o+n]=t[n];return e},$m=Cm(Object.getPrototypeOf,Object),Fm=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)Om(t,Bm(e)),e=$m(e);return t}:Lm,Hm=function(e,t,n){var r=t(e);return tm(e)?r:Om(r,n(e))},Wm=function(e){return Hm(e,Em,Bm)},Gm=function(e){return Hm(e,Mm,Fm)},jm=Rh(ch,"DataView"),Um=Rh(ch,"Promise"),Ym=Rh(ch,"Set"),qm=Rh(ch,"WeakMap");var Xm="[object Map]",zm="[object Promise]",Vm="[object Set]",Zm="[object WeakMap]",Km="[object DataView]",Jm=Ah(jm),Qm=Ah(Lh),ep=Ah(Um),tp=Ah(Ym),np=Ah(qm),rp=yh;(jm&&rp(new jm(new ArrayBuffer(1)))!=Km||Lh&&rp(new Lh)!=Xm||Um&&rp(Um.resolve())!=zm||Ym&&rp(new Ym)!=Vm||qm&&rp(new qm)!=Zm)&&(rp=function(e){var t=yh(e),n="[object Object]"==t?e.constructor:void 0,r=n?Ah(n):"";if(r)switch(r){case Jm:return Km;case Qm:return Xm;case ep:return zm;case tp:return Vm;case np:return Zm}return t});const op=rp;var ip=Object.prototype.hasOwnProperty;const ap=ch.Uint8Array,sp=function(e){var t=new e.constructor(e.byteLength);return new ap(t).set(new ap(e)),t};var lp=/\w*$/;var cp=uh?uh.prototype:void 0,up=cp?cp.valueOf:void 0;const dp=function(e,t,n){var r,o,i,a=e.constructor;switch(t){case"[object ArrayBuffer]":return sp(e);case"[object Boolean]":case"[object Date]":return new a(+e);case"[object DataView]":return function(e,t){var n=t?sp(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}(e,n);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return function(e,t){var n=t?sp(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}(e,n);case"[object Map]":case"[object Set]":return new a;case"[object Number]":case"[object String]":return new a(e);case"[object RegExp]":return(i=new(o=e).constructor(o.source,lp.exec(o))).lastIndex=o.lastIndex,i;case"[object Symbol]":return r=e,up?Object(up.call(r)):{}}};var hp=Object.create;const mp=function(){function e(){}return function(t){if(!vh(t))return{};if(hp)return hp(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();var pp=pm&&pm.isMap;const fp=pp?um(pp):function(e){return Vh(e)&&"[object Map]"==op(e)};var gp=pm&&pm.isSet;const yp=gp?um(gp):function(e){return Vh(e)&&"[object Set]"==op(e)};var vp="[object Arguments]",bp="[object Function]",wp="[object Object]",Cp={};Cp[vp]=Cp["[object Array]"]=Cp["[object ArrayBuffer]"]=Cp["[object DataView]"]=Cp["[object Boolean]"]=Cp["[object Date]"]=Cp["[object Float32Array]"]=Cp["[object Float64Array]"]=Cp["[object Int8Array]"]=Cp["[object Int16Array]"]=Cp["[object Int32Array]"]=Cp["[object Map]"]=Cp["[object Number]"]=Cp[wp]=Cp["[object RegExp]"]=Cp["[object Set]"]=Cp["[object String]"]=Cp["[object Symbol]"]=Cp["[object Uint8Array]"]=Cp["[object Uint8ClampedArray]"]=Cp["[object Uint16Array]"]=Cp["[object Uint32Array]"]=!0,Cp["[object Error]"]=Cp[bp]=Cp["[object WeakMap]"]=!1;const _p=function e(t,n,r,o,i,a){var s,l=1&n,c=2&n,u=4&n;if(r&&(s=i?r(t,o,i,a):r(t)),void 0!==s)return s;if(!vh(t))return t;var d=tm(t);if(d){if(s=function(e){var t=e.length,n=new e.constructor(t);return t&&"string"==typeof e[0]&&ip.call(e,"index")&&(n.index=e.index,n.input=e.input),n}(t),!l)return function(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t}(t,s)}else{var h=op(t),m=h==bp||"[object GeneratorFunction]"==h;if(im(t))return function(e,t){if(t)return e.slice();var n=e.length,r=Rm?Rm(n):new e.constructor(n);return e.copy(r),r}(t,l);if(h==wp||h==vp||m&&!i){if(s=c||m?{}:function(e){return"function"!=typeof e.constructor||wm(e)?{}:mp($m(e))}(t),!l)return c?function(e,t){return zh(e,Fm(e),t)}(t,function(e,t){return e&&zh(t,Mm(t),e)}(s,t)):function(e,t){return zh(e,Bm(e),t)}(t,function(e,t){return e&&zh(t,Em(t),e)}(s,t))}else{if(!Cp[h])return i?t:{};s=dp(t,h,l)}}a||(a=new jh);var p=a.get(t);if(p)return p;a.set(t,s),yp(t)?t.forEach((function(o){s.add(e(o,n,r,o,t,a))})):fp(t)&&t.forEach((function(o,i){s.set(i,e(o,n,r,i,t,a))}));var f=d?void 0:(u?c?Gm:Wm:c?Mm:Em)(t);return function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r&&!1!==t(e[n],n,e););}(f||t,(function(o,i){f&&(o=t[i=o]),Xh(s,i,e(o,n,r,i,t,a))})),s},kp=function(e){return _p(e,5)};class Ap{get active(){return Gk()===this}Load(){}Run(){}Click(){}Exit(){jk(null)}Unload(){}onChange(e){}}class Ep extends Ap{constructor(e,t,n,r,o,i){super(),this.character=e,this.permission=t,this.permissionData=n,this.back=i,this.myAccessLevel=r,this.noAccess=o,this.selectedLevel=n.min}Run(){if(DrawTextFit(`- Authority: Changing minimum access to permission "${this.permissionData.name}" -`,125,125,1850,"Black","Gray"),MainCanvas.textAlign="center",DrawText("Please select the new lowest role that should still have this permission.",1e3,255,"Black"),DrawTextFit(`Info: Currently set role: ${this.permissionData.min===xA.self?this.character.Name:Nd(xA[this.permissionData.min])}  Newly selected role: ${this.selectedLevel===xA.self?this.character.Name:Nd(xA[this.selectedLevel])}`,1e3,320,1850,"Black"),DrawText("All roles to the left of the selected one will also automatically get access.",1e3,385,"Black"),this.myAccessLevel===xA.self){const e=this.permissionData.min<=xA.self||!this.noAccess;DrawButton(890,460,220,72,WA(xA.self,this.character),this.selectedLevel===xA.self?"Cyan":e?"White":"#ddd",void 0,void 0,!e)}for(let e=1;e<8;e++){const t=this.selectedLevel===e,n=this.myAccessLevel===xA.self&&this.permissionData.min<=e&&e<=xA.owner||!this.noAccess&&this.myAccessLevel<=e;DrawButton(230*e-15,577,190,72,WA(e,this.character),t?"Cyan":n?"White":"#ddd",void 0,void 0,!n),e<7&&DrawText(">",196+230*e,613,"Black")}this.character.isPlayer()&&"authority_revoke_self"===this.permission&&this.selectedLevel!==xA.self&&DrawText("WARNING: If you confirm, all permitted roles can remove your access to this and all other permissions!",1e3,730,"Red","Gray"),DrawButton(700,800,200,80,"Confirm","White"),DrawButton(1120,800,200,80,"Cancel","White")}Click(){if(MouseIn(700,800,200,80))return this.Confirm();if(MouseIn(1120,800,200,80))return this.Exit();MouseIn(890,460,220,72)&&this.myAccessLevel===xA.self&&(this.permissionData.min<=xA.self||!this.noAccess)&&(this.selectedLevel=xA.self);for(let e=1;e<8;e++){const t=this.selectedLevel===e,n=this.myAccessLevel===xA.self&&this.permissionData.min<=e&&e<=xA.owner||!this.noAccess&&this.myAccessLevel<=e;MouseIn(230*e-15,577,190,72)&&!t&&n&&(this.selectedLevel=e)}}Confirm(){this.character.setPermission(this.permission,"min",this.selectedLevel)}Exit(){jk(this.back)}onChange(){this.Exit()}}class Sp extends Ap{constructor(e,t,n,r){super(),this.character=e,this.permission=t,this.permissionData=n,this.back=r}Run(){DrawTextFit(`- Authority: Removing self access to permission "${this.permissionData.name}" -`,125,125,1850,"Black","Gray"),MainCanvas.textAlign="center",DrawText("- Warning -",1e3,375,"Black","Black"),DrawText("If you confirm, you won't be able to change your access to this permission back yourself.",1e3,525,"Black"),DrawButton(700,720,200,80,"Confirm","White"),DrawButton(1120,720,200,80,"Cancel","White")}Click(){return MouseIn(700,720,200,80)?this.Confirm():MouseIn(1120,720,200,80)?this.Exit():void 0}Confirm(){this.character.setPermission(this.permission,"self",!1)}Exit(){jk(this.back)}onChange(){this.Exit()}}var Dp;!function(e){e[e.AuthorityRoles=10]="AuthorityRoles",e[e.AuthorityPermissions=11]="AuthorityPermissions",e[e.Log=20]="Log",e[e.LogConfig=21]="LogConfig",e[e.ConditionsViewCurses=30]="ConditionsViewCurses",e[e.ConditionsEditCurses=31]="ConditionsEditCurses",e[e.ConditionsGlobalCurses=32]="ConditionsGlobalCurses",e[e.CursesAdd=33]="CursesAdd",e[e.CursesAddPermissionMode=34]="CursesAddPermissionMode",e[e.ConditionsViewRules=40]="ConditionsViewRules",e[e.ConditionsEditRules=41]="ConditionsEditRules",e[e.ConditionsGlobalRules=42]="ConditionsGlobalRules",e[e.RulesAdd=43]="RulesAdd",e[e.RulesAddPermissionMode=44]="RulesAddPermissionMode",e[e.Commands=50]="Commands",e[e.CommandsPermissionMode=51]="CommandsPermissionMode",e[e.Relationships=60]="Relationships",e[e.ExportImportMain=91]="ExportImportMain",e[e.ExportImportSelect=92]="ExportImportSelect",e[e.Misc=100]="Misc"}(Dp||(Dp={}));const Mp={[Dp.AuthorityRoles]:"If you are permitted, this screen enables you to view, add, or remove the BCX-only roles 'Owner' and 'Mistress', which expand the classic roles of BC such as Bondage Club's Owner and the Lovers. The hierarchy of all roles that can be used to set various things in BCX can be seen on the right. The higher up a role is, the more authority it has. For instance, if something applies or is permitted for a Mistress, it also always is for an Owner. Any number of Owners and Mistresses can be set. Check their current power over BCX with the button on the right.",[Dp.AuthorityPermissions]:"The heart of HardCoreClub: Allows to configure the permissions to set up and use most of BCX. Default settings depend on the initial BCX setup preset selected. Self access is the checkbox next to every permission and the lowest access role is to its right. Example: If 'allow forbidding self access', 'allow granting self access', 'allow lowest access modification' have the checkbox removed and lowest role is 'Owner', then current and newly added BCX owners and the BC owner can get full control over any permissions they have access to. So careful with those three permissions!",[Dp.Log]:"This screen shows logs of important events. What is logged depends on the logging configuration, which can be viewed/edited via the button to the right. Log entries can have normal or protected visibility. Access to those as well as removing entries or the configuration is determined by the according authority module permission settings. The log can document the BCX's user's conduct, any rule violations, important changes made to BCX settings, curses or rules, and notes from other people.",[Dp.LogConfig]:"This screen determines what is logged in the behaviour log and what the visibility of each type of log messages is. 'Yes' means this log type has normal visibility, while 'protected' means only roles who have permission to view protected entries can view them. 'No' means that this log type is not logged at all. In the permission settings view of the authority module, the permissions of this log module can be configured.",[Dp.ConditionsViewCurses]:"This screen shows all active curses on the player, including many information, such as duration, if it is a cursed item/clothing/body slot or a blocked item or clothing slot that forces to stay unrestrained or naked there. Clicking on the button with the cog icon in the middle of each row moves you to a new screen that allows to configure the curse (if you have permission). When the cog icon has a blue aura, that means that the curse's conditions are the same as the global config. If permitted, you can remove single curses with the 'X' button.",[Dp.ConditionsEditCurses]:"Here you can switch the curse on/off, set a timer for activating/deactivating/deleting the curse and define when it can trigger, such as either always or based on where the player is and with whom. The small green/red bars next to the checkboxes indicate whether a condition is true at present or not and the big bar whether this means that the curse is in effect, if active. On the right side, you can curse the usage/alteration of an item such as fixing cuffs behind the back. Lastly, in the bottom right you can set the trigger conditions of this curse to the global curses config.",[Dp.ConditionsGlobalCurses]:"The settings on this page are the global/default settings for all newly added curses. Changes to the trigger conditions are also applied to existing curses that are (still) set to global curses configuration, though. Exception is if a timer is set here. Such a timer only applies to newly created curses.",[Dp.CursesAdd]:"Here, you can add a curse to any empty slot (white) which will keep it empty or on any worn item (gold) which will prevent removal. You add the curse by simply clicking the slot which then becomes purple to indicate that it is now cursed. Grey slots indicate that you have no access to them, due to them being blocked or due to your permission settings. Slots can be limited/blocked via the settings button on the very right. The screen has a second page for the character's body slots.",[Dp.CursesAddPermissionMode]:"Here you can cycle item and clothing slots between being not limited, limited and blocked. Blocked means no one can add a curse to it, while limited means only roles that have the permission to curse limited slots can curse them. There is no need to save changes as they are instantly in effect.",[Dp.ConditionsViewRules]:"This screen shows all active rules for the player, including many information, such as duration, the rule type and little status icons that show if the rule is enforced and/or transgressions are logged. Clicking on the button with the cog icon in the middle of each row moves you to a new screen that allows to configure the rule (if you have permission). When the cog icon has a blue aura, then that means that the rule's conditions are the same as the global config. If permitted, you can remove single rules with the 'X' button.",[Dp.ConditionsEditRules]:"Here you switch the rule on/off, set a timer for activating/deactivating/deleting the rule and define when it can trigger, such as either always or based on where the player is and with whom. The small green/red bars next to the checkboxes indicate whether a condition is true at present or not and the big bar whether this means that the rule is in effect, if active. Depending on the rule, you can either enforce its effect, log all violations, or both at the same time. Lastly on the bottom right, you can set whether the trigger conditions of this rule should follow the global rules config or not.",[Dp.ConditionsGlobalRules]:"The settings on this page are the global/default settings for all newly added rules. Changes to the trigger conditions are also applied to existing rules that are (still) set to global rules configuration, though. Exception is if a timer is set here. Such a timer only applies to newly established rules.",[Dp.RulesAdd]:"On this screen you can establish new rules for the player by simply clicking any rule template. After clicking on it, you can edit the rule's configuration. Purple rule templates indicate, that they are already in use; greyed out ones, that you have no access to them due to being blocked or due to your permission settings. Rule templates can be limited/blocked via the settings button on the very right. Note: If you want to be able to log rule violations, this type of log entry may need to be allowed in the configuration page of the behavior log module.",[Dp.RulesAddPermissionMode]:"Here you can cycle rule templates between being not limited, limited and blocked. Blocked means no one can add/use this rule, while limited means only roles that have the permission to establish limited rules can add them. There is no need to save changes as they are instantly in effect.",[Dp.Commands]:"On this screen you can see the available commands for the player. Clicking on one shows a more detailed description of it. Greyed out commands indicate that you have no access to them due to being blocked or due to your permission settings. Commands can be limited/blocked via the settings button on the very right. Commands will be used in the chat room's chat by whispering them with a '!' before the command to another player. Note: SOME of the commands can also be used on yourself with a leading '.' instead of '!' (e.g. '.eyes close')",[Dp.CommandsPermissionMode]:"Here you can cycle commands between being not limited, limited and blocked. Blocked means no one can use this command, while limited means only roles that have the permission to use limited commands can trigger them in that chat. There is no need to save changes as they are instantly in effect.",[Dp.Misc]:"This screen offers various settings to configure your Bondage Club experience in general, such as enabling/disabling the typing indicator that shows other BCX users an icon when you are currently typing something to public chat or whispering something to only them. The cheats are only temporarily active as long as they are set; items that were only given via a cheat are then also gone again.",[Dp.ExportImportMain]:"Please select the module feature you want to backup or import from a previous export. After storing the exported texts, you can later on use them again, e.g. for switching between cursed outfits or different rule sets. These exports are compatible between different BCX users and can be used by everyone with BCX who is permitted to make changes to the according module. For instance, if an owner has the permission to control limited AND non-limited rules on the sub, she is with that also allowed to import previously exported rules that are not blocked.",[Dp.ExportImportSelect]:"Export/import works by converting the current configuration of the selected module feature into a long code word that is copied to your device's clipboard. You can then paste it anywhere you like, for instance a text file on your device. Functionality of this feature depends on the device you are using and if the clipboard can be used on it. This field will also show you status information while you try to export or import.\nCompressing the export will save you some space when storing it, as the text length will be shorter, although the exported string will no longer be human readable. ",[Dp.Relationships]:"This screen lets you add custom nicknames for other club members. The set custom name replaces the added character's real name / BC-nickname in this player's chat, except within chat commands, which are considered OOC. You can also enforce the custom name so that the player is blocked from sending a chat message / whisper that use the character's name / BC-nickname while with her. The player cannot have multiple custom names set for a single character. A character who has a custom name set on this screen can always see their own set custom name in this list."};class xp extends Ap{constructor(e){super(),this.permissionData=null,this.myAccessLevel=xA.public,this.failed=!1,this.permList=[],this.page=0,this.showHelp=!1,this.filterInput=Bd("text",30),this.character=e,this.character.isPlayer()&&(this.myAccessLevel=xA.self),this.filterInput.addEventListener("input",(e=>{this.rebuildList()}))}Load(){this.requestData()}onChange(e){e===this.character.MemberNumber&&this.requestData()}requestData(){Promise.all([this.character.getPermissions(),this.character.getMyAccessLevel()]).then((e=>{this.permissionData=e[0],this.myAccessLevel=e[1],this.failed=!1,this.rebuildList()}),(e=>{console.error(`HardCoreClub: Failed to get permission info for ${this.character}`,e),this.permissionData=null,this.failed=!0,this.rebuildList()}))}rebuildList(){if(!this.active)return;if(this.permList=[],null===this.permissionData)return void this.filterInput.remove();this.filterInput.parentElement||document.body.appendChild(this.filterInput);const e=this.filterInput.value.trim().toLocaleLowerCase().split(" ").filter(Boolean),t=!!this.permissionData.authority_grant_self&&PA(this.permissionData.authority_grant_self,this.myAccessLevel),n=!!this.permissionData.authority_revoke_self&&PA(this.permissionData.authority_revoke_self,this.myAccessLevel),r=!!this.permissionData.authority_edit_min&&PA(this.permissionData.authority_edit_min,this.myAccessLevel),o=this.myAccessLevel===xA.self,i=new Map;for(const[t,n]of Object.entries(this.permissionData)){let r=i.get(n.category);e.some((e=>!pd[n.category].toLocaleLowerCase().includes(e)&&!n.name.toLocaleLowerCase().includes(e)&&!t.toLocaleLowerCase().includes(e)))||(r||i.set(n.category,r={}),r[t]=n)}for(const[a,s]of Array.from(i.entries()).sort(((e,t)=>e[0]-t[0]))){if(0===e.length)for(;this.permList.length%6!=0;)this.permList.push(null);this.permList.push({separator:!0,name:`${pd[a]} module permissions`});for(const[i,l]of Object.entries(s).sort(((e,t)=>e[1].name.localeCompare(t[1].name)))){0===e.length&&this.permList.length%6==0&&this.permList.push({separator:!0,name:`${pd[a]} module permissions (continued)`});const s=PA(l,this.myAccessLevel);this.permList.push({separator:!1,permission:i,permissionInfo:l,editSelf:(l.self?n:t)&&(o||s)&&(!l.self||l.min!==xA.self),editMin:o&&l.min<xA.owner||r&&s})}}const a=Math.ceil(this.permList.length/6);this.page<0?this.page=Math.max(a-1,0):this.page>=a&&(this.page=0)}Run(){if(null!==this.permissionData){DrawTextFit(this.character.Name,1111,190,189,"Black"),DrawText("is permitted",1111,235,"Black"),DrawText("Lowest permitted role",1370,235,"Black"),DrawEmptyRect(1335,230,0,610,"Black"),DrawText("Filter:",130,215,"Black"),Od(this.filterInput,550,210,600,64),this.filterInput.value&&(MainCanvas.textAlign="center",DrawButton(870,182,64,64,"X","White")),MainCanvas.textAlign="left";for(let e=0;e<6;e++){const t=6*this.page+e;if(t>=this.permList.length)break;const n=this.permList[t];if(null===n)continue;const r=275+100*e;n.separator?(DrawRect(125,r,1173,64,"#eeeeee"),DrawText(n.name,140,r+34,"Black")):(CE(fd[n.permissionInfo.category],125,r,{Height:64,Width:64}),DrawRect(200,r,1e3,64,PA(n.permissionInfo,this.myAccessLevel)?"White":"#ddd"),DrawEmptyRect(200,r,1e3,64,"Black"),DrawTextFit(n.permissionInfo.name,210,r+34,990,"Black"),DrawButton(1235,r,64,64,"",n.editSelf?"White":"#ddd",n.permissionInfo.self?"Icons/Checked.png":"",void 0,!n.editSelf),MainCanvas.textAlign="center",DrawButton(1370,r,170,64,WA(n.permissionInfo.min,this.character),n.editMin?"White":"#ddd",void 0,void 0,!n.editMin),MainCanvas.textAlign="left")}const e=Math.max(1,Math.ceil(this.permList.length/6));MainCanvas.textAlign="center",DrawBackNextButton(1605,800,300,90,`${InterfaceTextGet("Page")} ${this.page+1} / ${e}`,"White","",(()=>""),(()=>""))}else this.failed?(MainCanvas.textAlign="center",fA(`get permission data from ${this.character.Name}`)):(MainCanvas.textAlign="center",DrawText("Loading...",1e3,480,"Black"));this.showHelp&&IE(Mp[Dp.AuthorityPermissions]),MainCanvas.textAlign="left",DrawText(`- Authority: Permission Settings for ${this.character.Name} -`,125,125,"Black","Gray"),MainCanvas.textAlign="center",DrawButton(1815,75,90,90,"","White","Icons/Exit.png","BCX main menu"),DrawButton(1815,190,90,90,"","White","Icons/Question.png"),DrawButton(1815,305,90,90,"","White","Icons/West.png","Previous screen")}Click(){if(MouseIn(1815,75,90,90))return this.Exit();if(MouseIn(1815,190,90,90))this.showHelp=!this.showHelp;else{if(MouseIn(1815,305,90,90))return jk(new Ip(this.character));if(null!==this.permissionData){MouseIn(870,182,64,64)&&(this.filterInput.value="",this.rebuildList());for(let e=0;e<6;e++){const t=6*this.page+e;if(t>=this.permList.length)break;const n=this.permList[t];if(null===n)continue;const r=275+100*e;if(!n.separator){if(MouseIn(200,r,1e3,64),MouseIn(1235,r,64,64)&&n.editSelf)return void(!n.permissionInfo.self||!this.character.isPlayer()||"authority_grant_self"!==n.permission&&TA("authority_grant_self",VA())?this.character.setPermission(n.permission,"self",!n.permissionInfo.self):jk(new Sp(this.character,n.permission,n.permissionInfo,this)));if(MouseIn(1370,r,170,64)&&n.editMin){const e=!!this.permissionData.authority_edit_min&&PA(this.permissionData.authority_edit_min,this.myAccessLevel);return void jk(new Ep(this.character,n.permission,n.permissionInfo,this.myAccessLevel,!e||!PA(n.permissionInfo,this.myAccessLevel),this))}}}const e=Math.ceil(this.permList.length/6);MouseIn(1605,800,150,90)?(this.page--,this.page<0&&(this.page=Math.max(e-1,0))):MouseIn(1755,800,150,90)&&(this.page++,this.page>=e&&(this.page=0))}}}Exit(){jk(new Wk(this.character))}Unload(){this.filterInput.remove()}}class Np extends Ap{constructor(e,t,n,r=[]){super(),this.roleData=null,this.roleList=[],this.failed=!1,this.page=0,this.character=e,this.back=t,this.callback=n,this.ignoredCharacters=r}Load(){this.requestData()}onChange(e){e===this.character.MemberNumber&&this.requestData()}requestData(){Promise.all([this.character.getRolesData()]).then((e=>{this.roleData=e[0],this.failed=!1,this.refreshScreen()}),(e=>{console.error(`HardCoreClub: Failed to get role info for ${this.character}`,e),this.roleData=null,this.failed=!0,this.refreshScreen()}))}refreshScreen(){var e,t,n;if(!this.active)return;this.roleList=[];let r=document.getElementById("BCX_Filter");if(null===this.roleData)return void(r&&r.remove());r||(r=ElementCreateInput("BCX_Filter","text","","30"),r.addEventListener("input",(e=>{this.refreshScreen()})));const o=r.value.trim().toLocaleLowerCase().split(" ");this.roleList=[{type:"Character",memberNumber:this.character.MemberNumber,name:this.character.Name}],this.character.isPlayer()||this.roleList.push({type:"Player",memberNumber:Player.MemberNumber,name:Player.Name}),"number"!=typeof(null===(e=this.character.Character.Ownership)||void 0===e?void 0:e.MemberNumber)||this.roleList.some((e=>{var t;return e.memberNumber===(null===(t=this.character.Character.Ownership)||void 0===t?void 0:t.MemberNumber)}))||this.roleList.push({type:"Clubowner",memberNumber:this.character.Character.Ownership.MemberNumber,name:this.character.Character.Ownership.Name});for(const e of this.roleData.owners)this.roleList.some((t=>t.memberNumber===e[0]))||this.roleList.push({type:"Owner",memberNumber:e[0],name:ME(e[0],e[1]||"[unknown name]")});if(Array.isArray(this.character.Character.Lovership))for(const e of this.character.Character.Lovership)"number"!=typeof e.MemberNumber||this.roleList.some((t=>t.memberNumber===e.MemberNumber))||this.roleList.push({type:"Lover",memberNumber:e.MemberNumber,name:e.Name});for(const e of this.roleData.mistresses)this.roleList.some((t=>t.memberNumber===e[0]))||this.roleList.push({type:"Mistress",memberNumber:e[0],name:ME(e[0],e[1]||"[unknown name]")});if(Player.GetBlindLevel()<3||!(null===(t=Player.GameplaySettings)||void 0===t?void 0:t.BlindDisableExamine)){const e=zA();if(Player.GetBlindLevel()>0&&(null===(n=Player.ImmersionSettings)||void 0===n?void 0:n.BlindAdjacent)){const t=e.findIndex((e=>e.isPlayer()));for(let n=0;n<e.length;n++)1!==Math.abs(n-t)||this.roleList.some((t=>t.memberNumber===e[n].MemberNumber))||this.roleList.push({type:"in same room",memberNumber:e[n].MemberNumber,name:e[n].Name})}else for(const t of e)this.roleList.some((e=>e.memberNumber===t.MemberNumber))||this.roleList.push({type:"in same room",memberNumber:t.MemberNumber,name:t.Name})}if(Player.FriendNames)for(const[e,t]of Player.FriendNames.entries())this.roleList.some((t=>t.memberNumber===e))||this.roleList.push({type:"Friend",memberNumber:e,name:t});this.roleList=this.roleList.filter((e=>!this.ignoredCharacters.includes(e.memberNumber)&&o.every((t=>{var n;return(null===(n=e.name)||void 0===n?void 0:n.toLocaleLowerCase().includes(t))||e.memberNumber.toString().includes(t)}))));const i=Math.ceil(this.roleList.length/8);this.page<0?this.page=Math.max(i-1,0):this.page>=i&&(this.page=0)}Run(){var e;if(null!==this.roleData){DrawText("Filter name:",703,125,"Black"),ElementPosition("BCX_Filter",1203,118,600,64),(null===(e=document.getElementById("BCX_Filter"))||void 0===e?void 0:e.value)&&(MainCanvas.textAlign="center",DrawButton(1510,92,64,64,"X","White"));for(let e=0;e<8;e++){const t=8*this.page+e;if(t>=this.roleList.length)break;const n=this.roleList[t],r=290+75*e;MainCanvas.textAlign="center",DrawText(`${n.name}`,383,r+34,"Black"),DrawText(`${n.memberNumber}`,780,r+34,"Black"),DrawText(`${"Character"===n.type?"":n.type}`,1100,r+34,"Black"),DrawEmptyRect(175,r+69,1105,0,"#ddd"),DrawButton(1340,r,150,64,"Select","White","")}const t=Math.max(1,Math.ceil(this.roleList.length/8));DrawBackNextButton(1605,800,300,90,`${InterfaceTextGet("Page")} ${this.page+1} / ${t}`,"White","",(()=>""),(()=>""))}else this.failed?(MainCanvas.textAlign="center",fA(`get data from ${this.character.Name}`)):(MainCanvas.textAlign="center",DrawText("Loading...",1e3,480,"Black"));MainCanvas.textAlign="left",DrawText("Please select a member.",125,125,"Black","Gray"),MainCanvas.textAlign="center",DrawButton(1815,75,90,90,"","White","Icons/Exit.png","Back"),DrawEmptyRect(125,176,1441,0,"Black"),DrawText("Name",383,222,"Black"),DrawText("Member number",780,222,"Black"),DrawText("Note",1100,222,"Black"),DrawEmptyRect(125,265,1441,0,"Black")}Click(){if(MouseIn(1815,75,90,90))return this.Exit();if(null!==this.roleData){const e=document.getElementById("BCX_Filter");MouseIn(1510,92,64,64)&&e&&(e.value="",this.refreshScreen());for(let e=0;e<8;e++){const t=8*this.page+e;if(t>=this.roleList.length)break;const n=this.roleList[t];if(MouseIn(1340,290+75*e,150,64))return this.callback(n.memberNumber),void this.Exit()}const t=Math.ceil(this.roleList.length/8);MouseIn(1605,800,150,90)?(this.page--,this.page<0&&(this.page=Math.max(t-1,0))):MouseIn(1755,800,150,90)&&(this.page++,this.page>=t&&(this.page=0))}}Exit(){jk(this.back)}Unload(){ElementRemove("BCX_Filter")}}class Ip extends Ap{constructor(e){super(),this.roleData=null,this.roleList=[],this.failed=!1,this.page=0,this.hoveringTextList=[],this.roleAddInputAutofill=null,this.showHelp=!1,this.character=e,this.hoveringTextList=e.isPlayer()?["You - either top or bottom of the hierarchy","Your owner, visible on your character profile",'Any character, added to the list on the left as "Owner"',"Any of your lovers, visible on your character profile",'Any character, added to the list on the left as "Mistress"',"Anyone you have white-listed","Anyone you have friend-listed","Anyone, who can use items on you"]:["This player - either top or bottom of the hierarchy","This player's owner, visible on their character profile",'Any character, added to the list on the left as "Owner"',"Any lover of this player, visible on their profile",'Any character, added to the list on the left as "Mistress"',"Anyone this player has white-listed","Anyone this player has friend-listed","Anyone, who can use items on this player"]}Load(){this.requestData()}onChange(e){e===this.character.MemberNumber&&this.requestData()}requestData(){Promise.all([this.character.getRolesData()]).then((e=>{this.roleData=e[0],this.failed=!1,this.rebuildList()}),(e=>{console.error(`HardCoreClub: Failed to get role info for ${this.character}`,e),this.roleData=null,this.failed=!0,this.rebuildList()}))}rebuildList(){if(!this.active)return;this.roleList=[];let e=document.getElementById("BCX_RoleAdd");if(!this.roleData)return void(e&&e.remove());const t=this.roleData.allowAddMistress||this.roleData.allowAddOwner;!t&&e?e.remove():t&&!e&&(e=ElementCreateInput("BCX_RoleAdd","text","","6"),null!==this.roleAddInputAutofill&&(e.value=`${this.roleAddInputAutofill}`,this.roleAddInputAutofill=null)),this.roleList=this.roleData.owners.map((e=>({type:"Owner",memberNumber:e[0],name:ME(e[0],e[1]||null)}))),this.roleList.push(...this.roleData.mistresses.map((e=>({type:"Mistress",memberNumber:e[0],name:ME(e[0],e[1]||null)}))));const n=Math.ceil(this.roleList.length/6);this.page<0?this.page=Math.max(n-1,0):this.page>=n&&(this.page=0)}Run(){if(DrawText("Hierarchy of roles:",1336,95,"Black"),MainCanvas.beginPath(),MainCanvas.moveTo(1450,134),MainCanvas.lineTo(1600,134),MainCanvas.lineTo(1530,740),MainCanvas.lineTo(1520,740),MainCanvas.lineTo(1450,134),MainCanvas.fillStyle="Black",MainCanvas.fill(),this.roleData){for(let e=0;e<6;e++){const t=6*this.page+e;if(t>=this.roleList.length)break;const n=this.roleList[t],r=210+95*e;DrawEmptyRect(130,r,900,64,"Black");const o=`${n.type} ${null===n.name?"[unknown name]":n.name} (${n.memberNumber})`;DrawTextFit(o,140,r+34,590,"Black"),(("Owner"===n.type?this.roleData.allowRemoveOwner:this.roleData.allowRemoveMistress)||n.memberNumber===Player.MemberNumber)&&(MainCanvas.textAlign="center",DrawButton(1090,r,64,64,"X","White"),MainCanvas.textAlign="left")}document.getElementById("BCX_RoleAdd")&&(DrawText("Member Number:",130,847,"Black"),ElementPosition("BCX_RoleAdd",580,842,300,64)),MainCanvas.textAlign="center",this.roleData.allowAddOwner&&DrawButton(833,815,210,64,"Add as owner","white"),this.roleData.allowAddMistress&&DrawButton(1074,815,210,64,"Add as mistress","white"),(this.roleData.allowAddMistress||this.roleData.allowAddOwner)&&(DrawButton(740,815,64,64,"","White",void 0,"Select member number from list"),CE("Icons/Title.png",742,815,{Width:60,Height:60}));const e=Math.ceil(this.roleList.length/6);DrawBackNextButton(1430,800,300,90,`Page ${this.page+1} / ${e}`,"White","",(()=>""),(()=>""))}else this.failed?(MainCanvas.textAlign="center",fA(`get role data from ${this.character.Name}`,800)):(MainCanvas.textAlign="center",DrawText("Loading...",800,480,"Black"));MainCanvas.textAlign="center",DrawButton(1420,130,208,54,this.character.Name,"White",void 0,this.hoveringTextList[0]);for(let e=1;e<8;e++)DrawButton(1430,130+80*e,188,54,Nd(xA[e]),"White",void 0,this.hoveringTextList[e]);this.showHelp&&IE(Mp[Dp.AuthorityRoles]),MainCanvas.textAlign="left",DrawText(`- Authority: Role Management for ${this.character.Name} -`,125,125,"Black","Gray"),MainCanvas.textAlign="center",DrawButton(1815,75,90,90,"","White","Icons/Exit.png","BCX main menu"),DrawButton(1815,190,90,90,"","White","Icons/Question.png"),DrawButton(1815,305,90,90,"","White","Icons/Preference.png","Configure the role-based BCX permissions")}Click(){var e;if(MouseIn(1815,75,90,90))return this.Exit();if(MouseIn(1815,190,90,90))this.showHelp=!this.showHelp;else{if(MouseIn(1815,305,90,90))return this.Back();if(this.roleData){for(let e=0;e<6;e++){const t=6*this.page+e;if(t>=this.roleList.length)break;const n=this.roleList[t],r=210+95*e;if((("Owner"===n.type?this.roleData.allowRemoveOwner:this.roleData.allowRemoveMistress)||n.memberNumber===Player.MemberNumber)&&MouseIn(1090,r,64,64))return void this.character.editRole("Owner"===n.type?"owner":"mistress","remove",n.memberNumber)}const t=document.getElementById("BCX_RoleAdd"),n=null!==(e=null==t?void 0:t.value)&&void 0!==e?e:"",r=/^[0-9]+$/.test(n)?Number.parseInt(n,10):null;if(this.roleData.allowAddOwner&&t&&null!==r&&MouseIn(833,815,210,64))return t.value="",void this.character.editRole("owner","add",r);if(this.roleData.allowAddMistress&&t&&null!==r&&MouseIn(1074,815,210,64))return t.value="",void this.character.editRole("mistress","add",r);const o=Math.ceil(this.roleList.length/6);if(MouseIn(1430,800,150,90)?(this.page--,this.page<0&&(this.page=Math.max(o-1,0))):MouseIn(1580,800,150,90)&&(this.page++,this.page>=o&&(this.page=0)),MouseIn(740,815,64,64))return void jk(new Np(this.character,this,(e=>{this.roleAddInputAutofill=e})))}}}Exit(){jk(new Wk(this.character))}Back(){jk(new xp(this.character))}Unload(){ElementRemove("BCX_RoleAdd")}}function Rp(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new Wh;++t<n;)this.add(e[t])}Rp.prototype.add=Rp.prototype.push=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},Rp.prototype.has=function(e){return this.__data__.has(e)};const Lp=Rp,Tp=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1},Pp=function(e,t){return e.has(t)},Bp=function(e,t,n,r,o,i){var a=1&n,s=e.length,l=t.length;if(s!=l&&!(a&&l>s))return!1;var c=i.get(e),u=i.get(t);if(c&&u)return c==t&&u==e;var d=-1,h=!0,m=2&n?new Lp:void 0;for(i.set(e,t),i.set(t,e);++d<s;){var p=e[d],f=t[d];if(r)var g=a?r(f,p,d,t,e,i):r(p,f,d,e,t,i);if(void 0!==g){if(g)continue;h=!1;break}if(m){if(!Tp(t,(function(e,t){if(!Pp(m,t)&&(p===e||o(p,e,n,r,i)))return m.push(t)}))){h=!1;break}}else if(p!==f&&!o(p,f,n,r,i)){h=!1;break}}return i.delete(e),i.delete(t),h},Op=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e,r){n[++t]=[r,e]})),n},$p=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n};var Fp=uh?uh.prototype:void 0,Hp=Fp?Fp.valueOf:void 0;var Wp=Object.prototype.hasOwnProperty;var Gp="[object Arguments]",jp="[object Array]",Up="[object Object]",Yp=Object.prototype.hasOwnProperty;const qp=function(e,t,n,r,o,i){var a=tm(e),s=tm(t),l=a?jp:op(e),c=s?jp:op(t),u=(l=l==Gp?Up:l)==Up,d=(c=c==Gp?Up:c)==Up,h=l==c;if(h&&im(e)){if(!im(t))return!1;a=!0,u=!1}if(h&&!u)return i||(i=new jh),a||gm(e)?Bp(e,t,n,r,o,i):function(e,t,n,r,o,i,a){switch(n){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!i(new ap(e),new ap(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return nh(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var s=Op;case"[object Set]":var l=1&r;if(s||(s=$p),e.size!=t.size&&!l)return!1;var c=a.get(e);if(c)return c==t;r|=2,a.set(e,t);var u=Bp(s(e),s(t),r,o,i,a);return a.delete(e),u;case"[object Symbol]":if(Hp)return Hp.call(e)==Hp.call(t)}return!1}(e,t,l,n,r,o,i);if(!(1&n)){var m=u&&Yp.call(e,"__wrapped__"),p=d&&Yp.call(t,"__wrapped__");if(m||p){var f=m?e.value():e,g=p?t.value():t;return i||(i=new jh),o(f,g,n,r,i)}}return!!h&&(i||(i=new jh),function(e,t,n,r,o,i){var a=1&n,s=Wm(e),l=s.length;if(l!=Wm(t).length&&!a)return!1;for(var c=l;c--;){var u=s[c];if(!(a?u in t:Wp.call(t,u)))return!1}var d=i.get(e),h=i.get(t);if(d&&h)return d==t&&h==e;var m=!0;i.set(e,t),i.set(t,e);for(var p=a;++c<l;){var f=e[u=s[c]],g=t[u];if(r)var y=a?r(g,f,u,t,e,i):r(f,g,u,e,t,i);if(!(void 0===y?f===g||o(f,g,n,r,i):y)){m=!1;break}p||(p="constructor"==u)}if(m&&!p){var v=e.constructor,b=t.constructor;v==b||!("constructor"in e)||!("constructor"in t)||"function"==typeof v&&v instanceof v&&"function"==typeof b&&b instanceof b||(m=!1)}return i.delete(e),i.delete(t),m}(e,t,n,r,o,i))},Xp=function e(t,n,r,o,i){return t===n||(null==t||null==n||!Vh(t)&&!Vh(n)?t!=t&&n!=n:qp(t,n,r,o,e,i))},zp=function(e,t){return Xp(e,t)},Vp=function(e){return"symbol"==typeof e||Vh(e)&&"[object Symbol]"==yh(e)};var Zp=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Kp=/^\w*$/;const Jp=function(e,t){if(tm(e))return!1;var n=typeof e;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!Vp(e))||Kp.test(e)||!Zp.test(e)||null!=t&&e in Object(t)};function Qp(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var n=function(){var r=arguments,o=t?t.apply(this,r):r[0],i=n.cache;if(i.has(o))return i.get(o);var a=e.apply(this,r);return n.cache=i.set(o,a)||i,a};return n.cache=new(Qp.Cache||Wh),n}Qp.Cache=Wh;var ef=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,tf=/\\(\\)?/g;const nf=(rf=Qp((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(ef,(function(e,n,r,o){t.push(r?o.replace(tf,"$1"):n||e)})),t}),(function(e){return 500===of.size&&of.clear(),e})),of=rf.cache,rf);var rf,of;const af=function(e,t){for(var n=-1,r=null==e?0:e.length,o=Array(r);++n<r;)o[n]=t(e[n],n,e);return o};var sf=uh?uh.prototype:void 0,lf=sf?sf.toString:void 0;const cf=function e(t){if("string"==typeof t)return t;if(tm(t))return af(t,e)+"";if(Vp(t))return lf?lf.call(t):"";var n=t+"";return"0"==n&&1/t==-1/0?"-0":n},uf=function(e){return null==e?"":cf(e)},df=function(e,t){return tm(e)?e:Jp(e,t)?[e]:nf(uf(e))},hf=function(e){if("string"==typeof e||Vp(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t},mf=function(e,t){for(var n=0,r=(t=df(t,e)).length;null!=e&&n<r;)e=e[hf(t[n++])];return n&&n==r?e:void 0},pf=function(e,t,n,r){if(!vh(e))return e;for(var o=-1,i=(t=df(t,e)).length,a=i-1,s=e;null!=s&&++o<i;){var l=hf(t[o]),c=n;if("__proto__"===l||"constructor"===l||"prototype"===l)return e;if(o!=a){var u=s[l];void 0===(c=r?r(u,l,s):void 0)&&(c=vh(u)?u:sm(t[o+1])?[]:{})}Xh(s,l,c),s=s[l]}return e},ff=function(e,t){return null!=e&&t in Object(e)},gf=function(e,t){return null!=e&&function(e,t,n){for(var r=-1,o=(t=df(t,e)).length,i=!1;++r<o;){var a=hf(t[r]);if(!(i=null!=e&&n(e,a)))break;e=e[a]}return i||++r!=o?i:!!(o=null==e?0:e.length)&&lm(o)&&sm(a,o)&&(tm(e)||em(e))}(e,t,ff)},yf=function(e,t){return function(e,t,n){for(var r=-1,o=t.length,i={};++r<o;){var a=t[r],s=mf(e,a);n(s,a)&&pf(i,df(a,e),s)}return i}(e,t,(function(t,n){return gf(e,n)}))};var vf=uh?uh.isConcatSpreadable:void 0;const bf=function(e){return tm(e)||em(e)||!!(vf&&e&&e[vf])},wf=function e(t,n,r,o,i){var a=-1,s=t.length;for(r||(r=bf),i||(i=[]);++a<s;){var l=t[a];n>0&&r(l)?n>1?e(l,n-1,r,o,i):Om(i,l):o||(i[i.length]=l)}return i},Cf=function(e){return null!=e&&e.length?wf(e,1):[]};var _f=Math.max;const kf=function(e){return e},Af=Uh?function(e,t){return Uh(e,"toString",{configurable:!0,enumerable:!1,value:(n=t,function(){return n}),writable:!0});var n}:kf;var Ef=Date.now;const Sf=(Df=Af,Mf=0,xf=0,function(){var e=Ef(),t=16-(e-xf);if(xf=e,t>0){if(++Mf>=800)return arguments[0]}else Mf=0;return Df.apply(void 0,arguments)});var Df,Mf,xf;const Nf=function(e){return Sf(function(e,t,n){return t=_f(void 0===t?e.length-1:t,0),function(){for(var r=arguments,o=-1,i=_f(r.length-t,0),a=Array(i);++o<i;)a[o]=r[t+o];o=-1;for(var s=Array(t+1);++o<t;)s[o]=r[o];return s[t]=n(a),function(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}(e,this,s)}}(e,void 0,Cf),e+"")},If=Nf((function(e,t){return null==e?{}:yf(e,t)}));var Rf,Lf;!function(e){e.assertEqual=e=>e,e.assertIs=function(e){},e.assertNever=function(e){throw new Error},e.arrayToEnum=e=>{const t={};for(const n of e)t[n]=n;return t},e.getValidEnumValues=t=>{const n=e.objectKeys(t).filter((e=>"number"!=typeof t[t[e]])),r={};for(const e of n)r[e]=t[e];return e.objectValues(r)},e.objectValues=t=>e.objectKeys(t).map((function(e){return t[e]})),e.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{const t=[];for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t},e.find=(e,t)=>{for(const n of e)if(t(n))return n},e.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&isFinite(e)&&Math.floor(e)===e,e.joinValues=function(e,t=" | "){return e.map((e=>"string"==typeof e?`'${e}'`:e)).join(t)},e.jsonStringifyReplacer=(e,t)=>"bigint"==typeof t?t.toString():t}(Rf||(Rf={})),function(e){e.mergeShapes=(e,t)=>({...e,...t})}(Lf||(Lf={}));const Tf=Rf.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Pf=e=>{switch(typeof e){case"undefined":return Tf.undefined;case"string":return Tf.string;case"number":return isNaN(e)?Tf.nan:Tf.number;case"boolean":return Tf.boolean;case"function":return Tf.function;case"bigint":return Tf.bigint;case"symbol":return Tf.symbol;case"object":return Array.isArray(e)?Tf.array:null===e?Tf.null:e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch?Tf.promise:"undefined"!=typeof Map&&e instanceof Map?Tf.map:"undefined"!=typeof Set&&e instanceof Set?Tf.set:"undefined"!=typeof Date&&e instanceof Date?Tf.date:Tf.object;default:return Tf.unknown}},Bf=Rf.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class Of extends Error{constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}get errors(){return this.issues}format(e){const t=e||function(e){return e.message},n={_errors:[]},r=e=>{for(const o of e.issues)if("invalid_union"===o.code)o.unionErrors.map(r);else if("invalid_return_type"===o.code)r(o.returnTypeError);else if("invalid_arguments"===o.code)r(o.argumentsError);else if(0===o.path.length)n._errors.push(t(o));else{let e=n,r=0;for(;r<o.path.length;){const n=o.path[r];r===o.path.length-1?(e[n]=e[n]||{_errors:[]},e[n]._errors.push(t(o))):e[n]=e[n]||{_errors:[]},e=e[n],r++}}};return r(this),n}toString(){return this.message}get message(){return JSON.stringify(this.issues,Rf.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=(e=>e.message)){const t={},n=[];for(const r of this.issues)r.path.length>0?(t[r.path[0]]=t[r.path[0]]||[],t[r.path[0]].push(e(r))):n.push(e(r));return{formErrors:n,fieldErrors:t}}get formErrors(){return this.flatten()}}Of.create=e=>new Of(e);const $f=(e,t)=>{let n;switch(e.code){case Bf.invalid_type:n=e.received===Tf.undefined?"Required":`Expected ${e.expected}, received ${e.received}`;break;case Bf.invalid_literal:n=`Invalid literal value, expected ${JSON.stringify(e.expected,Rf.jsonStringifyReplacer)}`;break;case Bf.unrecognized_keys:n=`Unrecognized key(s) in object: ${Rf.joinValues(e.keys,", ")}`;break;case Bf.invalid_union:n="Invalid input";break;case Bf.invalid_union_discriminator:n=`Invalid discriminator value. Expected ${Rf.joinValues(e.options)}`;break;case Bf.invalid_enum_value:n=`Invalid enum value. Expected ${Rf.joinValues(e.options)}, received '${e.received}'`;break;case Bf.invalid_arguments:n="Invalid function arguments";break;case Bf.invalid_return_type:n="Invalid function return type";break;case Bf.invalid_date:n="Invalid date";break;case Bf.invalid_string:"object"==typeof e.validation?"includes"in e.validation?(n=`Invalid input: must include "${e.validation.includes}"`,"number"==typeof e.validation.position&&(n=`${n} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?n=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?n=`Invalid input: must end with "${e.validation.endsWith}"`:Rf.assertNever(e.validation):n="regex"!==e.validation?`Invalid ${e.validation}`:"Invalid";break;case Bf.too_small:n="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"date"===e.type?`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:"Invalid input";break;case Bf.too_big:n="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"bigint"===e.type?`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:"Invalid input";break;case Bf.custom:n="Invalid input";break;case Bf.invalid_intersection_types:n="Intersection results could not be merged";break;case Bf.not_multiple_of:n=`Number must be a multiple of ${e.multipleOf}`;break;case Bf.not_finite:n="Number must be finite";break;default:n=t.defaultError,Rf.assertNever(e)}return{message:n}};let Ff=$f;function Hf(){return Ff}const Wf=e=>{const{data:t,path:n,errorMaps:r,issueData:o}=e,i=[...n,...o.path||[]],a={...o,path:i};let s="";const l=r.filter((e=>!!e)).slice().reverse();for(const e of l)s=e(a,{data:t,defaultError:s}).message;return{...o,path:i,message:o.message||s}};function Gf(e,t){const n=Wf({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,Hf(),$f].filter((e=>!!e))});e.common.issues.push(n)}class jf{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,t){const n=[];for(const r of t){if("aborted"===r.status)return Uf;"dirty"===r.status&&e.dirty(),n.push(r.value)}return{status:e.value,value:n}}static async mergeObjectAsync(e,t){const n=[];for(const e of t)n.push({key:await e.key,value:await e.value});return jf.mergeObjectSync(e,n)}static mergeObjectSync(e,t){const n={};for(const r of t){const{key:t,value:o}=r;if("aborted"===t.status)return Uf;if("aborted"===o.status)return Uf;"dirty"===t.status&&e.dirty(),"dirty"===o.status&&e.dirty(),"__proto__"===t.value||void 0===o.value&&!r.alwaysSet||(n[t.value]=o.value)}return{status:e.value,value:n}}}const Uf=Object.freeze({status:"aborted"}),Yf=e=>({status:"dirty",value:e}),qf=e=>({status:"valid",value:e}),Xf=e=>"aborted"===e.status,zf=e=>"dirty"===e.status,Vf=e=>"valid"===e.status,Zf=e=>"undefined"!=typeof Promise&&e instanceof Promise;var Kf;!function(e){e.errToObj=e=>"string"==typeof e?{message:e}:e||{},e.toString=e=>"string"==typeof e?e:null==e?void 0:e.message}(Kf||(Kf={}));class Jf{constructor(e,t,n,r){this._cachedPath=[],this.parent=e,this.data=t,this._path=n,this._key=r}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const Qf=(e,t)=>{if(Vf(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new Of(e.common.issues);return this._error=t,this._error}}};function eg(e){if(!e)return{};const{errorMap:t,invalid_type_error:n,required_error:r,description:o}=e;if(t&&(n||r))throw new Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');return t?{errorMap:t,description:o}:{errorMap:(e,t)=>"invalid_type"!==e.code?{message:t.defaultError}:void 0===t.data?{message:null!=r?r:t.defaultError}:{message:null!=n?n:t.defaultError},description:o}}class tg{constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(e){return Pf(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:Pf(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new jf,ctx:{common:e.parent.common,data:e.data,parsedType:Pf(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(Zf(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const n=this.safeParse(e,t);if(n.success)return n.data;throw n.error}safeParse(e,t){var n;const r={common:{issues:[],async:null!==(n=null==t?void 0:t.async)&&void 0!==n&&n,contextualErrorMap:null==t?void 0:t.errorMap},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Pf(e)},o=this._parseSync({data:e,path:r.path,parent:r});return Qf(r,o)}async parseAsync(e,t){const n=await this.safeParseAsync(e,t);if(n.success)return n.data;throw n.error}async safeParseAsync(e,t){const n={common:{issues:[],contextualErrorMap:null==t?void 0:t.errorMap,async:!0},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:Pf(e)},r=this._parse({data:e,path:n.path,parent:n}),o=await(Zf(r)?r:Promise.resolve(r));return Qf(n,o)}refine(e,t){const n=e=>"string"==typeof t||void 0===t?{message:t}:"function"==typeof t?t(e):t;return this._refinement(((t,r)=>{const o=e(t),i=()=>r.addIssue({code:Bf.custom,...n(t)});return"undefined"!=typeof Promise&&o instanceof Promise?o.then((e=>!!e||(i(),!1))):!!o||(i(),!1)}))}refinement(e,t){return this._refinement(((n,r)=>!!e(n)||(r.addIssue("function"==typeof t?t(n,r):t),!1)))}_refinement(e){return new Gg({schema:this,typeName:ey.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}optional(){return jg.create(this,this._def)}nullable(){return Ug.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return kg.create(this,this._def)}promise(){return Wg.create(this,this._def)}or(e){return Sg.create([this,e],this._def)}and(e){return Ng.create(this,e,this._def)}transform(e){return new Gg({...eg(this._def),schema:this,typeName:ey.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t="function"==typeof e?e:()=>e;return new Yg({...eg(this._def),innerType:this,defaultValue:t,typeName:ey.ZodDefault})}brand(){return new Vg({typeName:ey.ZodBranded,type:this,...eg(this._def)})}catch(e){const t="function"==typeof e?e:()=>e;return new qg({...eg(this._def),innerType:this,catchValue:t,typeName:ey.ZodCatch})}describe(e){return new(0,this.constructor)({...this._def,description:e})}pipe(e){return Zg.create(this,e)}readonly(){return Kg.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const ng=/^c[^\s-]{8,}$/i,rg=/^[a-z][a-z0-9]*$/,og=/^[0-9A-HJKMNP-TV-Z]{26}$/,ig=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,ag=/^(?!\.)(?!.*\.\.)([A-Z0-9_+-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i;let sg;const lg=/^(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))$/,cg=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/;class ug extends tg{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==Tf.string){const t=this._getOrReturnCtx(e);return Gf(t,{code:Bf.invalid_type,expected:Tf.string,received:t.parsedType}),Uf}const t=new jf;let n;for(const a of this._def.checks)if("min"===a.kind)e.data.length<a.value&&(n=this._getOrReturnCtx(e,n),Gf(n,{code:Bf.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),t.dirty());else if("max"===a.kind)e.data.length>a.value&&(n=this._getOrReturnCtx(e,n),Gf(n,{code:Bf.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),t.dirty());else if("length"===a.kind){const r=e.data.length>a.value,o=e.data.length<a.value;(r||o)&&(n=this._getOrReturnCtx(e,n),r?Gf(n,{code:Bf.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}):o&&Gf(n,{code:Bf.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}),t.dirty())}else if("email"===a.kind)ag.test(e.data)||(n=this._getOrReturnCtx(e,n),Gf(n,{validation:"email",code:Bf.invalid_string,message:a.message}),t.dirty());else if("emoji"===a.kind)sg||(sg=new RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),sg.test(e.data)||(n=this._getOrReturnCtx(e,n),Gf(n,{validation:"emoji",code:Bf.invalid_string,message:a.message}),t.dirty());else if("uuid"===a.kind)ig.test(e.data)||(n=this._getOrReturnCtx(e,n),Gf(n,{validation:"uuid",code:Bf.invalid_string,message:a.message}),t.dirty());else if("cuid"===a.kind)ng.test(e.data)||(n=this._getOrReturnCtx(e,n),Gf(n,{validation:"cuid",code:Bf.invalid_string,message:a.message}),t.dirty());else if("cuid2"===a.kind)rg.test(e.data)||(n=this._getOrReturnCtx(e,n),Gf(n,{validation:"cuid2",code:Bf.invalid_string,message:a.message}),t.dirty());else if("ulid"===a.kind)og.test(e.data)||(n=this._getOrReturnCtx(e,n),Gf(n,{validation:"ulid",code:Bf.invalid_string,message:a.message}),t.dirty());else if("url"===a.kind)try{new URL(e.data)}catch(r){n=this._getOrReturnCtx(e,n),Gf(n,{validation:"url",code:Bf.invalid_string,message:a.message}),t.dirty()}else"regex"===a.kind?(a.regex.lastIndex=0,a.regex.test(e.data)||(n=this._getOrReturnCtx(e,n),Gf(n,{validation:"regex",code:Bf.invalid_string,message:a.message}),t.dirty())):"trim"===a.kind?e.data=e.data.trim():"includes"===a.kind?e.data.includes(a.value,a.position)||(n=this._getOrReturnCtx(e,n),Gf(n,{code:Bf.invalid_string,validation:{includes:a.value,position:a.position},message:a.message}),t.dirty()):"toLowerCase"===a.kind?e.data=e.data.toLowerCase():"toUpperCase"===a.kind?e.data=e.data.toUpperCase():"startsWith"===a.kind?e.data.startsWith(a.value)||(n=this._getOrReturnCtx(e,n),Gf(n,{code:Bf.invalid_string,validation:{startsWith:a.value},message:a.message}),t.dirty()):"endsWith"===a.kind?e.data.endsWith(a.value)||(n=this._getOrReturnCtx(e,n),Gf(n,{code:Bf.invalid_string,validation:{endsWith:a.value},message:a.message}),t.dirty()):"datetime"===a.kind?((i=a).precision?i.offset?new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${i.precision}}(([+-]\\d{2}(:?\\d{2})?)|Z)$`):new RegExp(`^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}\\.\\d{${i.precision}}Z$`):0===i.precision?i.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}Z$"):i.offset?new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?(([+-]\\d{2}(:?\\d{2})?)|Z)$"):new RegExp("^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d+)?Z$")).test(e.data)||(n=this._getOrReturnCtx(e,n),Gf(n,{code:Bf.invalid_string,validation:"datetime",message:a.message}),t.dirty()):"ip"===a.kind?(r=e.data,("v4"!==(o=a.version)&&o||!lg.test(r))&&("v6"!==o&&o||!cg.test(r))&&(n=this._getOrReturnCtx(e,n),Gf(n,{validation:"ip",code:Bf.invalid_string,message:a.message}),t.dirty())):Rf.assertNever(a);var r,o,i;return{status:t.value,value:e.data}}_regex(e,t,n){return this.refinement((t=>e.test(t)),{validation:t,code:Bf.invalid_string,...Kf.errToObj(n)})}_addCheck(e){return new ug({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...Kf.errToObj(e)})}url(e){return this._addCheck({kind:"url",...Kf.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...Kf.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...Kf.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...Kf.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...Kf.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...Kf.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...Kf.errToObj(e)})}datetime(e){var t;return"string"==typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,message:e}):this._addCheck({kind:"datetime",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision,offset:null!==(t=null==e?void 0:e.offset)&&void 0!==t&&t,...Kf.errToObj(null==e?void 0:e.message)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...Kf.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:null==t?void 0:t.position,...Kf.errToObj(null==t?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...Kf.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...Kf.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...Kf.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...Kf.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...Kf.errToObj(t)})}nonempty(e){return this.min(1,Kf.errToObj(e))}trim(){return new ug({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new ug({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new ug({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find((e=>"datetime"===e.kind))}get isEmail(){return!!this._def.checks.find((e=>"email"===e.kind))}get isURL(){return!!this._def.checks.find((e=>"url"===e.kind))}get isEmoji(){return!!this._def.checks.find((e=>"emoji"===e.kind))}get isUUID(){return!!this._def.checks.find((e=>"uuid"===e.kind))}get isCUID(){return!!this._def.checks.find((e=>"cuid"===e.kind))}get isCUID2(){return!!this._def.checks.find((e=>"cuid2"===e.kind))}get isULID(){return!!this._def.checks.find((e=>"ulid"===e.kind))}get isIP(){return!!this._def.checks.find((e=>"ip"===e.kind))}get minLength(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}function dg(e,t){const n=(e.toString().split(".")[1]||"").length,r=(t.toString().split(".")[1]||"").length,o=n>r?n:r;return parseInt(e.toFixed(o).replace(".",""))%parseInt(t.toFixed(o).replace(".",""))/Math.pow(10,o)}ug.create=e=>{var t;return new ug({checks:[],typeName:ey.ZodString,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t,...eg(e)})};class hg extends tg{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==Tf.number){const t=this._getOrReturnCtx(e);return Gf(t,{code:Bf.invalid_type,expected:Tf.number,received:t.parsedType}),Uf}let t;const n=new jf;for(const r of this._def.checks)"int"===r.kind?Rf.isInteger(e.data)||(t=this._getOrReturnCtx(e,t),Gf(t,{code:Bf.invalid_type,expected:"integer",received:"float",message:r.message}),n.dirty()):"min"===r.kind?(r.inclusive?e.data<r.value:e.data<=r.value)&&(t=this._getOrReturnCtx(e,t),Gf(t,{code:Bf.too_small,minimum:r.value,type:"number",inclusive:r.inclusive,exact:!1,message:r.message}),n.dirty()):"max"===r.kind?(r.inclusive?e.data>r.value:e.data>=r.value)&&(t=this._getOrReturnCtx(e,t),Gf(t,{code:Bf.too_big,maximum:r.value,type:"number",inclusive:r.inclusive,exact:!1,message:r.message}),n.dirty()):"multipleOf"===r.kind?0!==dg(e.data,r.value)&&(t=this._getOrReturnCtx(e,t),Gf(t,{code:Bf.not_multiple_of,multipleOf:r.value,message:r.message}),n.dirty()):"finite"===r.kind?Number.isFinite(e.data)||(t=this._getOrReturnCtx(e,t),Gf(t,{code:Bf.not_finite,message:r.message}),n.dirty()):Rf.assertNever(r);return{status:n.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,Kf.toString(t))}gt(e,t){return this.setLimit("min",e,!1,Kf.toString(t))}lte(e,t){return this.setLimit("max",e,!0,Kf.toString(t))}lt(e,t){return this.setLimit("max",e,!1,Kf.toString(t))}setLimit(e,t,n,r){return new hg({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:Kf.toString(r)}]})}_addCheck(e){return new hg({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:Kf.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:Kf.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:Kf.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:Kf.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:Kf.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:Kf.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:Kf.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:Kf.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:Kf.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find((e=>"int"===e.kind||"multipleOf"===e.kind&&Rf.isInteger(e.value)))}get isFinite(){let e=null,t=null;for(const n of this._def.checks){if("finite"===n.kind||"int"===n.kind||"multipleOf"===n.kind)return!0;"min"===n.kind?(null===t||n.value>t)&&(t=n.value):"max"===n.kind&&(null===e||n.value<e)&&(e=n.value)}return Number.isFinite(t)&&Number.isFinite(e)}}hg.create=e=>new hg({checks:[],typeName:ey.ZodNumber,coerce:(null==e?void 0:e.coerce)||!1,...eg(e)});class mg extends tg{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce&&(e.data=BigInt(e.data)),this._getType(e)!==Tf.bigint){const t=this._getOrReturnCtx(e);return Gf(t,{code:Bf.invalid_type,expected:Tf.bigint,received:t.parsedType}),Uf}let t;const n=new jf;for(const r of this._def.checks)"min"===r.kind?(r.inclusive?e.data<r.value:e.data<=r.value)&&(t=this._getOrReturnCtx(e,t),Gf(t,{code:Bf.too_small,type:"bigint",minimum:r.value,inclusive:r.inclusive,message:r.message}),n.dirty()):"max"===r.kind?(r.inclusive?e.data>r.value:e.data>=r.value)&&(t=this._getOrReturnCtx(e,t),Gf(t,{code:Bf.too_big,type:"bigint",maximum:r.value,inclusive:r.inclusive,message:r.message}),n.dirty()):"multipleOf"===r.kind?e.data%r.value!==BigInt(0)&&(t=this._getOrReturnCtx(e,t),Gf(t,{code:Bf.not_multiple_of,multipleOf:r.value,message:r.message}),n.dirty()):Rf.assertNever(r);return{status:n.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,Kf.toString(t))}gt(e,t){return this.setLimit("min",e,!1,Kf.toString(t))}lte(e,t){return this.setLimit("max",e,!0,Kf.toString(t))}lt(e,t){return this.setLimit("max",e,!1,Kf.toString(t))}setLimit(e,t,n,r){return new mg({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:n,message:Kf.toString(r)}]})}_addCheck(e){return new mg({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:Kf.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:Kf.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:Kf.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:Kf.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:Kf.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}mg.create=e=>{var t;return new mg({checks:[],typeName:ey.ZodBigInt,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t,...eg(e)})};class pg extends tg{_parse(e){if(this._def.coerce&&(e.data=Boolean(e.data)),this._getType(e)!==Tf.boolean){const t=this._getOrReturnCtx(e);return Gf(t,{code:Bf.invalid_type,expected:Tf.boolean,received:t.parsedType}),Uf}return qf(e.data)}}pg.create=e=>new pg({typeName:ey.ZodBoolean,coerce:(null==e?void 0:e.coerce)||!1,...eg(e)});class fg extends tg{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==Tf.date){const t=this._getOrReturnCtx(e);return Gf(t,{code:Bf.invalid_type,expected:Tf.date,received:t.parsedType}),Uf}if(isNaN(e.data.getTime()))return Gf(this._getOrReturnCtx(e),{code:Bf.invalid_date}),Uf;const t=new jf;let n;for(const r of this._def.checks)"min"===r.kind?e.data.getTime()<r.value&&(n=this._getOrReturnCtx(e,n),Gf(n,{code:Bf.too_small,message:r.message,inclusive:!0,exact:!1,minimum:r.value,type:"date"}),t.dirty()):"max"===r.kind?e.data.getTime()>r.value&&(n=this._getOrReturnCtx(e,n),Gf(n,{code:Bf.too_big,message:r.message,inclusive:!0,exact:!1,maximum:r.value,type:"date"}),t.dirty()):Rf.assertNever(r);return{status:t.value,value:new Date(e.data.getTime())}}_addCheck(e){return new fg({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:Kf.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:Kf.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}}fg.create=e=>new fg({checks:[],coerce:(null==e?void 0:e.coerce)||!1,typeName:ey.ZodDate,...eg(e)});class gg extends tg{_parse(e){if(this._getType(e)!==Tf.symbol){const t=this._getOrReturnCtx(e);return Gf(t,{code:Bf.invalid_type,expected:Tf.symbol,received:t.parsedType}),Uf}return qf(e.data)}}gg.create=e=>new gg({typeName:ey.ZodSymbol,...eg(e)});class yg extends tg{_parse(e){if(this._getType(e)!==Tf.undefined){const t=this._getOrReturnCtx(e);return Gf(t,{code:Bf.invalid_type,expected:Tf.undefined,received:t.parsedType}),Uf}return qf(e.data)}}yg.create=e=>new yg({typeName:ey.ZodUndefined,...eg(e)});class vg extends tg{_parse(e){if(this._getType(e)!==Tf.null){const t=this._getOrReturnCtx(e);return Gf(t,{code:Bf.invalid_type,expected:Tf.null,received:t.parsedType}),Uf}return qf(e.data)}}vg.create=e=>new vg({typeName:ey.ZodNull,...eg(e)});class bg extends tg{constructor(){super(...arguments),this._any=!0}_parse(e){return qf(e.data)}}bg.create=e=>new bg({typeName:ey.ZodAny,...eg(e)});class wg extends tg{constructor(){super(...arguments),this._unknown=!0}_parse(e){return qf(e.data)}}wg.create=e=>new wg({typeName:ey.ZodUnknown,...eg(e)});class Cg extends tg{_parse(e){const t=this._getOrReturnCtx(e);return Gf(t,{code:Bf.invalid_type,expected:Tf.never,received:t.parsedType}),Uf}}Cg.create=e=>new Cg({typeName:ey.ZodNever,...eg(e)});class _g extends tg{_parse(e){if(this._getType(e)!==Tf.undefined){const t=this._getOrReturnCtx(e);return Gf(t,{code:Bf.invalid_type,expected:Tf.void,received:t.parsedType}),Uf}return qf(e.data)}}_g.create=e=>new _g({typeName:ey.ZodVoid,...eg(e)});class kg extends tg{_parse(e){const{ctx:t,status:n}=this._processInputParams(e),r=this._def;if(t.parsedType!==Tf.array)return Gf(t,{code:Bf.invalid_type,expected:Tf.array,received:t.parsedType}),Uf;if(null!==r.exactLength){const e=t.data.length>r.exactLength.value,o=t.data.length<r.exactLength.value;(e||o)&&(Gf(t,{code:e?Bf.too_big:Bf.too_small,minimum:o?r.exactLength.value:void 0,maximum:e?r.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:r.exactLength.message}),n.dirty())}if(null!==r.minLength&&t.data.length<r.minLength.value&&(Gf(t,{code:Bf.too_small,minimum:r.minLength.value,type:"array",inclusive:!0,exact:!1,message:r.minLength.message}),n.dirty()),null!==r.maxLength&&t.data.length>r.maxLength.value&&(Gf(t,{code:Bf.too_big,maximum:r.maxLength.value,type:"array",inclusive:!0,exact:!1,message:r.maxLength.message}),n.dirty()),t.common.async)return Promise.all([...t.data].map(((e,n)=>r.type._parseAsync(new Jf(t,e,t.path,n))))).then((e=>jf.mergeArray(n,e)));const o=[...t.data].map(((e,n)=>r.type._parseSync(new Jf(t,e,t.path,n))));return jf.mergeArray(n,o)}get element(){return this._def.type}min(e,t){return new kg({...this._def,minLength:{value:e,message:Kf.toString(t)}})}max(e,t){return new kg({...this._def,maxLength:{value:e,message:Kf.toString(t)}})}length(e,t){return new kg({...this._def,exactLength:{value:e,message:Kf.toString(t)}})}nonempty(e){return this.min(1,e)}}function Ag(e){if(e instanceof Eg){const t={};for(const n in e.shape){const r=e.shape[n];t[n]=jg.create(Ag(r))}return new Eg({...e._def,shape:()=>t})}return e instanceof kg?new kg({...e._def,type:Ag(e.element)}):e instanceof jg?jg.create(Ag(e.unwrap())):e instanceof Ug?Ug.create(Ag(e.unwrap())):e instanceof Ig?Ig.create(e.items.map((e=>Ag(e)))):e}kg.create=(e,t)=>new kg({type:e,minLength:null,maxLength:null,exactLength:null,typeName:ey.ZodArray,...eg(t)});class Eg extends tg{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;const e=this._def.shape(),t=Rf.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){if(this._getType(e)!==Tf.object){const t=this._getOrReturnCtx(e);return Gf(t,{code:Bf.invalid_type,expected:Tf.object,received:t.parsedType}),Uf}const{status:t,ctx:n}=this._processInputParams(e),{shape:r,keys:o}=this._getCached(),i=[];if(!(this._def.catchall instanceof Cg&&"strip"===this._def.unknownKeys))for(const e in n.data)o.includes(e)||i.push(e);const a=[];for(const e of o){const t=r[e],o=n.data[e];a.push({key:{status:"valid",value:e},value:t._parse(new Jf(n,o,n.path,e)),alwaysSet:e in n.data})}if(this._def.catchall instanceof Cg){const e=this._def.unknownKeys;if("passthrough"===e)for(const e of i)a.push({key:{status:"valid",value:e},value:{status:"valid",value:n.data[e]}});else if("strict"===e)i.length>0&&(Gf(n,{code:Bf.unrecognized_keys,keys:i}),t.dirty());else if("strip"!==e)throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const e=this._def.catchall;for(const t of i){const r=n.data[t];a.push({key:{status:"valid",value:t},value:e._parse(new Jf(n,r,n.path,t)),alwaysSet:t in n.data})}}return n.common.async?Promise.resolve().then((async()=>{const e=[];for(const t of a){const n=await t.key;e.push({key:n,value:await t.value,alwaysSet:t.alwaysSet})}return e})).then((e=>jf.mergeObjectSync(t,e))):jf.mergeObjectSync(t,a)}get shape(){return this._def.shape()}strict(e){return Kf.errToObj,new Eg({...this._def,unknownKeys:"strict",...void 0!==e?{errorMap:(t,n)=>{var r,o,i,a;const s=null!==(i=null===(o=(r=this._def).errorMap)||void 0===o?void 0:o.call(r,t,n).message)&&void 0!==i?i:n.defaultError;return"unrecognized_keys"===t.code?{message:null!==(a=Kf.errToObj(e).message)&&void 0!==a?a:s}:{message:s}}}:{}})}strip(){return new Eg({...this._def,unknownKeys:"strip"})}passthrough(){return new Eg({...this._def,unknownKeys:"passthrough"})}extend(e){return new Eg({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new Eg({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:ey.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new Eg({...this._def,catchall:e})}pick(e){const t={};return Rf.objectKeys(e).forEach((n=>{e[n]&&this.shape[n]&&(t[n]=this.shape[n])})),new Eg({...this._def,shape:()=>t})}omit(e){const t={};return Rf.objectKeys(this.shape).forEach((n=>{e[n]||(t[n]=this.shape[n])})),new Eg({...this._def,shape:()=>t})}deepPartial(){return Ag(this)}partial(e){const t={};return Rf.objectKeys(this.shape).forEach((n=>{const r=this.shape[n];e&&!e[n]?t[n]=r:t[n]=r.optional()})),new Eg({...this._def,shape:()=>t})}required(e){const t={};return Rf.objectKeys(this.shape).forEach((n=>{if(e&&!e[n])t[n]=this.shape[n];else{let e=this.shape[n];for(;e instanceof jg;)e=e._def.innerType;t[n]=e}})),new Eg({...this._def,shape:()=>t})}keyof(){return $g(Rf.objectKeys(this.shape))}}Eg.create=(e,t)=>new Eg({shape:()=>e,unknownKeys:"strip",catchall:Cg.create(),typeName:ey.ZodObject,...eg(t)}),Eg.strictCreate=(e,t)=>new Eg({shape:()=>e,unknownKeys:"strict",catchall:Cg.create(),typeName:ey.ZodObject,...eg(t)}),Eg.lazycreate=(e,t)=>new Eg({shape:e,unknownKeys:"strip",catchall:Cg.create(),typeName:ey.ZodObject,...eg(t)});class Sg extends tg{_parse(e){const{ctx:t}=this._processInputParams(e),n=this._def.options;if(t.common.async)return Promise.all(n.map((async e=>{const n={...t,common:{...t.common,issues:[]},parent:null};return{result:await e._parseAsync({data:t.data,path:t.path,parent:n}),ctx:n}}))).then((function(e){for(const t of e)if("valid"===t.result.status)return t.result;for(const n of e)if("dirty"===n.result.status)return t.common.issues.push(...n.ctx.common.issues),n.result;const n=e.map((e=>new Of(e.ctx.common.issues)));return Gf(t,{code:Bf.invalid_union,unionErrors:n}),Uf}));{let e;const r=[];for(const o of n){const n={...t,common:{...t.common,issues:[]},parent:null},i=o._parseSync({data:t.data,path:t.path,parent:n});if("valid"===i.status)return i;"dirty"!==i.status||e||(e={result:i,ctx:n}),n.common.issues.length&&r.push(n.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;const o=r.map((e=>new Of(e)));return Gf(t,{code:Bf.invalid_union,unionErrors:o}),Uf}}get options(){return this._def.options}}Sg.create=(e,t)=>new Sg({options:e,typeName:ey.ZodUnion,...eg(t)});const Dg=e=>e instanceof Bg?Dg(e.schema):e instanceof Gg?Dg(e.innerType()):e instanceof Og?[e.value]:e instanceof Fg?e.options:e instanceof Hg?Object.keys(e.enum):e instanceof Yg?Dg(e._def.innerType):e instanceof yg?[void 0]:e instanceof vg?[null]:null;class Mg extends tg{_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==Tf.object)return Gf(t,{code:Bf.invalid_type,expected:Tf.object,received:t.parsedType}),Uf;const n=this.discriminator,r=t.data[n],o=this.optionsMap.get(r);return o?t.common.async?o._parseAsync({data:t.data,path:t.path,parent:t}):o._parseSync({data:t.data,path:t.path,parent:t}):(Gf(t,{code:Bf.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[n]}),Uf)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,n){const r=new Map;for(const n of t){const t=Dg(n.shape[e]);if(!t)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const o of t){if(r.has(o))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(o)}`);r.set(o,n)}}return new Mg({typeName:ey.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:r,...eg(n)})}}function xg(e,t){const n=Pf(e),r=Pf(t);if(e===t)return{valid:!0,data:e};if(n===Tf.object&&r===Tf.object){const n=Rf.objectKeys(t),r=Rf.objectKeys(e).filter((e=>-1!==n.indexOf(e))),o={...e,...t};for(const n of r){const r=xg(e[n],t[n]);if(!r.valid)return{valid:!1};o[n]=r.data}return{valid:!0,data:o}}if(n===Tf.array&&r===Tf.array){if(e.length!==t.length)return{valid:!1};const n=[];for(let r=0;r<e.length;r++){const o=xg(e[r],t[r]);if(!o.valid)return{valid:!1};n.push(o.data)}return{valid:!0,data:n}}return n===Tf.date&&r===Tf.date&&+e==+t?{valid:!0,data:e}:{valid:!1}}class Ng extends tg{_parse(e){const{status:t,ctx:n}=this._processInputParams(e),r=(e,r)=>{if(Xf(e)||Xf(r))return Uf;const o=xg(e.value,r.value);return o.valid?((zf(e)||zf(r))&&t.dirty(),{status:t.value,value:o.data}):(Gf(n,{code:Bf.invalid_intersection_types}),Uf)};return n.common.async?Promise.all([this._def.left._parseAsync({data:n.data,path:n.path,parent:n}),this._def.right._parseAsync({data:n.data,path:n.path,parent:n})]).then((([e,t])=>r(e,t))):r(this._def.left._parseSync({data:n.data,path:n.path,parent:n}),this._def.right._parseSync({data:n.data,path:n.path,parent:n}))}}Ng.create=(e,t,n)=>new Ng({left:e,right:t,typeName:ey.ZodIntersection,...eg(n)});class Ig extends tg{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==Tf.array)return Gf(n,{code:Bf.invalid_type,expected:Tf.array,received:n.parsedType}),Uf;if(n.data.length<this._def.items.length)return Gf(n,{code:Bf.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),Uf;!this._def.rest&&n.data.length>this._def.items.length&&(Gf(n,{code:Bf.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const r=[...n.data].map(((e,t)=>{const r=this._def.items[t]||this._def.rest;return r?r._parse(new Jf(n,e,n.path,t)):null})).filter((e=>!!e));return n.common.async?Promise.all(r).then((e=>jf.mergeArray(t,e))):jf.mergeArray(t,r)}get items(){return this._def.items}rest(e){return new Ig({...this._def,rest:e})}}Ig.create=(e,t)=>{if(!Array.isArray(e))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new Ig({items:e,typeName:ey.ZodTuple,rest:null,...eg(t)})};class Rg extends tg{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==Tf.object)return Gf(n,{code:Bf.invalid_type,expected:Tf.object,received:n.parsedType}),Uf;const r=[],o=this._def.keyType,i=this._def.valueType;for(const e in n.data)r.push({key:o._parse(new Jf(n,e,n.path,e)),value:i._parse(new Jf(n,n.data[e],n.path,e))});return n.common.async?jf.mergeObjectAsync(t,r):jf.mergeObjectSync(t,r)}get element(){return this._def.valueType}static create(e,t,n){return new Rg(t instanceof tg?{keyType:e,valueType:t,typeName:ey.ZodRecord,...eg(n)}:{keyType:ug.create(),valueType:e,typeName:ey.ZodRecord,...eg(t)})}}class Lg extends tg{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==Tf.map)return Gf(n,{code:Bf.invalid_type,expected:Tf.map,received:n.parsedType}),Uf;const r=this._def.keyType,o=this._def.valueType,i=[...n.data.entries()].map((([e,t],i)=>({key:r._parse(new Jf(n,e,n.path,[i,"key"])),value:o._parse(new Jf(n,t,n.path,[i,"value"]))})));if(n.common.async){const e=new Map;return Promise.resolve().then((async()=>{for(const n of i){const r=await n.key,o=await n.value;if("aborted"===r.status||"aborted"===o.status)return Uf;"dirty"!==r.status&&"dirty"!==o.status||t.dirty(),e.set(r.value,o.value)}return{status:t.value,value:e}}))}{const e=new Map;for(const n of i){const r=n.key,o=n.value;if("aborted"===r.status||"aborted"===o.status)return Uf;"dirty"!==r.status&&"dirty"!==o.status||t.dirty(),e.set(r.value,o.value)}return{status:t.value,value:e}}}}Lg.create=(e,t,n)=>new Lg({valueType:t,keyType:e,typeName:ey.ZodMap,...eg(n)});class Tg extends tg{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.parsedType!==Tf.set)return Gf(n,{code:Bf.invalid_type,expected:Tf.set,received:n.parsedType}),Uf;const r=this._def;null!==r.minSize&&n.data.size<r.minSize.value&&(Gf(n,{code:Bf.too_small,minimum:r.minSize.value,type:"set",inclusive:!0,exact:!1,message:r.minSize.message}),t.dirty()),null!==r.maxSize&&n.data.size>r.maxSize.value&&(Gf(n,{code:Bf.too_big,maximum:r.maxSize.value,type:"set",inclusive:!0,exact:!1,message:r.maxSize.message}),t.dirty());const o=this._def.valueType;function i(e){const n=new Set;for(const r of e){if("aborted"===r.status)return Uf;"dirty"===r.status&&t.dirty(),n.add(r.value)}return{status:t.value,value:n}}const a=[...n.data.values()].map(((e,t)=>o._parse(new Jf(n,e,n.path,t))));return n.common.async?Promise.all(a).then((e=>i(e))):i(a)}min(e,t){return new Tg({...this._def,minSize:{value:e,message:Kf.toString(t)}})}max(e,t){return new Tg({...this._def,maxSize:{value:e,message:Kf.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}Tg.create=(e,t)=>new Tg({valueType:e,minSize:null,maxSize:null,typeName:ey.ZodSet,...eg(t)});class Pg extends tg{constructor(){super(...arguments),this.validate=this.implement}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==Tf.function)return Gf(t,{code:Bf.invalid_type,expected:Tf.function,received:t.parsedType}),Uf;function n(e,n){return Wf({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Hf(),$f].filter((e=>!!e)),issueData:{code:Bf.invalid_arguments,argumentsError:n}})}function r(e,n){return Wf({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,Hf(),$f].filter((e=>!!e)),issueData:{code:Bf.invalid_return_type,returnTypeError:n}})}const o={errorMap:t.common.contextualErrorMap},i=t.data;if(this._def.returns instanceof Wg){const e=this;return qf((async function(...t){const a=new Of([]),s=await e._def.args.parseAsync(t,o).catch((e=>{throw a.addIssue(n(t,e)),a})),l=await Reflect.apply(i,this,s);return await e._def.returns._def.type.parseAsync(l,o).catch((e=>{throw a.addIssue(r(l,e)),a}))}))}{const e=this;return qf((function(...t){const a=e._def.args.safeParse(t,o);if(!a.success)throw new Of([n(t,a.error)]);const s=Reflect.apply(i,this,a.data),l=e._def.returns.safeParse(s,o);if(!l.success)throw new Of([r(s,l.error)]);return l.data}))}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new Pg({...this._def,args:Ig.create(e).rest(wg.create())})}returns(e){return new Pg({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,n){return new Pg({args:e||Ig.create([]).rest(wg.create()),returns:t||wg.create(),typeName:ey.ZodFunction,...eg(n)})}}class Bg extends tg{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}Bg.create=(e,t)=>new Bg({getter:e,typeName:ey.ZodLazy,...eg(t)});class Og extends tg{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return Gf(t,{received:t.data,code:Bf.invalid_literal,expected:this._def.value}),Uf}return{status:"valid",value:e.data}}get value(){return this._def.value}}function $g(e,t){return new Fg({values:e,typeName:ey.ZodEnum,...eg(t)})}Og.create=(e,t)=>new Og({value:e,typeName:ey.ZodLiteral,...eg(t)});class Fg extends tg{_parse(e){if("string"!=typeof e.data){const t=this._getOrReturnCtx(e),n=this._def.values;return Gf(t,{expected:Rf.joinValues(n),received:t.parsedType,code:Bf.invalid_type}),Uf}if(-1===this._def.values.indexOf(e.data)){const t=this._getOrReturnCtx(e),n=this._def.values;return Gf(t,{received:t.data,code:Bf.invalid_enum_value,options:n}),Uf}return qf(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e){return Fg.create(e)}exclude(e){return Fg.create(this.options.filter((t=>!e.includes(t))))}}Fg.create=$g;class Hg extends tg{_parse(e){const t=Rf.getValidEnumValues(this._def.values),n=this._getOrReturnCtx(e);if(n.parsedType!==Tf.string&&n.parsedType!==Tf.number){const e=Rf.objectValues(t);return Gf(n,{expected:Rf.joinValues(e),received:n.parsedType,code:Bf.invalid_type}),Uf}if(-1===t.indexOf(e.data)){const e=Rf.objectValues(t);return Gf(n,{received:n.data,code:Bf.invalid_enum_value,options:e}),Uf}return qf(e.data)}get enum(){return this._def.values}}Hg.create=(e,t)=>new Hg({values:e,typeName:ey.ZodNativeEnum,...eg(t)});class Wg extends tg{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==Tf.promise&&!1===t.common.async)return Gf(t,{code:Bf.invalid_type,expected:Tf.promise,received:t.parsedType}),Uf;const n=t.parsedType===Tf.promise?t.data:Promise.resolve(t.data);return qf(n.then((e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap}))))}}Wg.create=(e,t)=>new Wg({type:e,typeName:ey.ZodPromise,...eg(t)});class Gg extends tg{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===ey.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:n}=this._processInputParams(e),r=this._def.effect||null,o={addIssue:e=>{Gf(n,e),e.fatal?t.abort():t.dirty()},get path(){return n.path}};if(o.addIssue=o.addIssue.bind(o),"preprocess"===r.type){const e=r.transform(n.data,o);return n.common.issues.length?{status:"dirty",value:n.data}:n.common.async?Promise.resolve(e).then((e=>this._def.schema._parseAsync({data:e,path:n.path,parent:n}))):this._def.schema._parseSync({data:e,path:n.path,parent:n})}if("refinement"===r.type){const e=e=>{const t=r.refinement(e,o);if(n.common.async)return Promise.resolve(t);if(t instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1===n.common.async){const r=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});return"aborted"===r.status?Uf:("dirty"===r.status&&t.dirty(),e(r.value),{status:t.value,value:r.value})}return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then((n=>"aborted"===n.status?Uf:("dirty"===n.status&&t.dirty(),e(n.value).then((()=>({status:t.value,value:n.value}))))))}if("transform"===r.type){if(!1===n.common.async){const e=this._def.schema._parseSync({data:n.data,path:n.path,parent:n});if(!Vf(e))return e;const i=r.transform(e.value,o);if(i instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:i}}return this._def.schema._parseAsync({data:n.data,path:n.path,parent:n}).then((e=>Vf(e)?Promise.resolve(r.transform(e.value,o)).then((e=>({status:t.value,value:e}))):e))}Rf.assertNever(r)}}Gg.create=(e,t,n)=>new Gg({schema:e,typeName:ey.ZodEffects,effect:t,...eg(n)}),Gg.createWithPreprocess=(e,t,n)=>new Gg({schema:t,effect:{type:"preprocess",transform:e},typeName:ey.ZodEffects,...eg(n)});class jg extends tg{_parse(e){return this._getType(e)===Tf.undefined?qf(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}jg.create=(e,t)=>new jg({innerType:e,typeName:ey.ZodOptional,...eg(t)});class Ug extends tg{_parse(e){return this._getType(e)===Tf.null?qf(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Ug.create=(e,t)=>new Ug({innerType:e,typeName:ey.ZodNullable,...eg(t)});class Yg extends tg{_parse(e){const{ctx:t}=this._processInputParams(e);let n=t.data;return t.parsedType===Tf.undefined&&(n=this._def.defaultValue()),this._def.innerType._parse({data:n,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}Yg.create=(e,t)=>new Yg({innerType:e,typeName:ey.ZodDefault,defaultValue:"function"==typeof t.default?t.default:()=>t.default,...eg(t)});class qg extends tg{_parse(e){const{ctx:t}=this._processInputParams(e),n={...t,common:{...t.common,issues:[]}},r=this._def.innerType._parse({data:n.data,path:n.path,parent:{...n}});return Zf(r)?r.then((e=>({status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new Of(n.common.issues)},input:n.data})}))):{status:"valid",value:"valid"===r.status?r.value:this._def.catchValue({get error(){return new Of(n.common.issues)},input:n.data})}}removeCatch(){return this._def.innerType}}qg.create=(e,t)=>new qg({innerType:e,typeName:ey.ZodCatch,catchValue:"function"==typeof t.catch?t.catch:()=>t.catch,...eg(t)});class Xg extends tg{_parse(e){if(this._getType(e)!==Tf.nan){const t=this._getOrReturnCtx(e);return Gf(t,{code:Bf.invalid_type,expected:Tf.nan,received:t.parsedType}),Uf}return{status:"valid",value:e.data}}}Xg.create=e=>new Xg({typeName:ey.ZodNaN,...eg(e)});const zg=Symbol("zod_brand");class Vg extends tg{_parse(e){const{ctx:t}=this._processInputParams(e),n=t.data;return this._def.type._parse({data:n,path:t.path,parent:t})}unwrap(){return this._def.type}}class Zg extends tg{_parse(e){const{status:t,ctx:n}=this._processInputParams(e);if(n.common.async)return(async()=>{const e=await this._def.in._parseAsync({data:n.data,path:n.path,parent:n});return"aborted"===e.status?Uf:"dirty"===e.status?(t.dirty(),Yf(e.value)):this._def.out._parseAsync({data:e.value,path:n.path,parent:n})})();{const e=this._def.in._parseSync({data:n.data,path:n.path,parent:n});return"aborted"===e.status?Uf:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:n.path,parent:n})}}static create(e,t){return new Zg({in:e,out:t,typeName:ey.ZodPipeline})}}class Kg extends tg{_parse(e){const t=this._def.innerType._parse(e);return Vf(t)&&(t.value=Object.freeze(t.value)),t}}Kg.create=(e,t)=>new Kg({innerType:e,typeName:ey.ZodReadonly,...eg(t)});const Jg=(e,t={},n)=>e?bg.create().superRefine(((r,o)=>{var i,a;if(!e(r)){const e="function"==typeof t?t(r):"string"==typeof t?{message:t}:t,s=null===(a=null!==(i=e.fatal)&&void 0!==i?i:n)||void 0===a||a,l="string"==typeof e?{message:e}:e;o.addIssue({code:"custom",...l,fatal:s})}})):bg.create(),Qg={object:Eg.lazycreate};var ey;!function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"}(ey||(ey={}));const ty=ug.create,ny=hg.create,ry=Xg.create,oy=mg.create,iy=pg.create,ay=fg.create,sy=gg.create,ly=yg.create,cy=vg.create,uy=bg.create,dy=wg.create,hy=Cg.create,my=_g.create,py=kg.create,fy=Eg.create,gy=Eg.strictCreate,yy=Sg.create,vy=Mg.create,by=Ng.create,wy=Ig.create,Cy=Rg.create,_y=Lg.create,ky=Tg.create,Ay=Pg.create,Ey=Bg.create,Sy=Og.create,Dy=Fg.create,My=Hg.create,xy=Wg.create,Ny=Gg.create,Iy=jg.create,Ry=Ug.create,Ly=Gg.createWithPreprocess,Ty=Zg.create,Py={string:e=>ug.create({...e,coerce:!0}),number:e=>hg.create({...e,coerce:!0}),boolean:e=>pg.create({...e,coerce:!0}),bigint:e=>mg.create({...e,coerce:!0}),date:e=>fg.create({...e,coerce:!0})},By=Uf;var Oy=Object.freeze({__proto__:null,defaultErrorMap:$f,setErrorMap:function(e){Ff=e},getErrorMap:Hf,makeIssue:Wf,EMPTY_PATH:[],addIssueToContext:Gf,ParseStatus:jf,INVALID:Uf,DIRTY:Yf,OK:qf,isAborted:Xf,isDirty:zf,isValid:Vf,isAsync:Zf,get util(){return Rf},get objectUtil(){return Lf},ZodParsedType:Tf,getParsedType:Pf,ZodType:tg,ZodString:ug,ZodNumber:hg,ZodBigInt:mg,ZodBoolean:pg,ZodDate:fg,ZodSymbol:gg,ZodUndefined:yg,ZodNull:vg,ZodAny:bg,ZodUnknown:wg,ZodNever:Cg,ZodVoid:_g,ZodArray:kg,ZodObject:Eg,ZodUnion:Sg,ZodDiscriminatedUnion:Mg,ZodIntersection:Ng,ZodTuple:Ig,ZodRecord:Rg,ZodMap:Lg,ZodSet:Tg,ZodFunction:Pg,ZodLazy:Bg,ZodLiteral:Og,ZodEnum:Fg,ZodNativeEnum:Hg,ZodPromise:Wg,ZodEffects:Gg,ZodTransformer:Gg,ZodOptional:jg,ZodNullable:Ug,ZodDefault:Yg,ZodCatch:qg,ZodNaN:Xg,BRAND:zg,ZodBranded:Vg,ZodPipeline:Zg,ZodReadonly:Kg,custom:Jg,Schema:tg,ZodSchema:tg,late:Qg,get ZodFirstPartyTypeKind(){return ey},coerce:Py,any:uy,array:py,bigint:oy,boolean:iy,date:ay,discriminatedUnion:vy,effect:Ny,enum:Dy,function:Ay,instanceof:(e,t={message:`Input not instance of ${e.name}`})=>Jg((t=>t instanceof e),t),intersection:by,lazy:Ey,literal:Sy,map:_y,nan:ry,nativeEnum:My,never:hy,null:cy,nullable:Ry,number:ny,object:fy,oboolean:()=>iy().optional(),onumber:()=>ny().optional(),optional:Iy,ostring:()=>ty().optional(),pipeline:Ty,preprocess:Ly,promise:xy,record:Cy,set:ky,strictObject:gy,string:ty,symbol:sy,transformer:Ny,tuple:wy,undefined:ly,union:yy,unknown:dy,void:my,NEVER:By,ZodIssueCode:Bf,quotelessJson:e=>JSON.stringify(e,null,2).replace(/"([^"]+)":/g,"$1:"),ZodError:Of});class $y{constructor(){this._listeners=new Map,this._allListeners=new Set}onAny(e){return this._allListeners.add(e),()=>{this._allListeners.delete(e)}}on(e,t){let n=this._listeners.get(e);return n||(n=new Set,this._listeners.set(e,n)),n.add(t),()=>{n.delete(t),0===n.size&&this._listeners.delete(e)}}emit(e,t){var n;null===(n=this._listeners.get(e))||void 0===n||n.forEach((e=>e(t)));const r={event:e,data:t};this._allListeners.forEach((e=>e(r)))}}const Fy=new class extends $y{emitEvent(e,t){this.emit(e,t)}},Hy=function(e,t,n,r){var o=n.length,i=o,a=!r;if(null==e)return!i;for(e=Object(e);o--;){var s=n[o];if(a&&s[2]?s[1]!==e[s[0]]:!(s[0]in e))return!1}for(;++o<i;){var l=(s=n[o])[0],c=e[l],u=s[1];if(a&&s[2]){if(void 0===c&&!(l in e))return!1}else{var d=new jh;if(r)var h=r(c,u,l,e,t,d);if(!(void 0===h?Xp(u,c,3,r,d):h))return!1}}return!0},Wy=function(e){return e==e&&!vh(e)},Gy=function(e){for(var t=Em(e),n=t.length;n--;){var r=t[n],o=e[r];t[n]=[r,o,Wy(o)]}return t},jy=function(e,t){return function(n){return null!=n&&n[e]===t&&(void 0!==t||e in Object(n))}},Uy=function(e,t){return Jp(e)&&Wy(t)?jy(hf(e),t):function(n){var r=function(e,t,n){var r=null==e?void 0:mf(e,t);return void 0===r?n:r}(n,e);return void 0===r&&r===t?gf(n,e):Xp(t,r,3)}},Yy=function(e){return Jp(e)?(t=hf(e),function(e){return null==e?void 0:e[t]}):function(e){return function(t){return mf(t,e)}}(e);var t},qy=function(e){return"function"==typeof e?e:null==e?kf:"object"==typeof e?tm(e)?Uy(e[0],e[1]):1==(n=Gy(t=e)).length&&n[0][2]?jy(n[0][0],n[0][1]):function(e){return e===t||Hy(e,t,n)}:Yy(e);var t,n},Xy=function(e){return e!=e},zy=function(e,t){return!(null==e||!e.length)&&function(e,t,n){return t==t?function(e,t,n){for(var r=n-1,o=e.length;++r<o;)if(e[r]===t)return r;return-1}(e,t,n):function(e,t,n,r){for(var o=e.length,i=n+(r?1:-1);r?i--:++i<o;)if(t(e[i],i,e))return i;return-1}(e,Xy,n)}(e,t,0)>-1},Vy=function(e,t,n){for(var r=-1,o=null==e?0:e.length;++r<o;)if(n(t,e[r]))return!0;return!1},Zy=Ym&&1/$p(new Ym([,-0]))[1]==1/0?function(e){return new Ym(e)}:function(){},Ky=function(e,t){return e&&e.length?function(e,t,n){var r=-1,o=zy,i=e.length,a=!0,s=[],l=s;if(n)a=!1,o=Vy;else if(i>=200){var c=t?null:Zy(e);if(c)return $p(c);a=!1,o=Pp,l=new Lp}else l=t?[]:s;e:for(;++r<i;){var u=e[r],d=t?t(u):u;if(u=n||0!==u?u:0,a&&d==d){for(var h=l.length;h--;)if(l[h]===d)continue e;t&&l.push(d),s.push(u)}else o(l,d,n)||(l!==s&&l.push(d),s.push(u))}return s}(e,qy(t)):[]},Jy=[],Qy=Jy;function ev(e){if(EA!==yd.init)throw new Error("Export/Import categories can be registered only during init");if(Jy.some((t=>t.category===e.category)))throw new Error(`Export/Import category "${e.category}" already defined!`);Jy.push(e)}const tv={remove:"PLAYER_NAME's body seems to be cursed and the ASSET_NAME just falls off her body.",add:"The curse on PLAYER_NAME's ASSET_NAME wakes up and the item reappears.",swap:"The curse on PLAYER_NAME's ASSET_NAME wakes up, not allowing the item to be replaced by another item.",update:"The curse on PLAYER_NAME's ASSET_NAME wakes up and undoes all changes to the item.",color:"The curse on PLAYER_NAME's ASSET_NAME wakes up, changing the color of the item back.",autoremove:"The curse on PLAYER_NAME's body becomes dormant and the ASSET_NAME falls off her body."},nv={remove:"PLAYER_NAME's body seems to be cursed and several items just fall off her body.",add:"The curses on PLAYER_NAME's body wake up and several items reappear.",swap:"The curses on PLAYER_NAME's body wake up, not allowing several items to be replaced.",update:"The curses on PLAYER_NAME's body wake up and undoes all changes to several items.",color:"The curses on PLAYER_NAME's body wake up, changing the color of several items back.",autoremove:"The curses on PLAYER_NAME's body become dormant and several items fall off her body."},rv={remove:"The curse on PLAYER_NAME's body prevented a ASSET_NAME from being added to it",add:"The curse on PLAYER_NAME's ASSET_NAME made the item reappear",swap:"The curse on PLAYER_NAME's ASSET_NAME prevented the item from being replaced",update:"The curse on PLAYER_NAME's ASSET_NAME reverted all changes to the item",color:"The curse on PLAYER_NAME's ASSET_NAME reverted the color of the item"},ov={remove:"The curses on PLAYER_NAME's body prevented several items from being added to it",add:"The curses on PLAYER_NAME's body made several items reappear",swap:"The curses on PLAYER_NAME's body prevented several items from being replaced",update:"The curses on PLAYER_NAME's body reverted all changes to several items",color:"The curses on PLAYER_NAME's body reverted the color of several items"},iv=256;var av,sv;function lv(e,t,n){var r;if(!AA(md.Log))return;const o=null===(r=tA.logConfig)||void 0===r?void 0:r[e];if(void 0===o)throw new Error(`Attempt to log message with unknown category "${e}"`);o>sv.none&&cv(o,t,n)}function cv(e,t,n){if(AA(md.Log)){if(!tA.log)throw new Error("Mod storage log not initialized");tA.log.unshift([Date.now(),e,t,n]),tA.log.length>=2&&tA.log[0][0]<=tA.log[1][0]&&(tA.log[0][0]=tA.log[1][0]+1),tA.log.splice(iv),sA(),wA()}}function uv(e,t){var n;if(!AA(md.Log))return!1;if(t&&!TA("log_delete",t))return!1;const r=null===(n=tA.logConfig)||void 0===n?void 0:n.log_deleted;if(void 0===r)throw new Error("log_deleted category not found");if(!tA.log)throw new Error("Mod storage log not initialized");let o=!1;for(let t=tA.log.length-1;t>=0;t--){const n=tA.log[t];(Array.isArray(e)&&e.includes(n[0])||n[0]===e)&&(o=!0,r===sv.none?tA.log.splice(t,1):(n[1]=r,n[2]=av.deleted,n[3]=null))}return o&&(sA(),wA()),o}function dv(e,t,n){var r;return!(!AA(md.Log)||n&&!TA("log_configure",n)||void 0===(null===(r=tA.logConfig)||void 0===r?void 0:r[e])||![sv.none,sv.normal,sv.protected].includes(t)||(tA.logConfig[e]===t||(n&&(lv("log_config_change",av.plaintext,`${n} changed log configuration "${wv[e]}" from "${Cv[tA.logConfig[e]]}" to "${Cv[t]}"`),n.isPlayer()||yE(`${n.toNicknamedString()} changed log configuration "${wv[e]}" from "${Cv[tA.logConfig[e]]}" to "${Cv[t]}"`,void 0,n.MemberNumber)),tA.logConfig[e]=t,sA(),wA()),0))}function hv(e){return!(!AA(md.Log)||e&&!TA("log_delete",e)||(tA.log=[],cv(sv.everyone,av.plaintext,"The log has been cleared"),0))}function mv(e){if(!AA(md.Log))return[];if(!tA.log)throw new Error("Mod storage log not initialized");const t={[sv.none]:e.isPlayer(),[sv.normal]:TA("log_view_normal",e),[sv.protected]:TA("log_view_protected",e),[sv.everyone]:!0};return tA.log.filter((e=>t[e[1]]))}function pv(e,t){var n,r;if(e[2]===av.plaintext)return e[3];if(e[2]===av.deleted)return"[Log message deleted]";if(e[2]===av.ruleTrigger||e[2]===av.ruleTriggerAttempt){const o=e[3];if(!Array.isArray(o)||2!==o.length||"string"!=typeof o[0])return`[ERROR: Bad data for type ${e[2]}]`;if(!nw(o[0]))return`[ERROR: Trigger for unknown rule "${o[0]}"]`;const i=sw(o[0]),a=e[2]===av.ruleTriggerAttempt?null===(n=i.triggerTexts)||void 0===n?void 0:n.attempt_log:null===(r=i.triggerTexts)||void 0===r?void 0:r.log;return a?Pd(a,{PLAYER_NAME:t.Name,...o[1]}):`[ERROR: Missing log text for rule "${o[0]}" trigger]`}if(e[2]===av.curseTrigger){const n=e[3];return Array.isArray(n)&&2===n.length&&!n.some((e=>"string"!=typeof e))&&Object.keys(rv).includes(n[0])?Pd(rv[n[0]],{PLAYER_NAME:t.Name,ASSET_NAME:n[1]}):`[ERROR: Bad data for type ${e[2]}]`}if(e[2]===av.curseTriggerBatch){const n=e[3];return"string"==typeof n&&Object.keys(ov).includes(n)?Pd(ov[n],{PLAYER_NAME:t.Name}):`[ERROR: Bad data for type ${e[2]}]`}return`[ERROR: Unknown entry type ${e[2]}]`}!function(e){e[e.plaintext=0]="plaintext",e[e.deleted=1]="deleted",e[e.ruleTrigger=2]="ruleTrigger",e[e.ruleTriggerAttempt=3]="ruleTriggerAttempt",e[e.curseTrigger=4]="curseTrigger",e[e.curseTriggerBatch=5]="curseTriggerBatch"}(av||(av={})),function(e){e[e.none=0]="none",e[e.protected=1]="protected",e[e.normal=2]="normal",e[e.everyone=3]="everyone"}(sv||(sv={}));const fv=new Set;function gv(e){var t;return{configure:TA("log_configure",e),delete:TA("log_delete",e),leaveMessage:TA("log_add_note",e)&&!!(null===(t=tA.logConfig)||void 0===t?void 0:t.user_note),praise:TA("log_praise",e)&&!fv.has(e.MemberNumber)}}function yv(){if(!AA(md.Log))return{};if(!tA.logConfig)throw new Error("Mod storage log not initialized");return{...tA.logConfig}}function vv(e,t,n){if(!AA(md.Log))return!1;if(![-1,0,1].includes(e))throw new Error("Invalid value");if(0===e&&!t)return!1;const r=gv(n);return!(0!==e&&!r.praise||t&&!r.leaveMessage||(0!==e&&fv.add(n.MemberNumber),e>0?t?(lv("user_note",av.plaintext,`Praised by ${n} with note: ${t}`),yE(`${n.toNicknamedString()} praised you with the following note: ${t}`,void 0,n.MemberNumber)):(lv("praise",av.plaintext,`Praised by ${n}`),yE(`${n.toNicknamedString()} praised you.`,void 0,n.MemberNumber)):e<0?t?(lv("user_note",av.plaintext,`Scolded by ${n} with note: ${t}`),yE(`${n.toNicknamedString()} scolded you with the following note: ${t}`,void 0,n.MemberNumber)):(lv("praise",av.plaintext,`Scolded by ${n}`),yE(`${n.toNicknamedString()} scolded you.`,void 0,n.MemberNumber)):t&&(lv("user_note",av.plaintext,`${n} attached a note: ${t}`),yE(`${n.toNicknamedString()} put the following note on you: ${t}`,void 0,n.MemberNumber)),0))}const bv={log_config_change:sv.protected,log_deleted:sv.normal,praise:sv.normal,user_note:sv.normal,entered_public_room:sv.none,entered_private_room:sv.none,had_orgasm:sv.none,permission_change:sv.protected,curse_change:sv.none,curse_trigger:sv.none,rule_change:sv.none,rule_trigger:sv.none,command_change:sv.none,authority_roles_change:sv.protected,relationships_change:sv.none},wv={log_config_change:"Log changes in logging configuration",log_deleted:"Log deleted log entries",praise:"Log praising or scolding behavior",user_note:"Ability to see attached notes",entered_public_room:"Log which public rooms are entered",entered_private_room:"Log which private rooms are entered",had_orgasm:"Log each single orgasm",permission_change:"Log changes in permission settings",curse_change:"Log each application, removal or change of curses",curse_trigger:"Log every time a triggered curse reapplies an item",rule_change:"Log each addition, removal or change of rules",rule_trigger:"Log every rule violation",command_change:"Log each change of commands limit",authority_roles_change:"Log getting or losing a BCX owner/mistress",relationships_change:"Log each change in relationships module"},Cv={[sv.everyone]:"[ERROR]",[sv.none]:"No",[sv.protected]:"Protected",[sv.normal]:"Yes"},_v=[/^Script error\.?$/,/^Javascript error: Script error\.? on line 0$/,/^ResizeObserver loop completed with undelivered notifications.$/,/^Cannot redefine property: googletag$/,"undefined is not an object (evaluating 'a.L')",'can\'t redefine non-configurable property "solana"',"vv().getRestrictions is not a function. (In 'vv().getRestrictions(1,a)', 'vv().getRestrictions' is undefined)","Can't find variable: _AutofillCallbackHandler"],kv=(e={})=>({name:"InboundFilters",processEvent(t,n,r){const o=r.getOptions(),i=function(e={},t={}){return{allowUrls:[...e.allowUrls||[],...t.allowUrls||[]],denyUrls:[...e.denyUrls||[],...t.denyUrls||[]],ignoreErrors:[...e.ignoreErrors||[],...t.ignoreErrors||[],...e.disableErrorDefaults?[]:_v],ignoreTransactions:[...e.ignoreTransactions||[],...t.ignoreTransactions||[]],ignoreInternal:void 0===e.ignoreInternal||e.ignoreInternal}}(e,o);return function(e,t){return t.ignoreInternal&&function(e){try{return"SentryError"===e.exception.values[0].type}catch(e){}return!1}(e)?(_t&&W.warn(`Event dropped due to being internal Sentry Error.\nEvent: ${ce(e)}`),!0):function(e,t){return!(e.type||!t||!t.length)&&function(e){const t=[];let n;e.message&&t.push(e.message);try{n=e.exception.values[e.exception.values.length-1]}catch(e){}return n&&n.value&&(t.push(n.value),n.type&&t.push(`${n.type}: ${n.value}`)),t}(e).some((e=>U(e,t)))}(e,t.ignoreErrors)?(_t&&W.warn(`Event dropped due to being matched by \`ignoreErrors\` option.\nEvent: ${ce(e)}`),!0):function(e){return!e.type&&(!(!e.exception||!e.exception.values||0===e.exception.values.length)&&(!e.message&&!e.exception.values.some((e=>e.stacktrace||e.type&&"Error"!==e.type||e.value))))}(e)?(_t&&W.warn(`Event dropped due to not having an error message, error type or stacktrace.\nEvent: ${ce(e)}`),!0):function(e,t){if("transaction"!==e.type||!t||!t.length)return!1;const n=e.transaction;return!!n&&U(n,t)}(e,t.ignoreTransactions)?(_t&&W.warn(`Event dropped due to being matched by \`ignoreTransactions\` option.\nEvent: ${ce(e)}`),!0):function(e,t){if(!t||!t.length)return!1;const n=Av(e);return!!n&&U(n,t)}(e,t.denyUrls)?(_t&&W.warn(`Event dropped due to being matched by \`denyUrls\` option.\nEvent: ${ce(e)}.\nUrl: ${Av(e)}`),!0):!function(e,t){if(!t||!t.length)return!0;const n=Av(e);return!n||U(n,t)}(e,t.allowUrls)&&(_t&&W.warn(`Event dropped due to not being matched by \`allowUrls\` option.\nEvent: ${ce(e)}.\nUrl: ${Av(e)}`),!0)}(t,i)?null:t}});function Av(e){try{let t;try{t=e.exception.values[0].stacktrace.frames}catch(e){}return t?function(e=[]){for(let t=e.length-1;t>=0;t--){const n=e[t];if(n&&"<anonymous>"!==n.filename&&"[native code]"!==n.filename)return n.filename||null}return null}(t):null}catch(t){return _t&&W.error(`Cannot extract url for event ${ce(e)}`),null}}let Ev;const Sv=new WeakMap,Dv=()=>({name:"FunctionToString",setupOnce(){Ev=Function.prototype.toString;try{Function.prototype.toString=function(...e){const t=z(this),n=Sv.has(He())&&void 0!==t?t:this;return Ev.apply(n,e)}}catch(e){}},setup(e){Sv.set(e,!0)}}),Mv=()=>{let e;return{name:"Dedupe",processEvent(t){if(t.type)return t;try{if(function(e,t){return!!t&&(!!function(e,t){const n=e.message,r=t.message;return!(!n&&!r)&&(!(n&&!r||!n&&r)&&(n===r&&(!!Nv(e,t)&&!!xv(e,t))))}(e,t)||!!function(e,t){const n=Iv(t),r=Iv(e);return!(!n||!r)&&(n.type===r.type&&n.value===r.value&&(!!Nv(e,t)&&!!xv(e,t)))}(e,t))}(t,e))return _t&&W.warn("Event dropped due to being a duplicate of previously captured event."),null}catch(e){}return e=t}}};function xv(e,t){let n=Bt(e),r=Bt(t);if(!n&&!r)return!0;if(n&&!r||!n&&r)return!1;if(r.length!==n.length)return!1;for(let e=0;e<r.length;e++){const t=r[e],o=n[e];if(t.filename!==o.filename||t.lineno!==o.lineno||t.colno!==o.colno||t.function!==o.function)return!1}return!0}function Nv(e,t){let n=e.fingerprint,r=t.fingerprint;if(!n&&!r)return!0;if(n&&!r||!n&&r)return!1;try{return!(n.join("")!==r.join(""))}catch(e){return!1}}function Iv(e){return e.exception&&e.exception.values&&e.exception.values[0]}class Rv extends Error{constructor(e,t="warn"){super(e),this.message=e,this.name=new.target.prototype.constructor.name,Object.setPrototypeOf(this,new.target.prototype),this.logLevel=t}}const Lv="7";function Tv(e,t,n){return t||`${function(e){return`${function(e){const t=e.protocol?`${e.protocol}:`:"",n=e.port?`:${e.port}`:"";return`${t}//${e.host}${n}${e.path?`/${e.path}`:""}/api/`}(e)}${e.projectId}/envelope/`}(e)}?${function(e,t){return n={sentry_key:e.publicKey,sentry_version:Lv,...t&&{sentry_client:`${t.name}/${t.version}`}},Object.keys(n).map((e=>`${encodeURIComponent(e)}=${encodeURIComponent(n[e])}`)).join("&");var n}(e,n)}`}const Pv="Not capturing exception because it's already been captured.";class Bv{constructor(e){if(this._options=e,this._integrations={},this._numProcessing=0,this._outcomes={},this._hooks={},this._eventProcessors=[],e.dsn?this._dsn=function(e){const t="string"==typeof e?function(e){const t=Et.exec(e);if(!t)return void H((()=>{console.error(`Invalid Sentry Dsn: ${e}`)}));const[n,r,o="",i="",a="",s=""]=t.slice(1);let l="",c=s;const u=c.split("/");if(u.length>1&&(l=u.slice(0,-1).join("/"),c=u.pop()),c){const e=c.match(/^\d+/);e&&(c=e[0])}return Dt({host:i,pass:o,path:l,projectId:c,port:a,protocol:n,publicKey:r})}(e):Dt(e);if(t&&function(e){if(!O)return!0;const{port:t,projectId:n,protocol:r}=e;return!(["protocol","publicKey","host","projectId"].find((t=>!e[t]&&(W.error(`Invalid Sentry Dsn: ${t} missing`),!0)))||(n.match(/^\d+$/)?function(e){return"http"===e||"https"===e}(r)?t&&isNaN(parseInt(t,10))&&(W.error(`Invalid Sentry Dsn: Invalid port ${t}`),1):(W.error(`Invalid Sentry Dsn: Invalid protocol ${r}`),1):(W.error(`Invalid Sentry Dsn: Invalid projectId ${n}`),1)))}(t))return t}(e.dsn):_t&&W.warn("No DSN provided, client will not send events."),this._dsn){const t=Tv(this._dsn,e.tunnel,e._metadata?e._metadata.sdk:void 0);this._transport=e.transport({tunnel:this._options.tunnel,recordDroppedEvent:this.recordDroppedEvent.bind(this),...e.transportOptions,url:t})}}captureException(e,t,n){const r=se();if(he(e))return _t&&W.log(Pv),r;const o={event_id:r,...t};return this._process(this.eventFromException(e,o).then((e=>this._captureEvent(e,o,n)))),o.event_id}captureMessage(e,t,n,r){const o={event_id:se(),...n},i=C(e)?e:String(e),a=_(e)?this.eventFromMessage(i,t,o):this.eventFromException(e,o);return this._process(a.then((e=>this._captureEvent(e,o,r)))),o.event_id}captureEvent(e,t,n){const r=se();if(t&&t.originalException&&he(t.originalException))return _t&&W.log(Pv),r;const o={event_id:r,...t},i=(e.sdkProcessingMetadata||{}).capturedSpanScope;return this._process(this._captureEvent(e,o,i||n)),o.event_id}captureSession(e){"string"!=typeof e.release?_t&&W.warn("Discarded session because of missing or non-string release"):(this.sendSession(e),Ae(e,{init:!1}))}getDsn(){return this._dsn}getOptions(){return this._options}getSdkMetadata(){return this._options._metadata}getTransport(){return this._transport}flush(e){const t=this._transport;return t?(this.emit("flush"),this._isClientDoneProcessing(e).then((n=>t.flush(e).then((e=>n&&e))))):Jr(!0)}close(e){return this.flush(e).then((e=>(this.getOptions().enabled=!1,this.emit("close"),e)))}getEventProcessors(){return this._eventProcessors}addEventProcessor(e){this._eventProcessors.push(e)}init(){(this._isEnabled()||this._options.integrations.some((({name:e})=>e.startsWith("Spotlight"))))&&this._setupIntegrations()}getIntegrationByName(e){return this._integrations[e]}addIntegration(e){const t=this._integrations[e.name];Wo(this,e,this._integrations),t||Ho(this,[e])}sendEvent(e,t={}){this.emit("beforeSendEvent",e,t);let n=function(e,t,n,r){const o=Vt(n),i=e.type&&"replay_event"!==e.type?e.type:"event";!function(e,t){t&&(e.sdk=e.sdk||{},e.sdk.name=e.sdk.name||t.name,e.sdk.version=e.sdk.version||t.version,e.sdk.integrations=[...e.sdk.integrations||[],...t.integrations||[]],e.sdk.packages=[...e.sdk.packages||[],...t.packages||[]])}(e,n&&n.sdk);const a=Zt(e,o,r,t);return delete e.sdkProcessingMetadata,Ht(a,[[{type:i},e]])}(e,this._dsn,this._options._metadata,this._options.tunnel);for(const e of t.attachments||[])n=Wt(n,qt(e));const r=this.sendEnvelope(n);r&&r.then((t=>this.emit("afterSendEvent",e,t)),null)}sendSession(e){const t=function(e,t,n,r){const o=Vt(n);return Ht({sent_at:(new Date).toISOString(),...o&&{sdk:o},...!!r&&t&&{dsn:St(t)}},["aggregates"in e?[{type:"sessions"},e]:[{type:"session"},e.toJSON()]])}(e,this._dsn,this._options._metadata,this._options.tunnel);this.sendEnvelope(t)}recordDroppedEvent(e,t,n){if(this._options.sendClientReports){const r="number"==typeof n?n:1,o=`${e}:${t}`;_t&&W.log(`Recording outcome: "${o}"${r>1?` (${r} times)`:""}`),this._outcomes[o]=(this._outcomes[o]||0)+r}}on(e,t){const n=this._hooks[e]=this._hooks[e]||[];return n.push(t),()=>{const e=n.indexOf(t);e>-1&&n.splice(e,1)}}emit(e,...t){const n=this._hooks[e];n&&n.forEach((e=>e(...t)))}sendEnvelope(e){return this.emit("beforeEnvelope",e),this._isEnabled()&&this._transport?this._transport.send(e).then(null,(e=>(_t&&W.error("Error while sending event:",e),e))):(_t&&W.error("Transport disabled"),Jr({}))}_setupIntegrations(){const{integrations:e}=this._options;this._integrations=function(e,t){const n={};return t.forEach((t=>{t&&Wo(e,t,n)})),n}(this,e),Ho(this,e)}_updateSessionFromEvent(e,t){let n=!1,r=!1;const o=t.exception&&t.exception.values;if(o){r=!0;for(const e of o){const t=e.mechanism;if(t&&!1===t.handled){n=!0;break}}}const i="ok"===e.status;(i&&0===e.errors||i&&n)&&(Ae(e,{...n&&{status:"crashed"},errors:e.errors||Number(r||n)}),this.captureSession(e))}_isClientDoneProcessing(e){return new eo((t=>{let n=0;const r=setInterval((()=>{0==this._numProcessing?(clearInterval(r),t(!0)):(n+=1,e&&n>=e&&(clearInterval(r),t(!1)))}),1)}))}_isEnabled(){return!1!==this.getOptions().enabled&&void 0!==this._transport}_prepareEvent(e,t,n,r=Oe()){const o=this.getOptions(),i=Object.keys(this._integrations);return!t.integrations&&i.length>0&&(t.integrations=i),this.emit("preprocessEvent",e,t),e.type||r.setLastEventId(e.event_id||t.event_id),oo(o,e,t,n,this,r).then((e=>{if(null===e)return e;const t={...r.getPropagationContext(),...n?n.getPropagationContext():void 0};if((!e.contexts||!e.contexts.trace)&&t){const{traceId:n,spanId:r,parentSpanId:o,dsc:i}=t;e.contexts={trace:J({trace_id:n,span_id:r,parent_span_id:o}),...e.contexts};const a=i||wt(n,this);e.sdkProcessingMetadata={dynamicSamplingContext:a,...e.sdkProcessingMetadata}}return e}))}_captureEvent(e,t={},n){return this._processEvent(e,t,n).then((e=>e.event_id),(e=>{if(_t){const t=e;"log"===t.logLevel?W.log(t.message):W.warn(t)}}))}_processEvent(e,t,n){const r=this.getOptions(),{sampleRate:o}=r,i=$v(e),a=Ov(e),s=e.type||"error",l=`before send for type \`${s}\``,c=void 0===o?void 0:kt(o);if(a&&"number"==typeof c&&Math.random()>c)return this.recordDroppedEvent("sample_rate","error",e),Qr(new Rv(`Discarding event because it's not included in the random sample (sampling rate = ${o})`,"log"));const u="replay_event"===s?"replay":s,d=(e.sdkProcessingMetadata||{}).capturedSpanIsolationScope;return this._prepareEvent(e,t,n,d).then((n=>{if(null===n)throw this.recordDroppedEvent("event_processor",u,e),new Rv("An event processor returned `null`, will not send event.","log");if(t.data&&!0===t.data.__sentry__)return n;const o=function(e,t,n,r){const{beforeSend:o,beforeSendTransaction:i,beforeSendSpan:a}=t;if(Ov(n)&&o)return o(n,r);if($v(n)){if(n.spans&&a){const t=[];for(const r of n.spans){const n=a(r);n?t.push(n):e.recordDroppedEvent("before_send","span")}n.spans=t}if(i){if(n.spans){const e=n.spans.length;n.sdkProcessingMetadata={...n.sdkProcessingMetadata,spanCountBeforeProcessing:e}}return i(n,r)}}return n}(this,r,n,t);return function(e,t){const n=`${t} must return \`null\` or a valid event.`;if(E(e))return e.then((e=>{if(!k(e)&&null!==e)throw new Rv(n);return e}),(e=>{throw new Rv(`${t} rejected with ${e}`)}));if(!k(e)&&null!==e)throw new Rv(n);return e}(o,l)})).then((r=>{if(null===r){if(this.recordDroppedEvent("before_send",u,e),i){const t=1+(e.spans||[]).length;this.recordDroppedEvent("before_send","span",t)}throw new Rv(`${l} returned \`null\`, will not send event.`,"log")}const o=n&&n.getSession();if(!i&&o&&this._updateSessionFromEvent(o,r),i){const e=(r.sdkProcessingMetadata&&r.sdkProcessingMetadata.spanCountBeforeProcessing||0)-(r.spans?r.spans.length:0);e>0&&this.recordDroppedEvent("before_send","span",e)}const a=r.transaction_info;if(i&&a&&r.transaction!==e.transaction){const e="custom";r.transaction_info={...a,source:e}}return this.sendEvent(r,t),r})).then(null,(e=>{if(e instanceof Rv)throw e;throw this.captureException(e,{data:{__sentry__:!0},originalException:e}),new Rv(`Event processing pipeline threw an error, original event will not be sent. Details have been sent as a new event.\nReason: ${e}`)}))}_process(e){this._numProcessing++,e.then((e=>(this._numProcessing--,e)),(e=>(this._numProcessing--,e)))}_clearOutcomes(){const e=this._outcomes;return this._outcomes={},Object.entries(e).map((([e,t])=>{const[n,r]=e.split(":");return{reason:n,category:r,quantity:t}}))}_flushOutcomes(){_t&&W.log("Flushing outcomes...");const e=this._clearOutcomes();if(0===e.length)return void(_t&&W.log("No outcomes to send"));if(!this._dsn)return void(_t&&W.log("No dsn provided, will not send outcomes"));_t&&W.log("Sending outcomes:",e);const t=(n=e,Ht((r=this._options.tunnel&&St(this._dsn))?{dsn:r}:{},[[{type:"client_report"},{timestamp:ye(),discarded_events:n}]]));var n,r;this.sendEnvelope(t)}}function Ov(e){return void 0===e.type}function $v(e){return"transaction"===e.type}function Fv(e,t){const n=Wv(e,t),r={type:t&&t.name,value:jv(t)};return n.length&&(r.stacktrace={frames:n}),void 0===r.type&&""===r.value&&(r.value="Unrecoverable error caught"),r}function Hv(e,t){return{exception:{values:[Fv(e,t)]}}}function Wv(e,t){const n=t.stacktrace||t.stack||"",r=function(e){return e&&Gv.test(e.message)?1:0}(t),o=function(e){return"number"==typeof e.framesToPop?e.framesToPop:0}(t);try{return e(n,r,o)}catch(e){}return[]}const Gv=/Minified React error #\d+;/i;function jv(e){const t=e&&e.message;return t?t.error&&"string"==typeof t.error.message?t.error.message:t:"No error message"}function Uv(e,t,n,r,o){let i;if(v(t)&&t.error)return Hv(e,t.error);if(b(t)||y(t,"DOMException")){const o=t;if("stack"in t)i=Hv(e,t);else{const t=o.name||(b(o)?"DOMError":"DOMException"),a=o.message?`${t}: ${o.message}`:t;i=Yv(e,a,n,r),ue(i,a)}return"code"in o&&(i.tags={...i.tags,"DOMException.code":`${o.code}`}),i}return g(t)?Hv(e,t):k(t)||A(t)?(i=function(e,t,n,r){const o=He(),i=o&&o.getOptions().normalizeDepth,a=function(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t)){const n=e[t];if(n instanceof Error)return n}}(t),s={__serialized__:$t(t,i)};if(a)return{exception:{values:[Fv(e,a)]},extra:s};const l={exception:{values:[{type:A(t)?t.constructor.name:r?"UnhandledRejection":"Error",value:qv(t,{isUnhandledRejection:r})}]},extra:s};if(n){const t=Wv(e,n);t.length&&(l.exception.values[0].stacktrace={frames:t})}return l}(e,t,n,o),de(i,{synthetic:!0}),i):(i=Yv(e,t,n,r),ue(i,`${t}`,void 0),de(i,{synthetic:!0}),i)}function Yv(e,t,n,r){const o={};if(r&&n){const r=Wv(e,n);r.length&&(o.exception={values:[{value:t,stacktrace:{frames:r}}]})}if(C(t)){const{__sentry_template_string__:e,__sentry_template_values__:n}=t;return o.logentry={message:e,params:n},o}return o.message=t,o}function qv(e,{isUnhandledRejection:t}){const n=function(e,t=40){const n=Object.keys(V(e));n.sort();const r=n[0];if(!r)return"[object has no keys]";if(r.length>=t)return G(r,t);for(let e=n.length;e>0;e--){const r=n.slice(0,e).join(", ");if(!(r.length>t))return e===n.length?r:G(r,t)}return""}(e),r=t?"promise rejection":"exception";return v(e)?`Event \`ErrorEvent\` captured as ${r} with message \`${e.message}\``:A(e)?`Event \`${function(e){try{const t=Object.getPrototypeOf(e);return t?t.constructor.name:void 0}catch(e){}}(e)}\` (type=${e.type}) captured as ${r}`:`Object captured as ${r} with keys: ${n}`}class Xv extends Bv{constructor(e){const t={parentSpanIsAlwaysRootSpan:!0,...e};!function(e,t,n=[t],r="npm"){const o=e._metadata||{};o.sdk||(o.sdk={name:`sentry.javascript.${t}`,packages:n.map((e=>({name:`${r}:@sentry/${e}`,version:M}))),version:M}),e._metadata=o}(t,"browser",["browser"],po.SENTRY_SDK_SOURCE||"npm"),super(t),t.sendClientReports&&po.document&&po.document.addEventListener("visibilitychange",(()=>{"hidden"===po.document.visibilityState&&this._flushOutcomes()}))}eventFromException(e,t){return function(e,t,n,r){const o=Uv(e,t,n&&n.syntheticException||void 0,r);return de(o),o.level="error",n&&n.event_id&&(o.event_id=n.event_id),Jr(o)}(this._options.stackParser,e,t,this._options.attachStacktrace)}eventFromMessage(e,t="info",n){return function(e,t,n="info",r,o){const i=Yv(e,t,r&&r.syntheticException||void 0,o);return i.level=n,r&&r.event_id&&(i.event_id=r.event_id),Jr(i)}(this._options.stackParser,e,t,n,this._options.attachStacktrace)}captureUserFeedback(e){if(!this._isEnabled())return void(Zr&&W.warn("SDK not enabled, will not capture user feedback."));const t=function(e,{metadata:t,tunnel:n,dsn:r}){const o={event_id:e.event_id,sent_at:(new Date).toISOString(),...t&&t.sdk&&{sdk:{name:t.sdk.name,version:t.sdk.version}},...!!n&&!!r&&{dsn:St(r)}},i=function(e){return[{type:"user_report"},e]}(e);return Ht(o,[i])}(e,{metadata:this.getSdkMetadata(),dsn:this.getDsn(),tunnel:this.getOptions().tunnel});this.sendEnvelope(t)}_prepareEvent(e,t,n){return e.platform=e.platform||"javascript",super._prepareEvent(e,t,n)}}function zv(){"console"in x&&$.forEach((function(e){e in x.console&&Y(x.console,e,(function(t){return F[e]=t,function(...t){Pr("console",{args:t,level:e});const n=F[e];n&&n.apply(x.console,t)}}))}))}const Vv=["fatal","error","warning","log","info","debug"];const Zv=(e={})=>{const t={console:!0,dom:!0,fetch:!0,history:!0,sentry:!0,xhr:!0,...e};return{name:"Breadcrumbs",setup(e){t.console&&function(e){const t="console";Lr(t,e),Tr(t,zv)}(function(e){return function(t){if(He()!==e)return;const n={category:"console",data:{arguments:t.args,logger:"console"},level:(r=t.level,"warn"===r?"warning":Vv.includes(r)?r:"log"),message:j(t.args," ")};var r;if("assert"===t.level){if(!1!==t.args[0])return;n.message=`Assertion failed: ${j(t.args.slice(1)," ")||"console.assert"}`,n.data.arguments=t.args.slice(1)}ui(n,{input:t.args,level:t.level})}}(e)),t.dom&&Ai(function(e,t){return function(n){if(He()!==e)return;let r,o,i="object"==typeof t?t.serializeAttribute:void 0,a="object"==typeof t&&"number"==typeof t.maxStringLength?t.maxStringLength:void 0;a&&a>1024&&(Zr&&W.warn(`\`dom.maxStringLength\` cannot exceed 1024, but a value of ${a} was configured. Sentry will use 1024 instead.`),a=1024),"string"==typeof i&&(i=[i]);try{const e=n.event,t=function(e){return!!e&&!!e.target}(e)?e.target:e;r=L(t,{keyAttrs:i,maxStringLength:a}),o=B(t)}catch(e){r="<unknown>"}if(0===r.length)return;const s={category:`ui.${n.name}`,message:r};o&&(s.data={"ui.component_name":o}),ui(s,{event:n.event,name:n.name,global:n.global})}}(e,t.dom)),t.xhr&&bo(function(e){return function(t){if(He()!==e)return;const{startTimestamp:n,endTimestamp:r}=t,o=t.xhr[vo];if(!n||!r||!o)return;const{method:i,url:a,status_code:s,body:l}=o;ui({category:"xhr",data:{method:i,url:a,status_code:s},type:"http"},{xhr:t.xhr,input:l,startTimestamp:n,endTimestamp:r})}}(e)),t.fetch&&Ao(function(e){return function(t){if(He()!==e)return;const{startTimestamp:n,endTimestamp:r}=t;if(r&&(!t.fetchData.url.match(/sentry_key/)||"POST"!==t.fetchData.method))if(t.error)ui({category:"fetch",data:t.fetchData,level:"error",type:"http"},{data:t.error,input:t.args,startTimestamp:n,endTimestamp:r});else{const e=t.response;ui({category:"fetch",data:{...t.fetchData,status_code:e&&e.status},type:"http"},{input:t.args,response:e,startTimestamp:n,endTimestamp:r})}}}(e)),t.history&&$r(function(e){return function(t){if(He()!==e)return;let n=t.from,r=t.to;const o=un(po.location.href);let i=n?un(n):void 0;const a=un(r);i&&i.path||(i=o),o.protocol===a.protocol&&o.host===a.host&&(r=a.relative),o.protocol===i.protocol&&o.host===i.host&&(n=i.relative),ui({category:"navigation",data:{from:n,to:r}})}}(e)),t.sentry&&e.on("beforeSendEvent",function(e){return function(t){He()===e&&ui({category:"sentry."+("transaction"===t.type?"transaction":"event"),event_id:t.event_id,level:t.level,message:ce(t)},{event:t})}}(e))}}},Kv=["EventTarget","Window","Node","ApplicationCache","AudioTrackList","BroadcastChannel","ChannelMergerNode","CryptoOperation","EventSource","FileReader","HTMLUnknownElement","IDBDatabase","IDBRequest","IDBTransaction","KeyOperation","MediaController","MessagePort","ModalWindow","Notification","SVGElementInstance","Screen","SharedWorker","TextTrack","TextTrackCue","TextTrackList","WebSocket","WebSocketWorker","Worker","XMLHttpRequest","XMLHttpRequestEventTarget","XMLHttpRequestUpload"],Jv=(e={})=>{const t={XMLHttpRequest:!0,eventTarget:!0,requestAnimationFrame:!0,setInterval:!0,setTimeout:!0,...e};return{name:"BrowserApiErrors",setupOnce(){t.setTimeout&&Y(po,"setTimeout",Qv),t.setInterval&&Y(po,"setInterval",Qv),t.requestAnimationFrame&&Y(po,"requestAnimationFrame",eb),t.XMLHttpRequest&&"XMLHttpRequest"in po&&Y(XMLHttpRequest.prototype,"send",tb);const e=t.eventTarget;e&&(Array.isArray(e)?e:Kv).forEach(nb)}}};function Qv(e){return function(...t){const n=t[0];return t[0]=yo(n,{mechanism:{data:{function:Pt(e)},handled:!1,type:"instrument"}}),e.apply(this,t)}}function eb(e){return function(t){return e.apply(this,[yo(t,{mechanism:{data:{function:"requestAnimationFrame",handler:Pt(e)},handled:!1,type:"instrument"}})])}}function tb(e){return function(...t){const n=this;return["onload","onerror","onprogress","onreadystatechange"].forEach((e=>{e in n&&"function"==typeof n[e]&&Y(n,e,(function(t){const n={mechanism:{data:{function:e,handler:Pt(t)},handled:!1,type:"instrument"}},r=z(t);return r&&(n.mechanism.data.handler=Pt(r)),yo(t,n)}))})),e.apply(this,t)}}function nb(e){const t=po,n=t[e]&&t[e].prototype;n&&n.hasOwnProperty&&n.hasOwnProperty("addEventListener")&&(Y(n,"addEventListener",(function(t){return function(n,r,o){try{"function"==typeof r.handleEvent&&(r.handleEvent=yo(r.handleEvent,{mechanism:{data:{function:"handleEvent",handler:Pt(r),target:e},handled:!1,type:"instrument"}}))}catch(e){}return t.apply(this,[n,yo(r,{mechanism:{data:{function:"addEventListener",handler:Pt(r),target:e},handled:!1,type:"instrument"}}),o])}})),Y(n,"removeEventListener",(function(e){return function(t,n,r){const o=n;try{const n=o&&o.__sentry_wrapped__;n&&e.call(this,t,n,r)}catch(e){}return e.call(this,t,o,r)}})))}const rb=(e={})=>{const t={onerror:!0,onunhandledrejection:!0,...e};return{name:"GlobalHandlers",setupOnce(){Error.stackTraceLimit=50},setup(e){t.onerror&&(function(e){jr((t=>{const{stackParser:n,attachStacktrace:r}=ib();if(He()!==e||go())return;const{msg:o,url:i,line:a,column:s,error:l}=t,c=function(e,t,n,r){const o=e.exception=e.exception||{},i=o.values=o.values||[],a=i[0]=i[0]||{},s=a.stacktrace=a.stacktrace||{},l=s.frames=s.frames||[],c=isNaN(parseInt(r,10))?void 0:r,u=isNaN(parseInt(n,10))?void 0:n,d=w(t)&&t.length>0?t:P();return 0===l.length&&l.push({colno:c,filename:d,function:xt,in_app:!0,lineno:u}),e}(Uv(n,l||o,void 0,r,!1),i,a,s);c.level="error",lo(c,{originalException:l,mechanism:{handled:!1,type:"onerror"}})}))}(e),ob("onerror")),t.onunhandledrejection&&(function(e){qr((t=>{const{stackParser:n,attachStacktrace:r}=ib();if(He()!==e||go())return;const o=function(e){if(_(e))return e;try{if("reason"in e)return e.reason;if("detail"in e&&"reason"in e.detail)return e.detail.reason}catch(e){}return e}(t),i=_(o)?{exception:{values:[{type:"UnhandledRejection",value:`Non-Error promise rejection captured with value: ${String(o)}`}]}}:Uv(n,o,void 0,r,!0);i.level="error",lo(i,{originalException:o,mechanism:{handled:!1,type:"onunhandledrejection"}})}))}(e),ob("onunhandledrejection"))}}};function ob(e){Zr&&W.log(`Global Handler attached: ${e}`)}function ib(){const e=He();return e&&e.getOptions()||{stackParser:()=>[],attachStacktrace:!1}}function ab(e,t,n=250,r,o,i,a){if(!(i.exception&&i.exception.values&&a&&S(a.originalException,Error)))return;const s=i.exception.values.length>0?i.exception.values[i.exception.values.length-1]:void 0;var l,c;s&&(i.exception.values=(l=sb(e,t,o,a.originalException,r,i.exception.values,s,0),c=n,l.map((e=>(e.value&&(e.value=G(e.value,c)),e)))))}function sb(e,t,n,r,o,i,a,s){if(i.length>=n+1)return i;let l=[...i];if(S(r[o],Error)){lb(a,s);const i=e(t,r[o]),c=l.length;cb(i,o,c,s),l=sb(e,t,n,r[o],o,[i,...l],i,c)}return Array.isArray(r.errors)&&r.errors.forEach(((r,i)=>{if(S(r,Error)){lb(a,s);const c=e(t,r),u=l.length;cb(c,`errors[${i}]`,u,s),l=sb(e,t,n,r,o,[c,...l],c,u)}})),l}function lb(e,t){e.mechanism=e.mechanism||{type:"generic",handled:!0},e.mechanism={...e.mechanism,..."AggregateError"===e.type&&{is_exception_group:!0},exception_id:t}}function cb(e,t,n,r){e.mechanism=e.mechanism||{type:"generic",handled:!0},e.mechanism={...e.mechanism,type:"chained",source:t,exception_id:n,parent_id:r}}const ub=(e={})=>{const t=e.limit||5,n=e.key||"cause";return{name:"LinkedErrors",preprocessEvent(e,r,o){const i=o.getOptions();ab(Fv,i.stackParser,i.maxValueLength,n,t,e,r)}}};function db(e,t,n,r){const o={filename:e,function:"<anonymous>"===t?xt:t,in_app:!0};return void 0!==n&&(o.lineno=n),void 0!==r&&(o.colno=r),o}const hb=/^\s*at (\S+?)(?::(\d+))(?::(\d+))\s*$/i,mb=/^\s*at (?:(.+?\)(?: \[.+\])?|.*?) ?\((?:address at )?)?(?:async )?((?:<anonymous>|[-a-z]+:|.*bundle|\/)?.*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i,pb=/\((\S*)(?::(\d+))(?::(\d+))\)/,fb=/^\s*(.*?)(?:\((.*?)\))?(?:^|@)?((?:[-a-z]+)?:\/.*?|\[native code\]|[^@]*(?:bundle|\d+\.js)|\/[\w\-. /=]+)(?::(\d+))?(?::(\d+))?\s*$/i,gb=/(\S+) line (\d+)(?: > eval line \d+)* > eval/i,yb=Rt([30,e=>{const t=hb.exec(e);if(t){const[,e,n,r]=t;return db(e,xt,+n,+r)}const n=mb.exec(e);if(n){if(n[2]&&0===n[2].indexOf("eval")){const e=pb.exec(n[2]);e&&(n[2]=e[1],n[3]=e[2],n[4]=e[3])}const[e,t]=vb(n[1]||xt,n[2]);return db(t,e,n[3]?+n[3]:void 0,n[4]?+n[4]:void 0)}}],[50,e=>{const t=fb.exec(e);if(t){if(t[3]&&t[3].indexOf(" > eval")>-1){const e=gb.exec(t[3]);e&&(t[1]=t[1]||"eval",t[3]=e[1],t[4]=e[2],t[5]="")}let e=t[3],n=t[1]||xt;return[n,e]=vb(n,e),db(e,n,t[4]?+t[4]:void 0,t[5]?+t[5]:void 0)}}]),vb=(e,t)=>{const n=-1!==e.indexOf("safari-extension"),r=-1!==e.indexOf("safari-web-extension");return n||r?[-1!==e.indexOf("@")?e.split("@")[0]:xt,n?`safari-extension:${t}`:`safari-web-extension:${t}`]:[e,t]};const bb=64;function wb(e,t){if("event"===t||"transaction"===t)return Array.isArray(e)?e[1]:void 0}function Cb(e,t=yi("fetch")){let n=0,r=0;return function(e,t,n=function(e){const t=[];function n(e){return t.splice(t.indexOf(e),1)[0]||Promise.resolve(void 0)}return{$:t,add:function(r){if(!(void 0===e||t.length<e))return Qr(new Rv("Not adding Promise because buffer limit was reached."));const o=r();return-1===t.indexOf(o)&&t.push(o),o.then((()=>n(o))).then(null,(()=>n(o).then(null,(()=>{})))),o},drain:function(e){return new eo(((n,r)=>{let o=t.length;if(!o)return n(!0);const i=setTimeout((()=>{e&&e>0&&n(!1)}),e);t.forEach((e=>{Jr(e).then((()=>{--o||(clearTimeout(i),n(!0))}),r)}))}))}}}(e.bufferSize||bb)){let r={};return{send:function(o){const i=[];if(Gt(o,((t,n)=>{const o=zt(n);if(mi(r,o)){const r=wb(t,n);e.recordDroppedEvent("ratelimit_backoff",o,r)}else i.push(t)})),0===i.length)return Jr({});const a=Ht(o[0],i),s=t=>{Gt(a,((n,r)=>{const o=wb(n,r);e.recordDroppedEvent(t,zt(r),o)}))};return n.add((()=>t({body:Ut(a)}).then((e=>(void 0!==e.statusCode&&(e.statusCode<200||e.statusCode>=300)&&_t&&W.warn(`Sentry responded with status code ${e.statusCode} to sent event.`),r=pi(r,e),e)),(e=>{throw s("network_error"),e})))).then((e=>e),(e=>{if(e instanceof Rv)return _t&&W.error("Skipped sending event because buffer is full."),s("queue_overflow"),Jr({});throw e}))},flush:e=>n.drain(e)}}(e,(function(o){const i=o.body.length;n+=i,r++;const a={body:o.body,method:"POST",referrerPolicy:"origin",headers:e.headers,keepalive:n<=6e4&&r<15,...e.fetchOptions};if(!t)return vi("fetch"),Qr("No fetch implementation available");try{return t(e.url,a).then((e=>(n-=i,r--,{statusCode:e.status,headers:{"x-sentry-rate-limits":e.headers.get("X-Sentry-Rate-Limits"),"retry-after":e.headers.get("Retry-After")}})))}catch(e){return vi("fetch"),n-=i,r--,Qr(e)}}))}function _b(e={}){const t=function(e={}){const t={defaultIntegrations:[kv(),Dv(),Jv(),Zv(),rb(),ub(),Mv(),{name:"HttpContext",preprocessEvent(e){if(!po.navigator&&!po.location&&!po.document)return;const t=e.request&&e.request.url||po.location&&po.location.href,{referrer:n}=po.document||{},{userAgent:r}=po.navigator||{},o={...e.request&&e.request.headers,...n&&{Referer:n},...r&&{"User-Agent":r}},i={...e.request,...t&&{url:t},headers:o};e.request=i}}],release:"string"==typeof __SENTRY_RELEASE__?__SENTRY_RELEASE__:po.SENTRY_RELEASE&&po.SENTRY_RELEASE.id?po.SENTRY_RELEASE.id:void 0,autoSessionTracking:!0,sendClientReports:!0};return null==e.defaultIntegrations&&delete e.defaultIntegrations,{...t,...e}}(e);if(function(){const e=void 0!==po.window&&po;if(!e)return!1;const t=e[e.chrome?"chrome":"browser"],n=t&&t.runtime&&t.runtime.id,r=po.location&&po.location.href||"",o=!!n&&po===po.top&&["chrome-extension:","moz-extension:","ms-browser-extension:","safari-web-extension:"].some((e=>r.startsWith(`${e}//`))),i=void 0!==e.nw;return!!n&&!o&&!i}())return void H((()=>{console.error("[Sentry] You cannot run Sentry this way in a browser extension, check: https://docs.sentry.io/platforms/javascript/best-practices/browser-extensions/")}));Zr&&(_o()||W.warn("No Fetch API detected. The Sentry SDK requires a Fetch API compatible environment to send events. Please add a Fetch API polyfill."));const n={...t,stackParser:(r=t.stackParser||yb,Array.isArray(r)?Rt(...r):r),integrations:Fo(t),transport:t.transport||Cb};var r;const o=function(e,t){!0===t.debug&&(_t?W.enable():H((()=>{console.warn("[Sentry] Cannot initialize SDK with `debug` option using a non-debug bundle.")}))),Be().update(t.initialScope);const n=new e(t);return function(e){Be().setClient(e)}(n),n.init(),n}(Xv,n);return t.autoSessionTracking&&(void 0!==po.document?(co({ignoreDuration:!0}),mo(),$r((({from:e,to:t})=>{void 0!==e&&e!==t&&(co({ignoreDuration:!0}),mo())}))):Zr&&W.warn("Session tracking in non-browser environment with @sentry/browser is not supported.")),o}_b(dd);const kb=[];function Ab(e){if(EA!==yd.init)throw new Error("Speech hooks can be registered only during init");kb.push(e)}function Eb(e){var t,n;const r=e;e.startsWith("//")&&(e=e.substring(1));let o="Chat";o=ChatRoomTargetMemberNumber>0?"Whisper":o,o=e.startsWith("/")?"Command":o,o=e.startsWith("*")||e.startsWith("/me")||e.startsWith("/action")||(null===(t=Player.ChatSettings)||void 0===t?void 0:t.MuStylePoses)&&e.startsWith(":")&&e.length>3?"Emote":o;const i=e.replace(/\([^)]*\)*\s?/gs,""),a=e.includes("(");return(null===(n=Player.ChatSettings)||void 0===n?void 0:n.MuStylePoses)&&e.startsWith(":")?e=e.substring(1):((e=e.replace(/^\*/,"").replace(/\*$/,"")).startsWith("/me ")&&(e=e.replace("/me ","")),e.startsWith("/action ")&&(e=e.replace("/action ","*"))),{type:o,rawMessage:r,originalMessage:e=e.trim(),target:ChatRoomTargetMemberNumber,noOOCMessage:i,hasOOC:a}}function Sb(e){if(VC())return null;if(!e)return null;let t=e.originalMessage;if(console.groupCollapsed("Processing message: "+e.originalMessage),console.log("Message: "+JSON.stringify(e,null,2)),"Command"===e.type)return console.log("Command"),ud.forEach((n=>{e.rawMessage.includes(n)&&(console.log("Command "+e.rawMessage+" is forbidden"),fE("Command "+e.rawMessage+" is forbidden. Do not cheat!"),t=null)})),console.groupEnd(),t;if(1===Db(e))return console.log("Message shall be blocked."),console.groupEnd(),lw("speech_force_retype").isEnforced&&function(e){const t=document.getElementById("InputChat");t?t.value="":console.error("Chat element not found"),ChatRoomLastMessage.length>0&&ChatRoomLastMessage.at(-1)===e&&(ChatRoomLastMessage.splice(ChatRoomLastMessage.length-1,1),ChatRoomLastMessageIndex=Math.min(ChatRoomLastMessageIndex,ChatRoomLastMessage.length))}(e.rawMessage),null;for(const n of kb)n.modify&&(console.log("Message shall be modified."),t=n.modify(e,t));if(0===Db(e))for(const n of kb)n.onSend&&(console.log("Send message"),n.onSend(e,t));return console.groupEnd(),t}function Db(e){let t=0;for(const n of kb)if(n.allowSend){const r=n.allowSend(e);2===r?(console.log("--\x3e Message hook: allow"),t=2):1===r&&0===t&&(console.log("--\x3e Message hook: block"),t=1)}return t}const Mb=Oy.object({memberNumber:Oy.number(),nickname:Oy.string().refine(Nb),enforceNickname:Oy.boolean()}),xb=20;function Nb(e){return e.trim()===e&&e.length>0&&e.length<=xb&&ServerCharacterNicknameRegex.test(e)}function Ib(e){const t=e;return Ed(t)&&"number"==typeof t.memberNumber&&"string"==typeof t.nickname&&Nb(t.nickname)&&"boolean"==typeof t.enforceNickname}function Rb(e){if(e instanceof UA&&(e=e.MemberNumber),null!=e&&AA(md.Relationships)&&tA.relationships){const t=tA.relationships.find((t=>t.memberNumber===e));if(t)return t.nickname}return null}let Lb=null,Tb=!1,Pb=0;function Bb(){return null!=CurrentCharacter&&(null!=Player.FocusGroup||null!=CurrentCharacter&&null!=CurrentCharacter.FocusGroup&&CurrentCharacter.AllowItem)&&""!==DialogIntro()&&("items"===DialogMenuMode||"permissions"===DialogMenuMode)}function Ob(e,t){var n;if(!Lb){Lb=ElementCreateInput("BCXSearch","text","","40"),Lb.oninput=()=>{Lb&&(Tb&&!Lb.value?($b(e),MainCanvas.canvas.focus()):(DialogInventoryBuild(e),DialogMenuButtonBuild(e)))},Lb.focus(),Lb.setAttribute("value",null!=t?t:"");const r=null!==(n=null==t?void 0:t.length)&&void 0!==n?n:0;Lb.setSelectionRange(r,r),DialogInventoryBuild(e),DialogMenuButtonBuild(e)}}function $b(e){Lb&&(Lb.remove(),Lb=null,Tb=!1,DialogInventoryBuild(e),DialogMenuButtonBuild(e))}function Fb(){return DialogMenuButton}const Hb={};function Wb(e){return Array.isArray(tA.cheats)&&tA.cheats.includes(e)}function Gb(e,t){Array.isArray(tA.cheats)?(t?tA.cheats.includes(e)||tA.cheats.push(e):tA.cheats=tA.cheats.filter((t=>t!==e)),Hb[e]&&Hb[e](t),sA()):console.error("HardCoreClub: Attempt to set cheat, while not initalized")}function jb(e){Gb(e,!Wb(e))}const Ub=["MistressPadlock","MistressPadlockKey","MistressTimerPadlock"],Yb=["PandoraPadlock","PandoraPadlockKey"],qb=new Map;function Xb(e,t){qb.set(e,t)}const zb=new Map;function Vb(e,t){zb.set(e,t)}const Zb=new Map;function Kb(e,t){let n=Zb.get(e);n||(n=[],Zb.set(e,n)),n.includes(t)||n.push(t)}const Jb=[],Qb=[];function ew(e,t,n=!0){for(let r of e){r=r.toLocaleLowerCase();let e=!0,o=-1,i=n;for(const n of t)if(/\p{L}/giu.test(n))if(n===r[(o+1)%r.length])o=(o+1)%r.length,o===r.length-1&&(i=!0);else if(n!==r[o]){e=!1;break}if(e&&i)return!0}return!1}_b(dd);const tw={0:a,1:"Icons/Swap.png",2:"Icons/Preference.png",3:o,4:"Icons/Chat.png",99:"Icons/Chest.png"};function nw(e){return"string"==typeof e&&ow.has(e)}function rw(e,t){const n=ow.get(e);if(!n)return!1;if(n.dataDefinition){if(!Ed(t))return!1;for(const e of Object.keys(t))if(!n.dataDefinition[e])return!1;for(const[e,r]of Object.entries(n.dataDefinition)){const n=dw[r.type];if(!n||!n.validate(t[e],r))return!1}}else if(void 0!==t)return!1;return!0}const ow=new Map,iw=[];function aw(e,t){var n;if(EA!==yd.init)throw new Error("Rules can be registered only during init");if(ow.has(e))throw new Error(`Rule "${e}" already defined!`);if(t.dataDefinition)for(const[n,r]of Object.entries(t.dataDefinition)){const t=dw[r.type];if(!t)throw new Error(`Unknown handler for ${e}:${n} (${r.type})`);if(t.validateOptions&&!t.validateOptions(r.options))throw new Error(`Bad options for ${e}:${n} (${r.type})`);const o="function"==typeof r.default?r.default():r.default;if(!t.validate(o,r))throw new Error(`Default doesn't validate for ${e}:${n} (${r.type})`)}if(t.internalDataValidate){if(!t.internalDataValidate(null===(n=t.internalDataDefault)||void 0===n?void 0:n.call(t)))throw new Error(`Default internal data doesn't validate for rule ${e}`)}else if(void 0!==t.internalDataDefault)throw new Error(`Default internal data for rule ${e} without internal data validation`);ow.set(e,{...t,state:new fw(e,t)}),iw.push(e)}function sw(e){const t=ow.get(e);if(!t)throw new Error(`Attempt to get display definition for unknown rule '${e}'`);return{name:t.name,type:t.type,shortDescription:t.shortDescription,keywords:t.keywords,longDescription:t.longDescription,triggerTexts:t.triggerTexts,defaultLimit:t.defaultLimit,enforceable:t.enforceable,loggable:t.loggable,dataDefinition:t.dataDefinition}}function lw(e){const t=ow.get(e);if(!t)throw new Error(`Attempt to get state for unknown rule '${e}'`);return t.state}const cw=new Map;let uw=null;const dw={listSelect:{validateOptions:e=>Array.isArray(e)&&e.every((e=>Array.isArray(e)&&2===e.length&&e.every((e=>"string"==typeof e)))),validate:(e,t)=>"string"==typeof e&&t.options.map((e=>e[0])).includes(e),run({def:e,value:t,Y:n,access:r}){DrawTextFit(e.description,1050,n+0,900,"Black");const o=e.options.findIndex((e=>e[0]===t));if(o<0)throw new Error("Bad data during listSelect render");const i=Ld(o+1,0,e.options.length-1),a=Ld(o-1,0,e.options.length-1);MainCanvas.textAlign="center",DrawBackNextButton(1050,n+36,250,60,e.options[o][1],r?"White":"#ddd","",(()=>e.options[a][1]),(()=>e.options[i][1]),!r),MainCanvas.textAlign="left"},click({def:e,value:t,Y:n,access:r}){if(!r)return;const o=e.options.findIndex((e=>e[0]===t));return MouseIn(1050,n+36,125,60)?e.options[Ld(o-1,0,e.options.length-1)][0]:MouseIn(1175,n+36,125,60)?e.options[Ld(o+1,0,e.options.length-1)][0]:void 0}},memberNumberList:{validateOptions:e=>void 0===e||Number.isInteger(null==e?void 0:e.pageSize),validate:e=>Array.isArray(e)&&e.every(Number.isInteger),onDataChange({active:e,key:t,access:n}){let r=document.getElementById(`BCX_RCDH_${t}`);e?(r||(r=ElementCreateInput(`BCX_RCDH_${t}`,"text","","100"),r.inputMode="numeric",r.pattern="[0-9]+",null!==uw&&(r.value=`${uw}`,uw=null)),r.disabled=!n):r&&r.remove()},run({def:e,value:t,Y:n,key:r,access:o}){var i,a;n-=20;const s=(null===(i=e.options)||void 0===i?void 0:i.pageSize)?e.options.pageSize:4,l=Math.max(1,Math.ceil(t.length/s)),c=Rd(null!==(a=cw.get(r))&&void 0!==a?a:0,0,l-1);DrawTextFit(e.description,1050,n+0,900,"Black");for(let e=0;e<s;e++){const r=c*s+e;if(r>=t.length)break;DrawEmptyRect(1050,n+26+70*e,766,64,"black");const i=`${ME(t[r],"[unknown]")} (${t[r]})`;DrawTextFit(i,1060,n+26+70*e+34,380,"Black"),o&&(MainCanvas.textAlign="center",DrawButton(1836,n+26+70*e,64,64,"X","White"),MainCanvas.textAlign="left")}ElementPositionFix(`BCX_RCDH_${r}`,40,1050,n+70*s+43,360,60),MainCanvas.textAlign="center";const u=document.getElementById(`BCX_RCDH_${r}`);u&&document.activeElement===u&&DrawHoverElements.push((()=>{const e=u.value&&Number.parseInt(u.value,10);e&&(DrawRect(580,630,450,65,"#FFFF88"),DrawEmptyRect(580,630,450,65,"black",2),DrawTextFit(ME(e,"[unknown]"),805,663,444,"black"))})),DrawButton(1444,n+70*s+43,64,64,"",o?"White":"#ddd",void 0,void 0,!o),CE("Icons/Title.png",1446,n+70*s+43,{Width:60,Height:60}),DrawButton(1530,n+70*s+43,100,64,"Add",o?"White":"#ddd",void 0,void 0,!o),DrawBackNextButton(1650,n+70*s+43,250,64,`Page ${c+1}/${l}`,"White",void 0,(()=>""),(()=>"")),MainCanvas.textAlign="left"},click({value:e,Y:t,key:n,target:r,def:o,access:i}){var a,s;t-=20;const l=(null===(a=o.options)||void 0===a?void 0:a.pageSize)?o.options.pageSize:4,c=Math.max(1,Math.ceil(e.length/l)),u=Rd(null!==(s=cw.get(n))&&void 0!==s?s:0,0,c-1);for(let n=0;n<l;n++){const r=u*l+n;if(r>=e.length)break;if(i&&MouseIn(1836,t+26+70*n,64,64))return e.splice(r,1),e}const d=document.getElementById(`BCX_RCDH_${n}`),h=Gk();if(i&&MouseIn(1444,t+70*l+43,64,64)&&d&&h&&jk(new Np(r,h,(e=>{uw=e}),e.slice())),i&&MouseIn(1530,t+70*l+43,100,64)&&d&&d.value){const t=Number.parseInt(d.value,10);if(Number.isInteger(t)&&!e.includes(t))return e.push(t),e.sort(((e,t)=>e-t)),d.value="",e}MouseIn(1650,t+70*l+43,125,64)&&u>0?cw.set(n,u-1):MouseIn(1775,t+70*l+43,125,64)&&u+1<c&&cw.set(n,u+1)},unload({key:e}){ElementRemove(`BCX_RCDH_${e}`),cw.delete(e)}},number:{validateOptions:e=>void 0===e||Ed(e)&&(void 0===e.min||Number.isInteger(e.min))&&(void 0===e.max||Number.isInteger(e.max)),validate:(e,t)=>{var n,r;return"number"==typeof e&&Number.isInteger(e)&&(void 0===(null===(n=t.options)||void 0===n?void 0:n.min)||e>=t.options.min)&&(void 0===(null===(r=t.options)||void 0===r?void 0:r.max)||e<=t.options.max)},onDataChange({active:e,key:t,onInput:n,value:r,access:o}){let i=document.getElementById(`BCX_RCDH_${t}`);e?(i?i.value=r.toString(10):(i=ElementCreateInput(`BCX_RCDH_${t}`,"text",r.toString(10),"50"),i.inputMode="numeric",i.pattern="[0-9]+",i.oninput=n),i.onblur=()=>{i&&(i.value=r.toString(10))},i.disabled=!o):i&&i.remove()},processInput({key:e,value:t,def:n}){var r,o,i,a;const s=document.getElementById(`BCX_RCDH_${e}`);if(s&&s.value){if(/^[0-9]+$/.test(s.value)){const e=Rd(Number.parseInt(s.value,10),null!==(o=null===(r=n.options)||void 0===r?void 0:r.min)&&void 0!==o?o:-1/0,null!==(a=null===(i=n.options)||void 0===i?void 0:i.max)&&void 0!==a?a:1/0);return s.onblur=()=>{s.value=e.toString(10)},e}s.value=t.toString(10)}},run({def:e,Y:t,key:n}){DrawTextFit(e.description,1050,t+0,850,"Black"),ElementPositionFix(`BCX_RCDH_${n}`,40,1050,t+26,425,60)},unload({key:e}){ElementRemove(`BCX_RCDH_${e}`)}},poseSelect:{validate:e=>Array.isArray(e)&&e.every((e=>"string"==typeof e)),run({def:e,value:t,Y:n,access:r}){DrawTextFit(e.description,1050,n+0,900,"Black");const o=PoseFemale3DCG.filter((e=>e.AllowMenu||e.AllowMenuTransient)).map((e=>e.Category)).filter(((e,t,n)=>e&&n.indexOf(e)===t)).map((e=>PoseFemale3DCG.filter((t=>(t.AllowMenu||t.AllowMenuTransient)&&t.Category===e))));for(let e=0;e<o.length;e++){const i=n+60+140*e,a=o[e];for(let e=0;e<a.length;e++){const n=1070+100*e,o=t.includes(a[e].Name);DrawButton(n,i,90,90,"",o?r?"Darkred":"#333":r?"White":"#ddd","Icons/Poses/"+a[e].Name+".png","",!r)}}},click({value:e,Y:t,access:n}){if(!n)return;const r=PoseFemale3DCG.filter((e=>e.AllowMenu||e.AllowMenuTransient)).map((e=>e.Category)).filter(((e,t,n)=>e&&n.indexOf(e)===t)).map((e=>PoseFemale3DCG.filter((t=>(t.AllowMenu||t.AllowMenuTransient)&&t.Category===e))));for(let n=0;n<r.length;n++){const o=t+60+140*n,i=r[n];for(let t=0;t<i.length;t++)if(MouseIn(1070+100*t,o,90,90))return e.includes(i[t].Name)?e.splice(e.indexOf(i[t].Name),1):e.push(i[t].Name),e}}},roleSelector:{validate:e=>"number"==typeof e&&void 0!==xA[e],run({def:e,value:t,Y:n,access:r}){DrawTextFit(e.description,1050,n+0,900,"Black");const o=t<xA.public?t+1:xA.clubowner,i=t>xA.clubowner?t-1:xA.public;MainCanvas.textAlign="center",DrawBackNextButton(1050,n+46,250,60,Nd(xA[t])+(t!==xA.clubowner?" ":""),r?"White":"#ddd","",(()=>Nd(xA[i])),(()=>Nd(xA[o])),!r),MainCanvas.textAlign="left"},click({value:e,Y:t,access:n}){if(n)return MouseIn(1050,t+46,125,60)?e>xA.clubowner?e-1:xA.public:MouseIn(1175,t+46,125,60)?e<xA.public?e+1:xA.clubowner:void 0}},string:{validateOptions:e=>void 0===e||e instanceof RegExp,validate:(e,t)=>"string"==typeof e&&(!t.options||t.options.test(e)),onDataChange({active:e,key:t,onInput:n,value:r,access:o,def:i}){let a=document.getElementById(`BCX_RCDH_${t}`);if(e){if(a)a.value=r;else{let e=r;const o=ElementCreateInput(`BCX_RCDH_${t}`,"text",e,"160");o.oninput=()=>{!i.options||i.options.test(o.value)?(e=o.value,n()):o.value=e},a=o}a.disabled=!o}else a&&a.remove()},processInput({key:e,def:t}){const n=document.getElementById(`BCX_RCDH_${e}`);return!n||t.options&&!t.options.test(n.value)?void 0:n.value},run({def:e,Y:t,key:n}){DrawTextFit(e.description,1050,t+0,850,"Black"),ElementPositionFix(`BCX_RCDH_${n}`,40,1050,t+26,850,60)},unload({key:e}){ElementRemove(`BCX_RCDH_${e}`)}},stringList:{validateOptions:e=>void 0===e||Ed(e)&&(void 0===e.validate||e.validate instanceof RegExp),validate:(e,t)=>Array.isArray(e)&&e.length<=128&&e.every((e=>{var n;return"string"==typeof e&&(!(null===(n=t.options)||void 0===n?void 0:n.validate)||t.options.validate.test(e))})),onDataChange({active:e,key:t,access:n,def:r}){let o=document.getElementById(`BCX_RCDH_${t}`);if(e){if(!o){let e="";const n=ElementCreateInput(`BCX_RCDH_${t}`,"text","","120");n.oninput=()=>{var t;(null===(t=r.options)||void 0===t?void 0:t.validate)&&!r.options.validate.test(n.value)?(1===n.value.length&&r.options.validate.test("")&&(e=""),n.value=e):e=n.value},o=n}o.disabled=!n}else o&&o.remove()},run({def:e,value:t,Y:n,key:r,access:o}){var i,a,s;n-=20;const l=null!==(a=null===(i=e.options)||void 0===i?void 0:i.pageSize)&&void 0!==a?a:4,c=Math.max(1,Math.ceil(t.length/l)),u=Rd(null!==(s=cw.get(r))&&void 0!==s?s:0,0,c-1);DrawTextFit(e.description,1050,n+0,900,"Black");for(let e=0;e<l;e++){const r=u*l+e;if(r>=t.length)break;const i=t[r];MouseIn(1050,n+26+70*e,766,64)&&DrawHoverElements.push((()=>{MainCanvas.save(),DrawRect(1050,n+26,766,70*l,"rgba(255, 255, 136, 0.9)"),DrawEmptyRect(1050,n+26,766,70*l,"Black"),MainCanvas.textAlign="left",DrawTextWrap(i+"   -   [click to copy into the empty input text field]",677,n+30,756,70*l-10,"black",void 0,5),MainCanvas.restore()})),DrawEmptyRect(1050,n+26+70*e,766,64,"black"),DrawTextFit(i.length>61?i.substring(0,60)+"":i,1060,n+26+70*e+34,750,"Black"),o&&(MainCanvas.textAlign="center",DrawButton(1836,n+26+70*e,64,64,"X","White"),MainCanvas.textAlign="left")}ElementPositionFix(`BCX_RCDH_${r}`,40,1050,n+70*l+43,450,60),MainCanvas.textAlign="center",DrawButton(1530,n+70*l+43,100,64,"Add",o?"White":"#ddd",void 0,void 0,!o),DrawBackNextButton(1650,n+70*l+43,250,64,`Page ${u+1}/${c}`,"White",void 0,(()=>""),(()=>"")),MainCanvas.textAlign="left"},click({value:e,Y:t,key:n,def:r,access:o}){var i,a,s,l;t-=20;const c=null!==(a=null===(i=r.options)||void 0===i?void 0:i.pageSize)&&void 0!==a?a:4,u=Math.max(1,Math.ceil(e.length/c)),d=Rd(null!==(s=cw.get(n))&&void 0!==s?s:0,0,u-1),h=document.getElementById(`BCX_RCDH_${n}`);for(let n=0;n<c;n++){const r=d*c+n;if(r>=e.length)break;if(o&&MouseIn(1050,t+26+70*n,766,64)&&h&&""===h.value&&(h.value=e[r]),o&&MouseIn(1836,t+26+70*n,64,64))return e.splice(r,1),e}if(o&&MouseIn(1530,t+70*c+43,100,64)&&h&&h.value&&(!(null===(l=r.options)||void 0===l?void 0:l.validate)||r.options.validate.test(h.value))&&!e.includes(h.value))return e.length>=128?void fE("Reached the max. number of entries - please delete one first",1e4):(e.push(h.value),e.sort(),h.value="",e);MouseIn(1650,t+70*c+43,125,64)&&d>0?cw.set(n,d-1):MouseIn(1775,t+70*c+43,125,64)&&d+1<u&&cw.set(n,d+1)},unload({key:e}){ElementRemove(`BCX_RCDH_${e}`),cw.delete(e)}},textArea:{validate:e=>"string"==typeof e,onDataChange({active:e,key:t,onInput:n,value:r,access:o}){let i=document.getElementById(`BCX_RCDH_${t}`);e?(i?i.value=r:(i=document.createElement("textarea"),i.id=`BCX_RCDH_${t}`,i.name=`BCX_RCDH_${t}`,i.value=r,i.maxLength=1e4,i.setAttribute("screen-generated",CurrentScreen),i.className="HideOnPopup",i.oninput=n,document.body.appendChild(i)),i.disabled=!o):i&&i.remove()},processInput({key:e}){const t=document.getElementById(`BCX_RCDH_${e}`);return t?t.value:void 0},run({def:e,Y:t,key:n}){DrawTextFit(e.description,1e3,t+0,900,"Black");const r=document.getElementById(`BCX_RCDH_${n}`);r&&document.activeElement===r?ElementPositionFix(`BCX_RCDH_${n}`,36,105,170,1790,750):ElementPositionFix(`BCX_RCDH_${n}`,28,1e3,t+26,900,765-t)},unload({key:e}){ElementRemove(`BCX_RCDH_${e}`)}},toggle:{validate:e=>"boolean"==typeof e,run({def:e,value:t,Y:n,access:r}){DrawCheckbox(1050,n,64,64,e.description,t,!r)},click({value:e,Y:t,access:n}){if(n)return MouseIn(1050,t,64,64)?!e:void 0}}};function hw(e,t){e=e.toLocaleLowerCase();const n=Array.from(ow.entries()).filter((e=>!t||t(e[0]))).find((([t,n])=>t.toLocaleLowerCase()===e||n.name.toLocaleLowerCase()===e));return n?[!0,n[0]]:[!1,`Unknown rule "${e}".`]}function mw(){return iw.map((e=>[e,sw(e)]))}function pw(e,t){if(!AA(md.Rules))return!1;if(t&&!sC("rules",e,t))return!1;const n=sw(e);return lC("rules",e)&&t&&(lv("rule_change",av.plaintext,`${t} removed the rule: ${n.name}`),t.isPlayer()||yE(`${t.toNicknamedString()} removed your rule "${n.name}"`)),!0}class fw{get condition(){return oC("rules",this.rule)}get inEffect(){return function(e,t){var n;if(!Qw(e))return!1;const r=eC(e),o=r.conditions[t];return!!o&&(!(void 0!==o.timer&&o.timer<=Date.now())&&(!!o.active&&!!mC(null!==(n=o.requirements)&&void 0!==n?n:r.requirements)))}("rules",this.rule)}get isEnforced(){const e=this.condition;return!(!e||!this.inEffect)&&!1!==e.data.enforce}get isLogged(){const e=this.condition;return!(!e||!this.inEffect)&&!1!==e.data.log}get customData(){var e;return null===(e=this.condition)||void 0===e?void 0:e.data.customData}get internalData(){var e;return kp(null===(e=this.condition)||void 0===e?void 0:e.data.internalData)}set internalData(e){const t=this.condition;t&&!zp(t.data.internalData,e)&&(t.data.internalData=e,sA())}constructor(e,t){this.rule=e,this.ruleDefinition=t}trigger(e=null,t={}){var n,r,o;const i=this.ruleDefinition.triggerTexts;if(i){let a=CharacterNickname(Player);if(null!=e){const t=XA(e);a=t?CharacterNickname(t.Character):ME(e,"[unknown]")}if(i.infoBeep&&fE("HardCoreClub: "+Pd(i.infoBeep,{PLAYER_NAME:null!==(n=Rb(Player.MemberNumber))&&void 0!==n?n:CharacterNickname(Player),TARGET_PLAYER:null!==(r=Rb(null!=e?e:Player.MemberNumber))&&void 0!==r?r:a,...t}),7e3),this.isLogged){i.log&&lv("rule_trigger",av.ruleTrigger,[this.rule,t]);const n=null!==(o=i.announce)&&void 0!==o?o:i.log;n&&gE(`${Pd(n,{PLAYER_NAME:"SourceCharacter",TARGET_PLAYER:`TargetCharacterName (${null!=e?e:Player.MemberNumber})`,...t})}.`,null,[{Tag:"SourceCharacter",MemberNumber:Player.MemberNumber,Text:CharacterNickname(Player)},{Tag:"TargetCharacterName",MemberNumber:null!=e?e:Player.MemberNumber,Text:a}])}}Fy.emitEvent("ruleTrigger",{rule:this.rule,triggerType:"trigger",targetCharacter:e})}triggerAttempt(e=null,t={}){var n,r,o,i;const a=this.ruleDefinition.triggerTexts;if(a){let s=CharacterNickname(Player);if(null!=e){const t=XA(e);s=t?CharacterNickname(t.Character):ME(e,"[unknown]")}const l=null!==(n=a.attempt_infoBeep)&&void 0!==n?n:a.infoBeep;if(l&&fE("HardCoreClub: "+Pd(l,{PLAYER_NAME:null!==(r=Rb(Player.MemberNumber))&&void 0!==r?r:CharacterNickname(Player),TARGET_PLAYER:null!==(o=Rb(null!=e?e:Player.MemberNumber))&&void 0!==o?o:s,...t}),7e3),this.isLogged){a.attempt_log&&lv("rule_trigger",av.ruleTriggerAttempt,[this.rule,t]);const n=null!==(i=a.attempt_announce)&&void 0!==i?i:a.attempt_log;n&&gE(`${Pd(n,{PLAYER_NAME:"SourceCharacter",TARGET_PLAYER:`TargetCharacterName (${null!=e?e:Player.MemberNumber})`,...t})}.`,null,[{Tag:"SourceCharacter",MemberNumber:Player.MemberNumber,Text:CharacterNickname(Player)},{Tag:"TargetCharacterName",MemberNumber:null!=e?e:Player.MemberNumber,Text:s}])}}Fy.emitEvent("ruleTrigger",{rule:this.rule,triggerType:"triggerAttempt",targetCharacter:e})}}const gw=["utility","cheats","modules","commands"],yw="The command failed to execute, likely because you are lacking the permission to give it.",vw=new Map,bw=new Map;let ww=null;function Cw(e,t,n,r,o=null){if(t=t.toLocaleLowerCase(),vw.has(t))throw new Error(`Command "${t}" already registered!`);vw.set(t,{parse:!1,callback:r,autocomplete:o,category:e,description:n})}function _w(e,t){e=e.toLocaleLowerCase(),t=t.toLocaleLowerCase();const n=vw.get(e);if(!n)throw new Error(`Command "${e}" to alias not found`);n.parse?vw.set(t,{parse:!0,category:n.category,description:null,callback:n.callback,autocomplete:n.autocomplete}):vw.set(t,{parse:!1,category:n.category,description:null,callback:n.callback,autocomplete:n.autocomplete})}function kw(e,t,n,r,o=null){if(t=t.toLocaleLowerCase(),vw.has(t))throw new Error(`Command "${t}" already registered!`);vw.set(t,{parse:!0,callback:r,autocomplete:o,category:e,description:n})}function Aw(e,t,n,r,o=null,i=!0){if(t=t.toLocaleLowerCase(),i&&kw(e,t,n,(e=>(r(e,VA(),(e=>yE(e))),!0)),o?e=>o(e,VA()):null),bw.has(t))throw new Error(`Command "${t}" already registered!`);bw.set(t,{callback:r,autocomplete:o,category:e,description:n})}function Ew(e){e=e.trimStart();const t=/^(\S+)(?:\s|$)(.*)$/.exec(e);return t?[(t[1]||"").toLocaleLowerCase(),t[2]]:["",""]}function Sw(e){return[...e.matchAll(/".*?(?:"|$)|'.*?(?:'|$)|[^ ]+/g)].map((e=>e[0])).map((e=>'"'===e[0]||"'"===e[0]?e.substring(1,e.length>1&&e[e.length-1]===e[0]?e.length-1:e.length):e))}function Dw(e){const t=Sw(e);return 0===t.length||!e.endsWith(t[t.length-1])}function Mw(e){return e.includes(" ")||e.includes('"')||e.startsWith("'")}function xw(e,t=!1){return e.startsWith('"')?`'${e}'`:e.startsWith("'")?`"${e}"`:e.includes(" ")||t?e.includes('"')?`'${e}'`:`"${e}"`:e}let Nw=null,Iw=null,Rw=null,Lw=[],Tw=0;function Pw(){Nw&&(Nw.remove(),Nw=null),Iw=null,Rw=null}function Bw(e,t,n){if(Pw(),t.length>0){const r=document.createElement("div");r.innerText+=`[${e}]\n`;for(let e=0;e<t.length;e++){const o=document.createElement("div");o.innerText=t[e],e===n&&(o.style.background="#7e7eff54"),r.appendChild(o)}Nw=yE(r,1e4)}}function Ow(e,t){return e.isPlayer()?t.replace(/^!/gm,"."):t}function $w(e,t){return e=e.toLocaleLowerCase(),t.filter((t=>t.toLocaleLowerCase().startsWith(e)))}function Fw(e){const t=zA();if(/^[0-9]+$/.test(e)){const n=Number.parseInt(e,10),r=t.find((e=>e.MemberNumber===n));return r||`Player #${n} not found in the room.`}let n=t.filter((t=>t.Name===e||Nb(t.Nickname)&&t.Nickname===e));return 0===n.length&&(n=t.filter((t=>t.Name.toLowerCase()===e.toLowerCase()||Nb(t.Nickname)&&t.Name.toLowerCase()===e.toLowerCase()))),1===n.length?n[0]:0===n.length?`Player "${e}" not found in the room.`:`Multiple players match "${e}". Please use Member Number instead.`}function Hw(e,t=!0){const n=Fw(e);return"string"==typeof n&&t&&/^[0-9]+$/.test(e)?Number.parseInt(e,10):"string"==typeof n?n:n.MemberNumber}function Ww(e){const t=zA();return/^[0-9]+$/.test(e)?t.map((e=>{var t;return null===(t=e.MemberNumber)||void 0===t?void 0:t.toString(10)})).filter((t=>null!=t&&t.startsWith(e))):t.flatMap((e=>Nb(e.Nickname)&&e.Nickname.toLowerCase()!==e.Name.toLowerCase()?[e.Nickname,e.Name]:[e.Name])).filter((t=>t.toLocaleLowerCase().startsWith(e.toLowerCase())))}function Gw(e,t,n=DE){const r=e.Character.Appearance.filter((e=>n(e)));let o=r.filter((e=>e.Asset.Group.Name.toLocaleLowerCase()===t.toLocaleLowerCase()));return 0===o.length&&(o=r.filter((e=>pE(e.Asset.Group).toLocaleLowerCase()===t.toLocaleLowerCase()))),0===o.length&&(o=r.filter((e=>e.Asset.Name.toLocaleLowerCase()===t.toLocaleLowerCase()))),0===o.length&&(o=r.filter((e=>e.Asset.Description.toLocaleLowerCase()===t.toLocaleLowerCase()))),1===o.length?o[0]:0===o.length?`Item "${t}" not found on character ${e}. If your item(group) consists of more than one word, please put it in quotes, such as "lower leg".`:"Multiple items match, please use group name instead. (eg. arms)"}function jw(e,t,n=DE){const r=e.Character.Appearance.filter((e=>n(e)));let o=xd(r.map((e=>pE(e.Asset.Group))).concat(r.map((e=>e.Asset.Description)))).filter((e=>e.toLocaleLowerCase().startsWith(t.toLocaleLowerCase())));return 0===o.length&&(o=xd(r.map((e=>e.Asset.Group.Name)).concat(r.map((e=>e.Asset.Name)))).filter((e=>e.toLocaleLowerCase().startsWith(t.toLocaleLowerCase())))),o}function Uw(e,t,n){let r=AssetGroup.filter((t=>t.Name.toLocaleLowerCase()===e.toLocaleLowerCase()&&t.AllowCustomize&&(!n||n(t))));if(0===r.length&&(r=AssetGroup.filter((t=>pE(t).toLocaleLowerCase()===e.toLocaleLowerCase()&&(!n||n(t))))),r.length>1)return`Multiple groups match "${e}", please report this as a bug.`;if(1===r.length)return r[0];if(t){const r=Gw(t,e,(e=>!n||n(e.Asset.Group)));return"string"==typeof r?r:r.Asset.Group}return`Unknown group "${e}".`}function Yw(e,t,n){const r=t?t.Character.Appearance:[];let o=xd(AssetGroup.filter((e=>e.AllowCustomize&&(!n||n(e)))).map((e=>pE(e))).concat(r.filter((e=>!n||n(e.Asset.Group))).map((e=>e.Asset.Description)))).filter((t=>t.toLocaleLowerCase().startsWith(e.toLocaleLowerCase())));return 0===o.length&&(o=xd(AssetGroup.filter((e=>e.AllowCustomize&&(!n||n(e)))).map((e=>e.Name)).concat(r.filter((e=>!n||n(e.Asset.Group))).map((e=>e.Asset.Name)))).filter((t=>t.toLocaleLowerCase().startsWith(e.toLocaleLowerCase())))),o}function qw(e){const t=/^([0-9]+)([a-z]+)$/.exec(e.toLocaleLowerCase());if(!t)return`Unknown time format "${e}", please use format 'number+unit' (e.g. 23h 30m)`;const n=Number.parseInt(t[1],10),r=t[2];return["d","day","days"].includes(r)?24*n*60*60*1e3:["h","hour","hours"].includes(r)?60*n*60*1e3:["m","min","minute","minutes"].includes(r)?60*n*1e3:["s","sec","second","seconds"].includes(r)?1e3*n:`Unknown time unit "${r}", please use one of:\nd (day), h (hour), m (minute), s (second)`}const Xw=Oy.lazy((()=>Oy.object({orLogic:Oy.literal(!0).optional(),room:Oy.object({type:Oy.enum(["public","private"]),inverted:Oy.literal(!0).optional()}).optional(),roomName:Oy.object({name:Oy.string(),inverted:Oy.literal(!0).optional()}).optional(),role:Oy.object({role:Oy.nativeEnum(xA),inverted:Oy.literal(!0).optional()}).optional(),player:Oy.object({memberNumber:Oy.number(),inverted:Oy.literal(!0).optional()}).optional()})));function zw(e){return Ed(e)&&(void 0===e.orLogic||!0===e.orLogic)&&(void 0===e.room||Ed(e.room)&&(void 0===e.room.inverted||!0===e.room.inverted)&&("public"===e.room.type||"private"===e.room.type))&&(void 0===e.roomName||Ed(e.roomName)&&(void 0===e.roomName.inverted||!0===e.roomName.inverted)&&"string"==typeof e.roomName.name)&&(void 0===e.role||Ed(e.role)&&(void 0===e.role.inverted||!0===e.role.inverted)&&"number"==typeof e.role.role&&void 0!==xA[e.role.role])&&(void 0===e.player||Ed(e.player)&&(void 0===e.player.inverted||!0===e.player.inverted)&&"number"==typeof e.player.memberNumber)}function Vw(e,t,n){const r=n,o=Zw.get(e);return!!o&&o.loadValidateConditionKey(t)&&Ed(r)&&"boolean"==typeof r.active&&"boolean"==typeof r.favorite&&(null===r.timer||"number"==typeof r.timer)&&"boolean"==typeof r.timerRemove&&(null===r.requirements||zw(r.requirements))&&(void 0===r.addedBy||Number.isInteger(r.addedBy))&&o.validatePublicData(t,r.data)}const Zw=new Map;function Kw(e,t){if(EA!==yd.init)throw new Error("Conditions categories can be registered only during init");if(Zw.has(e))throw new Error(`Conditions categories "${e}" already defined!`);if(Zw.set(e,t),null!=t.permission_configure&&t.currentExportImport){const n=t.currentExportImport;ev({category:`${e}Current`,name:`${pd[t.category]}`,module:t.category,export:()=>{const r=nC(e),o=eC(e).conditions,i={};for(const[e,r]of Sd(o)){if(!r)continue;const o=tC(t,e,r,null);i[e]={...If(o,"active","timer","timerRemove","requirements","favorite"),data:n.export(e,r.data)}}return{categoryConfig:r,conditions:i}},import:(r,o)=>{let i="";hC(e,r.categoryConfig,o)||(i+="Failed to set global config!\n");const a=eC(e).conditions;for(const e of Object.keys(a))if(null==r.conditions[e]){const r=n.importRemove(e,o);if(!0!==r)return i+`Failed to remove ${t.commandConditionSelectorHelp} "${e}": ${r}\nFailed!\n`}for(const[a,s]of Object.entries(r.conditions)){const r=a;if(null==s)continue;if(!t.loadValidateConditionKey(r)){i+=`Skipped unknown ${t.commandConditionSelectorHelp}: "${r}"\n`;continue}if(aC(e,r)===bd.blocked){i+=`Skipped blocked ${t.commandConditionSelectorHelp} "${r}"\n`;continue}const[l,c]=n.import(r,s.data,o);if(!l){i+=`Failed to load ${t.commandConditionSelectorHelp} "${r}": ${c}\n`;continue}let u=kp(oC(e,r));if(u&&zp(u.data,c)||(iC(e,r,c,o),n.importLog(r,c,o),u=kp(oC(e,r))),!uC(e,r,s)){i+=`Failed to load ${t.commandConditionSelectorHelp} "${r}": Error updating base data\n`;continue}const d=oC(e,r);u&&d&&o&&t.logConditionUpdate(r,o,tC(t,r,d,null),tC(t,r,u,null))}return i+"Done!"},importPermissions:[t.permission_configure,t.permission_normal,t.permission_limited],importValidator:Oy.object({categoryConfig:Oy.object({requirements:Xw,timer:Oy.number().nullable(),timerRemove:Oy.boolean(),data:Oy.custom((e=>t.validateCategorySpecificGlobalData(e)))}),conditions:Oy.record(Oy.object({active:Oy.boolean(),data:Oy.unknown().optional(),timer:Oy.number().nullable(),timerRemove:Oy.boolean(),requirements:Xw.nullable(),favorite:Oy.boolean()}))})})}ev({category:`${e}Limits`,name:`${pd[t.category]} - Limits`,module:t.category,export:()=>eC(e).limits,import:(n,r)=>{let o="";for(const[i,a]of Object.entries(n))null!=a&&(t.loadValidateConditionKey(i)?cC(e,i,a,r)||(o+=`Failed to set limit for "${i}"\n`):o+=`Skipped unknown ${t.commandConditionSelectorHelp}: "${i}"\n`);return o+"Done!"},importPermissions:[t.permission_changeLimits],importValidator:Oy.record(Oy.nativeEnum(bd))})}function Jw(e){const t=Zw.get(e);if(!t)throw new Error(`No handler for conditions category ${e}`);return t}function Qw(e){return AA(Jw(e).category)}function eC(e){var t;if(!Zw.has(e))throw new Error(`Attempt to get unknown conditions category data ${e}`);const n=null===(t=tA.conditions)||void 0===t?void 0:t[e];if(!n)throw new Error(`Attempt to get data for uninitialized category ${e}`);return n}function tC(e,t,n,r){var o,i,a;const s={active:n.active,data:e.makePublicData(t,n),timer:null!==(o=n.timer)&&void 0!==o?o:null,timerRemove:null!==(i=n.timerRemove)&&void 0!==i&&i,requirements:n.requirements?kp(n.requirements):null,favorite:null!==(a=n.favorite)&&void 0!==a&&a};return(null===r||null!=e.permission_viewOriginator&&TA(e.permission_viewOriginator,r))&&(s.addedBy=n.addedBy),s}function nC(e){var t,n;const r=eC(e);return{timer:null!==(t=r.timer)&&void 0!==t?t:null,timerRemove:null!==(n=r.timerRemove)&&void 0!==n&&n,data:kp(r.data),requirements:kp(r.requirements)}}function rC(e,t){const n=Jw(e),r=eC(e),o={access_normal:TA(n.permission_normal,t),access_limited:TA(n.permission_limited,t),access_configure:null!=n.permission_configure&&TA(n.permission_configure,t),access_changeLimits:TA(n.permission_changeLimits,t),highestRoleInRoom:LA(),conditions:{},...nC(e),limits:{...n.getDefaultLimits(),...r.limits}};for(const[e,i]of Sd(r.conditions))i&&(o.conditions[e]=tC(n,e,i,t));return o}function oC(e,t){if(Qw(e))return eC(e).conditions[t]}function iC(e,t,n,r){if(!AA(Jw(e).category))return;const o=eC(e),i=o.conditions[t];if(i)i.data=n;else{const e={active:!0,lastActive:!1,timer:void 0!==o.timer?Date.now()+o.timer:void 0,timerRemove:o.timerRemove,data:n};r&&(e.addedBy=r.MemberNumber),o.conditions[t]=e}sA(),wA()}function aC(e,t){var n,r;const o=Jw(e);return AA(o.category)?null!==(r=null!==(n=eC(e).limits[t])&&void 0!==n?n:o.getDefaultLimits()[t])&&void 0!==r?r:bd.normal:bd.blocked}function sC(e,t,n){const r=aC(e,t);if(r===bd.blocked)return!1;const o=Jw(e);return TA(r===bd.limited?o.permission_limited:o.permission_normal,n)}function lC(e,t){if(!Qw(e))return!1;Array.isArray(t)||(t=[t]);const n=eC(e),r=Jw(e);let o=!1;for(const e of t)n.conditions[e]&&(r.stateChangeHandler(e,n.conditions[e],!1),delete n.conditions[e],o=!0);return o&&(sA(),wA()),o}function cC(e,t,n,r){var o,i;const a=Jw(e);if(!AA(a.category))return!1;if(!a.loadValidateConditionKey(t))return console.warn(`Attempt to set invalid condition limit ${e}:${t}`),!1;const s=eC(e);if(r&&!TA(a.permission_changeLimits,r))return!1;const l=null!==(o=a.getDefaultLimits()[t])&&void 0!==o?o:bd.normal,c=null!==(i=s.limits[t])&&void 0!==i?i:l;return c===n||void 0===s.conditions[t]&&(n===l?delete s.limits[t]:s.limits[t]=n,r&&a.logLimitChange(t,r,n,c),wA(),sA(),!0)}function uC(e,t,n){if(!AA(Jw(e).category))return!1;const r=oC(e,t);if(!r)return!1;if(r.active=n.active,n.favorite?r.favorite=!0:delete r.favorite,n.requirements){r.requirements=n.requirements;const e=r.requirements,t=!!(e.room||e.roomName||e.role||e.player);e.orLogic&&!t&&delete e.orLogic}else delete r.requirements;return null!==n.timer?r.timer=n.timer:delete r.timer,n.timerRemove&&n.active?r.timerRemove=!0:delete r.timerRemove,wA(),sA(),!0}function dC(e,t,n,r){const o=Jw(e);if(!AA(o.category))return!1;if(r&&!sC(e,t,r))return!1;const i=oC(e,t);if(!i)return!1;const a=tC(o,t,i,r);return!!o.updateCondition(t,i,n.data,r,n)&&!!uC(e,t,n)&&(r&&o.logConditionUpdate(t,r,n,a),wA(),sA(),!0)}function hC(e,t,n){const r=Jw(e);if(!AA(r.category))return!1;if(n&&(null==r.permission_configure||!TA(r.permission_configure,n)))return!1;const o=eC(e);if(!o)return!1;const i=n&&rC(e,n);o.requirements=t.requirements;const a=o.requirements,s=!!(a.room||a.roomName||a.role||a.player);return a.orLogic&&!s&&delete a.orLogic,null!==t.timer?o.timer=t.timer:delete o.timer,t.timerRemove?o.timerRemove=!0:delete o.timerRemove,o.data=kp(t.data),n&&i&&r.logCategoryUpdate(n,t,i),wA(),sA(),!0}function mC(e,t){const n=ServerPlayerIsInChatRoom(),r=n&&null!=ChatRoomData&&ChatRoomData.Private,o=[];if(e.room){const t=n&&("public"===e.room.type?!r:r);o.push(e.room.inverted?!t:t)}if(e.roomName){const t=n&&null!=ChatRoomData&&"string"==typeof ChatRoomData.Name&&ChatRoomData.Name.toLocaleLowerCase()===e.roomName.name.toLocaleLowerCase();o.push(e.roomName.inverted?!t:t)}if(e.role){void 0===t&&(t=LA());const n=null!=t&&t<=e.role.role;o.push(e.role.inverted?!n:n)}if(e.player){const t=n&&zA().some((t=>t.MemberNumber===e.player.memberNumber));o.push(e.player.inverted?!t:t)}return 0===o.length||(e.orLogic?o.includes(!0):!o.includes(!1))}const pC=["setactive","triggers","globaltriggers","timer","defaulttimer","setlimit"],fC=["room","roomname","role","player"];function gC(e,t,n,r){const o=(t[0]||"").toLocaleLowerCase(),i=(t[1]||"").toLocaleLowerCase();if("ignore"===i&&2!==t.length)return r(`Error:\n'${o} ignore' does not expect any extra arguments.`),!0;if(!["is","isnot","with","notwith"].includes(i))return r(`Error:\nUnknown setting '${i}'. please use one of: ${"room"===o||"roomname"===o?"is, isnot":"with, notwith"}`),!0;if(3!==t.length)return r(`Error:\n'${o} ${i} <value>' got too many arguments. Arguments with space need to be "quoted".`),!0;const a="isnot"===i||"notwith"===i||void 0;let s=t[2];if("room"===o){if("ignore"===i)return delete e.room,!1;if(s=s.toLocaleLowerCase(),"public"!==s&&"private"!==s)return r(`Error:\nRoom can be either 'public' or 'private', got: '${s}'`),!0;e.room={type:s,inverted:a}}else if("roomname"===o){if("ignore"===i)return delete e.roomName,!1;e.roomName={name:s,inverted:a}}else if("role"===o){if("ignore"===i)return delete e.role,!1;const t=xA[s.toLocaleLowerCase()];if("number"!=typeof t||t===xA.self)return r(`Error:\n'role ${i}' expects one of: clubowner, owner, lover, mistress, whitelist, friend, public; got: '${s.toLocaleLowerCase()}'`),!0;e.role={role:t,inverted:a}}else if("player"===o){if("ignore"===i)return delete e.player,!1;const t=Hw(s,!0);if("string"==typeof t)return r(t),!0;e.player={memberNumber:t,inverted:a}}return!1}function yC(e,t){const n=(e[0]||"").toLocaleLowerCase();return e.length<2?[]:"room"===n&&2===e.length?$w(e[1],["ignore","is","isnot"]):"room"===n&&3===e.length?$w(e[2],["public","private"]):"roomname"===n&&2===e.length?$w(e[1],["ignore","is","isnot"]):"role"===n&&2===e.length?$w(e[1],["ignore","with","notwith"]):"role"===n&&3===e.length?$w(e[2],["clubowner","owner","lover","mistress","whitelist","friend","public"]):"player"===n&&2===e.length?$w(e[1],["ignore","with","notwith"]):"player"===n&&3===e.length?Ww(e[2]):[]}function vC(e,t,n,r){const o=(t[0]||"").toLocaleLowerCase();if(!pC.includes(o))throw new Error(`Subcomand "${o}" passed to ConditionsRunSubcommand isn't valid ConditionsSubcommand`);const i=Zw.get(e);if(!i)throw new Error(`Attempt to run command for unknown conditions category ${e}`);if(!AA(i.category))return r(`The command failed to execute, because ${Player.Name} disabled her ${pd[i.category]} module.`);const a=eC(e),s=e.slice(0,-1),l=i.commandConditionSelectorHelp;if("setactive"===o){const o=(t[2]||"").toLocaleLowerCase();if(3!==t.length||"yes"!==o&&"no"!==o)return r(`Usage:\nsetactive <${l}> <yes/no>`);const[c,u]=i.parseConditionName(t[1],Dd(a.conditions));if(!c)return r(u);if(!a.conditions[u])return r(`This ${s} doesn't exist`);const d=tC(i,u,a.conditions[u],n);d.active="yes"===o,r(dC(e,u,d,n)?"Ok.":yw)}else if("triggers"===o){const[o,c]=i.parseConditionName(t[1]||"",Dd(a.conditions));if(!o)return r(c);if(!a.conditions[c])return r(`This ${s} doesn't exist`);const u=tC(i,c,a.conditions[c],n),d=(t[2]||"").toLocaleLowerCase();if(!d){if(u.requirements){const e=[],t=u.requirements;if(e.push(t.orLogic?"Logic: OR (at least one)":"Logic: AND (all of)"),t.room&&e.push(`When ${t.room.inverted?"not in":"in"} ${t.room.type} room`),t.roomName&&e.push(`When ${t.roomName.inverted?"not in":"in"} room named '${t.roomName.name}'`),t.role){const n=Nd(xA[t.role.role])+(t.role.role!==xA.clubowner?" ":"");e.push(`When ${t.role.inverted?"not in":"in"} room with role '${n}'`)}if(t.player){const n=ME(t.player.memberNumber,null);e.push(`When ${t.player.inverted?"not in":"in"} room with member '${t.player.memberNumber}'${n?` (${n})`:""}`)}return e.length>1?r(`Current status:\nThis ${s} will trigger under following conditions:\n`+e.join("\n")):r(`Current status:\nNo triggers are set. The ${s} will now always trigger, while it is active`)}return r(`Current status:\nUses global ${e} trigger configuration`)}if("global"===d){const e=(t[3]||"").toLocaleLowerCase();if(4!==t.length||"yes"!==e&&"no"!==e)return r(`Usage:\ntriggers <${l}> global <yes/no>`);"yes"===e?u.requirements=null:u.requirements||(u.requirements=kp(a.requirements))}else if("logic"===d){const e=(t[3]||"").toLocaleLowerCase();if(4!==t.length||"or"!==e&&"and"!==e)return r(`Usage:\ntriggers <${l}> logic <or/and>`);if(!u.requirements)return r(`Cannot configure specific trigger while using global data. First use:\ntriggers <${l}> global no`);"or"===e?u.requirements.orLogic=!0:delete u.requirements.orLogic}else{if(!fC.includes(d))return r(`${"help"!==d?`Unknown trigger '${d}'. `:""}List of possible 'triggers <${l}> *' options:\nglobal <yes/no> - Set the trigger condition of this ${s} to the global configuration\nlogic <or/and>\t- Set if the logic should be OR (at least one) or AND (all of) logic; default is AND\nroom ignore - Remove the 'room type'-based trigger condition\nroom <is/isnot> <public/private> - Add such a 'room type'-based trigger condition\nroomname ignore - Remove the 'room name'-based trigger condition\nroomname <is/isnot> <name> - Add such a 'room name'-based trigger condition\nrole ignore - Remove the role-based trigger condition\nrole <with/notwith> <role> - Add such a role-based trigger condition\nplayer ignore - Remove the person-based trigger condition\nplayer <with/notwith> <memberNumber> - Add such a person-based trigger condition\n\nTo show currently set triggers, use just 'triggers <group>' without adding one of the above sub-commands.`);if(!u.requirements)return r(`Cannot configure specific trigger while using global data. First use:\ntriggers <${l}> global no`);if(gC(u.requirements,t.slice(2),0,r))return}r(dC(e,c,u,n)?"Ok.":yw)}else if("globaltriggers"===o){const o=rC(e,n);if(!t[1]){const t=[],n=o.requirements;if(t.push(n.orLogic?"Logic: OR (at least one)":"Logic: AND (all of)"),n.room&&t.push(`When ${n.room.inverted?"not in":"in"} ${n.room.type} room`),n.roomName&&t.push(`When ${n.roomName.inverted?"not in":"in"} room named '${n.roomName.name}'`),n.role){const e=Nd(xA[n.role.role])+(n.role.role!==xA.clubowner?" ":"");t.push(`When ${n.role.inverted?"not in":"in"} room with role '${e}'`)}if(n.player){const e=ME(n.player.memberNumber,null);t.push(`When ${n.player.inverted?"not in":"in"} room with member '${n.player.memberNumber}'${e?` (${e})`:""}`)}return t.length>1?r(`Current status:\nGlobally ${e} are set to trigger under following conditions:\n`+t.join("\n")):r(`Current status:\nNo triggers are set globally. ${Nd(e)} using global config will now always trigger, if they are active`)}if("logic"===t[1].toLocaleLowerCase()){const e=(t[2]||"").toLocaleLowerCase();if(3!==t.length||"or"!==e&&"and"!==e)return r("Usage:\nglobaltriggers logic <or/and>");"or"===e?o.requirements.orLogic=!0:delete o.requirements.orLogic}else{if(!fC.includes(t[1].toLocaleLowerCase()))return r(("help"!==t[1]?`Unknown trigger '${t[1].toLocaleLowerCase()}'. `:"")+"List of possible 'globaltriggers *' options:\nlogic <or/and>\t- Set if the logic should be OR (at least one) or AND (all of) logic; default is AND\nroom ignore - Remove the 'room type'-based trigger condition\nroom <is/isnot> <public/private> - Add such a 'room type'-based trigger condition\nroomname ignore - Remove the 'room name'-based trigger condition\nroomname <is/isnot> <name> - Add such a 'room name'-based trigger condition\nrole ignore - Remove the role-based trigger condition\nrole <with/notwith> <role> - Add such a role-based trigger condition\nplayer ignore - Remove the person-based trigger condition\nplayer <with/notwith> <memberNumber> - Add such a person-based trigger condition\n\nTo show currently set global triggers, use just 'globaltriggers' without anything behind.");if(gC(o.requirements,t.slice(1),0,r))return}r(hC(e,o,n)?"Ok.":yw)}else if("timer"===o){const[o,c]=i.parseConditionName(t[1]||"",Dd(a.conditions));if(!o)return r(c);if(!a.conditions[c])return r(`This ${s} doesn't exist`);const u=(t[2]||"").toLocaleLowerCase();if("set"!==u&&"disable"!==u&&"autoremove"!==u)return r(`Usage:\ntimer <${l}> disable - Remove the timer and set lifetime to infinite\ntimer <${l}> set <time> - Set timer to the given amount of days, hours, minutes or seconds (e.g. 23h 30m)\ntimer <${l}> autoremove <yes/no> - Set if the ${s} is removed when the timer runs out or just disables itself`);const d=tC(i,c,a.conditions[c],n);if("disable"===u)d.timer=null,d.timerRemove=!1;else if("set"===u){let e=0;for(const n of t.slice(3)){const t=qw(n);if("string"==typeof t)return r(t);e+=t}d.timer=Date.now()+e}else if("autoremove"===u){const e=(t[3]||"").toLocaleLowerCase();if(4!==t.length||"yes"!==e&&"no"!==e)return r(`Usage:\ntimer <${l}> autoremove <yes/no>`);if(!d.active)return r(`Timer is counting until ${s} becomes enabled, cannot use autoremove in this mode.`);if(null===d.timer)return r(`Timer is disabled on this ${s}. To use autoremove, first set timer`);d.timerRemove="yes"===e}r(dC(e,c,d,n)?"Ok.":yw)}else if("defaulttimer"===o){const o=(t[1]||"").toLocaleLowerCase();if("set"!==o&&"disable"!==o&&"autoremove"!==o)return r(`Usage:\ndefaulttimer disable - Remove the timer and set lifetime to infinite\ndefaulttimer set <time> - Set timer to the given amount of days, hours, minutes or seconds (e.g. 23h 30m)\ndefaulttimer autoremove <yes/no> - Set if the ${s} is removed when the timer runs out or just disables itself`);const i=rC(e,n);if("disable"===o)i.timer=null,i.timerRemove=!1;else if("set"===o){let e=0;for(const n of t.slice(2)){const t=qw(n);if("string"==typeof t)return r(t);e+=t}i.timer=e}else if("autoremove"===o){const n=(t[2]||"").toLocaleLowerCase();if(3!==t.length||"yes"!==n&&"no"!==n)return r(`Usage:\ndefaulttimer <${l}> autoremove <yes/no>`);if(null===i.timer)return r(`Timer is disabled by default for ${e}. To use autoremove, first set timer`);i.timerRemove="yes"===n}r(hC(e,i,n)?"Ok.":yw)}else if("setlimit"===o){const[o,a]=i.parseConditionName(t[1]||"",!1);if(!o)return r(a);if(!i.loadValidateConditionKey(a))throw new Error("Parse name returned invalid condition key");const s=(t[2]||"").toLocaleLowerCase();if("normal"!==s&&"limited"!==s&&"blocked"!==s)return r(`Usage:\nsetlimit <${l}> <normal/limited/blocked> - Set a limit on certain <${l}>`);r(cC(e,a,bd[s],n)?"Ok.":yw)}}function bC(e,t,n){const r=(t[0]||"").toLocaleLowerCase();if(!pC.includes(r))throw new Error(`Subcomand "${r}" passed to ConditionsAutocompleteSubcommand isn't valid ConditionsSubcommand`);const o=Zw.get(e);if(!o)throw new Error(`Attempt to autocomplete command for unknown conditions category ${e}`);if(!AA(o.category))return[];const i=eC(e);if("setactive"===r){if(2===t.length)return o.autocompleteConditionName(t[1],Dd(i.conditions));if(3===t.length)return $w(t[2],["yes","no"])}else if("triggers"===r){if(2===t.length)return o.autocompleteConditionName(t[1],Dd(i.conditions));const[e,n]=o.parseConditionName(t[1]||"",Dd(i.conditions));if(!e||!i.conditions[n])return[];if(3===t.length)return $w(t[2],["global","logic",...fC]);if("global"===t[2].toLocaleLowerCase())return $w(t[3],["yes","no"]);if("logic"===t[2].toLocaleLowerCase())return $w(t[3],["and","or"]);if(i.conditions[n].requirements&&fC.includes(t[2].toLocaleLowerCase()))return yC(t.slice(2))}else if("globaltriggers"===r){if(2===t.length)return $w(t[1],["logic",...fC]);if("logic"===t[1].toLocaleLowerCase())return $w(t[2],["and","or"]);if(fC.includes(t[2].toLocaleLowerCase()))return yC(t.slice(1))}else if("timer"===r){if(2===t.length)return o.autocompleteConditionName(t[1],Dd(i.conditions));if(3===t.length)return $w(t[2],["set","disable","autoremove"]);if(4===t.length&&"autoremove"===t[2].toLocaleLowerCase())return $w(t[3],["yes","no"])}else if("defaulttimer"===r){if(2===t.length)return $w(t[1],["set","disable","autoremove"]);if(3===t.length&&"autoremove"===t[1].toLocaleLowerCase())return $w(t[2],["yes","no"])}else if("setlimit"===r){if(2===t.length)return o.autocompleteConditionName(t[1],!1);if(3===t.length)return $w(t[2],["normal","limited","blocked"])}return[]}const wC=15,CC=18e4;let _C,kC=!0,AC="",EC=0,SC="",DC=0,MC=!1;function xC(e=!0){let t="----- Debug report -----\n";t+=`Location: ${window.location.href.replace(/\d{4,}/g,"<numbers>")}\n`,t+=`UA: ${window.navigator.userAgent}\n`,t+=`BC Version: ${GameVersion}\n`,t+=`ModSDK Version: ${Ud().version}\n`,t+="Mods:\n"+Ud().getModsInfo().map((e=>`  - ${e.fullName} (${e.name}): ${e.version}\n`+(e.repository?`    repository: ${e.repository}\n`:""))).join("");const n=Object.entries(bE()).filter((e=>e[1]));n.length>0?t+="Detected legacy mods (NOT USING ModSDK):\n"+n.map((e=>`  - ${e[0]}`+("boolean"!=typeof e[1]?`: ${e[1]}`:"")+"\n")).join(""):t+="No known legacy mods detected.\n";const r=Date.now();if(t+="\n----- BC state report -----\n",t+=`Mouse position: ${MouseX} ${MouseY}\n`,t+=`Connected to server: ${ServerIsConnected}\n`,t+=`Local time: ${r}\n`,t+=`Server time: ${CurrentTime} (diff: ${(CurrentTime-r).toFixed(2)})\n`,t+=`Screen: ${CurrentModule}/${CurrentScreen}\n`,t+=`In chatroom: ${ServerPlayerIsInChatRoom()}\n`,t+=`GLVersion: ${GLVersion}\n`,t+=`Last received message: ${AC} (${EC})\n`,t+=`Last sent message: ${SC} (${DC})\n`,e){t+="\n----- BCX report -----\n",t+=`Version: ${ad}\n`,t+=`Init state: ${yd[EA]}\n`,t+=`First init: ${rA}\n`,t+=`Disabled modules: ${kA().map((e=>md[e])).join(", ")||"[None]"}\n`;try{Qw("curses")&&(t+=`Curses: ${Object.keys(eC("curses").conditions).join(", ")||"[None]"}\n`)}catch(e){t+=`ERROR getting Curses data: ${IC(e)}\n`}try{Qw("rules")&&(t+=`Rules: ${Object.keys(eC("rules").conditions).join(", ")||"[None]"}\n`)}catch(e){t+=`ERROR getting Rules data: ${IC(e)}\n`}}return t+="\n"+function(e=!1){let t="----- ModSDK report -----\n";let n=!1;const r=Array.from(Ud().getPatchingInfo().values()).filter((e=>e.currentEntrypoint!==e.sdkEntrypoint));r.length>0&&(n=!0,t+="Functions overwritten by non-ModSDK mods:\n"+r.map((e=>{var t,n;return`  - ${e.name}: ${kd(null!==(n=null===(t=e.currentEntrypoint)||void 0===t?void 0:t.toString().replaceAll("\r\n","\n"))&&void 0!==n?n:"")}\n`})).join("")),n||(t+="No warnings.\n");const o=th(!1);return o.length>0&&(e||ld.includes(GameVersion))?(t+="\n----- BCX Patching report -----\n",o.length>0&&(t+="Patched functions with unknown checksums:\n"+o.map((e=>`  - ${e[0]}: ${e[1]}\n`)).join(""))):e&&(t+="\n----- BCX Patching report -----\n",t+="No warnings.\n"),t}(e),t}function NC(e){return e.replaceAll(window.location.href.substring(0,window.location.href.lastIndexOf("/")),"<url>").replace(/\/\d{4,}\.html/,"/<numbers>.html").replace(/[?&]_=\d+(?=$|&|:)/,"")}function IC(e){if(e instanceof Error){let t=`${e.stack}`.split("\n");return t.length>wC&&(t=t.slice(0,wC).concat("    ...")),t.map(NC).join("\n")}return`${e}`}function RC(e,t,n,r=!0,o,i){var a,s;console.info("Error overlay displayed\n",n),r&&(n="```\n"+n.trim()+"\n```");const l=document.createElement("div");l.style.position="fixed",l.style.inset="0px",l.style.zIndex="999999",l.style.background="#00000090";const c=document.createElement("div");l.appendChild(c),c.style.position="absolute",c.style.inset="5%",c.style.background="white",c.style.display="flex",c.style.flexDirection="column",c.style.padding="1em",c.style.overflow="auto";const d=document.createElement("h1");c.appendChild(d),d.innerText=e;const h=document.createElement("p");c.appendChild(h),h.innerHTML=t;const m=document.createElement("textarea");if(i)i(c);else{const e=document.createElement("button");e.style.cursor="pointer",c.appendChild(e),e.innerText="Copy report",e.onclick=()=>{if(m.focus(),m.select(),navigator.clipboard)navigator.clipboard.writeText(m.value);else try{document.execCommand("copy")}catch(e){}}}c.appendChild(m),m.readOnly=!0,m.value=n,m.style.minHeight="min(10em, 50vh)",m.style.flex="1",m.style.margin="0.5em 0";let p=null!=o?o:0;const f=document.createElement("button");c.appendChild(f),f.onclick=()=>{p>0||l.remove()};const g=()=>{f.innerText=p>0?`Close (${p})`:"Close",f.disabled=p>0,p>0?u((()=>{p--,g()}),1e3):f.style.cursor="pointer"};g(),null===(s=null===(a=document.activeElement)||void 0===a?void 0:a.blur)||void 0===s||s.call(a),window.document.body.appendChild(l)}const LC=6e4;let TC=!1;function PC(){if(TC||EA!==yd.ready)return;const e=bE();let t="",n=0;e.BcUtil&&(n=5,t+="----- BC-Util -----\nBCX detected the presence of the incompatible mod BC-Util.\nBC-Util is a useful and high quality mod, which has unfortunately not been updated since September 2021 and doesn't use ModSDK.\nIt isn't compatible with BCX due to that and is known to cause problems, including crashes (especially in the wardrobe).\n\n"),e.QuickAccessMenu&&(n=5,t+="----- Quick Access Menu (QAM) -----\nBCX detected the presence of the incompatible mod Quick Access Menu.\nThis mod is deprecated and is known to conflict with other mods (e.g. BCX or FBC). Continued usage of this mod is not advised.\nContact its author for more information.\nError reports while using QAM will not be acted upon.\n\n"),e.Curse&&(t+='----- "Cursed" Script -----\nBCX detected the presence of the obsolete mod Cursed script.\nCurse is the spiritual predecessor of BCX, and can be considered obsolete since BCX has almost the same features (and much more). Curse is no longer updated since September 2021 and doesn\'t use ModSDK.\nAs BCX is meant to supersede Curse, no compatibility can be guaranteed.\n\n');const r=Array.from(Ud().getPatchingInfo().values()),o=ld.includes(GameVersion)?th(!1):[],i=r.filter((e=>e.currentEntrypoint!==e.sdkEntrypoint));if(Array.from(Object.values(e)).every((e=>!e))&&(o.length>0||i.length>0)&&(t+="----- Unknown mod not using ModSDK -----\nBCX detected the presence of modifications not done using ModSDK or any known legacy mod.\nIf you are not author of the mod, please report what mod caused this warning on the BC Scripting Community Discord server: https://discord.gg/SHJMjEh9VH\nIf you are author of the mod triggering this warning, please modify your mod to use ModSDK: https://github.com/Jomshir98/bondage-club-mod-sdk. Feel free to ask for help doing that on the above-mentioned Discord server.\n\n"),t&&(t+="----- Detected modifications -----\n"+(o.length>0?"Patched functions with unknown checksums:\n"+o.map((e=>`  - ${e[0]}: ${e[1]}\n`)).join(""):"")+(i.length>0?"Overwritten functions:\n"+i.map((e=>{var t,n;return`  - ${e.name}: ${kd(null!==(n=null===(t=e.currentEntrypoint)||void 0===t?void 0:t.toString().replaceAll("\r\n","\n"))&&void 0!==n?n:"")}\n`})).join(""):"")+"\n"),t){const e=kd(t);if(tA.compatibilityCheckerWarningIgnore===e)return;TC=!0,RC("BCX Compatibility checker","BCX's Compatibility checker detected problems with other mods you appear to be using.<br />For reasons stated below please reconsider using mentioned mods.<br />Please note, that this is a warning for you, not meant to be reported. It says that some features are likely to be broken.<br />If you have any questions or think this message is an error, please get in touch with us on <a href='https://discord.gg/SHJMjEh9VH' target='_blank'>BC Scripting Community</a> Discord server.<br />You can use the 'Close' button at the bottom to continue anyway.",t+`Report signature: ${e}`,!1,n,(t=>{const n=document.createElement("button");n.style.cursor="pointer",t.appendChild(n),n.innerText="Do not show this report again unless something changes",n.onclick=()=>{n.innerText="This report won't show again unless something changes.",n.disabled=!0,tA.compatibilityCheckerWarningIgnore=e,sA()}}))}else null!=tA.compatibilityCheckerWarningIgnore&&(delete tA.compatibilityCheckerWarningIgnore,sA())}const BC={bcx:"<br /><h3>Whoops... seems like BCX might be to blame this time</h3> Could you please help us by submitting the report below to the <a href='https://discord.gg/SHJMjEh9VH' target='_blank'>BC Scripting Community Discord</a> server?<br />Thank you!</p>",knownMod:e=>`<br /><h3>The error seems to come from mod ${e}</h3> Please submit the report to <a href='https://discord.gg/SHJMjEh9VH' target='_blank'>BC Scripting Community Discord</a> server!`,bc:"<br /><h3>The error seems not to come from any ModSDK mod!</h3> Please submit the report to <a href='https://discord.gg/dkWsEjf' target='_blank'>Bondage Club's Discord</a> server!",unknown:"<br /><h3>Could not detect origin of the error.</h3> Please submit the report to <a href='https://discord.gg/dkWsEjf' target='_blank'>Bondage Club's Discord</a> server!"};function OC(e){if(!kC)return;kC=!1;const t=h();RC("Crash Handler (by ModSDK)","The Crash Handler provided by ModSDK detected an uncaught error, which most likely crashed the Bondage Club.<br />While reporting this error, please use the information below to help us find the source faster.<br />You can use the 'Close' button at the bottom to continue, however BC may no longer work correctly until you reload the current tab."+("BCX"===t?BC.bcx:""===t?BC.bc:null==t?BC.unknown:BC.knownMod(t)),function(e){const t=h();let n=`----- UNHANDLED ERROR ${null!=t?`(IN ${t||"BC"}) `:""}-----\nMessage: ${e.message}\nSource: ${NC(e.filename)}:${e.lineno}:${e.colno}\n`;n+=IC(e.error)+"\n\n",n+=p();try{n+="\n"+xC("BCX"===t)}catch(e){n+=`----- Debug report -----\nERROR GENERATING DEBUG REPORT!\n${IC(e)}`}return n}(e))}function $C(e,t){if(console.error(`HardCoreClub: Error report: ${e}\n`,t),!kC)return;kC=!1;const n=h();RC("Error Report (by BCX)","The following error happend in event originating from BCX.<br />While reporting this error, please use the information below to help us find the source faster.<br />You can use the 'Close' button at the bottom to continue, however BC may no longer work correctly until you reload the current tab."+("BCX"===n?BC.bcx:""===n?BC.bc:null==n?BC.unknown:BC.knownMod(n)),function(e,t){const n=h();let r=`----- ERROR ${null!=n?`(IN ${n||"BC"}) `:""}-----\nDescription: ${e}\n`;r+=IC(t)+"\n\n",r+=p();try{r+="\n"+xC("BCX"===n)}catch(e){r+=`----- Debug report -----\nERROR GENERATING DEBUG REPORT!\n${IC(e)}`}return r}(e,t))}let FC,HC,WC,GC;function jC(...e){const t=Array.isArray(e[0])&&"string"==typeof e[0][0]?e[0][0]:"[unknown]";AC=t,EC=Date.now();const n=Array.isArray(e[0])?e[0].slice(1):[];MC&&console.log(" Receive",t,...n);const r=m(`Server message ${t}`,{root:!0,modArea:"",extraInfo:()=>`Event: ${t}\n`+n.map((e=>JSON.stringify(e,void 0,"  "))).join("\n")}),o=null==FC?void 0:FC.apply(this,e);return r.end(),o}function UC(...e){const t=Array.isArray(e)&&"string"==typeof e[0]?e[0]:"[unknown]";return SC=t,DC=Date.now(),MC&&console.log(" Send",...e),e.length>=2&&function(e,t){const n=Ad(t);n>0&&n>CC&&function(e,t){const n=Ad(t);console.error(`HardCoreClub Outgoing message size: ${n}`,"\nIndividual sizes:",t.map(Ad),"\nMessage:",t),kC&&(kC=!1,RC("Profile data size alert","BCX detected a large outgoing data packet that might cause you to disconnect from the server.<br />The most common cause for this is too much data being stored by all of your mods/extensions together. This problem won't be fixed by simply disabling some or all extensions.<br />Solution to this problem isn't straightforward - we recommend asking for help on the <a href='https://discord.gg/dkWsEjf' target='_blank'>Bondage Club's Discord</a> server.<br /><h3>If you do encounter a disconnect:</h3> Please submit the report to <a href='https://discord.gg/dkWsEjf' target='_blank'>Bondage Club's Discord</a> server!<br /><i>This message will not show again during this session.</i>",function(e,t){const n=h();let r=`----- Huge outgoing message report ${null!=n?`(IN ${n||"BC"}) `:""}-----\n`;r+=`Message type: ${e}\n`,r+=`Message total size: ${Ad(t)}\n`,r+="\n----- Message size breakdown -----\n";for(let e=0;e<t.length;e++){const n=t[e];if(r+=`\n--- Part #${e} ---\n`,r+=`Type: ${null==n?"null":Array.isArray(n)?"array":typeof n}\n`,r+=`Size: ${Ad(n)}\n`,"string"==typeof n&&n.length<64&&(r+=`Value: ${JSON.stringify(n)}\n`),Ed(n)){r+="Breakdown by keys:\n";for(const[e,t]of Object.entries(n).sort(((e,t)=>Ad(t[1])-Ad(e[1]))))if(r+=`- ${e}: ${Ad(t)}\n`,Ed(t))for(const[e,n]of Object.entries(t).sort(((e,t)=>Ad(t[1])-Ad(e[1]))))r+=`  - ${e}: ${Ad(n)}\n`}}r+="\n",r+=p();try{r+="\n"+xC("BCX"===n)}catch(e){r+=`----- Debug report -----\nERROR GENERATING DEBUG REPORT!\n${IC(e)}`}return r}(e,t)))}(e,t)}(t,e),null==HC?void 0:HC.apply(this,e)}function YC(e){const t=m("Canvas click",{root:!0,modArea:"",extraInfo:()=>`X: ${MouseX}\nY: ${MouseY}`}),n=null==WC?void 0:WC.call(this,e);return t.end(),n}function qC(e){var t;return null!==(t=null==GC?void 0:GC.call(this,((...t)=>{const n=m("Animation frame",{root:!0,modArea:"",extraInfo:()=>`time: ${t}`}),r=e.apply(window,t);return n.end(),r})))&&void 0!==t?t:0}function XC(){if(window.BCX_Loaded||EA!==yd.construct)return;const e=m("BCX init",{modArea:"BCX"});if(function(){var e,t;window.addEventListener("error",OC),void 0===FC&&"function"==typeof(null===(e=null===ServerSocket||void 0===ServerSocket?void 0:ServerSocket.__proto__)||void 0===e?void 0:e.emitEvent)&&(FC=ServerSocket.__proto__.emitEvent,ServerSocket.__proto__.emitEvent=jC),void 0===HC&&"function"==typeof(null===(t=null===ServerSocket||void 0===ServerSocket?void 0:ServerSocket.__proto__)||void 0===t?void 0:t.emit)&&(HC=ServerSocket.__proto__.emit,ServerSocket.__proto__.emit=UC);const n=document.getElementById("MainCanvas");n&&void 0===WC&&"function"==typeof n.onclick&&(WC=n.onclick,n.onclick=YC),void 0===GC&&"function"==typeof window.requestAnimationFrame&&(GC=window.requestAnimationFrame,window.requestAnimationFrame=qC),null==_C&&(_C=c((()=>{PC()}),LC),u((()=>{PC()}),3e3))}(),!function(){EA=yd.init;for(const e of SA)if(!1===e.init())return!1;const e="string"==typeof tA.version?Fd(tA.version):{major:0,minor:0,patch:0};if(!e)return alert("Failed to parse BCX version in your saved data.\nAre you loading older version or is your data corrupted?\nRefusing to load."),!1;if(0!==Hd(t=e,n=Gd)&&!rA&&(Hd(t,n)>0&&!confirm("You are attempting to load older BCX version than you did previously. This might result in loss of some data.\nAre you sure you want to continue?")||(console.log("HardCoreClub: Version migration from",Wd(t),"to",Wd(n)),Hd(t,{major:0,minor:7,patch:4})<0&&(tA.menuShouldDisplayTutorialHelp=!0),Hd(t,{major:0,minor:8,patch:0})<0&&tA.preset===hd.dominant&&Array.isArray(tA.disabledModules)&&!tA.disabledModules.includes(md.Commands)&&tA.disabledModules.push(md.Commands),0)))return!1;var t,n;tA.version="1.0.2-STRICT-6585254c",EA=yd.load;for(const e of SA)e.load(_A());EA=yd.ready;for(const e of SA)e.run();return!0}())return e.end(),void zC();const t=Player.MemberNumber;if(null==t)throw new Error("No player MemberNumber");Zd("LoginResponse",0,((e,n)=>{const r=e[0];if(Ed(r)&&"string"==typeof r.Name&&"string"==typeof r.AccountName&&r.MemberNumber!==t)throw alert(`Attempting to load BCX with different account than already loaded (${r.MemberNumber} vs ${t}). This is not supported, please refresh the page.`),new Error("Attempting to load BCX with different account");return n(e)})),Qd("ChatRoomViews",ChatRoomViews),Qd("CurrentScreenFunctions",CurrentScreenFunctions),Qd("DialogSelfMenuOptions",DialogSelfMenuOptions);const{BondageClubTools:n}=bE();if(n)if(console.warn("HardCoreClub: Bondage Club Tools detected!"),!0===window.BCX_BondageClubToolsPatch)console.info("HardCoreClub: Bondage Club Tools already patched, skip!");else{window.BCX_BondageClubToolsPatch=!0;const e=ServerSocket.listeners("ChatRoomMessage").find((e=>e.toString().includes("window.postMessage"))),t=ServerSocket.listeners("AccountBeep").find((e=>e.toString().includes("window.postMessage")));if(!e||!t)throw new Error("Failed to patch for Bondage Club Tools!");ServerSocket.off("ChatRoomMessage",e),ServerSocket.on("ChatRoomMessage",(t=>{"Hidden"===(null==t?void 0:t.Type)&&"BCXMsg"===t.Content&&"number"==typeof t.Sender||e(t)})),ServerSocket.off("AccountBeep",t),ServerSocket.on("AccountBeep",(e=>{var n;"string"==typeof(null==e?void 0:e.BeepType)&&["Leash","BCX"].includes(e.BeepType)&&Ed(null===(n=e.Message)||void 0===n?void 0:n.BCX)||t(e)}))}console.log("CHECKING ENABLED MODULES AGAINST FORBIDDEN LIST"),console.log("---\x3e Waiting 10s for the initialization of modules"),c((()=>{const e=wE();e.length>0&&(alert("Found forbidden BC modules. Please disable them first!"),console.log("Found forbidden BC modules. Please disable them first!"),fE("HardCoreClub Found forbidden BC modules. Please disable them first! The list of mods: "+e.toString()),window.BCX_Loaded=!1,window.close(),zC())}),1e4),window.BCX_Loaded=!0,fE(`HardCoreClub loaded! Version: ${ad.replace(/-[0-f]+$/i,"")}`),console.info(`HardCoreClub loaded! Version: ${ad}`),VC(),e.end()}function zC(){return Xd=!0,qd.clear(),Yd.unload(),function(){EA=yd.destroy;for(const e of SA)e.unload()}(),function(){window.removeEventListener("error",OC),FC&&ServerSocket.__proto__.emitEvent===jC&&(ServerSocket.__proto__.emitEvent=FC,FC=void 0),HC&&ServerSocket.__proto__.emit===UC&&(ServerSocket.__proto__.emit=HC,HC=void 0);const e=document.getElementById("MainCanvas");e&&WC&&e.onclick===YC&&(e.onclick=WC,WC=void 0),GC&&window.requestAnimationFrame===qC&&(window.requestAnimationFrame=GC,GC=void 0),null!=_C&&(clearInterval(_C),_C=void 0)}(),delete window.BCX_Loaded,console.info("HardCoreClub: Unloaded."),!0}function VC(){const e=ZC(LZString.decompressFromBase64(Player.ExtensionSettings.FBC)),t=`bce.settings.${null===Player||void 0===Player?void 0:Player.AccountName}`,n=ZC(localStorage.getItem(t));return console.groupCollapsed("WCE AntiGarble"),n&&(console.log("Local Settings"),console.log(n),n.antiGarble)?(fE("Talking disabled if WCE AntiGarble activated. Don't cheat!"),console.groupEnd(),!0):e?(console.log("Remote Settings"),console.log(e),"true"===e.antiGarble?(console.log("Found antiGarble enabled ("+e.antiGarble+")"),console.groupEnd(),!0):(console.groupEnd(),!1)):(console.groupEnd(),!1)}function ZC(e){if(null===e)return null;try{return JSON.parse(e)}catch(e){return console.error("parsing JSON",e),null}}_b(dd);let KC,JC,QC=null,e_=null,t_=!1;const n_=new Map;function r_(){null!==QC&&(clearTimeout(QC),QC=null),mA("versionCheck",{version:ad,devel:!0,GameVersion,Source:(mE?"E:":"")+(null!=hE?hE:"[UNKNOWN]"),UA:window.navigator.userAgent},sd,!0),QC=u(r_,6e4*(5+Math.random())),o_()}function o_(){wE().length>0&&(alert("Found forbidden BC modules. Please disable them first!"),console.log("Found forbidden BC modules. Please disable them first!"),fE("HardCoreClub Found forbidden BC modules. Please disable them first! The list of mods: "+wE.toString()),window.BCX_Loaded=!1,zC())}class i_ extends Ap{constructor(e){super(),this.character=e}Run(){if(MainCanvas.textAlign="left",DrawText(`- Global: Configuration for ${this.character.Name} -`,125,125,"Black","Gray"),MainCanvas.textAlign="center",DrawButton(1815,75,90,90,"","White","Icons/Exit.png","BCX main menu"),!this.character.isPlayer())return void DrawText("Global configuration is not possible on others",1e3,500,"Black");DrawRect(840,200,950,90,"#ddd"),CE("Icons/Introduction.png",860,220,{Height:50,Width:50}),DrawTextFit(`Your initially selected Hard Core Club preset was: "${Nd(hd[_A()])}"`,1300,244,850,"Black"),DrawTextFit("YOU ARE USING Hard Core Club. USE IT AT YOUR OWN RISK.",1800,244,850,"Red"),MainCanvas.textAlign="left",DrawCheckbox(125,350,64,64,"Show Hard Core Club icons above characters in chatroom",!tA.chatroomIconHidden);const e=void 0!==KC;DrawCheckbox(125,450,64,64,"Show your Hard Core Club Supporter Heart to all BCX users",e&&!tA.supporterHidden,!e)}Click(){if(MouseIn(1815,75,90,90))return this.Exit();if(this.character.isPlayer()){if(MouseIn(125,350,64,64))return null!=tA.chatroomIconHidden?delete tA.chatroomIconHidden:tA.chatroomIconHidden=!0,void sA();if(void 0!==KC&&MouseIn(125,450,64,64))(e=!!tA.supporterHidden)!=!tA.supporterHidden&&(e?delete tA.supporterHidden:tA.supporterHidden=!0,sA(),Jk());else var e}}Exit(){jk(new Wk(this.character))}}class a_ extends Ap{constructor(e){super(),this.config=null,this.failed=!1,this.configList=[],this.allowDelete=!1,this.allowConfigure=!1,this.page=0,this.showHelp=!1,this.filterInput=Bd("text",30),this.character=e,this.filterInput.addEventListener("input",(e=>{this.rebuildList()}))}Load(){this.requestData()}onChange(e){e===this.character.MemberNumber&&this.requestData()}requestData(){Promise.all([this.character.getLogConfig(),this.character.getPermissionAccess("log_delete"),this.character.getPermissionAccess("log_configure")]).then((e=>{this.config=e[0],this.allowDelete=e[1],this.allowConfigure=e[2],this.failed=!1,this.rebuildList()}),(e=>{console.error(`HardCoreClub: Failed to get log config for ${this.character}`,e),this.config=null,this.allowDelete=!1,this.allowConfigure=!1,this.failed=!0,this.rebuildList()}))}rebuildList(){if(!this.active)return;if(this.configList=[],null===this.config)return void this.filterInput.remove();this.filterInput.parentElement||document.body.appendChild(this.filterInput);const e=this.filterInput.value.trim().toLocaleLowerCase().split(" ");for(const[t,n]of Object.entries(this.config))void 0!==wv[t]&&void 0!==Cv[n]&&e.every((e=>wv[t].toLocaleLowerCase().includes(e)||t.toLocaleLowerCase().includes(e)))&&this.configList.push({category:t,access:n,name:wv[t]});this.configList.sort(((e,t)=>e.name.localeCompare(t.name)));const t=Math.ceil(this.configList.length/6);this.page<0?this.page=Math.max(t-1,0):this.page>=t&&(this.page=0)}Run(){if(null!==this.config){DrawText("Filter:",130,215,"Black"),Od(this.filterInput,550,210,600,64),this.filterInput.value&&(MainCanvas.textAlign="center",DrawButton(870,182,64,64,"X","White")),MainCanvas.textAlign="left";for(let e=0;e<6;e++){const t=6*this.page+e;if(t>=this.configList.length)break;const n=this.configList[t],r=290+100*e;DrawButton(130,r,1070,64,"","White"),DrawTextFit(n.name,140,r+34,1060,"Black"),MainCanvas.textAlign="center",this.allowConfigure?DrawBackNextButton(1270,r,170,64,Cv[n.access],"White","",(()=>n.access>0?Cv[n.access-1]:""),(()=>n.access<2?Cv[n.access+1]:"")):DrawButton(1270,r,170,64,Cv[n.access],"#ccc",void 0,void 0,!0),MainCanvas.textAlign="left"}const e=Math.max(1,Math.ceil(this.configList.length/6));MainCanvas.textAlign="center",DrawBackNextButton(1605,800,300,90,`${InterfaceTextGet("Page")} ${this.page+1} / ${e}`,"White","",(()=>""),(()=>""))}else this.failed?(MainCanvas.textAlign="center",fA(`get log config data from ${this.character.Name}`)):(MainCanvas.textAlign="center",DrawText("Loading...",1e3,480,"Black"));MainCanvas.textAlign="left",DrawText(`- Behaviour Log: Configuration for ${this.character.Name} -`,125,125,"Black","Gray"),MainCanvas.textAlign="center",this.allowDelete&&DrawButton(1525,690,380,64,"Delete all log entries","White"),this.showHelp&&IE(Mp[Dp.LogConfig]),DrawButton(1815,75,90,90,"","White","Icons/Exit.png","Back"),DrawButton(1815,190,90,90,"","White","Icons/Question.png")}Click(){if(MouseIn(1815,75,90,90))return this.Exit();if(MouseIn(1815,190,90,90))this.showHelp=!this.showHelp;else if(null!==this.config){MouseIn(870,182,64,64)&&(this.filterInput.value="",this.rebuildList());for(let e=0;e<6;e++){const t=6*this.page+e;if(t>=this.configList.length)break;const n=this.configList[t],r=290+100*e;if(n.access>0&&MouseIn(1270,r,85,64)&&this.allowConfigure)return void this.character.setLogConfig(n.category,n.access-1);if(n.access<2&&MouseIn(1355,r,85,64)&&this.allowConfigure)return void this.character.setLogConfig(n.category,n.access+1)}if(MouseIn(1525,690,380,64)&&this.allowDelete)return void this.character.logClear().then((()=>{jk(new s_(this.character))}));const e=Math.ceil(this.configList.length/6);MouseIn(1605,800,150,90)?(this.page--,this.page<0&&(this.page=Math.max(e-1,0))):MouseIn(1755,800,150,90)&&(this.page++,this.page>=e&&(this.page=0))}}Exit(){jk(new s_(this.character))}Unload(){this.filterInput.remove()}}class s_ extends Ap{constructor(e){super(),this.failed=!1,this.logData=null,this.logEntries=[],this.allowDeletion=!1,this.allowConfiguration=!1,this.allowPraise=!1,this.allowLeaveMessage=!1,this.page=0,this.showMore=new Array(5).fill(!1),this.showHelp=!1,this.filterInput=Bd("text",30),this.character=e,this.filterInput.addEventListener("input",(e=>{this.refreshScreen()}))}Load(){this.requestData()}onChange(e){e===this.character.MemberNumber&&this.requestData()}requestData(){Promise.all([this.character.getLogEntries(),this.character.logGetAllowedActions()]).then((e=>{this.logData=e[0],this.allowDeletion=e[1].delete,this.allowConfiguration=e[1].configure||this.character.isPlayer(),this.allowPraise=e[1].praise,this.allowLeaveMessage=e[1].leaveMessage,this.failed=!1,this.refreshScreen()}),(e=>{console.error(`HardCoreClub: Failed to get log data for ${this.character}`,e),this.logData=null,this.failed=!0,this.refreshScreen()}))}refreshScreen(){if(!this.active)return;this.logEntries=[];let e=document.getElementById("BCX_NoteField");if(null===this.logData)return this.filterInput.remove(),void(e&&e.remove());this.filterInput.parentElement||document.body.appendChild(this.filterInput),!this.allowLeaveMessage&&e?e.remove():this.allowLeaveMessage&&!e&&(e=ElementCreateInput("BCX_NoteField","text","","30"));const t=this.filterInput.value.trim().toLocaleLowerCase().split(" ");this.logEntries=this.logData.filter((e=>{const n=pv(e,this.character).toLocaleLowerCase();return t.every((e=>n.includes(e)))}));const n=Math.ceil(this.logEntries.length/5);this.page<0?this.page=Math.max(n-1,0):this.page>=n&&(this.page=0)}Run(){if(null!==this.logData){DrawText("Filter:",130,215,"Black"),Od(this.filterInput,550,210,600,64),this.filterInput.value&&(MainCanvas.textAlign="center",DrawButton(870,182,64,64,"X","White"),this.allowDeletion&&DrawButton(1270,182,420,64,"Delete all filtered log entries","White"));for(let e=0;e<5;e++){const t=5*this.page+e;if(t>=this.logEntries.length)break;const n=this.logEntries[t],r=290+95*e;CE(n[1]===sv.protected?"Icons/Security.png":"Icons/Public.png",125,r,{Height:64,Width:64}),MainCanvas.textAlign="left";const o=pv(n,this.character);if(this.showMore[e])DrawRect(200,r-32,1030,128,"#ffff88"),DrawEmptyRect(200,r-32,1030,128,"Black"),DrawTextWrap(o,-285,r-32+5,990,118,"black",void 0,3);else{DrawButton(200,r,1030,64,"","White");let e=o;o.length>95&&(e=e.slice(0,80)+"... >> click <<"),DrawTextFit(e,210,r+34,1020,e.startsWith("[")?"Gray":"Black")}DrawEmptyRect(1270,r,320,64,"Black"),DrawTextFit(new Date(n[0]).toLocaleString(),1290,r+34,300,"Black",""),MainCanvas.textAlign="center",this.allowDeletion&&DrawButton(1630,r,64,64,"X","White","","Delete log entry"),MouseIn(125,r,64,64)&&DrawButtonHover(125,r,64,64,n[1]===sv.protected?"Protected visibility":"Normal visibility")}this.allowLeaveMessage&&(MainCanvas.textAlign="left",DrawText("Attach",130,831,"Black"),DrawText("note:",130,869,"Black"),ElementPosition("BCX_NoteField",580,842,660,64)),MainCanvas.textAlign="center",this.allowPraise&&DrawButton(950,815,150,64,"Praise","White"),this.allowLeaveMessage&&DrawButton(1150,815,200,64,"Only note","White"),this.allowPraise&&DrawButton(1400,815,150,64,"Scold","White");const e=Math.max(1,Math.ceil(this.logEntries.length/5));DrawBackNextButton(1605,800,300,90,`${InterfaceTextGet("Page")} ${this.page+1} / ${e}`,"White","",(()=>""),(()=>""))}else this.failed?(MainCanvas.textAlign="center",fA(`get log data from ${this.character.Name}`)):(MainCanvas.textAlign="center",DrawText("Loading...",1e3,480,"Black"));this.showHelp&&IE(Mp[Dp.Log]),MainCanvas.textAlign="left",DrawText(`- Behaviour Log: About ${this.character.Name} -`,125,125,"Black","Gray"),MainCanvas.textAlign="center",DrawButton(1815,75,90,90,"","White","Icons/Exit.png","BCX main menu"),DrawButton(1815,190,90,90,"","White","Icons/Question.png"),DrawButton(1815,305,90,90,"",this.allowConfiguration?"White":"#ddd","Icons/Preference.png","Configure logging",!this.allowConfiguration)}Click(){if(MouseIn(1815,75,90,90))return this.Exit();if(MouseIn(1815,190,90,90))this.showHelp=!this.showHelp;else{if(MouseIn(1815,305,90,90)&&this.allowConfiguration)return jk(new a_(this.character));if(null!==this.logData){if(MouseIn(870,182,64,64)&&(this.filterInput.value="",this.refreshScreen()),MouseIn(1270,182,420,64)&&this.allowDeletion)return void this.character.logMessageDelete(this.logEntries.map((e=>e[0])));for(let e=0;e<5;e++){const t=5*this.page+e;if(t>=this.logEntries.length)break;const n=this.logEntries[t],r=290+95*e;if(this.allowDeletion&&MouseIn(1630,r,64,64))return void this.character.logMessageDelete(n[0]);MouseIn(200,r-32,1030,128)&&this.showMore[e]?this.showMore[e]=!this.showMore[e]:MouseIn(200,r,1030,64)&&(this.showMore.includes(!0)&&this.showMore.fill(!1),this.showMore[e]=!this.showMore[e])}const e=document.getElementById("BCX_NoteField"),t=(null==e?void 0:e.value)||null;let n=!1;if(this.allowPraise&&MouseIn(950,815,150,64)&&(this.character.logPraise(1,t),n=!0),this.allowLeaveMessage&&MouseIn(1150,815,200,64)&&t&&(this.character.logPraise(0,t),n=!0),this.allowPraise&&MouseIn(1400,815,150,64)&&(this.character.logPraise(-1,t),n=!0),n)return this.allowPraise=!1,void(e&&(e.value=""));const r=Math.ceil(this.logEntries.length/5);MouseIn(1605,800,150,90)?(this.showMore.fill(!1),this.page--,this.page<0&&(this.page=Math.max(r-1,0))):MouseIn(1755,800,150,90)&&(this.showMore.fill(!1),this.page++,this.page>=r&&(this.page=0))}}}Exit(){jk(new Wk(this.character))}Unload(){this.filterInput.remove(),ElementRemove("BCX_NoteField")}}class l_ extends Ap{constructor(e){super(),this.showHelp=!1,this.page=0,this.character=e}Load(){this.setPage(0),this.character.isPlayer()&&ElementCreateInput("BCX_RoomSearchValueField","text",tA.roomSearchAutoFill||"","20")}setPage(e){this.page=e;const t=document.getElementById("BCX_RoomSearchValueField");t&&(t.style.display=0===this.page&&this.character.isPlayer()?"":"none")}Run(){var e;MainCanvas.textAlign="left",DrawText(`- Miscellaneous: Configuration for ${this.character.Name} -`,125,125,"Black","Gray"),MainCanvas.textAlign="center",DrawButton(1815,75,90,90,"","White","Icons/Exit.png","BCX main menu"),this.character.isPlayer()&&DrawButton(1815,190,90,90,"","White","Icons/Question.png"),DrawBackNextButton(1600,820,300,90,`Page ${this.page+1} / 2`,"White","",(()=>""),(()=>"")),this.character.isPlayer()?(MainCanvas.textAlign="left",0===this.page?(DrawCheckbox(125,200,64,64,"Enable typing indicator",!!tA.typingIndicatorEnable),DrawCheckbox(700,200,64,64,"Hide BC's typing & wardrobe icon on users showing BCX one",!!tA.typingIndicatorHideBC),DrawCheckbox(125,300,64,64,"Enable status indicator showing when you are in any player's BCX menu, biography, or wardrobe",!!tA.screenIndicatorEnable),DrawCheckbox(125,400,64,64,"Cheat: Prevent random NPC events (kidnappings, ransoms, asylum, club slaves)",Wb(vd.BlockRandomEvents)),DrawCheckbox(125,500,64,64,"Cheat: Prevent loosing Mistress status when reputation falls below 50 dominance",Wb(vd.CantLoseMistress)),DrawCheckbox(125,600,64,64,"Cheat: Give yourself the mistress padlock and its key",Wb(vd.GiveMistressKey)),DrawCheckbox(125,700,64,64,"Cheat: Give yourself the pandora padlock and its key",Wb(vd.GivePandoraKey)),DrawText("Use the following text to auto fill the chat room search field:",125,830,"Black","Gray"),ElementPosition("BCX_RoomSearchValueField",1320,827,460,64)):1===this.page&&DrawCheckbox(125,200,64,64,"Use the extended wardrobe importer as default",null===(e=tA.wardrobeDefaultExtended)||void 0===e||e),this.showHelp&&IE(Mp[Dp.Misc])):DrawText("Miscellaneous module configuration is not possible on others",1e3,500,"Black")}Click(){if(MouseIn(1815,75,90,90))return this.Exit();MouseIn(1815,190,90,90)&&this.character.isPlayer()?this.showHelp=!this.showHelp:this.character.isPlayer()&&(MouseIn(1600,820,150,90)?this.setPage(Ld(this.page-1,0,1)):MouseIn(1750,820,150,90)&&this.setPage(Ld(this.page+1,0,1)),0===this.page?(MouseIn(125,200,64,64)&&(tA.typingIndicatorEnable=!tA.typingIndicatorEnable,sA(),Jk()),MouseIn(700,200,64,64)&&(tA.typingIndicatorHideBC=!tA.typingIndicatorHideBC,sA()),MouseIn(125,300,64,64)&&(tA.screenIndicatorEnable=!tA.screenIndicatorEnable,sA(),Jk()),MouseIn(125,400,64,64)&&jb(vd.BlockRandomEvents),MouseIn(125,500,64,64)&&jb(vd.CantLoseMistress),MouseIn(125,600,64,64)&&jb(vd.GiveMistressKey),MouseIn(125,700,64,64)&&jb(vd.GivePandoraKey)):1===this.page&&MouseIn(125,200,64,64)&&(tA.wardrobeDefaultExtended=!tA.wardrobeDefaultExtended,sA()))}Exit(){const e=document.getElementById("BCX_RoomSearchValueField");e&&(e.value?tA.roomSearchAutoFill=e.value:delete tA.roomSearchAutoFill,sA()),jk(new Wk(this.character))}Unload(){ElementRemove("BCX_RoomSearchValueField")}}class c_ extends Ap{constructor(e,t){super(),this.showHelp=!1,this.exportCompress=!0,this.pasteListenredBound=this.pasteListener.bind(this),this.character=e,this.category=t}Load(){let e=document.getElementById("BCX_EI");e||(e=document.createElement("textarea"),e.id="BCX_EI",e.name="BCX_EI",e.value=Mp[Dp.ExportImportSelect],e.readOnly=!0,e.disabled=!0,e.setAttribute("screen-generated",CurrentScreen),e.className="HideOnPopup",document.body.appendChild(e)),document.addEventListener("paste",this.pasteListenredBound)}Unload(){var e;null===(e=document.getElementById("BCX_EI"))||void 0===e||e.remove(),document.removeEventListener("paste",this.pasteListenredBound)}Run(){DrawText(`- Export / Import of ${this.category.name} on ${this.character.Name} -`,125,125,"Black","Gray"),DrawButton(1815,75,90,90,"","White","Icons/Exit.png"),MainCanvas.textAlign="center",DrawButton(120,180,400,90,"Export","White","","Export current config"),DrawButton(620,180,400,90,"Import","White","","Try to import a previously exported config"),ElementPositionFix("BCX_EI",36,105,380,1790,500),MainCanvas.textAlign="left",DrawCheckbox(125,290,64,64,"Export compressed",this.exportCompress)}Click(){if(MouseIn(1815,75,90,90))return this.Exit();const e=document.getElementById("BCX_EI");if(MouseIn(120,180,400,90)&&e)return e.disabled=!1,e.value="Exporting...",void u((async()=>{try{const t=await this.character.exportImportDoExport(this.category.category,this.exportCompress);await navigator.clipboard.writeText(t),e.value="Exported to clipboard!"}catch(t){console.warn("Export failed:",t),e.value="Export failed:\n"+String(t)}}),0);MouseIn(620,180,400,90)&&e?u((async()=>{if("function"!=typeof navigator.clipboard.readText)return void(e.value="Please press Ctrl+V");const t=await navigator.clipboard.readText();e.disabled=!1,e.value="Importing...";try{e.value=await this.character.exportImportDoImport(this.category.category,t)}catch(t){console.warn("Import failed:",t),e.value="Import failed:\n"+String(t)}}),0):MouseIn(125,290,64,64)&&(this.exportCompress=!this.exportCompress)}pasteListener(e){const t=document.getElementById("BCX_EI");if(t){e.preventDefault(),e.stopImmediatePropagation();const n=(e.clipboardData||window.clipboardData).getData("text");u((async()=>{t.disabled=!1,t.value="Importing...";try{t.value=await this.character.exportImportDoImport(this.category.category,n)}catch(e){console.warn("Import failed:",e),t.value="Import failed:\n"+String(e)}}),0)}}Exit(){jk(new u_(this.character))}}class u_ extends Ap{constructor(e){super(),this.showHelp=!1,this.disabledModules=gd,this.character=e}Load(){this.character.getDisabledModules(5e3).then((e=>{this.disabledModules=e})).catch((e=>{this.disabledModules=[],console.error("HardCoreClub: error getting disabled modules",e)}))}onChange(e){e===this.character.MemberNumber&&this.Load()}Run(){DrawText(`- Export / Import of BCX module configurations on ${this.character.Name} -`,125,125,"Black","Gray"),DrawButton(1815,75,90,90,"","White","Icons/Exit.png","BCX main menu"),DrawButton(1815,190,90,90,"","White","Icons/Question.png");for(let e=0;e<Qy.length;e++){const t=Qy[e],n=Math.floor(e/6),r=e%6,o=this.disabledModules.includes(t.module);DrawButton(150+530*n,190+120*r,500,90,"",o?"#ddd":"White",fd[t.module],o?"Module is deactivated":"",o),DrawTextFit(t.name,250+530*n,235+120*r,390,"Black")}MainCanvas.textAlign="left",this.showHelp&&IE(Mp[Dp.ExportImportMain])}Click(){if(MouseIn(1815,75,90,90))return this.Exit();if(MouseIn(1815,190,90,90))this.showHelp=!this.showHelp;else for(let e=0;e<Qy.length;e++){const t=Qy[e],n=Math.floor(e/6);MouseIn(150+530*n,190+e%6*120,500,90)&&!this.disabledModules.includes(t.module)&&jk(new c_(this.character,t))}}Exit(){jk(new Wk(this.character))}}class d_ extends Ap{constructor(e){super(),this.relationshipsData=null,this.relationshipsList=[],this.failed=!1,this.page=0,this.memberNumberPrefill=null,this.showHelp=!1,this.character=e}Load(){this.requestData()}onChange(e){e===this.character.MemberNumber&&this.requestData()}requestData(){this.character.relatonshipsGet().then((e=>{this.active&&(this.relationshipsData=e,this.failed=!1,this.onDataChange())}),(e=>{console.error(`HardCoreClub: Failed to get relationships data from ${this.character}`,e),this.relationshipsData=null,this.failed=!0,this.onDataChange()}))}onDataChange(){var e,t;if(!this.active)return;this.relationshipsList=[];let n=document.getElementById("BCX_NameAdd"),r=document.getElementById("BCX_NewNameAdd");if(null==this.relationshipsData)return null==n||n.remove(),void(null==r||r.remove());n||(n=ElementCreateInput("BCX_NameAdd","text",null!==(t=null===(e=this.memberNumberPrefill)||void 0===e?void 0:e.toString())&&void 0!==t?t:"","8"),this.memberNumberPrefill=null),r||(r=ElementCreateInput("BCX_NewNameAdd","text","",String(xb))),this.relationshipsList=this.relationshipsData.relationships.map((e=>({memberNumber:e.memberNumber,name:ME(e.memberNumber,null),newName:e.nickname,enforced:e.enforceNickname}))),this.page=Rd(this.page,0,Math.ceil(this.relationshipsList.length/6))}Run(){if(MainCanvas.textAlign="left",DrawText(`- Relationships: Custom names shown (only) to ${this.character.Name} -`,125,125,"Black","Gray"),MainCanvas.textAlign="center",DrawButton(1815,75,90,90,"","White","Icons/Exit.png","BCX main menu"),DrawButton(1815,190,90,90,"","White","Icons/Question.png"),this.showHelp&&IE(Mp[Dp.Relationships]),null==this.relationshipsData)return MainCanvas.textAlign="center",void(this.failed?fA(`get role data from ${this.character.Name}`):DrawText("Loading...",1e3,480,"Black"));MainCanvas.textAlign="left",DrawRect(130,200,1484,64,"#eeeeee"),DrawText("Actual character name",140,234,"Black"),DrawText("Enforce speaking it?",740,234,"Black"),DrawText("Custom name",1260,234,"Black");for(let e=0;e<6;e++){const t=6*this.page+e;if(t>=this.relationshipsList.length)break;const n=this.relationshipsList[t],r=305+95*e,o=n.memberNumber===Player.MemberNumber?this.relationshipsData.access_modify_self:this.relationshipsData.access_modify_others;DrawEmptyRect(130,r,700,64,"Black",2);const i=`${null===n.name?"[unknown name]":n.name} (${n.memberNumber})`;DrawTextFit(i,140,r+34,680,"Black"),DrawCheckbox(880,r,64,64,"",n.enforced,!o),DrawEmptyRect(994,r,500,64,"Black",2),DrawTextFit(n.newName,1004,r+34,480,"Black"),MainCanvas.textAlign="center",MouseIn(880,r,64,64)&&DrawButtonHover(930,r,4,64,`${this.character.Name} can only say the custom name`),o&&DrawButton(1550,r,64,64,"X","White",void 0,"Delete this custom name"),MainCanvas.textAlign="left"}const e=document.getElementById("BCX_NameAdd");e&&(DrawText("Member Number:",130,847,"Black"),ElementPosition("BCX_NameAdd",580,842,300,64),this.relationshipsData.access_modify_others||(e.value=String(Player.MemberNumber))),DrawButton(740,815,64,64,"",this.relationshipsData.access_modify_others?"White":"#ddd",void 0,void 0,!this.relationshipsData.access_modify_others),CE("Icons/Title.png",742,815,{Width:60,Height:60}),MainCanvas.textAlign="center",MouseIn(740,815,64,64)&&DrawButtonHover(580,890,4,64,"Select member number from list"),MainCanvas.textAlign="left";const t=document.getElementById("BCX_NewNameAdd");t&&(DrawText("New name:",854,847,"Black"),ElementPosition("BCX_NewNameAdd",1210,842,300,64)),MainCanvas.textAlign="center";const n=e&&/^[0-9]+$/.test(e.value)?Number.parseInt(e.value,10):null,r=null!==n&&(n===Player.MemberNumber?this.relationshipsData.access_modify_self:this.relationshipsData.access_modify_others)&&t&&Nb(t.value);DrawButton(1375,815,90,64,"Add",r?"White":"#ddd",void 0,void 0,!r);const o=Math.max(Math.ceil(this.relationshipsList.length/6),1);DrawBackNextButton(1605,800,300,90,`Page ${this.page+1} / ${o}`,"White","",(()=>""),(()=>""))}Click(){var e,t,n,r;if(MouseIn(1815,75,90,90))return this.Exit();if(MouseIn(1815,190,90,90))return void(this.showHelp=!this.showHelp);if(!this.relationshipsData)return;for(let e=0;e<6;e++){const t=6*this.page+e;if(t>=this.relationshipsList.length)break;const n=this.relationshipsList[t],r=305+95*e,o=n.memberNumber===Player.MemberNumber?this.relationshipsData.access_modify_self:this.relationshipsData.access_modify_others;if(MouseIn(880,r,64,64)&&o)return void this.character.relationshipsSet({memberNumber:n.memberNumber,nickname:n.newName,enforceNickname:!n.enforced});if(MouseIn(1550,r,64,64)&&o)return void this.character.relationshipsRemove(n.memberNumber)}const o=document.getElementById("BCX_NameAdd"),i=null!==(e=null==o?void 0:o.value)&&void 0!==e?e:"",a=/^[0-9]+$/.test(i)?Number.parseInt(i,10):null,s=document.getElementById("BCX_NewNameAdd"),l=null!==(t=null==s?void 0:s.value)&&void 0!==t?t:"";if(o&&s&&null!==a&&Nb(l)&&MouseIn(1375,815,90,64)&&(a===Player.MemberNumber?this.relationshipsData.access_modify_self:this.relationshipsData.access_modify_others))return o.value="",s.value="",console.log("Send set"),void this.character.relationshipsSet({memberNumber:a,nickname:l,enforceNickname:null!==(r=null===(n=this.relationshipsList.find((e=>e.memberNumber===a)))||void 0===n?void 0:n.enforced)&&void 0!==r&&r});if(MouseIn(740,815,64,64)&&this.relationshipsData.access_modify_others)return void jk(new Np(this.character,this,(e=>{this.memberNumberPrefill=e}),this.relationshipsData.access_modify_self?void 0:[VA().MemberNumber]));const c=Math.ceil(this.relationshipsList.length/6);MouseIn(1605,800,150,90)?(this.page--,this.page<0&&(this.page=Math.max(c-1,0))):MouseIn(1755,800,150,90)&&(this.page++,this.page>=c&&(this.page=0))}Exit(){jk(new Wk(this.character))}Unload(){ElementRemove("BCX_NameAdd"),ElementRemove("BCX_NewNameAdd")}}var h_;!function(e){e[e.main=0]="main",e[e.clothSelect=1]="clothSelect",e[e.cosplaySelect=2]="cosplaySelect",e[e.bodySelect=3]="bodySelect",e[e.lockSelect=4]="lockSelect"}(h_||(h_={}));const m_={clothes:{title:"clothing",filter:e=>AE(e,!1)},cosplay:{title:"cosplay items",filter:e=>EE(e)},body:{title:"body parts",filter:e=>SE(e)},items:{title:"items",filter:e=>DE(e,["ItemNeck","ItemNeckAccessories","ItemNeckRestraints","ItemNipplesPiercings","ItemVulvaPiercings"])},piercings:{title:"piercings",filter:e=>DE(e,[])&&["ItemNipplesPiercings","ItemVulvaPiercings"].includes(e.Name)},collar:{title:"collar and accessories",filter:e=>DE(e,[])&&["ItemNeck","ItemNeckAccessories","ItemNeckRestraints"].includes(e.Name)}},p_=[null,"Introduction","BrickWall","grey","White"];let f_=[],g_=0;const y_=new Set,v_=new Set;class b_ extends Ap{constructor(e,t,n,r,o){var i,a;super(),this.screenState=h_.main,this.hiddenElements=new Set,this.allowLocks=!1,this.showHelp=!1,this.doApply=!1,this.skippedBlockedCount=0,this.exitCallback=e,this.character=t,this.allowBindsBase=n,this.clothesOnly=o,n&&(n=!o),this.allowBinds=n,this.bindsBlockedByLock=!1,this.allowPiercings=n,this.piercingsBlockedByLock=!1,this.allowCollar=n,this.collarBlockedByLock=!1,this.data=r;const s=t.MemberNumber&&XA(t.MemberNumber);this.allowCosplay=t.IsPlayer()||!1===(null===(i=t.OnlineSharedSettings)||void 0===i?void 0:i.BlockBodyCosplay),this.allowBody=t.IsPlayer()||!0===(null===(a=t.OnlineSharedSettings)||void 0===a?void 0:a.AllowFullWardrobeAccess),!s||!s.BCXVersion||this.allowCosplay&&this.allowBody||gA("rule_alt_allow_changing_appearance",void 0,s.MemberNumber).then((e=>{e&&(this.allowCosplay=!0,this.allowBody=!0)}))}Load(){for(const e of Array.from(document.getElementsByClassName("HideOnPopup")))e instanceof HTMLElement&&"none"!==e.style.display&&(this.hiddenElements.add(e),e.style.display="none");this.originalAppearance=CharacterAppearanceStringify(this.character),this.originalData=this.character.Appearance.map(WardrobeAssetBundle),this.skippedBlockedCount=0;for(let e=this.data.length-1;e>=0;e--){const t=this.data[e];S_(this.character,t.Group,t.Name,void 0)||(this.data.splice(e,1),this.skippedBlockedCount++)}for(const e of AssetGroup)if(!e.AllowNone&&!this.data.some((t=>t.Group===e.Name))){const t=this.originalData.find((t=>t.Group===e.Name));t&&this.data.push(t)}this.allowBinds&&A_(this.character,this.data,E_({cloth:!1,cosplay:!1,body:!1,binds:!0,collar:!1,piercings:!1}))&&(this.allowBinds=!1,this.bindsBlockedByLock=!0),this.allowPiercings&&A_(this.character,this.data,E_({cloth:!1,cosplay:!1,body:!1,binds:!0,collar:!1,piercings:!0}))&&(this.allowPiercings=!1,this.piercingsBlockedByLock=!0),this.allowCollar&&A_(this.character,this.data,E_({cloth:!1,cosplay:!1,body:!1,binds:!1,collar:!0,piercings:!1}))&&(this.allowCollar=!1,this.collarBlockedByLock=!0),this.refresh()}Unload(){for(const e of this.hiddenElements)e.style.display="";this.hiddenElements.clear(),this.doApply||(CharacterAppearanceRestore(this.character,this.originalAppearance),CharacterRefresh(this.character))}Run(){g_=Ld(g_,0,p_.length-1);const e=p_[g_];if(e&&CE("Backgrounds/"+e+".jpg",0,0),MainCanvas.textAlign="center",DrawButton(1420,45,50,50,"","White","","Color help"),CE("Icons/Question.png",1423,48,{Width:44,Height:44}),DrawButton(1515,45,207,50,"Import","White",""),DrawButton(1766,25,90,90,"","White","./Icons/Cancel.png"),DrawButton(1884,25,90,90,"","White","./Icons/Accept.png"),DrawBackNextButton(25,25,340,90,`Background ${g_+1} / ${Math.max(p_.length,1)}`,"White","",(()=>""),(()=>"")),this.showHelp&&(DrawRect(25,300,340,450,"#ffffff88"),DrawEmptyRect(25,300,340,450,"black"),DrawText("Color legend",195,340,"Black","#ddd"),DrawRect(50,374,290,64,"#ffb"),DrawRect(50,438,290,64,"#fff"),DrawRect(50,502,290,64,"#88c"),DrawRect(50,566,290,64,"#ccc"),DrawRect(50,630,290,64,"#faa"),MainCanvas.textAlign="center",DrawTextFit("Items are added",197.5,408,276,"Black"),DrawTextFit("Items are removed",197.5,472,276,"Black"),DrawTextFit("No item changes",197.5,536,276,"Black"),DrawTextFit("Not available/permitted",197.5,600,276,"Black"),DrawTextFit("Blocked by locks",197.5,664,276,"Black")),DrawCharacter(this.character,460,0,1,!0,MainCanvas),this.screenState===h_.main){DrawRect(970,220,810,710,"#ffffffcc"),DrawEmptyRect(970,220,810,710,"black"),MainCanvas.fillStyle="Black";{MainCanvas.textAlign="left";const{checked:e,color:t,disabled:n}=this.getGlobalSelectorState("clothes");DrawButton(1e3,250,50,50,"",t,void 0,void 0,n),DrawTextFit("Clothes",1100,275,300,"black"),"partial"===e?DrawRect(1008,258,34,34,"black"):"yes"===e&&CE("./Icons/Checked.png",1006,256,{Width:38,Height:38}),MainCanvas.textAlign="center",DrawButton(1400,250,350,50,"Select individually",n?"#ccc":"White",void 0,void 0,n)}{MainCanvas.textAlign="left";const{checked:e,color:t,disabled:n}=this.getGlobalSelectorState("cosplay");DrawButton(1e3,350,50,50,"",t,void 0,void 0,n),DrawTextFit("Cosplay items",1100,375,300,"black"),"partial"===e?DrawRect(1008,358,34,34,"black"):"yes"===e&&CE("./Icons/Checked.png",1006,356,{Width:38,Height:38}),MainCanvas.textAlign="center",DrawButton(1400,350,350,50,"Select individually",n?"#ccc":"White",void 0,void 0,n)}{MainCanvas.textAlign="left";const{checked:e,color:t,disabled:n}=this.getGlobalSelectorState("body");DrawButton(1e3,450,50,50,"",t,void 0,void 0,n),DrawTextFit("Body",1100,475,300,"black","white"),"partial"===e?DrawRect(1008,458,34,34,"black"):"yes"===e&&CE("./Icons/Checked.png",1006,456,{Width:38,Height:38}),MainCanvas.textAlign="center",DrawButton(1400,450,350,50,"Select individually",n?"#ccc":"White",void 0,void 0,n)}{MainCanvas.textAlign="left";const{checked:e,color:t,disabled:n}=this.getGlobalSelectorState("items");DrawButton(1e3,550,50,50,"",t,void 0,void 0,n),DrawTextFit("Restraints/items",1100,575,300,"black"),"partial"===e?DrawRect(1008,558,34,34,"black"):"yes"===e&&CE("./Icons/Checked.png",1006,556,{Width:38,Height:38})}{MainCanvas.textAlign="left";const{checked:e,color:t,disabled:n}=this.getGlobalSelectorState("collar");DrawButton(1e3,650,50,50,"",t,void 0,void 0,n),DrawTextFit("Collar",1100,675,300,"black"),"partial"===e?DrawRect(1008,658,34,34,"black"):"yes"===e&&CE("./Icons/Checked.png",1006,656,{Width:38,Height:38})}{MainCanvas.textAlign="left";const{checked:e,color:t,disabled:n}=this.getGlobalSelectorState("piercings");DrawButton(1e3,750,50,50,"",t,void 0,void 0,n),DrawTextFit("Piercings",1100,775,300,"black"),"partial"===e?DrawRect(1008,758,34,34,"black"):"yes"===e&&CE("./Icons/Checked.png",1006,756,{Width:38,Height:38})}{MainCanvas.textAlign="left";const{checked:e,color:t,disabled:n}=this.getLocksState();DrawButton(1e3,850,50,50,"",t,void 0,void 0,n),DrawTextFit("Locks",1100,875,300,"black"),"partial"===e?DrawRect(1008,858,34,34,"black"):"yes"===e&&CE("./Icons/Checked.png",1006,856,{Width:38,Height:38}),MainCanvas.textAlign="center",DrawButton(1400,850,350,50,"Select individually",n?"#ccc":"White",void 0,void 0,n)}let e;this.skippedBlockedCount>0?e=`Skipped ${this.skippedBlockedCount} blocked/limited item${this.skippedBlockedCount>1?"s":""}`:this.allowBindsBase||this.clothesOnly||(e="You do not have permission to import items."),e&&(DrawRect(970,140,810,70,"Pink"),DrawEmptyRect(970,140,810,70,"Black"),DrawTextFit(e,1370,177,800,"Black"))}else this.screenState===h_.clothSelect?this.drawSelectorArea("clothes"):this.screenState===h_.cosplaySelect?this.drawSelectorArea("cosplay"):this.screenState===h_.bodySelect?this.drawSelectorArea("body"):this.screenState===h_.lockSelect&&this.drawLocksSelector()}drawSelectorArea(e){var t,n,r;const o=m_[e],i=AssetGroup.filter(o.filter);MainCanvas.textAlign="left",DrawRect(1005,165,830,64,"#cccccc"),DrawText(`Choose ${o.title}`,1290,199,"Black"),MainCanvas.textAlign="center",DrawButton(1020,173,200,48,"<<< Back","White");for(let e=0;e<i.length;e++){const o=e%10,a=Math.floor(e/10),s=i[e],l=this.originalData.find((e=>e.Group===s.Name)),c=l&&AssetGet(this.character.AssetFamily,l.Group,l.Name),u=this.data.find((e=>e.Group===s.Name)),d=u&&AssetGet(this.character.AssetFamily,u.Group,u.Name),h=w_(s.Name,this.data,this.originalData),m=(null==c?void 0:c.Name)===(null==d?void 0:d.Name),p=h?"#88c":d?"#ffb":"#fff",f=h?null!==(t=null==c?void 0:c.Description)&&void 0!==t?t:"[EMPTY]":m?`Changes to the configuration of ${null==c?void 0:c.Description}`:(null!==(n=null==c?void 0:c.Description)&&void 0!==n?n:"[EMPTY]")+"  "+(null!==(r=null==d?void 0:d.Description)&&void 0!==r?r:"[EMPTY]");if(DrawButton(1006+281*a,240+69*o,265,54,pE(s),p,void 0,void 0,h),MouseIn(1006+281*a,240+69*o,265,54)){const e=1006,t=930;DrawRect(e,t,826,65,"#FFFF88"),DrawEmptyRect(e,t,826,65,"black",2),DrawTextFit(f,e+413,t+33,820,"black")}!h&&y_.has(s.Name)&&DrawEmptyRect(1006+281*a-2,240+69*o-2,269,58,"#FF69B4",4)}}clickSelectorArea(e){const t=m_[e],n=AssetGroup.filter(t.filter);if(MouseIn(1020,173,200,48))this.screenState=h_.main;else for(let e=0;e<n.length;e++){const t=e%10,r=Math.floor(e/10),o=n[e],i=w_(o.Name,this.data,this.originalData);if(MouseIn(1006+281*r,240+69*t,265,54)&&!i)return y_.has(o.Name)?y_.delete(o.Name):y_.add(o.Name),void this.refresh()}}drawLocksSelector(){const e=new Set(this.data.filter((e=>{var t;return Ed(e.Property)&&"string"==typeof e.Property.LockedBy&&!0===(null===(t=AssetGet(this.character.AssetFamily,"ItemMisc",e.Property.LockedBy))||void 0===t?void 0:t.IsLock)})).map((e=>e.Property.LockedBy)));MainCanvas.textAlign="left",DrawRect(1005,165,830,64,"#cccccc"),DrawText("Choose lock types",1290,199,"Black"),MainCanvas.textAlign="center",DrawButton(1020,173,200,48,"<<< Back","White");for(let t=0;t<f_.length;t++){const n=t%10,r=Math.floor(t/10),o=f_[t],i=e.has(o.Name),a=i?"#ffb":"#88c";DrawButton(1006+281*r,240+69*n,265,54,o.Description,a,void 0,void 0,!i),i&&v_.has(o.Name)&&DrawEmptyRect(1006+281*r-2,240+69*n-2,269,58,"#FF69B4",4)}}clickLocksSelector(){const e=new Set(this.data.filter((e=>{var t;return Ed(e.Property)&&"string"==typeof e.Property.LockedBy&&!0===(null===(t=AssetGet(this.character.AssetFamily,"ItemMisc",e.Property.LockedBy))||void 0===t?void 0:t.IsLock)})).map((e=>e.Property.LockedBy)));if(MouseIn(1020,173,200,48))this.screenState=h_.main;else for(let t=0;t<f_.length;t++){const n=t%10,r=Math.floor(t/10),o=f_[t],i=e.has(o.Name);if(MouseIn(1006+281*r,240+69*n,265,54)&&i)return v_.has(o.Name)?v_.delete(o.Name):v_.add(o.Name),void this.refresh()}}Click(){if(MouseIn(1420,45,50,50)||MouseIn(25,300,340,450)&&this.showHelp)this.showHelp=!this.showHelp;else if(MouseIn(1515,45,207,50))u((async()=>{if("function"!=typeof navigator.clipboard.readText)return void fE("Please press Ctrl+V",5e3);const e=__(await navigator.clipboard.readText());"string"!=typeof e?this.exitCallback(new b_(this.exitCallback,this.character,this.allowBindsBase,e,!1)):fE(e,5e3)}),0);else{if(MouseIn(1766,25,90,90))return this.Exit();if(MouseIn(1884,25,90,90))return this.doApply=!0,this.Exit();if(MouseIn(25,25,170,90))g_=Ld(g_-1,0,p_.length-1);else if(MouseIn(195,25,170,90))g_=Ld(g_+1,0,p_.length-1);else if(this.screenState===h_.main){if(MouseIn(1e3,250,50,50)){const e=this.getGlobalSelectorState("clothes");return void(e.disabled||(AssetGroup.filter(m_.clothes.filter).forEach((t=>{"no"===e.checked?y_.add(t.Name):y_.delete(t.Name)})),this.refresh()))}if(MouseIn(1400,250,350,50)&&!this.getGlobalSelectorState("clothes").disabled&&(this.screenState=h_.clothSelect),MouseIn(1e3,350,50,50)){const e=this.getGlobalSelectorState("cosplay");return void(e.disabled||(AssetGroup.filter(m_.cosplay.filter).forEach((t=>{"no"===e.checked?y_.add(t.Name):y_.delete(t.Name)})),this.refresh()))}if(MouseIn(1400,350,350,50)&&!this.getGlobalSelectorState("cosplay").disabled&&(this.screenState=h_.cosplaySelect),MouseIn(1e3,450,50,50)){const e=this.getGlobalSelectorState("body");return void(e.disabled||(AssetGroup.filter(m_.body.filter).forEach((t=>{"no"===e.checked?y_.add(t.Name):y_.delete(t.Name)})),this.refresh()))}if(MouseIn(1400,450,350,50)&&!this.getGlobalSelectorState("body").disabled&&(this.screenState=h_.bodySelect),MouseIn(1e3,550,50,50)){const e=this.getGlobalSelectorState("items");return void(e.disabled||(AssetGroup.filter(m_.items.filter).forEach((t=>{"no"===e.checked?y_.add(t.Name):y_.delete(t.Name)})),this.refresh()))}if(MouseIn(1e3,650,50,50)){const e=this.getGlobalSelectorState("collar");return void(e.disabled||(AssetGroup.filter(m_.collar.filter).forEach((t=>{"no"===e.checked?y_.add(t.Name):y_.delete(t.Name)})),this.refresh()))}if(MouseIn(1e3,750,50,50)){const e=this.getGlobalSelectorState("piercings");return void(e.disabled||(AssetGroup.filter(m_.piercings.filter).forEach((t=>{"no"===e.checked?y_.add(t.Name):y_.delete(t.Name)})),this.refresh()))}if(MouseIn(1e3,850,50,50)){const e=this.getLocksState();return void(e.disabled||(f_.forEach((t=>{"no"===e.checked?v_.add(t.Name):v_.delete(t.Name)})),this.refresh()))}MouseIn(1400,850,350,50)&&!this.getLocksState().disabled&&(this.screenState=h_.lockSelect)}else this.screenState===h_.clothSelect?this.clickSelectorArea("clothes"):this.screenState===h_.cosplaySelect?this.clickSelectorArea("cosplay"):this.screenState===h_.bodySelect?this.clickSelectorArea("body"):this.screenState===h_.lockSelect&&this.clickLocksSelector()}}Exit(){this.exitCallback(null)}refresh(){const e=this.getGlobalSelectorState("items"),t=this.getGlobalSelectorState("collar"),n=this.getGlobalSelectorState("piercings");this.allowLocks=this.data.some((e=>{var t,n;return null===(n=null===(t=e.Property)||void 0===t?void 0:t.Effect)||void 0===n?void 0:n.includes("Lock")}))&&(this.allowBinds&&"no"!==e.checked&&!e.disabled||this.allowPiercings&&"no"!==n.checked&&!n.disabled||this.allowCollar&&"no"!==t.checked&&!t.disabled),CharacterAppearanceRestore(this.character,this.originalAppearance),M_(this.character,this.data,(e=>this.checkAllowChange(_E(e))),!!this.allowLocks&&v_)}checkAllowChange(e){return!(!this.allowCosplay&&m_.cosplay.filter(e))&&!(!this.allowBody&&m_.body.filter(e))&&!(!this.allowBinds&&m_.items.filter(e))&&!(!this.allowPiercings&&m_.piercings.filter(e))&&!(!this.allowCollar&&m_.collar.filter(e))&&y_.has(e.Name)&&!w_(e.Name,this.data,this.originalData)}getGlobalSelectorState(e){const t=m_[e],n=AssetGroup.filter(t.filter);if(function(e,t,n){const r=m_[e];return AssetGroup.filter(r.filter).every((e=>w_(e.Name,t,n)))}(e,this.data,this.originalData))return{checked:"no",color:"#88c",disabled:!0};const r="clothes"===e||("cosplay"===e?this.allowCosplay:"body"===e?this.allowBody:"items"===e?this.allowBinds:"piercings"===e?this.allowPiercings:"collar"===e&&this.allowCollar),o=!r&&("items"===e?this.bindsBlockedByLock:"piercings"===e?this.piercingsBlockedByLock:"collar"===e&&this.collarBlockedByLock);if(!r)return{checked:"no",color:o?"#faa":"#ccc",disabled:!0};const i=n.filter((e=>!w_(e.Name,this.data,this.originalData)));let a="no";const s=i.map((e=>e.Name)).filter((e=>y_.has(e)));return s.length>0&&(a=s.length===i.length?"yes":"partial"),{checked:a,color:this.data.some((e=>n.some((t=>t.Name===e.Group))))?"#ffb":"#fff",disabled:!1}}getLocksState(){const e=new Set(this.data.filter((e=>{var t;return Ed(e.Property)&&"string"==typeof e.Property.LockedBy&&!0===(null===(t=AssetGet(this.character.AssetFamily,"ItemMisc",e.Property.LockedBy))||void 0===t?void 0:t.IsLock)})).map((e=>e.Property.LockedBy)));if(0===e.size)return{checked:"no",color:"#88c",disabled:!0};if(!this.allowLocks)return{checked:"no",color:"#ccc",disabled:!0};let t="no";const n=Array.from(e).filter((e=>v_.has(e)));return n.length>0&&(t=n.length===e.size?"yes":"partial"),{checked:t,color:"#ffb",disabled:!1}}}function w_(e,t,n){var r,o,i,a;const s=t.find((t=>t.Group===e)),l=n.find((t=>t.Group===e));return void 0===s&&void 0===l||void 0!==s&&void 0!==l&&s.Group===l.Group&&s.Name===l.Name&&NE(s.Color,l.Color)&&(null!==(r=s.Difficulty)&&void 0!==r?r:0)===(null!==(o=l.Difficulty)&&void 0!==o?o:0)&&zp(null!==(i=s.Property)&&void 0!==i?i:{},null!==(a=k_(s.Property,l.Property,{includeNoncursableProperties:!0,lockAssignMemberNumber:Player.MemberNumber}))&&void 0!==a?a:{})&&zp(s.Craft,l.Craft)}function C_(e=!1){if(!CharacterAppearanceSelection)return"";const t=CharacterAppearanceSelection.Appearance.filter(E_({cloth:!0,cosplay:!0,body:!0,binds:e,collar:e,piercings:e})).map((e=>({...WardrobeAssetBundle(e),Craft:D_(e.Craft,e.Asset).result})));return LZString.compressToBase64(JSON.stringify(t))}function __(e){if("string"!=typeof e||!e.trim())return"Import error: No data";try{if("["!==e[0]){const t=LZString.decompressFromBase64(e);if(!t)return"Import error: Bad data";e=t}const t=JSON.parse(e);return Array.isArray(t)?t:"Import error: Bad data"}catch(e){return console.warn(e),"Import error: Bad data"}}function k_(e,t,{includeNoncursableProperties:n=!1,lockAssignMemberNumber:r}={}){const o=kp(null!=e?e:{});t=kp(null!=t?t:{}),null!=r&&(t.LockedBy?o.LockedBy===t.LockedBy&&"number"==typeof o.LockMemberNumber?t.LockMemberNumber=o.LockMemberNumber:t.LockMemberNumber=r:delete t.LockMemberNumber);for(const e of xd(Object.keys(t).concat(Object.keys(o))))"Effect"!==e&&(!n&&q_.includes(e)||(void 0===t[e]?void 0!==o[e]&&delete o[e]:typeof t[e]==typeof o[e]&&zp(t[e],o[e])||(o[e]=kp(t[e]))));const i=Array.isArray(o.Effect)?o.Effect.filter((e=>!n&&X_.includes(e))):[],a=Array.isArray(o.Effect)?o.Effect.filter((e=>n||!X_.includes(e))).sort():[],s=Array.isArray(t.Effect)?t.Effect.filter((e=>n||!X_.includes(e))).sort():[];if(zp(new Set(a),new Set(s))||(o.Effect=s.concat(i)),0!==Object.keys(t).length)return o}function A_(e,t,n){var r,o,i,a;if(e.Appearance.some((e=>{var t,n;return DE(e)&&(null===(n=null===(t=e.Property)||void 0===t?void 0:t.Effect)||void 0===n?void 0:n.includes("Lock"))}))){const s=new Set,l=t=>{var n;if(DE(t))for(const r of(t.Asset.Block||[]).concat(Array.isArray(null===(n=t.Property)||void 0===n?void 0:n.Block)?t.Property.Block:[])){if(s.has(r)||!AssetGroup.some((e=>e.Name===r)))continue;s.add(r);const t=e.Appearance.find((e=>e.Asset.Group.Name===r));t&&l(t)}};for(const t of e.Appearance)(null===(o=null===(r=t.Property)||void 0===r?void 0:r.Effect)||void 0===o?void 0:o.includes("Lock"))&&!s.has(t.Asset.Group.Name)&&(s.add(t.Asset.Group.Name),l(t));for(const r of s){const o=e.Appearance.find((e=>e.Asset.Group.Name===r)),s=t.find((e=>e.Group===r));if(o){if(n(o)&&(!s||o.Asset.Name!==s.Name||!NE(o.Color,s.Color)||!zp(null!==(i=o.Property)&&void 0!==i?i:{},null!==(a=k_(o.Property,s.Property,{includeNoncursableProperties:!0,lockAssignMemberNumber:Player.MemberNumber}))&&void 0!==a?a:{})))return!0}else if(s)return!0}}return!1}function E_({cloth:e,cosplay:t,body:n,binds:r,collar:o,piercings:i}){return a=>e&&AE(a,!1)||t&&EE(a)||n&&SE(a)||r&&DE(a,["ItemNeck","ItemNeckAccessories","ItemNeckRestraints","ItemNipplesPiercings","ItemVulvaPiercings"])||o&&DE(a,[])&&["ItemNeck","ItemNeckAccessories","ItemNeckRestraints"].includes(_E(a).Name)||i&&DE(a,[])&&["ItemNipplesPiercings","ItemVulvaPiercings"].includes(_E(a).Name)}function S_(e,t,n,r){const o=VA().MemberNumber;return(null==r||S_(e,t,n,void 0))&&!ValidationIsItemBlockedOrLimited(e,o,t,n)&&(!e.IsPlayer()||!InventoryIsPermissionBlocked(e,n,t))}function D_(e,t){if(void 0===e)return{result:void 0,messages:[]};if(!Ed(e))return{result:void 0,messages:["Expected object, got "+typeof e]};const n=console.warn;try{const n=[];return console.warn=e=>{"string"==typeof e&&n.push(e)},{result:CraftingValidate(e,t,!0)>CraftingStatusType.CRITICAL_ERROR?e:void 0,messages:n}}catch(e){return n("HardCoreClub: Failed crafted data validation because of crash:",e),{result:void 0,messages:[`Validation failed: ${e}`]}}finally{console.warn=n}}function M_(e,t,n,r){const o=VA().MemberNumber,i=ValidationCreateDiffParams(e,o),a=new Set;t.forEach((e=>a.add(e.Group))),e.Appearance=e.Appearance.filter((e=>!ValidationCanRemoveItem(e,i,a.has(e.Asset.Group.Name))||!n(e)));for(const o of t){if(e.Appearance.some((e=>e.Asset.Group.Name===o.Group))||!S_(e,o.Group,o.Name,void 0))continue;const t=AssetGet(e.AssetFamily,o.Group,o.Name);if(null!=t){if(n(t)){CharacterAppearanceSetItem(e,o.Group,t,o.Color,0,void 0,!1);const n=InventoryGet(e,o.Group);if(o.Property&&n){Ed(o.Property)?n.Property=k_(n.Property,o.Property,{includeNoncursableProperties:"string"==typeof o.Property.LockedBy&&S_(e,"ItemMisc",o.Property.LockedBy,void 0)&&(!e.IsPlayer()||!InventoryIsPermissionBlocked(e,o.Property.LockedBy,"ItemMisc"))&&(!0===r||"boolean"!=typeof r&&r.has(o.Property.LockedBy)),lockAssignMemberNumber:Player.MemberNumber}):n.Property=kp(o.Property);const i=D_(o.Craft,t);i.messages.length>0&&console.warn(`HardCoreClub: Crafted item validation failed:\n${i.messages.join("\n")}`),n.Craft=i.result}}}else console.warn("Clothing not found: ",o)}CharacterRefresh(e,!1)}function x_(e,t,n=!1){var r;if(!Array.isArray(e)&&"string"==typeof(e=__(e)))return e;const o=CharacterAppearanceSelection;if(!o)return"Import error: No character";if(o.MemberNumber!==I_&&t)return"Import error: Not allowed to import items";const i=E_({cloth:!0,cosplay:!0!==(null===(r=o.OnlineSharedSettings)||void 0===r?void 0:r.BlockBodyCosplay)||o.IsPlayer(),body:!1,binds:t,collar:!1,piercings:t});if(t&&!n&&A_(o,e,i))return"Refusing to change locked item!";let a=t;if(t)for(const t of xd(o.Appearance.filter(i).map((e=>e.Asset.Group.Name)).concat(e.map((e=>e.Group))))){const n=o.Appearance.find((e=>e.Asset.Group.Name===t)),r=e.find((e=>e.Group===t));n&&r&&n.Asset.Name===r.Name&&NE(n.Color,r.Color)&&zp(Z_(n.Property),Z_(r.Property))||(a=!1)}return M_(o,e,i,a),!a&&t&&e.some((e=>{var t,n;return Array.isArray(null===(t=e.Property)||void 0===t?void 0:t.Effect)&&(null===(n=e.Property)||void 0===n?void 0:n.Effect.includes("Lock"))}))?"Imported! Repeat to also import locks.":"Imported!"}let N_=!1,I_=-1,R_=!1,L_=!1;const T_="BCX's wardrobe export/import works by converting your appearance into a long code word that is copied to your device's clipboard. You can then paste it anywhere you like, for instance a text file. You can wear the look again by copying the code word to the clipboard and importing it with the according button. Functionality of this feature depends on the device you are using and if the clipboard can be used on it. Importing has two modes: quick and extended. The default behavior when importing is the extended mode, but you can use the quick one when you hold the 'Shift' button while importing. This behavior can be switched around in the misc module settings. The button to the left of the 'Export'-button toggles whether items/restraints on your character should also be exported or imported while using quick mode. Using quick mode, importing with items has two stages: First usage adds no locks, second one also imports locks from the exported items. Importing an outfit with restraints will fail if it would change any item that is locked (or blocked by a locked item), except collars, neck accessories/restraints, and piercings. Those, as well as the body itself, are ignored.";function P_(e){if("Appearance"===CurrentScreen&&"Wardrobe"===CharacterAppearanceMode||"Wardrobe"===CurrentScreen){e.preventDefault(),e.stopImmediatePropagation();const t=(e.clipboardData||window.clipboardData).getData("text"),n=j_()?U_(t):x_(t,N_,lE);n&&(CharacterAppearanceWardrobeText=n)}}function B_(e){L_=e.shiftKey}let O_=null,$_=!1;function F_(){return"Appearance"===CurrentScreen&&null!=CharacterAppearanceSelection&&"Cloth"===CharacterAppearanceMode&&null==DialogFocusItem}function H_(e,t){var n;if(!O_){O_=ElementCreateInput("BCXSearch","text","","40"),O_.oninput=()=>{O_&&($_&&!O_.value?(W_(e),MainCanvas.canvas.focus()):(DialogInventoryBuild(e),AppearancePreviewBuild(e,!0),AppearanceMenuBuild(e)))},O_.focus(),O_.setAttribute("value",null!=t?t:"");const r=null!==(n=null==t?void 0:t.length)&&void 0!==n?n:0;O_.setSelectionRange(r,r),DialogInventoryBuild(e),AppearancePreviewBuild(e,!0),AppearanceMenuBuild(e)}}function W_(e){O_&&(O_.remove(),O_=null,$_=!1,DialogInventoryBuild(e),AppearancePreviewBuild(e,!0),AppearanceMenuBuild(e))}let G_=null;function j_(){var e;return(null!==(e=tA.wardrobeDefaultExtended)&&void 0!==e&&e)!==L_}function U_(e,t=!1){const n=Array.isArray(e)?e:__(e);if("string"==typeof n)return n;const r=CharacterAppearanceSelection;if(!r)return"Import error: No character";const o=r.MemberNumber===I_;return Y_(new b_(Y_,r,o,n,t)),null}function Y_(e){G_&&(G_.Unload(),G_=null),G_=e,e&&e.Load()}const q_=ValidationModifiableProperties.concat(["HeartRate"]),X_=["Lock"],z_=["SlaveCollar","ClubSlaveCollar"],V_=["Appearance","Wardrobe","ChatSelect","ChatSearch","ChatCreate"];function Z_(e){const t={};if(Ed(e))for(const n of Object.keys(e))if("Effect"===n)if(Array.isArray(e.Effect)&&e.Effect.every((e=>"string"==typeof e))){const n=e.Effect.filter((e=>!X_.includes(e)));n.length>0&&(t.Effect=n)}else console.error("HardCoreClub: Bad effect of properties: ",e.Effect);else q_.includes(n)||void 0===e[n]||(t[n]=kp(e[n]));return t}function K_(e){const t={Name:e.Asset.Name,curseProperty:!1,Difficulty:e.Difficulty||void 0,Color:e.Color&&"Default"!==e.Color?kp(e.Color):void 0,Property:Z_(e.Property),Craft:D_(e.Craft,e.Asset).result};return 0===Object.keys(t.Property).length&&delete t.Property,t}function J_(e){var t,n,r,o;return!!(e.Extended||(null===(t=e.Effect)||void 0===t?void 0:t.includes("Egged"))||(null===(n=e.AllowEffect)||void 0===n?void 0:n.includes("Egged"))||(null===(r=e.Effect)||void 0===r?void 0:r.includes("UseRemote"))||(null===(o=e.AllowEffect)||void 0===o?void 0:o.includes("UseRemote")))}function Q_(e){var t;return J_(e)&&e.Extended&&["typed","modular"].includes(null!==(t=e.Archetype)&&void 0!==t?t:"")&&!e.DynamicScriptDraw}function ek(e,t,n){var r;if(!AA(md.Curses))return!1;const o=AssetGroup.find((t=>t.Name===e));if(!o||"boolean"!=typeof t&&null!==t)return console.error("HardCoreClub: Attempt to curse with invalid data",e,t),!1;if("Appearance"===o.Category&&!o.AllowCustomize)return console.warn("HardCoreClub: Attempt to curse non-customizable slot",e),!1;if(n&&!sC("curses",e,n))return!1;const i=InventoryGet(Player,e);if(!i&&!o.AllowNone)return console.error("HardCoreClub: Refusing to curse empty group that doesn't allow none"),!1;if(i){if(null===t){if(oC("curses",e))return!0;t=Q_(i.Asset)}!J_(i.Asset)&&t&&(console.warn(`HardCoreClub: Attempt to curse properties of item ${i.Asset.Group.Name}:${i.Asset.Name}, while not allowed`),t=!1);const a=K_(i);t&&(a.curseProperty=!0),(null===(r=eC("curses").data)||void 0===r?void 0:r.itemRemove)&&o.AllowNone&&(a.itemRemove=!0),iC("curses",e,a,n),n&&(lv("curse_change",av.plaintext,`${n} cursed ${Player.Name}'s ${o.AllowNone?i.Asset.Description:o.Description}`),n.isPlayer()||yE(`${n.toNicknamedString()} cursed the ${o.AllowNone?i.Asset.Description:o.Description} on you`))}else iC("curses",e,null,n),n&&(lv("curse_change",av.plaintext,`${n} cursed ${Player.Name}'s body part to stay exposed (${pE(o)})`),n.isPlayer()||yE(`${n.toNicknamedString()} put a curse on you, forcing part of your body to stay exposed (${pE(o)})`));return sA(),wA(),!0}function tk(e,t,n){if(n&&!TA("curses_normal",n)&&!TA("curses_limited",n))return!1;let r;if("items"===e)r=AssetGroup.filter((e=>"Item"===e.Category&&(t||InventoryGet(Player,e.Name))));else if("clothes"===e)r=AssetGroup.filter((e=>"Appearance"===e.Category&&e.Clothing&&(t||InventoryGet(Player,e.Name))));else{if("body"!==e)return console.error("HardCoreClub: Attempt to curse in invalid mode",e),!1;r=AssetGroup.filter((e=>"Appearance"===e.Category&&!e.Clothing&&e.AllowCustomize&&(t||InventoryGet(Player,e.Name))))}n&&(lv("curse_change",av.plaintext,`${n} cursed all of ${Player.Name}'s ${t?"":"occupied "}${"items"===e?"item":"clothes"===e?"clothing":"body"} slots`),n.isPlayer()||yE(`${n.toNicknamedString()} cursed all of your ${t?"":"occupied "}${"items"===e?"item":"clothes"===e?"clothing":"body"} slots`));for(const e of r)if(!oC("curses",e.Name)&&(!n||sC("curses",e.Name,n))&&!ek(e.Name,null,null))return!1;return!0}function nk(e,t){var n;if(!AA(md.Curses))return!1;if(t&&!sC("curses",e,t))return!1;const r=oC("curses",e);if(r){const o=AssetGroup.find((t=>t.Name===e));if(t&&o){const i=r.data&&(null===(n=AssetGet(Player.AssetFamily,e,r.data.Name))||void 0===n?void 0:n.Description);i?(lv("curse_change",av.plaintext,`${t} lifted the curse on ${Player.Name}'s ${i}`),t.isPlayer()||yE(`${t.toNicknamedString()} lifted the curse on your ${i}`)):(lv("curse_change",av.plaintext,`${t} lifted the curse on ${Player.Name}'s body part (${pE(o)})`),t.isPlayer()||yE(`${t.toNicknamedString()} lifted the curse on part of your body (${pE(o)})`))}return lC("curses",e),!0}return!1}function rk(e){return!!AA(md.Curses)&&!!(!e||TA("curses_normal",e)&&TA("curses_limited",e))&&(e&&(lv("curse_change",av.plaintext,`${e} lifted all curse on ${Player.Name}`),e.isPlayer()||yE(`${e.toNicknamedString()} lifted all curses on you`)),lC("curses",Dd(eC("curses").conditions)),!0)}class ok extends Ap{constructor(e,t,n,r){super(),this.conditionCategoryData=null,this.conditionData=null,this.failed=!1,this.changes=null,this.showHelp=!1,this.character=e,this.conditionCategory=t,this.conditionName=n,this.back=r}makeChangesData(){var e;if(!this.conditionData)throw new Error("Data required");return null!==(e=this.changes)&&void 0!==e?e:kp(this.conditionData)}Load(){this.requestData()}onChange(e){e===this.character.MemberNumber&&this.requestData()}requestData(){this.character.conditionsGetByCategory(this.conditionCategory).then((e=>{if(!this.active)return;const t=e.conditions[this.conditionName];t?(this.conditionCategoryData=e,this.conditionData=t,this.checkAccess()||(this.changes=null),this.failed=!1,this.onDataChange()):(console.warn(`HardCoreClub: Condition ${this.conditionCategory}:${this.conditionName} not found in list from ${this.character}`),this.conditionCategoryData=null,this.conditionData=null,this.failed=!0,this.onDataChange(),this.Exit())}),(e=>{console.error(`HardCoreClub: Failed to get condition info for ${this.conditionCategory}:${this.conditionName} from ${this.character}`,e),this.failed=!0}))}setUseGlobal(e){var t;this.changes&&this.conditionData&&this.conditionCategoryData&&(this.changes.requirements=e?null:kp(null!==(t=this.conditionData.requirements)&&void 0!==t?t:this.conditionCategoryData.requirements))}onDataChange(){var e,t,n,r,o,i,a,s,l,c,u,d;let h=document.getElementById("BCX_ConditionRoomName"),m=document.getElementById("BCX_ConditionMemberNumber");if(!this.conditionCategoryData||!this.conditionData)return h&&h.remove(),void(m&&m.remove());const p=null!==(e=this.changes)&&void 0!==e?e:this.conditionData,f=null!==(t=p.requirements)&&void 0!==t?t:this.conditionCategoryData.requirements,g=!p.requirements,y=!this.checkAccess()||g;h||(h=ElementCreateInput("BCX_ConditionRoomName","text",null!==(r=null===(n=f.roomName)||void 0===n?void 0:n.name)&&void 0!==r?r:"","30"),h.oninput=()=>{this.changes=this.makeChangesData(),this.processInputs()}),m||(m=ElementCreateInput("BCX_ConditionMemberNumber","text",null!==(a=null===(i=null===(o=f.player)||void 0===o?void 0:o.memberNumber)||void 0===i?void 0:i.toString())&&void 0!==a?a:"0","6"),m.inputMode="numeric",m.pattern="[0-9]+",m.oninput=()=>{this.changes=this.makeChangesData(),this.processInputs()}),h.disabled=y||!f.roomName,m.disabled=y||!f.player,this.changes&&!y&&f.roomName||(h.value=null!==(l=null===(s=f.roomName)||void 0===s?void 0:s.name)&&void 0!==l?l:""),this.changes&&!y&&f.player||(m.value=null!==(d=null===(u=null===(c=f.player)||void 0===c?void 0:c.memberNumber)||void 0===u?void 0:u.toString())&&void 0!==d?d:"0")}processInputs(){var e,t,n,r,o;const i=document.getElementById("BCX_ConditionRoomName"),a=document.getElementById("BCX_ConditionMemberNumber");if(this.changes&&i&&a&&((null===(e=this.changes.requirements)||void 0===e?void 0:e.roomName)&&(this.changes.requirements.roomName.name=i.value),null===(t=this.changes.requirements)||void 0===t?void 0:t.player)){const e=a.value;if(!e)return;/^[0-9]+$/.test(e)?this.changes.requirements.player.memberNumber=Number.parseInt(e,10):a.value=(null!==(o=null===(r=null===(n=this.changes.requirements)||void 0===n?void 0:n.player)||void 0===r?void 0:r.memberNumber)&&void 0!==o?o:0).toString()}}checkAccess(){var e;if(!this.conditionCategoryData)return!1;const t=null!==(e=this.conditionCategoryData.limits[this.conditionName])&&void 0!==e?e:bd.normal;return[this.conditionCategoryData.access_normal,this.conditionCategoryData.access_limited,!1][t]}Run(){var e,t,n,r,o,i,a,s,l,c;MainCanvas.textAlign="left";const u=null===(e=this.conditionData)||void 0===e?void 0:e.addedBy;if(DrawText(`- ${this.headerText()} -`,180,108,"Black","Gray"),void 0!==u&&(MainCanvas.save(),MainCanvas.font=CommonGetFont(26),DrawText(`Added by: ${ME(u,"[unknown name]")} (${u})`,205,143,"#444"),MainCanvas.restore()),MainCanvas.textAlign="center",this.changes?(DrawButton(1815,75,90,90,"","White","Icons/Accept.png","Save all changes and go back"),DrawButton(1815,190,90,90,"","White","Icons/Cancel.png","Go back without saving")):(DrawButton(1815,75,90,90,"","White","Icons/Exit.png","Back"),DrawButton(1815,190,90,90,"","White","Icons/Question.png")),null===this.conditionCategoryData||null===this.conditionData)return MainCanvas.textAlign="center",this.failed?fA(`get data from ${this.character.Name}`):DrawText("Loading...",1e3,480,"Black"),!0;this.changes&&null!==this.changes.timer&&(this.changes.timer<Date.now()?(this.changes.timer=null,this.changes.timerRemove=!1,this.changes.active=!this.changes.active):this.changes.active||(this.changes.timerRemove=!1));const d=null!==(t=this.changes)&&void 0!==t?t:this.conditionData,h=null!==(n=d.requirements)&&void 0!==n?n:this.conditionCategoryData.requirements,m=!d.requirements,p=this.checkAccess(),f=!p||m,g=p?d.favorite?"Yellow":"White":"#ddd";let y;TE(MainCanvas,"m12 .288l2.833 8.718h9.167l-7.417 5.389 2.833 8.718-7.416-5.388-7.417 5.388 2.833-8.718-7.416-5.389h9.167z",105,91,60,60,24,1,1.5,g,p&&MouseIn(93,80,85,80)?"Cyan":"black"),DrawEmptyRect(98,272,862,0,"Gray",1),DrawEmptyRect(98,540,862,0,"Gray",1),MainCanvas.textAlign="left",DrawCheckbox(125,180,64,64,`This ${this.conditionCategory.slice(0,-1)} is active and can trigger`,d.active,!p),m&&(DrawRect(526,546,418,68,"#0052A3"),DrawRect(120,615,74,74,"#0052A3"),DrawRect(120,695,74,74,"#0052A3"),DrawRect(120,775,74,74,"#0052A3"),DrawRect(120,855,74,74,"#0052A3")),MainCanvas.textAlign="center",y=null===d.timer?"Timer disabled":`${d.active?"Deactivates":"Activates"} in: ${Td(d.timer-Date.now())}`,DrawText(y,530,311,d.active||!d.timer?"Black":"#060"),null===d.timer?(DrawButton(120,360,820,160,"Enable timer","White"),MainCanvas.textAlign="left"):(DrawButton(120,360,85,60,"-1d",p?"White":"#ddd","","Remove 1 day from the timer",!p),DrawButton(245,360,85,60,"-1h",p?"White":"#ddd","","Remove 1 hour from the timer",!p),DrawButton(370,360,85,60,"-5m",p?"White":"#ddd","","Remove 5 minutes from the timer",!p),DrawButton(495,360,70,60,"",p?"White":"#ddd","","Disable the timer",!p),DrawButton(605,360,85,60,"+5m",p?"White":"#ddd","","Add 5 minutes to the timer",!p),DrawButton(730,360,85,60,"+1h",p?"White":"#ddd","","Add 1 hour to the timer",!p),DrawButton(855,360,85,60,"+1d",p?"White":"#ddd","","Add 1 day to the timer",!p),MainCanvas.textAlign="left",d.active&&DrawCheckbox(125,450,64,64,`Delete the ${this.conditionCategory.slice(0,-1)} when timer runs out`,d.timerRemove,!p)),DrawText(`${Nd(this.conditionCategory.slice(0,-1))} trigger conditions:`,130,580,"Black",""),MainCanvas.textAlign="center";const v=!!(h.room||h.roomName||h.role||h.player);if(DrawButton(530,550,410,60,v?h.orLogic?"Any selected below":"All selected below":"Always in effect",f||!v?"#ddd":"White","","",f||!v),MainCanvas.textAlign="left",DrawRect(80,620,15,304,mC(h,this.conditionCategoryData.highestRoleInRoom)?"#00FF22":"#AA0000"),DrawCheckbox(125,620,64,64,"when",!!h.room,f),MainCanvas.textAlign="center",DrawButton(324,622,115,60,(null===(r=h.room)||void 0===r?void 0:r.inverted)?"not in":"in",f||!h.room?"#ddd":"White","","",f||!h.room),DrawButton(453,622,130,60,"private"===(null===(o=h.room)||void 0===o?void 0:o.type)?"private":"public",f||!h.room?"#ddd":"White","","",f||!h.room),MainCanvas.textAlign="left",DrawText("room",597,652,"Black","Gray"),h.room){const e=ServerPlayerIsInChatRoom(),t=e&&ChatRoomData&&ChatRoomData.Private,n=e&&("public"===h.room.type?!t:t);DrawRect(95,620,15,64,(h.room.inverted?!n:n)?"#00FF22":"#AA0000")}if(DrawCheckbox(125,700,64,64,"when",!!h.roomName,f),MainCanvas.textAlign="center",DrawButton(324,702,115,60,(null===(i=h.roomName)||void 0===i?void 0:i.inverted)?"not in":"in",f||!h.roomName?"#ddd":"White","","",f||!h.roomName),MainCanvas.textAlign="left",DrawText("room named",453,732,"Black","Gray"),ElementPosition("BCX_ConditionRoomName",813,726,285,60),h.roomName){const e=ServerPlayerIsInChatRoom()&&ChatRoomData&&"string"==typeof ChatRoomData.Name&&ChatRoomData.Name.toLocaleLowerCase()===h.roomName.name.toLocaleLowerCase();DrawRect(95,700,15,64,(h.roomName.inverted?!e:e)?"#00FF22":"#AA0000")}DrawCheckbox(125,780,64,64,"when",!!h.role,f),MainCanvas.textAlign="center",DrawButton(324,782,115,60,(null===(a=h.role)||void 0===a?void 0:a.inverted)?"not in":"in",f||!h.role?"#ddd":"White","","",f||!h.role);const b=null!==(l=null===(s=h.role)||void 0===s?void 0:s.role)&&void 0!==l?l:xA.mistress,w=b<xA.public?b+1:xA.clubowner,C=b>xA.clubowner?b-1:xA.public;if(DrawBackNextButton(695,782,244,60,Nd(xA[b])+(b!==xA.clubowner?" ":""),f||!h.role?"#ddd":"White","",(()=>Nd(xA[C])),(()=>Nd(xA[w])),f||!h.role),MainCanvas.textAlign="left",DrawText("room with role",453,812,"Black","Gray"),h.role){const e=null!=this.conditionCategoryData.highestRoleInRoom&&this.conditionCategoryData.highestRoleInRoom<=h.role.role;DrawRect(95,780,15,64,(h.role.inverted?!e:e)?"#00FF22":"#AA0000")}if(DrawCheckbox(125,860,64,64,"when",!!h.player,f),MainCanvas.textAlign="center",DrawButton(324,862,115,60,(null===(c=h.player)||void 0===c?void 0:c.inverted)?"not in":"in",f||!h.player?"#ddd":"White","","",f||!h.player),MainCanvas.textAlign="left",DrawText("room with member",453,892,"Black","Gray"),ElementPositionFix("BCX_ConditionMemberNumber",40,768,860,162,60),DrawButton(950,862,64,64,"",f||!h.player?"#ddd":"White",void 0,void 0,f||!h.player),CE("Icons/Title.png",952,864,{Width:60,Height:60}),h.player){const e=ServerPlayerIsInChatRoom()&&zA().some((e=>e.MemberNumber===h.player.memberNumber));DrawRect(95,860,15,64,(h.player.inverted?!e:e)?"#00FF22":"#AA0000");const t=document.getElementById("BCX_ConditionMemberNumber");t&&document.activeElement===t&&DrawHoverElements.push((()=>{h.player&&(DrawRect(957,858,450,65,"#FFFF88"),DrawEmptyRect(957,858,450,65,"black",2),DrawTextFit(ME(h.player.memberNumber,"[unknown]"),1182,891,444,"black"))}))}return DrawEmptyRect(1190,830,720,104,"#0052A3"),DrawCheckbox(1210,850,64,64,`Set to global ${this.conditionCategory} configuration`,m,!p),DrawCircle(1910,830,22,0,"","#0052A3"),CE("Icons/General.png",1887,807,{Height:46,Width:46}),MainCanvas.textAlign="center",null!==d.timer&&MouseIn(125,450,80,64)&&DrawButtonHover(125,450,64,64,`Removes ${this.conditionCategory.slice(0,-1)} instead of only deactivating it `),MouseIn(1190,830,100,104)&&DrawButtonHover(1786,854,64,64,"Overwrites current trigger conditions"),MouseIn(950,862,64,64)&&DrawButtonHover(950,782,4,64,"Select member number from list"),MouseIn(93,80,85,80)&&DrawButtonHover(93,80,80,80,"Favorite: Listed first in overview"),!1}Click(){var e,t,n,r;if(MouseIn(1815,75,90,90))return this.changes&&(this.processInputs(),this.character.conditionUpdate(this.conditionCategory,this.conditionName,this.changes)),this.Exit(),!0;if(this.changes&&MouseIn(1815,190,90,90))return this.Exit(),!0;if(MouseIn(1815,190,90,90))return this.showHelp=!this.showHelp,!0;if(null===this.conditionCategoryData||null===this.conditionData)return!0;if(!this.checkAccess())return!1;const o=null!==(e=this.changes)&&void 0!==e?e:this.conditionData;if(MouseIn(125,180,64,64))return this.changes=this.makeChangesData(),this.changes.active=!this.changes.active,this.changes.timer=null,this.changes.timerRemove=!1,!0;if(MouseIn(93,80,85,80))return this.changes=this.makeChangesData(),this.changes.favorite=!this.changes.favorite,!0;if(null===o.timer){if(MouseIn(120,360,820,160))return this.changes=this.makeChangesData(),this.changes.timer=Date.now()+3e5,!0}else{if(MouseIn(120,360,85,60))return this.changes=this.makeChangesData(),this.changes.timer-=864e5,!0;if(MouseIn(245,360,85,60))return this.changes=this.makeChangesData(),this.changes.timer-=36e5,!0;if(MouseIn(370,360,85,60))return this.changes=this.makeChangesData(),this.changes.timer-=3e5,!0;if(MouseIn(495,360,70,60))return this.changes=this.makeChangesData(),this.changes.timer=null,this.changes.timerRemove=!1,!0;if(MouseIn(605,360,85,60))return this.changes=this.makeChangesData(),this.changes.timer+=3e5,!0;if(MouseIn(730,360,85,60))return this.changes=this.makeChangesData(),this.changes.timer+=36e5,!0;if(MouseIn(855,360,85,60))return this.changes=this.makeChangesData(),this.changes.timer+=864e5,!0;if(MouseIn(125,450,64,64)&&o.active)return this.changes=this.makeChangesData(),this.changes.timerRemove=!this.changes.timerRemove,!0}const i=!(this.changes?this.changes.requirements:this.conditionData.requirements),a=null!==(t=this.changes?this.changes.requirements:this.conditionData.requirements)&&void 0!==t?t:this.conditionCategoryData.requirements;if(MouseIn(530,550,410,60)&&!i)return this.changes=this.makeChangesData(),this.changes.requirements.orLogic=!this.changes.requirements.orLogic||void 0,!0;if(MouseIn(125,620,64,64)&&!i)return this.changes=this.makeChangesData(),this.changes.requirements.room=this.changes.requirements.room?void 0:{type:"public"},!0;if(MouseIn(324,622,115,60)&&!i&&a.room)return this.changes=this.makeChangesData(),this.changes.requirements.room.inverted=!this.changes.requirements.room.inverted||void 0,!0;if(MouseIn(453,622,130,60)&&!i&&a.room)return this.changes=this.makeChangesData(),this.changes.requirements.room.type="public"===this.changes.requirements.room.type?"private":"public",!0;if(MouseIn(125,700,64,64)&&!i)return this.changes=this.makeChangesData(),this.changes.requirements.roomName=this.changes.requirements.roomName?void 0:{name:""},this.onDataChange(),!0;if(MouseIn(324,702,115,60)&&!i&&a.roomName)return this.changes=this.makeChangesData(),this.changes.requirements.roomName.inverted=!this.changes.requirements.roomName.inverted||void 0,!0;if(MouseIn(125,780,64,64)&&!i)return this.changes=this.makeChangesData(),this.changes.requirements.role=this.changes.requirements.role?void 0:{role:xA.mistress},!0;if(MouseIn(324,782,115,60)&&!i&&a.role)return this.changes=this.makeChangesData(),this.changes.requirements.role.inverted=!this.changes.requirements.role.inverted||void 0,!0;const s=null!==(r=null===(n=a.role)||void 0===n?void 0:n.role)&&void 0!==r?r:xA.mistress;return MouseIn(727,782,106,60)&&!i&&a.role?(this.changes=this.makeChangesData(),this.changes.requirements.role.role=s>xA.clubowner?s-1:xA.public,!0):MouseIn(833,782,106,60)&&!i&&a.role?(this.changes=this.makeChangesData(),this.changes.requirements.role.role=s<xA.public?s+1:xA.clubowner,!0):MouseIn(125,860,64,64)&&!i?(this.changes=this.makeChangesData(),this.changes.requirements.player=this.changes.requirements.player?void 0:{memberNumber:0},this.onDataChange(),!0):MouseIn(324,862,115,60)&&!i&&a.player?(this.changes=this.makeChangesData(),this.changes.requirements.player.inverted=!this.changes.requirements.player.inverted||void 0,!0):MouseIn(950,862,64,64)&&!i&&a.player?(jk(new Np(this.character,this,(e=>{this.changes=this.makeChangesData(),this.changes.requirements.player.memberNumber=e}))),!0):!!MouseIn(1210,850,64,64)&&(this.changes=this.makeChangesData(),this.setUseGlobal(!!this.changes.requirements),this.onDataChange(),!0)}Exit(){jk(this.back)}Unload(){ElementRemove("BCX_ConditionRoomName"),ElementRemove("BCX_ConditionMemberNumber")}}class ik extends ok{constructor(e,t,n){super(e,"curses",t,n),this.item=null,this.allowSettingsCurse=!1}headerText(){const e=AssetGroup.find((e=>e.Name===this.conditionName));return`View / Edit the '${e?pE(e):"[ERROR]"}' curse`}setUseGlobal(e){var t;super.setUseGlobal(e),this.changes&&this.conditionData&&this.conditionCategoryData&&(null===(t=this.changes)||void 0===t?void 0:t.data)&&(this.changes.data.itemRemove=!e&&this.conditionCategoryData.data.itemRemove)}onDataChange(){var e,t;super.onDataChange(),this.conditionCategoryData&&this.conditionData&&(this.conditionData.data?(this.item=AssetGet(this.character.Character.AssetFamily,this.conditionName,this.conditionData.data.Name),this.allowSettingsCurse=this.conditionData.data.curseProperties||!this.item||J_(this.item)):(this.item=null,this.allowSettingsCurse=!1),this.changes&&(null===(e=this.changes.data)||void 0===e?void 0:e.Name)!==(null===(t=this.conditionData.data)||void 0===t?void 0:t.Name)&&(this.changes.data=kp(this.conditionData.data)))}Run(){var e,t;if(super.Run()||null===this.conditionCategoryData||null===this.conditionData)return!0;const n=null!==(e=this.changes)&&void 0!==e?e:this.conditionData,r=!n.requirements,o=!!(r?this.conditionCategoryData.data.itemRemove:null===(t=n.data)||void 0===t?void 0:t.itemRemove),i=this.checkAccess();return MainCanvas.textAlign="left",n.data&&(r&&DrawRect(1045,100,74,74,"#0052A3"),DrawCheckbox(1050,105,64,64,"Remove the item when the curse",o,!i||r),MainCanvas.save(),MainCanvas.font=CommonGetFont(28),DrawText("becomes inactive, removed, or is no longer",1152,185,"Black"),DrawText("triggering - does not remove locked items",1152,225,"Black"),MainCanvas.restore()),this.allowSettingsCurse&&n.data&&(DrawCheckbox(1050,265,64,64,"Also curse the item's configuration",n.data.curseProperties,!i),MainCanvas.save(),MainCanvas.font=CommonGetFont(28),DrawText("Example: which rope tie is used",1151,347,"Black",""),MainCanvas.restore(),this.item&&!Q_(this.item)&&(MainCanvas.save(),MainCanvas.font=CommonGetFont(30),DrawTextWrap("Warning: This item is not standardized and some or all of its configuration states could behave in unexpected ways if they are cursed with the above checkbox. Please assume most of them will not work correctly. Issues could range from respawning with a different configuration to the curse triggering randomly all the time. As some of these items do work (partially), the option to curse the configuration is still offered.",621,365,860,400,"FireBrick"),MainCanvas.restore())),this.showHelp&&IE(Mp[Dp.ConditionsEditCurses]),!1}Click(){var e;if(super.Click()||null===this.conditionCategoryData||null===this.conditionData)return!0;if(!this.checkAccess())return!1;const t=null!==(e=this.changes)&&void 0!==e?e:this.conditionData,n=!(this.changes?this.changes.requirements:t.requirements);return MouseIn(1050,105,64,64)&&t.data&&!n?(this.changes=this.makeChangesData(),this.changes.data.itemRemove=!this.changes.data.itemRemove,!0):!!(MouseIn(1050,265,64,64)&&this.allowSettingsCurse&&t.data)&&(this.changes=this.makeChangesData(),this.changes.data.curseProperties=!this.changes.data.curseProperties,!0)}}class ak extends Ap{constructor(e,t,n){super(),this.conditionCategoryData=null,this.failed=!1,this.showHelp=!1,this.changes=null,this.character=e,this.conditionCategory=t,this.back=n}makeChangesData(){var e;if(!this.conditionCategoryData)throw new Error("Data required");return null!==(e=this.changes)&&void 0!==e?e:{requirements:kp(this.conditionCategoryData.requirements),timer:this.conditionCategoryData.timer,timerRemove:this.conditionCategoryData.timerRemove,data:kp(this.conditionCategoryData.data)}}Load(){this.requestData()}onChange(e){e===this.character.MemberNumber&&this.requestData()}requestData(){this.character.conditionsGetByCategory(this.conditionCategory).then((e=>{this.active&&(this.conditionCategoryData=e,this.checkAccess()||(this.changes=null),this.failed=!1,this.onDataChange())}),(e=>{console.error(`HardCoreClub: Failed to get condition info for ${this.conditionCategory} from ${this.character}`,e),this.conditionCategoryData=null,this.failed=!0,this.onDataChange()}))}onDataChange(){var e,t,n,r,o,i,a,s,l,c,u;let d=document.getElementById("BCX_ConditionRoomName"),h=document.getElementById("BCX_ConditionMemberNumber");if(!this.conditionCategoryData)return d&&d.remove(),void(h&&h.remove());const m=(null!==(e=this.changes)&&void 0!==e?e:this.conditionCategoryData).requirements,p=!this.checkAccess();d||(d=ElementCreateInput("BCX_ConditionRoomName","text",null!==(n=null===(t=m.roomName)||void 0===t?void 0:t.name)&&void 0!==n?n:"","30"),d.oninput=()=>{this.changes=this.makeChangesData(),this.processInputs()}),h||(h=ElementCreateInput("BCX_ConditionMemberNumber","text",null!==(i=null===(o=null===(r=m.player)||void 0===r?void 0:r.memberNumber)||void 0===o?void 0:o.toString())&&void 0!==i?i:"0","6"),h.inputMode="numeric",h.pattern="[0-9]+",h.oninput=()=>{this.changes=this.makeChangesData(),this.processInputs()}),d.disabled=p||!m.roomName,h.disabled=p||!m.player,this.changes&&!p&&m.roomName||(d.value=null!==(s=null===(a=m.roomName)||void 0===a?void 0:a.name)&&void 0!==s?s:""),this.changes&&!p&&m.player||(h.value=null!==(u=null===(c=null===(l=m.player)||void 0===l?void 0:l.memberNumber)||void 0===c?void 0:c.toString())&&void 0!==u?u:"0")}processInputs(){var e,t,n,r,o;const i=document.getElementById("BCX_ConditionRoomName"),a=document.getElementById("BCX_ConditionMemberNumber");if(this.changes&&i&&a&&((null===(e=this.changes.requirements)||void 0===e?void 0:e.roomName)&&(this.changes.requirements.roomName.name=i.value),null===(t=this.changes.requirements)||void 0===t?void 0:t.player)){const e=a.value;if(!e)return;/^[0-9]+$/.test(e)?this.changes.requirements.player.memberNumber=Number.parseInt(e,10):a.value=(null!==(o=null===(r=null===(n=this.changes.requirements)||void 0===n?void 0:n.player)||void 0===r?void 0:r.memberNumber)&&void 0!==o?o:0).toString()}}checkAccess(){return!!this.conditionCategoryData&&this.conditionCategoryData.access_configure}Run(){var e,t,n,r,o,i,a,s;if(MainCanvas.textAlign="left",DrawText(`- ${this.headerText()} -`,125,125,"Black","Gray"),MainCanvas.textAlign="center",this.changes?(DrawButton(1815,75,90,90,"","White","Icons/Accept.png","Save all changes and go back"),DrawButton(1815,190,90,90,"","White","Icons/Cancel.png","Go back without saving")):(DrawButton(1815,75,90,90,"","White","Icons/Exit.png","Back"),DrawButton(1815,190,90,90,"","White","Icons/Question.png")),null===this.conditionCategoryData)return MainCanvas.textAlign="center",this.failed?fA(`get data from ${this.character.Name}`):DrawText("Loading...",1e3,480,"Black"),!0;this.changes&&null!==this.changes.timer&&this.changes.timer<=0&&(this.changes.timer=null,this.changes.timerRemove=!1);const l=null!==(e=this.changes)&&void 0!==e?e:this.conditionCategoryData,c=l.requirements,u=this.checkAccess(),d=!u;let h;DrawEmptyRect(98,272,862,0,"Gray",1),DrawEmptyRect(98,540,862,0,"Gray",1),MainCanvas.textAlign="center",h=null===l.timer?"Timer disabled by default":`Default timer: ${Td(l.timer)}`,DrawText(h,530,311,"Black"),null===l.timer?(DrawButton(120,360,820,160,"Enable timer","White"),MainCanvas.textAlign="left"):(DrawButton(120,360,85,60,"-1d",u?"White":"#ddd","","Remove 1 day from the timer",!u),DrawButton(245,360,85,60,"-1h",u?"White":"#ddd","","Remove 1 hour from the timer",!u),DrawButton(370,360,85,60,"-5m",u?"White":"#ddd","","Remove 5 minutes from the timer",!u),DrawButton(495,360,70,60,"",u?"White":"#ddd","","Set lifetime to infinite",!u),DrawButton(605,360,85,60,"+5m",u?"White":"#ddd","","Add 5 minutes to the timer",!u),DrawButton(730,360,85,60,"+1h",u?"White":"#ddd","","Add 1 hour to the timer",!u),DrawButton(855,360,85,60,"+1d",u?"White":"#ddd","","Add 1 day to the timer",!u),MainCanvas.textAlign="left",DrawCheckbox(125,450,64,64,`Remove the ${this.conditionCategory.slice(0,-1)} when timer runs out`,l.timerRemove,!u)),DrawText(`${Nd(this.conditionCategory.slice(0,-1))} trigger conditions:`,130,580,"Black",""),MainCanvas.textAlign="center";const m=!!(c.room||c.roomName||c.role||c.player);if(DrawButton(530,550,410,60,m?c.orLogic?"Any selected below":"All selected below":"Always in effect",d||!m?"#ddd":"White","","",d||!m),MainCanvas.textAlign="left",DrawRect(75,620,15,304,mC(c,this.conditionCategoryData.highestRoleInRoom)?"#00FF22":"#AA0000"),DrawCheckbox(125,620,64,64,"when",!!c.room,d),MainCanvas.textAlign="center",DrawButton(324,622,115,60,(null===(t=c.room)||void 0===t?void 0:t.inverted)?"not in":"in",d||!c.room?"#ddd":"White","","",d||!c.room),DrawButton(453,622,130,60,"private"===(null===(n=c.room)||void 0===n?void 0:n.type)?"private":"public",d||!c.room?"#ddd":"White","","",d||!c.room),MainCanvas.textAlign="left",DrawText("room",597,652,"Black","Gray"),c.room){const e=ServerPlayerIsInChatRoom(),t=e&&ChatRoomData&&ChatRoomData.Private,n=e&&("public"===c.room.type?!t:t);DrawRect(95,620,15,64,(c.room.inverted?!n:n)?"#00FF22":"#AA0000")}if(DrawCheckbox(125,700,64,64,"when",!!c.roomName,d),MainCanvas.textAlign="center",DrawButton(324,702,115,60,(null===(r=c.roomName)||void 0===r?void 0:r.inverted)?"not in":"in",d||!c.roomName?"#ddd":"White","","",d||!c.roomName),MainCanvas.textAlign="left",DrawText("room named",453,732,"Black","Gray"),ElementPosition("BCX_ConditionRoomName",813,726,285,60),c.roomName){const e=ServerPlayerIsInChatRoom()&&ChatRoomData&&"string"==typeof ChatRoomData.Name&&ChatRoomData.Name.toLocaleLowerCase()===c.roomName.name.toLocaleLowerCase();DrawRect(95,700,15,64,(c.roomName.inverted?!e:e)?"#00FF22":"#AA0000")}DrawCheckbox(125,780,64,64,"when",!!c.role,d),MainCanvas.textAlign="center",DrawButton(324,782,115,60,(null===(o=c.role)||void 0===o?void 0:o.inverted)?"not in":"in",d||!c.role?"#ddd":"White","","",d||!c.role);const p=null!==(a=null===(i=c.role)||void 0===i?void 0:i.role)&&void 0!==a?a:xA.mistress,f=p<xA.public?p+1:xA.clubowner,g=p>xA.clubowner?p-1:xA.public;if(DrawBackNextButton(695,782,244,60,Nd(xA[p])+(p!==xA.clubowner?" ":""),d||!c.role?"#ddd":"White","",(()=>Nd(xA[g])),(()=>Nd(xA[f])),d||!c.role),MainCanvas.textAlign="left",DrawText("room with role",453,812,"Black","Gray"),c.role){const e=null!=this.conditionCategoryData.highestRoleInRoom&&this.conditionCategoryData.highestRoleInRoom<=c.role.role;DrawRect(95,780,15,64,(c.role.inverted?!e:e)?"#00FF22":"#AA0000")}if(DrawCheckbox(125,860,64,64,"when",!!c.player,d),MainCanvas.textAlign="center",DrawButton(324,862,115,60,(null===(s=c.player)||void 0===s?void 0:s.inverted)?"not in":"in",d||!c.player?"#ddd":"White","","",d||!c.player),MainCanvas.textAlign="left",DrawText("room with member",453,892,"Black","Gray"),ElementPositionFix("BCX_ConditionMemberNumber",40,768,860,162,60),c.player){const e=ServerPlayerIsInChatRoom()&&zA().some((e=>e.MemberNumber===c.player.memberNumber));DrawRect(95,860,15,64,(c.player.inverted?!e:e)?"#00FF22":"#AA0000");const t=document.getElementById("BCX_ConditionMemberNumber");t&&document.activeElement===t&&DrawHoverElements.push((()=>{c.player&&(DrawRect(957,858,450,65,"#FFFF88"),DrawEmptyRect(957,858,450,65,"black"),DrawTextFit(ME(c.player.memberNumber,"[unknown]"),1182,891,444,"black"))}))}return MainCanvas.textAlign="center",null!==l.timer&&MouseIn(125,450,80,64)&&DrawButtonHover(125,450,64,64,`Removes ${this.conditionCategory.slice(0,-1)} instead of only deactivating it `),!1}Click(){var e,t,n;if(MouseIn(1815,75,90,90))return this.changes&&(this.processInputs(),this.character.conditionCategoryUpdate(this.conditionCategory,this.changes)),this.Exit(),!0;if(this.changes&&MouseIn(1815,190,90,90))return this.Exit(),!0;if(MouseIn(1815,190,90,90))return this.showHelp=!this.showHelp,!0;if(null===this.conditionCategoryData)return!0;if(!this.checkAccess())return!1;const r=null!==(e=this.changes)&&void 0!==e?e:this.conditionCategoryData;if(null===r.timer){if(MouseIn(120,360,820,160))return this.changes=this.makeChangesData(),this.changes.timer=3e5,!0}else{if(MouseIn(120,360,85,60))return this.changes=this.makeChangesData(),this.changes.timer-=864e5,!0;if(MouseIn(245,360,85,60))return this.changes=this.makeChangesData(),this.changes.timer-=36e5,!0;if(MouseIn(370,360,85,60))return this.changes=this.makeChangesData(),this.changes.timer-=3e5,!0;if(MouseIn(495,360,70,60))return this.changes=this.makeChangesData(),this.changes.timer=null,this.changes.timerRemove=!1,!0;if(MouseIn(605,360,85,60))return this.changes=this.makeChangesData(),this.changes.timer+=3e5,!0;if(MouseIn(730,360,85,60))return this.changes=this.makeChangesData(),this.changes.timer+=36e5,!0;if(MouseIn(855,360,85,60))return this.changes=this.makeChangesData(),this.changes.timer+=864e5,!0;if(MouseIn(125,450,64,64))return this.changes=this.makeChangesData(),this.changes.timerRemove=!this.changes.timerRemove,!0}const o=r.requirements;if(MouseIn(530,550,410,60))return this.changes=this.makeChangesData(),this.changes.requirements.orLogic=!this.changes.requirements.orLogic||void 0,!0;if(MouseIn(125,620,64,64))return this.changes=this.makeChangesData(),this.changes.requirements.room=this.changes.requirements.room?void 0:{type:"public"},!0;if(MouseIn(324,622,115,60)&&o.room)return this.changes=this.makeChangesData(),this.changes.requirements.room.inverted=!this.changes.requirements.room.inverted||void 0,!0;if(MouseIn(453,622,130,60)&&o.room)return this.changes=this.makeChangesData(),this.changes.requirements.room.type="public"===this.changes.requirements.room.type?"private":"public",!0;if(MouseIn(125,700,64,64))return this.changes=this.makeChangesData(),this.changes.requirements.roomName=this.changes.requirements.roomName?void 0:{name:""},this.onDataChange(),!0;if(MouseIn(324,702,115,60)&&o.roomName)return this.changes=this.makeChangesData(),this.changes.requirements.roomName.inverted=!this.changes.requirements.roomName.inverted||void 0,!0;if(MouseIn(125,780,64,64))return this.changes=this.makeChangesData(),this.changes.requirements.role=this.changes.requirements.role?void 0:{role:xA.mistress},!0;if(MouseIn(324,782,115,60)&&o.role)return this.changes=this.makeChangesData(),this.changes.requirements.role.inverted=!this.changes.requirements.role.inverted||void 0,!0;const i=null!==(n=null===(t=o.role)||void 0===t?void 0:t.role)&&void 0!==n?n:xA.mistress;return MouseIn(727,782,106,60)&&o.role?(this.changes=this.makeChangesData(),this.changes.requirements.role.role=i>xA.clubowner?i-1:xA.public,!0):MouseIn(833,782,106,60)&&o.role?(this.changes=this.makeChangesData(),this.changes.requirements.role.role=i<xA.public?i+1:xA.clubowner,!0):MouseIn(125,860,64,64)?(this.changes=this.makeChangesData(),this.changes.requirements.player=this.changes.requirements.player?void 0:{memberNumber:0},this.onDataChange(),!0):!(!MouseIn(324,862,115,60)||!o.player||(this.changes=this.makeChangesData(),this.changes.requirements.player.inverted=!this.changes.requirements.player.inverted||void 0,0))}Exit(){jk(this.back)}Unload(){ElementRemove("BCX_ConditionRoomName"),ElementRemove("BCX_ConditionMemberNumber")}}class sk extends ak{constructor(e,t){super(e,"curses",t)}headerText(){return`View / Edit the global ${this.conditionCategory} configuration`}Run(){var e;if(super.Run()||null===this.conditionCategoryData)return!0;MainCanvas.textAlign="left",DrawText("Note: Settings are applied to new curses and all existing ones set to the global config.",130,210,"Black","");const t=null!==(e=this.changes)&&void 0!==e?e:this.conditionCategoryData,n=this.checkAccess();return t.data&&(DrawCheckbox(1050,267,64,64,"Remove the item when the curse",t.data.itemRemove,!n),MainCanvas.save(),MainCanvas.font=CommonGetFont(28),DrawText("becomes inactive, removed, or is no longer",1152,347,"Black"),DrawText("triggering - does not remove locked items",1152,387,"Black"),MainCanvas.restore()),this.showHelp&&IE(Mp[Dp.ConditionsGlobalCurses]),!1}Click(){var e;if(super.Click()||null===this.conditionCategoryData)return!0;if(!this.checkAccess())return!1;const t=null!==(e=this.changes)&&void 0!==e?e:this.conditionCategoryData;return!(!MouseIn(1050,267,64,64)||!t.data||(this.changes=this.makeChangesData(),this.changes.data.itemRemove=!this.changes.data.itemRemove,0))}}const lk=14;let ck=!1,uk=!1;class dk extends Ap{constructor(e,t){super(),this.conditionEntries=[],this.conditionCategoryData=null,this.failed=!1,this.page=0,this.showHelp=!1,this.filterInput=Bd("text",30),this.character=e,this.conditionCategory=t,this.conditionCategorySingular=t.slice(0,-1),this.filterInput.addEventListener("input",(e=>{this.onDataChange()}))}Load(){this.requestData()}onChange(e){e===this.character.MemberNumber&&this.requestData()}requestData(){this.character.conditionsGetByCategory(this.conditionCategory).then((e=>{this.active&&(this.conditionCategoryData=e,this.failed=!1,this.onDataChange())}),(e=>{console.error(`HardCoreClub: Failed to get condition info for ${this.conditionCategory} from ${this.character}`,e),this.conditionCategoryData=null,this.failed=!0,this.onDataChange()}))}onDataChange(){var e;if(!this.active)return;if(this.conditionEntries=[],null===this.conditionCategoryData)return void this.filterInput.remove();this.filterInput.parentElement||document.body.appendChild(this.filterInput);const t=this.filterInput.value.trim().toLocaleLowerCase().split(" ").filter(Boolean);for(const[n,r]of Sd(this.conditionCategoryData.conditions)){if(!r)continue;const o=this.loadCondition(n,r);if(null===o)continue;const i=[this.conditionCategoryData.access_normal,this.conditionCategoryData.access_limited,!1][null!==(e=this.conditionCategoryData.limits[n])&&void 0!==e?e:bd.normal];t.some((e=>!n.toLocaleLowerCase().includes(e)&&!o[0].toLocaleLowerCase().includes(e)))||this.conditionEntries.push({condition:n,access:i,data:r,displayName:o[0],extra:o[1]})}this.conditionEntries=this.sortEntries(this.conditionEntries),this.page=Rd(this.page,0,Math.ceil(this.conditionEntries.length/lk))}sortEntries(e){return e.sort(((e,t)=>!e.data.favorite&&t.data.favorite?1:e.data.favorite&&!t.data.favorite?-1:0)),ck&&e.sort(((e,t)=>e.displayName.localeCompare(t.displayName))),uk&&e.sort(((e,t)=>(t.data.active?1:0)-(e.data.active?1:0))),e}Run(){if(MainCanvas.textAlign="left",DrawText(`- ${this.headerText()} -`,125,125,"Black","Gray"),MainCanvas.textAlign="center",DrawButton(1815,75,90,90,"","White","Icons/Exit.png"),DrawButton(1815,190,90,90,"","White","Icons/Question.png"),null===this.conditionCategoryData)return MainCanvas.textAlign="center",this.failed?fA(`get data from ${this.character.Name}`):DrawText("Loading...",1e3,480,"Black"),!0;DrawEmptyRect(953,160,0,620,"Black");for(let e=0;e<lk;e++){const t=this.page*lk+e;if(t>=this.conditionEntries.length)break;const n=this.conditionEntries[t],r=170+e%7*90,o=120+865*Math.floor(e/7),i=!n.data.requirements;((e+1)%7==0||t===this.conditionEntries.length-1?MouseIn(o,r,440,60):MouseIn(o,r,440,90))&&DrawHoverElements.push((()=>{this.showDetailedDescriptionBackground(e<7?985:120),MouseIn(o,r,440,60)&&this.showDetailedDescriptionText(e<7?985:120,n.condition,n)})),MainCanvas.textAlign="left",DrawButton(o,r,440,60,"","White"),this.drawCategoryImage(o,r,n),DrawTextFit(n.displayName,o+65,r+30,365,"Black"),MainCanvas.textAlign="center",DrawButton(o+470,r,240,60,"",n.data.active?"#d8fed7":"White"),i&&DrawCircle(o+470+33,r+30,22,0,"","#0052A3"),CE("Icons/General.png",o+480,r+7,{Height:46,Width:46});let a="n/a";a=null===n.data.timer?"":Td(n.data.timer-Date.now(),"short"),DrawText(a,o+570,r+30,"Black",""),this.drawEntryExtra(o,r,n),n.access&&DrawButton(o+740,r,60,60,"X","White","",this.removeLabel),MouseIn(o+470,r,60,60)&&DrawHoverElements.push((()=>{DrawButtonHover(o+470,r,60,60,`Change this ${this.conditionCategorySingular}'s configuration`)})),MouseIn(o+531,r,78,60)&&DrawHoverElements.push((()=>{DrawButtonHover(o+531,r,78,60,`Remaining duration of the ${this.conditionCategorySingular}`)}))}MainCanvas.textAlign="center";const e=this.conditionCategoryData.access_normal&&this.conditionCategoryData.access_limited;DrawButton(678,820,170,50,"",e?"White":"#ddd","",e?`Switch all added ${this.conditionCategory} to active`:"You have no permission to use this",!e),DrawTextFit("Activate all",765,845,145,"Black",""),DrawButton(678,885,170,46,"",e?"White":"#ddd","",e?`Activate only global config ${this.conditionCategory}`:"You have no permission to use this",!e),DrawTextFit("A. only",741.5,910,90,"Black",""),DrawCircle(817,908,21,0,"","#0052A3"),CE("Icons/General.png",795,886,{Height:44,Width:44}),DrawButton(870,820,170,50,"Deactivate all",e?"White":"#ddd","",e?`Switch all added ${this.conditionCategory} to inactive`:"You have no permission to use this",!e),DrawButton(870,885,170,46,"",e?"White":"#ddd","",e?`Deactivate only global config ${this.conditionCategory}`:"You have no permission to use this",!e),DrawTextFit("D. only",933.5,910,90,"Black",""),DrawCircle(1010,908,21,0,"","#0052A3"),CE("Icons/General.png",988,886,{Height:44,Width:44}),DrawButton(1068,820,505,90,"",this.conditionCategoryData.access_configure?"White":"#ddd","",this.conditionCategoryData.access_configure?`Existing ${this.conditionCategory} set to global ${this.conditionCategory} config are also changed`:"You have no permission to use this",!this.conditionCategoryData.access_configure),DrawTextFit(`Change global ${this.conditionCategory} config`,1358,865,400,"Black",""),DrawCircle(1113,864,34,0,"","#0052A3"),CE("Icons/General.png",1078,830,{Height:70,Width:70}),MainCanvas.textAlign="left",Od(this.filterInput,1200,110,500,64),MainCanvas.textAlign="center",this.filterInput.value&&DrawButton(1470,82,64,64,"X","White"),DrawButton(1583,82,64,64,"","White"),CE("Icons/Accept.png",1586,85,{Alpha:uk?1:.2,Width:58,Height:58}),DrawButton(1683,82,64,64,"","White"),DrawTextFit("A-Z",1715,115,60,ck?"black":"#bbb");const t=Math.ceil(this.conditionEntries.length/lk);return DrawBackNextButton(1605,820,300,90,`Page ${this.page+1} / ${Math.max(t,1)}`,"White","",(()=>""),(()=>"")),!1}Click(){if(MouseIn(1815,75,90,90))return this.Exit(),!0;if(MouseIn(1815,190,90,90))return this.showHelp=!this.showHelp,!0;if(null===this.conditionCategoryData)return!0;for(let e=0;e<lk;e++){const t=this.page*lk+e;if(t>=this.conditionEntries.length)break;const n=this.conditionEntries[t],r=170+e%7*90,o=120+865*Math.floor(e/7);if(MouseIn(o,r,440,60)&&this.onDescriptionTextClick(n.condition,n),MouseIn(o+470,r,240,60))return this.openEditSubscreen(n.condition),!0;if(n.access&&MouseIn(o+740,r,60,60))return this.removeCondition(n.condition),!0}const e=this.conditionCategoryData.access_normal&&this.conditionCategoryData.access_limited;if(e&&MouseIn(678,820,170,50))return this.character.conditionUpdateMultiple(this.conditionCategory,Sd(this.conditionCategoryData.conditions).filter((([e,t])=>!!t&&!t.active)).map((([e,t])=>e)),{active:!0}),!0;if(e&&MouseIn(678,885,170,46))return this.character.conditionUpdateMultiple(this.conditionCategory,Sd(this.conditionCategoryData.conditions).filter((([e,t])=>!!t&&!t.active&&null===t.requirements)).map((([e,t])=>e)),{active:!0}),!0;if(e&&MouseIn(870,820,170,50))return this.character.conditionUpdateMultiple(this.conditionCategory,Sd(this.conditionCategoryData.conditions).filter((([e,t])=>!!t&&t.active)).map((([e,t])=>e)),{active:!1}),!0;if(e&&MouseIn(870,885,170,46))return this.character.conditionUpdateMultiple(this.conditionCategory,Sd(this.conditionCategoryData.conditions).filter((([e,t])=>!!t&&t.active&&null===t.requirements)).map((([e,t])=>e)),{active:!1}),!0;if(this.conditionCategoryData.access_configure&&MouseIn(1068,820,505,90))return this.openGlobalConfig(),!0;MouseIn(1470,82,64,64)&&(this.filterInput.value="",this.onDataChange()),MouseIn(1583,82,64,64)&&(uk=!uk,this.onDataChange()),MouseIn(1683,82,64,64)&&(ck=!ck,this.onDataChange());const t=Math.ceil(this.conditionEntries.length/lk);return MouseIn(1605,800,150,90)?(this.page--,this.page<0&&(this.page=Math.max(t-1,0)),!0):!!MouseIn(1755,800,150,90)&&(this.page++,this.page>=t&&(this.page=0),!0)}Exit(){jk(new Wk(this.character))}Unload(){this.filterInput.remove()}}const hk=[{title:"Items",filter:e=>"Item"===e.Category,batchType:"items"},{title:"Clothing",filter:e=>"Appearance"===e.Category&&e.Clothing,batchType:"clothes"},{title:"Body",filter:e=>"Appearance"===e.Category&&!e.Clothing&&e.AllowCustomize,batchType:"body"}];class mk extends Ap{constructor(e){super(),this.curseData=null,this.failed=!1,this.permissionMode=!1,this.page=0,this.showHelp=!1,this.character=e}Load(){this.requestData()}onChange(e){e===this.character.MemberNumber&&this.requestData()}requestData(){this.character.conditionsGetByCategory("curses").then((e=>{this.curseData=e,this.curseData.access_changeLimits||(this.permissionMode=!1),this.failed=!1}),(e=>{console.error(`HardCoreClub: Failed to get permission info for ${this.character}`,e),this.curseData=null,this.failed=!0}))}Run(){var e;if(MainCanvas.textAlign="left",DrawText(`- Curses: Place new curses on ${this.character.Name} -`,125,125,"Black","Gray"),MainCanvas.textAlign="center",DrawButton(1815,75,90,90,"","White","Icons/Exit.png","Back"),DrawButton(1815,190,90,90,"","White","Icons/Question.png"),null===this.curseData)return void(this.failed?fA(`get curse data from ${this.character.Name}`):DrawText("Loading...",1e3,480,"Black"));DrawButton(1815,305,90,90,"",this.curseData.access_changeLimits?"White":"#ddd",this.permissionMode?"Icons/Reset.png":"Icons/Preference.png",this.curseData.access_changeLimits?this.permissionMode?"Leave permission mode":"Edit curse slot permissions":"You have no permission to change limits",!this.curseData.access_changeLimits);for(let t=0;t<2;t++){const n=2*this.page+t;if(n>=hk.length)break;const r=hk[n],o=t%2?845:0;MainCanvas.textAlign="left",DrawRect(o+105,165,830,64,"#cccccc"),DrawText(r.title,o+120,199,"Black"),MainCanvas.textAlign="center",this.permissionMode||(DrawButton(o+440,173,265,48,"Curse occupied","White",void 0,"Curse all occupied slots at once"),DrawButton(o+720,173,200,48,"Curse all","White",void 0,"Curse all slots at once"));const i=AssetGroup.filter(r.filter);for(let t=0;t<i.length;t++){const n=t%10,r=Math.floor(t/10),a=i[t],s=InventoryGet(this.character.Character,a.Name),l=void 0!==this.curseData.conditions[a.Name],c=null!==(e=this.curseData.limits[a.Name])&&void 0!==e?e:bd.normal,u=[this.curseData.access_normal,this.curseData.access_limited,!1][c];let d,h;this.permissionMode?(d=["#50ff56","#f6fe78","#ffa7a7"][c],h=["Normal","Limited","Blocked"][c]):(d=l?"#88c":u?s?"Gold":"White":"#ccc",h=l?"Already cursed":u?s?s.Asset.Description:"Nothing":"You have no permission to curse this"),DrawButton(o+106+281*r,240+69*n,265,54,pE(a),d,void 0,h,l||!u||this.permissionMode)}}this.permissionMode&&(DrawRect(1284,75,166,64,"#50ff56"),DrawRect(1450,75,166,64,"#f6fe78"),DrawRect(1616,75,165,64,"#ffa7a7"),MainCanvas.textAlign="center",DrawText("Normal",1367,109,"Black"),DrawText("Limited",1533,109,"Black"),DrawText("Blocked",1699,109,"Black")),this.showHelp&&IE(Mp[this.permissionMode?Dp.CursesAddPermissionMode:Dp.CursesAdd]);const t=Math.ceil(hk.length/2);DrawBackNextButton(1605,865,300,90,`Page ${this.page+1} / ${Math.max(t,1)}`,"White","",(()=>""),(()=>""))}Click(){var e;if(MouseIn(1815,75,90,90))return this.Exit();if(MouseIn(1815,190,90,90))return void(this.showHelp=!this.showHelp);if(null===this.curseData)return;if(MouseIn(1815,305,90,90))return void(this.permissionMode=this.curseData.access_changeLimits&&!this.permissionMode);for(let t=0;t<2;t++){const n=2*this.page+t;if(n>=hk.length)break;const r=hk[n],o=t%2?845:0;if(MouseIn(o+440,173,265,48)&&!this.permissionMode)return void this.character.curseBatch(r.batchType,!1);if(MouseIn(o+720,173,200,48)&&!this.permissionMode)return void this.character.curseBatch(r.batchType,!0);const i=AssetGroup.filter(r.filter);for(let t=0;t<i.length;t++){const n=t%10,r=Math.floor(t/10),a=i[t],s=void 0!==this.curseData.conditions[a.Name],l=null!==(e=this.curseData.limits[a.Name])&&void 0!==e?e:bd.normal,c=[this.curseData.access_normal,this.curseData.access_limited,!1][l];if(MouseIn(o+106+281*r,240+69*n,265,54))return void(this.permissionMode?this.character.conditionSetLimit("curses",a.Name,(l+1)%3):!s&&c&&this.character.curseItem(a.Name,null))}}const t=Math.ceil(hk.length/2);return MouseIn(1605,865,150,90)?(this.page=Ld(this.page-1,0,t-1),!0):MouseIn(1755,865,150,90)?(this.page=Ld(this.page+1,0,t-1),!0):void 0}Exit(){jk(new pk(this.character))}}class pk extends dk{constructor(e){super(e,"curses"),this.removeLabel="Lift curse"}Run(){if(super.Run()||null===this.conditionCategoryData)return!0;DrawButton(120,820,250,90,"Add new curse","White","","Place new curses on body, items or clothes");const e=this.conditionCategoryData.access_normal||this.conditionCategoryData.access_limited;return DrawButton(400,820,250,90,"Lift all curses",e?"White":"#ddd","",e?"Remove all curses on body, items or clothes":"You have no permission to use this",!e),this.showHelp&&IE(Mp[Dp.ConditionsViewCurses]),!1}Click(){return!(!super.Click()&&null!==this.conditionCategoryData)||(MouseIn(120,820,250,90)?(jk(new mk(this.character)),!0):!(!this.conditionCategoryData.access_normal&&!this.conditionCategoryData.access_limited||!MouseIn(400,820,250,90)||(this.character.curseLiftAll(),0)))}drawCategoryImage(e,t,n){CE("body"===n.extra.type?"Icons/Character.png":"clothing"===n.extra.type?"Icons/Dress.png":"Assets/Female3DCG/ItemArms/Preview/NylonRope.png",e+6,t+6,{Height:50,Width:50})}drawEntryExtra(e,t,n){var r,o;const i=n.data.requirements?null===(o=n.data.data)||void 0===o?void 0:o.itemRemove:null===(r=this.conditionCategoryData)||void 0===r?void 0:r.data.itemRemove;void 0!==i&&n.data.data&&(CE("Icons/Remove.png",e+610,t+10,{Height:40,Width:40,Alpha:i?1:.2}),MouseIn(e+610,t+6,44,44)&&DrawHoverElements.push((()=>{DrawButtonHover(e+610,t+6,44,44,i?"Remove item when curse is dormant":"Don't remove item when curse is dormant")}))),n.extra.propertiesCursedShow&&(CE(n.extra.propertiesCursed?"Icons/Lock.png":"Icons/Unlock.png",e+660,t+10,{Height:40,Width:40,Alpha:n.extra.propertiesCursed?1:.2}),MouseIn(e+660,t+6,44,44)&&DrawHoverElements.push((()=>{DrawButtonHover(e+660,t+6,44,44,n.extra.propertiesCursed?"Item configuration cursed":"Item configuration not cursed")})))}headerText(){return`Curses: All active curses on ${this.character.Name}`}loadCondition(e,t){var n;const r=AssetGroup.find((t=>t.Name===e));if(!r)return console.warn(`HardCoreClub: Unknown group ${e}`),null;if(null===t.data)return[`Blocked: ${pE(r)}`,{type:"Item"===r.Category?"item":r.Clothing?"clothing":"body"}];{const o=AssetGet(this.character.Character.AssetFamily,e,t.data.Name);return[`${null!==(n=null==o?void 0:o.Description)&&void 0!==n?n:t.data.Name} (${pE(r)})`,{type:"Item"===r.Category?"item":r.Clothing?"clothing":"body",propertiesCursed:t.data.curseProperties,propertiesCursedShow:t.data.curseProperties||!o||J_(o)}]}}showDetailedDescriptionBackground(e){}showDetailedDescriptionText(e,t,n){}onDescriptionTextClick(e,t){}openEditSubscreen(e){jk(new ik(this.character,e,this))}removeCondition(e){this.character.curseLift(e)}openGlobalConfig(){jk(new sk(this.character,this))}}class fk extends ok{constructor(e,t,n){super(e,"rules",t,n),this.definition=sw(t)}headerText(){return`View / Edit the '${this.definition.name}' rule`}onDataChange(){var e,t,n;super.onDataChange();const r=!!this.conditionCategoryData&&!!this.conditionData,o=null!==(e=this.changes)&&void 0!==e?e:this.conditionData,i=this.checkAccess();if(this.definition.dataDefinition)for(const[e,a]of Object.entries(this.definition.dataDefinition)){const s=dw[a.type];null===(t=s.onDataChange)||void 0===t||t.call(s,{def:a,active:r,key:e,onInput:()=>{this.changes=this.makeChangesData(),this.processInputs()},value:null!==(n=null==o?void 0:o.data.customData[e])&&void 0!==n?n:"function"==typeof a.default?a.default():a.default,access:i})}}processInputs(){if(super.processInputs(),this.changes&&this.definition.dataDefinition)for(const[e,t]of Object.entries(this.definition.dataDefinition)){const n=dw[t.type];if(n.processInput){const r=n.processInput({def:t,key:e,value:this.changes.data.customData[e]});if(void 0!==r){if(!n.validate(r,t))throw console.error("processInput result failed to validate",r,t),new Error("processInput result failed to validate");this.changes.data.customData[e]=r}}}}Run(){var e,t;if(super.Run()||null===this.conditionCategoryData||null===this.conditionData)return!0;const n=null!==(e=this.changes)&&void 0!==e?e:this.conditionData,r=this.checkAccess();MainCanvas.textAlign="left";let o=175;if(!1!==this.definition.enforceable&&(DrawCheckbox(1050,o,64,64,"Enforce this rule",n.data.enforce,!r),o+=100),!1!==this.definition.loggable&&(DrawCheckbox(1050,o,64,64,"Behaviour log entry when rule is violated",n.data.log,!r),o+=100),o+=45,this.definition.dataDefinition)for(const[e,i]of Object.entries(this.definition.dataDefinition))dw[i.type].run({def:i,value:n.data.customData[e],Y:null!==(t=i.Y)&&void 0!==t?t:o,key:e,target:this.character,access:r});return this.showHelp&&(DrawRect(95,80,800,600,"#ffff88"),DrawEmptyRect(95,80,800,600,"Black"),MainCanvas.textAlign="left",DrawTextWrap(Mp[Dp.ConditionsEditRules],-265,100,760,560,"black")),!1}Click(){var e,t;if(super.Click()||null===this.conditionCategoryData||null===this.conditionData)return!0;const n=this.checkAccess();let r=175;if(!1!==this.definition.enforceable){if(n&&MouseIn(1050,r,64,64))return this.changes=this.makeChangesData(),this.changes.data.enforce=!this.changes.data.enforce,!0;r+=100}if(!1!==this.definition.loggable){if(n&&MouseIn(1050,r,64,64))return this.changes=this.makeChangesData(),this.changes.data.log=!this.changes.data.log,!0;r+=100}if(r+=45,this.definition.dataDefinition)for(const[o,i]of Object.entries(this.definition.dataDefinition)){const a=dw[i.type];if(a.click){const s=null!==(e=this.changes)&&void 0!==e?e:this.conditionData,l=a.click({def:i,value:s.data.customData[o],Y:null!==(t=i.Y)&&void 0!==t?t:r,key:o,target:this.character,access:n});if(n&&void 0!==l)return this.changes=this.makeChangesData(),this.changes.data.customData[o]=l,!0}}return!1}Unload(){if(this.definition.dataDefinition)for(const[e,t]of Object.entries(this.definition.dataDefinition)){const n=dw[t.type];n.unload&&n.unload({def:t,key:e})}super.Unload()}}class gk extends ak{constructor(e,t){super(e,"rules",t)}headerText(){return`View / Edit the global ${this.conditionCategory} configuration`}Run(){return!(!super.Run()&&null!==this.conditionCategoryData&&(MainCanvas.textAlign="left",DrawText("Note: Settings are applied to new rules and all existing ones set to the global config.",130,210,"Black",""),this.showHelp&&IE(Mp[Dp.ConditionsGlobalRules]),1))}Click(){return!(!super.Click()&&null!==this.conditionCategoryData)}}class yk extends Ap{constructor(e,t,n,r){super(),this.showFailedMsg=!1,this.character=e,this.back=t,this.rule=n,this.ruleDefinition=sw(n),this.allowAdd=r}onChange(e){e===this.character.MemberNumber&&this.Exit()}Run(){MainCanvas.textAlign="left",DrawText(`- Rules: Description of the rule: "${this.ruleDefinition.name}"-`,125,125,"Black","Gray"),MainCanvas.textAlign="left",DrawTextWrap(Pd(this.ruleDefinition.longDescription,{PLAYER_NAME:this.character.Name}),-750,220,1750,500,"Black"),MainCanvas.textAlign="center",this.showFailedMsg&&DrawText(`Adding this rule failed! Likely cause is that it does not exist on ${this.character.Name}'s BCX version.`,1e3,750,"Red","Gray"),this.allowAdd?(DrawButton(700,800,200,80,"Add","White"),DrawButton(1100,800,200,80,"Back","White")):DrawButton(900,800,200,80,"Back","White")}Click(){if(this.allowAdd){if(MouseIn(700,800,200,80)&&this.character.ruleCreate(this.rule).then((e=>{e&&jk(new fk(this.character,this.rule,new Ck(this.character)))})).catch((e=>{this.showFailedMsg=!0,console.warn(`Error creating rule on ${this.character}: `,e)})),MouseIn(1100,800,200,80))return this.Exit()}else MouseIn(900,800,200,80)&&this.Exit()}Exit(){jk(this.back)}}let vk=!1,bk=!1;class wk extends Ap{constructor(e){super(),this.rulesData=null,this.failed=!1,this.permissionMode=!1,this.ruleList=[],this.page=0,this.showHelp=!1,this.filterInput=Bd("text",30),this.filterRuleType=null,this.character=e,this.filterInput.addEventListener("input",(e=>{this.rebuildList()}))}Load(){this.requestData()}onChange(e){e===this.character.MemberNumber&&this.requestData()}requestData(){this.character.conditionsGetByCategory("rules").then((e=>{this.rulesData=e,this.rulesData.access_changeLimits||(this.permissionMode=!1),this.failed=!1,this.rebuildList()}),(e=>{console.error(`HardCoreClub: Failed to get rules info for ${this.character}`,e),this.rulesData=null,this.failed=!0,this.rebuildList()}))}rebuildList(){if(!this.active)return;if(this.ruleList=[],null===this.rulesData)return void this.filterInput.remove();this.filterInput.parentElement||document.body.appendChild(this.filterInput);const e=this.filterInput.value.trim().toLocaleLowerCase().split(" ").filter(Boolean);for(const t of mw())null!=this.filterRuleType&&this.filterRuleType!==t[1].type||e.some((e=>{var n,r;return!(t[0].toLocaleLowerCase().includes(e)||t[1].name.toLocaleLowerCase().includes(e)||(null===(n=t[1].shortDescription)||void 0===n?void 0:n.toLocaleLowerCase().includes(e))||(null===(r=t[1].keywords)||void 0===r?void 0:r.some((t=>t.toLocaleLowerCase().includes(e)))))}))||this.ruleList.push({name:t[0],definition:t[1]});const t=this.rulesData;vk&&this.ruleList.sort(((e,t)=>e.definition.name.localeCompare(t.definition.name))),bk&&this.ruleList.sort(((e,n)=>(this.HasAccess(n)?1:0)-(this.HasAccess(e)?1:0)||(t.conditions[e.name]?1:0)-(t.conditions[n.name]?1:0)));const n=Math.ceil(this.ruleList.length/6);this.page<0?this.page=Math.max(n-1,0):this.page>=n&&(this.page=0)}Run(){var e;if(MainCanvas.textAlign="left",DrawText(`- Rules: Create new rules for ${this.character.Name} -`,125,125,"Black","Gray"),MainCanvas.textAlign="center",DrawButton(1815,75,90,90,"","White","Icons/Exit.png","Back"),DrawButton(1815,190,90,90,"","White","Icons/Question.png"),null===this.rulesData)return void(this.failed?fA(`get rules data from ${this.character.Name}`):DrawText("Loading...",1e3,480,"Black"));DrawButton(1815,305,90,90,"",this.rulesData.access_changeLimits?"White":"#ddd",this.permissionMode?"Icons/Reset.png":"Icons/Preference.png",this.rulesData.access_changeLimits?this.permissionMode?"Leave permission mode":"Edit rules permissions":"You have no permission to change limits",!this.rulesData.access_changeLimits),MainCanvas.textAlign="left",DrawText("Filter:",130,215,"Black"),Od(this.filterInput,550,210,600,64),MainCanvas.textAlign="center",this.filterInput.value&&DrawButton(870,182,64,64,"X","White"),DrawButton(1083,182,64,64,"ALL",null!=this.filterRuleType?"White":"#FEC5C5"),DrawButton(1183,82,64,64,"",0===this.filterRuleType?"#FEC5C5":"White"),CE(tw[0],1186,85,{Width:58,Height:58}),DrawButton(1283,82,64,64,"",1===this.filterRuleType?"#FEC5C5":"White"),CE(tw[1],1286,85,{Width:58,Height:58}),DrawButton(1383,82,64,64,"",2===this.filterRuleType?"#FEC5C5":"White"),CE(tw[2],1386,85,{Width:58,Height:58}),DrawButton(1183,182,64,64,"",3===this.filterRuleType?"#FEC5C5":"White"),CE(tw[3],1186,185,{Width:58,Height:58}),DrawButton(1283,182,64,64,"",4===this.filterRuleType?"#FEC5C5":"White"),CE(tw[4],1286,185,{Width:58,Height:58}),DrawButton(1383,182,64,64,"",99===this.filterRuleType?"#FEC5C5":"White"),CE(tw[99],1386,185,{Width:58,Height:58}),DrawButton(1483,132,64,64,"","White",void 0,"Toggle availability-based sorting"),CE("Icons/LockMenu.png",1486,135,{Alpha:bk?1:.2,Width:58,Height:58}),DrawButton(1583,132,64,64,"","white",void 0,"Toggle alphabetical sorting"),DrawTextFit("A-Z",1615,165,60,vk?"black":"#bbb"),MainCanvas.textAlign="left";for(let t=0;t<6;t++){const n=6*this.page+t;if(n>=this.ruleList.length)break;const r=this.ruleList[n];if(null===r)continue;const o=275+100*t,i=void 0!==this.rulesData.conditions[r.name],a=null!==(e=this.rulesData.limits[r.name])&&void 0!==e?e:bd.normal,s=this.HasAccess(r);let l,c;CE(tw[r.definition.type],125,o,{Height:64,Width:64}),this.permissionMode?(l=["#50ff56","#f6fe78","#ffa7a7"][a],c=["Normal","Limited","Blocked"][a]):(l=i?"#88c":s?"White":"#ccc",c=i?"Already applied":s?"":"You don't have permission to use this rule"),DrawButton(200,o,1350,64,"",l,"","",i||this.permissionMode);let u=r.definition.name;r.definition.shortDescription&&(u+=` (${Pd(r.definition.shortDescription,{PLAYER_NAME:this.character.Name})})`),DrawTextFit(u,210,o+34,1340,"Black"),MouseIn(200,o,1350,64)&&DrawHoverElements.push((()=>{DrawButtonHover(1200,o,60,60,c)}))}const t=Math.max(1,Math.ceil(this.ruleList.length/6));MainCanvas.textAlign="center",DrawBackNextButton(1605,800,300,90,`${InterfaceTextGet("Page")} ${this.page+1} / ${t}`,"White","",(()=>""),(()=>"")),this.permissionMode&&(DrawRect(1739,574,166,64,"#50ff56"),DrawRect(1739,638,166,64,"#f6fe78"),DrawRect(1739,702,166,64,"#ffa7a7"),MainCanvas.textAlign="center",DrawText("Normal",1822,608,"Black"),DrawText("Limited",1822,672,"Black"),DrawText("Blocked",1822,736,"Black")),this.showHelp&&IE(Mp[this.permissionMode?Dp.RulesAddPermissionMode:Dp.RulesAdd])}Click(){var e;if(MouseIn(1815,75,90,90))return this.Exit();if(MouseIn(1815,190,90,90))return void(this.showHelp=!this.showHelp);if(null===this.rulesData)return;if(MouseIn(1815,305,90,90))return void(this.permissionMode=this.rulesData.access_changeLimits&&!this.permissionMode);MouseIn(870,182,64,64)&&(this.filterInput.value="",this.rebuildList()),MouseIn(1083,182,64,64)&&(this.filterRuleType=null,this.rebuildList()),MouseIn(1183,82,64,64)&&(this.filterRuleType=0,this.rebuildList()),MouseIn(1283,82,64,64)&&(this.filterRuleType=1,this.rebuildList()),MouseIn(1383,82,64,64)&&(this.filterRuleType=2,this.rebuildList()),MouseIn(1183,182,64,64)&&(this.filterRuleType=3,this.rebuildList()),MouseIn(1283,182,64,64)&&(this.filterRuleType=4,this.rebuildList()),MouseIn(1383,182,64,64)&&(this.filterRuleType=99,this.rebuildList()),MouseIn(1483,132,64,64)&&(bk=!bk,this.rebuildList()),MouseIn(1583,132,64,64)&&(vk=!vk,this.rebuildList());for(let t=0;t<6;t++){const n=6*this.page+t;if(n>=this.ruleList.length)break;const r=this.ruleList[n];if(null===r)continue;const o=275+100*t,i=void 0!==this.rulesData.conditions[r.name],a=null!==(e=this.rulesData.limits[r.name])&&void 0!==e?e:bd.normal,s=[this.rulesData.access_normal,this.rulesData.access_limited,!1][a];if(MouseIn(200,o,1350,64)){const e=r.name;return void(this.permissionMode?this.character.conditionSetLimit("rules",r.name,(a+1)%3):i||jk(new yk(this.character,this,e,s)))}}const t=Math.ceil(this.ruleList.length/6);MouseIn(1605,800,150,90)?(this.page--,this.page<0&&(this.page=Math.max(t-1,0))):MouseIn(1755,800,150,90)&&(this.page++,this.page>=t&&(this.page=0))}HasAccess(e){var t;if(!this.rulesData)throw new Error("HardCoreClub: Rules data was unexpectedly 'null'");const n=null!==(t=this.rulesData.limits[e.name])&&void 0!==t?t:bd.normal;return[this.rulesData.access_normal,this.rulesData.access_limited,!1][n]}Exit(){jk(new Ck(this.character))}Unload(){this.filterInput.remove()}}class Ck extends dk{constructor(e){super(e,"rules"),this.removeLabel="Remove rule"}Run(){return!(!super.Run()&&null!==this.conditionCategoryData&&(DrawButton(120,820,384,90,"Add new rule","White","","...from the list of yet unestablished rules"),this.showHelp&&IE(Mp[Dp.ConditionsViewRules]),1))}Click(){return!(!super.Click()&&null!==this.conditionCategoryData)||!!MouseIn(120,820,384,90)&&(jk(new wk(this.character)),!0)}drawCategoryImage(e,t,n){CE(tw[n.extra.definition.type],e+6,t+6,{Height:50,Width:50})}drawEntryExtra(e,t,n){!1!==n.extra.definition.enforceable&&(CE("Icons/Management.png",e+610,t+10,{Height:40,Width:40,Alpha:n.data.data.enforce?1:.2}),MouseIn(e+610,t+6,44,44)&&DrawHoverElements.push((()=>{DrawButtonHover(e+610,t+6,44,44,n.data.data.enforce?"Rule will be enforced":"Rule will not be enforced")}))),!1!==n.extra.definition.loggable&&(CE("Icons/Title.png",e+660,t+10,{Height:40,Width:40,Alpha:n.data.data.log?1:.2}),MouseIn(e+660,t+6,44,44)&&DrawHoverElements.push((()=>{DrawButtonHover(e+660,t+6,44,44,n.data.data.log?"Rule violations will be logged":"Rule violations will not be logged")})))}headerText(){return`Rules: All active rules on ${this.character.Name}`}loadCondition(e,t){const n=sw(e);return[n.name,{definition:n}]}showDetailedDescriptionBackground(e){DrawRect(e,170,801,600,"White"),DrawEmptyRect(e,170,801,600,"Black")}showDetailedDescriptionText(e,t,n){MainCanvas.textAlign="left",DrawTextWrap(Pd(n.extra.definition.longDescription,{PLAYER_NAME:this.character.Name}),e+20-380,190,760,560,"black")}onDescriptionTextClick(e,t){jk(new yk(this.character,this,e,!1))}openEditSubscreen(e){jk(new fk(this.character,e,this))}removeCondition(e){this.character.ruleDelete(e)}openGlobalConfig(){jk(new gk(this.character,this))}}class _k extends Ap{constructor(e){super(),this.selectedPreset=-1,this.character=e}Run(){MainCanvas.textAlign="center",DrawButton(800,66,400,54,"<< Back to the tutorial","White"),DrawText("Please choose a preset, which sets your default experience, permissions and configuration.",1e3,150,"Black"),DrawText("Note: You can change the defaults, but changing to another preset is not possible without resetting BCX fully.",1e3,200,"FireBrick");const e=400,t=["Dominant","Switch/Exploring","Submissive","Slave"],n=["Icons/Management.png","Icons/Swap.png","Icons/Kneel.png",o],r=["This preset is for dominants who\nnever intend to submit. Therefore,\nmost modules are not loaded at\nstart. That said, you can still use\nthe BCX graphical user interface\non other BCX users to use actions,\nyou have permission for, on them,\nsame as with all other presets.","This preset is for switches who\nare sometimes dominant and\nsometimes submissive, enabling\nthem to explore BCX slowly, while\nhaving full control over all of its\nsettings and features.","This preset is for submissives,\nwho want to give some of their\ncontrol to selected dominants and\nlovers, giving only them authority\nover some of BCX's settings. You\ncan irreversably give away more\nand more control, when you want.","This preset is a much more\nextreme submissive experience,\nnot leaving much control over the\nsettings and permissions to you,\nthus enabling others to use many\nof BCX's features on you. Owners\ncan even unblock the most extreme\nsettings, if they desire so."];for(let o=0;o<4;o++){const i=125+450*o;if(MouseIn(i,250,e,575)&&DrawRect(i,250,e,575,"#ddd"),DrawEmptyRect(i,250,e,575,"Black"),o===this.selectedPreset){const t=10;DrawEmptyRect(i-t,250-t,e+2*t,575+2*t,"Cyan",5),DrawButton(i+20,850,360,65,"Confirm","White")}CE(n[o],i+200-43,275),DrawText(t[o],i+200,400,"Black"),MainCanvas.font=CommonGetFont(24);let a=475;for(const e of r[o].split("\n"))DrawText(e,i+200,a,"Black"),a+=36;1===o?DrawText("Easily try out all features",i+200,775,"Black"):2===o&&DrawText("Similar to Ace's Cursed Script",i+200,775,"Black"),MainCanvas.font=CommonGetFont(36)}}Click(){for(let t=0;t<4;t++){const n=125+450*t;if(MouseIn(n,250,400,575))return void(this.selectedPreset=t);t===this.selectedPreset&&MouseIn(n+20,850,360,65)&&(e=t,tA.preset=e,function(e){if(EA!==yd.ready)return console.error("HardCoreClub: Attempt to apply preset to modules, while not ready"),!1;for(const t of SA)t.applyPreset(e)}(e),function(e){Array.isArray(tA.disabledModules)?(e=xd(e.filter((e=>gd.includes(e)))),!!CommonArraysEqual(e,tA.disabledModules)||(tA.disabledModules=e,MA()&&(sA(),wA()))):console.error("HardCoreClub: Attempt to set disabled modules before initializetion")}(CA[e]),rA&&(rA=!1,tA.chatShouldDisplayFirstTimeHelp=!0,sA(),console.log("HardCoreClub: First time init finalized"),Jk(!0)),jk(new Wk(VA())))}var e;MouseIn(800,66,400,54)&&jk(new Ek(this.character,!0))}Exit(){}}const kk=[{name:"Welcome",image:"welcome.png",afterDraw(){DrawButton(1815,190,90,90,"","White","Icons/Question.png","",!0),MainCanvas.save(),MainCanvas.font='28px "Arial", sans-serif',MainCanvas.textAlign="left",DrawText(`Dear ${Player.Name},`,285,510,"Black"),DrawTextWrap("we are happy you are interested in our extension for the Bondage Club (BC) in which we invest a lot of our free time and love. If you have any questions, suggestions, or encounter any bugs, please feel free to get in touch with us on Discord. A button linking to it is in the main menu.",-185,544,940,160,"black"),MainCanvas.restore()}},{name:"Quick overview",image:"quick_overview.png"},{name:"New chat room icons",image:"status_icons.png",afterDraw(){DrawCharacter(Player,130,100,.82,!0,MainCanvas),TE(MainCanvas,t,450,70,50,50,50,1,4,"#6e6eff");const e=Date.now()%1e4;(e<4e3||e>6e3&&e<9e3)&&LE(MainCanvas,450,128,50,48,1)}},{name:"Introduction to roles and permissions",image:"basic_roles_permissions.png"},{name:"End of introduction",image:"basic_end.png",afterDraw(){DrawCharacter(Player,220,160,.78,!0,MainCanvas)}},{name:"Logging module screen",image:"log_part1.png"},{name:"Logging configuration screen",image:"log_part2.png"},{name:"Curses module overview",image:"curses1.png"},{name:"Adding curses",image:"curses2.png"},{name:"Rules module overview",image:"rules1.png"},{name:"Adding a rule",image:"rules2.png"},{name:"Limiting curse slots / rules",image:"limit_system.png"},{name:"Commands module overview",image:"commands.png"},{name:"Trigger conditions",image:"trigger_conditions.png"},{name:"Permission system overview",image:"permissions1.png"},{name:"Permission system base principles",image:"permissions2.png"},{name:"General permission examples",image:"permissions3.png"},{name:"Permission setup example 1",image:"permissions4.png"},{name:"Permission setup example 2",image:"permissions5.png"},{name:"Chat commands",image:"chat_commands.png"}],Ak=kk.findIndex((e=>"End of introduction"===e.name));class Ek extends Ap{constructor(e,t){super(),this.page=0,this.character=e,this.firstRun=t}Load(){this.page=0}Run(){const e=kk[this.page];var t;MainCanvas.textAlign="center",DrawText(`BCX TUTORIAL: ${e.name}`,1e3,125,"Black","Gray"),DrawButton(1500,830,300,90,this.firstRun&&this.page<Ak?"Skip tutorial":"Close tutorial","White"),e.image&&(t="tutorial/"+e.image,!hE||CE(hE+"resources/"+t,200,180,void 0)||DrawText("Loading...",1e3,500,"Black")),e.afterDraw&&e.afterDraw(),DrawBackNextButton(850,830,300,90,`Page ${this.page+1}/${kk.length}`,"White",void 0,(()=>""),(()=>""))}Click(){if(MouseIn(1500,830,300,90))return this.Exit();MouseIn(850,830,150,90)&&(this.page=Ld(this.page-1,0,kk.length-1)),MouseIn(1e3,830,150,90)&&(this.page=Ld(this.page+1,0,kk.length-1))}Exit(){jk(this.firstRun?new _k(this.character):new Wk(this.character))}}const Sk=JSON.parse('["AbandonedBuilding","AbandonedSideRoom","AlchemistOffice","AmandaCollarIntro","AmandaIntro","AncientRuins","AsylumBedroom","AsylumEntrance","AsylumGGTSRoom","AsylumGGTSRoomAlert","AsylumMeeting","AsylumTherapy","BDSMRoomBlue","BDSMRoomPurple","BDSMRoomRed","BackAlley","BalconyNight","Bar","BarRestaurant","Beach","BeachCafe","BeachHotel","BeachSunset","Bedroom","BondageBedChamber","Boudoir","BoutiqueBack","BoutiqueMain","BrickWall","CaptainCabin","Castle","Cell","Cellar","CeremonialVenue","ChillRoom","ClubCardLounge","ClubCardPlayBoard1","CollegeCafeteria","CollegeClass","CollegeClass2","CollegeDetention","CollegeEntrance","CollegeTeacherLounge","CollegeTennis","CollegeTennisPlay","CollegeTheater","Confessions","CosyChalet","CozyLivingRoom","CraftingWorkshop","CreepyBasement","DeepForest","Desert","DesolateVillage","DiningRoom","Dressing","Dungeon","DungeonRuin","DystopianCity","EgyptianExhibit","EgyptianTomb","EmptyWarehouse","ForestCave","ForestPath","Gambling","Gardens","Gymnasium","HeavenEntrance","HellEntrance","HorseStable","HorseStableLight","HotelBedroom","HotelBedroom2","HouseBasement1","HouseBasement2","HouseBasement3","HouseInterior1","HouseInterior2","HouseInterior3","HypnoSpiral2","HypnoticSpiral","IndoorPool","Industrial","Infiltration","Introduction","JungleTemple","Kennels","KidnapLeague","Kitchen","LatexRoom","LeatherChamber","LingerieShop","LockerRoom","LostVages","Magic","MagicSchoolEscape","MagicSchoolLaboratory","MaidCafe","MaidQuarters","MainHall","Management","MedinaMarket","MiddletownSchool","MovieStudio","NightClub","Nursery","Office1","Office2","OldFarm","Onsen","Orig/Dressing","Orig/Entrance","Orig/KidnapLeague","Orig/Lounge","Orig/MaidQuarters","Orig/MainHall","Orig/Shibari","Orig/Shop","Orig/buhne-dekorativ-kino-276179","OutdoorPool","OutdoorPool2","OutsideCells","PaddedCell","PaddedCell2","Pandora/Ground/Entrance","Pandora/Second/Cell0","Pandora/Second/Cell1","Pandora/Second/Cell2","Pandora/Second/Cell3","Pandora/Second/Cell4","Pandora/Second/Cell5","Pandora/Second/Cell6","Pandora/Second/Entrance","Pandora/Second/Fork0","Pandora/Second/Fork1","Pandora/Second/Fork2","Pandora/Second/Fork3","Pandora/Second/Fork4","Pandora/Second/Fork5","Pandora/Second/Fork6","Pandora/Second/Rest0","Pandora/Second/Tunnel0","Pandora/Second/Tunnel1","Pandora/Second/Tunnel2","Pandora/Second/Tunnel3","Pandora/Second/Tunnel4","Pandora/Second/Tunnel5","Pandora/Second/Tunnel6","Pandora/Underground/Cell0","Pandora/Underground/Cell1","Pandora/Underground/Cell2","Pandora/Underground/Cell3","Pandora/Underground/Cell4","Pandora/Underground/Cell5","Pandora/Underground/Cell6","Pandora/Underground/Entrance","Pandora/Underground/Fork0","Pandora/Underground/Fork1","Pandora/Underground/Fork2","Pandora/Underground/Fork3","Pandora/Underground/Fork4","Pandora/Underground/Fork5","Pandora/Underground/Fork6","Pandora/Underground/Rest0","Pandora/Underground/Tunnel0","Pandora/Underground/Tunnel1","Pandora/Underground/Tunnel2","Pandora/Underground/Tunnel3","Pandora/Underground/Tunnel4","Pandora/Underground/Tunnel5","Pandora/Underground/Tunnel6","ParkDay","ParkNight","ParkWinter","PartyBasement","PirateIsland","PirateIslandNight","PoolBottom","Prison","PrisonHall","Private","PublicBath","RainyForestPathDay","RainyForstPathNight","RainyStreetDay","RainyStreetNight","Ranch","ResearchPrep","ResearchProgress","Restaurant1","Restaurant2","RhythmGame","RhythmGameLoading","RooftopParty","RustySaloon","SarahBedroom0","SarahBedroom1","SarahBedroom2","SarahBedroom3","SarahCollarIntro","SarahIntro","SchoolHallway","SchoolHospital","SchoolRuins","SciFiCell","SciFiOutdoors","SciFiRed","SecretChamber","Sheet","SheetWhite","SheikhPrivate","SheikhTent","Shibari","ShipDeck","Shipwreck","Shop","SlaveMarket","SlipperyClassroom","SlumApartment","SlumCellar","SlumRuins","SnowyChaletDay","SnowyChaletNight","SnowyDeepForest","SnowyForestPathDay","SnowyForestPathNight","SnowyLakeNight","SnowyStreet","SnowyStreetDay1","SnowyStreetDay2","SnowyStreetNight2","SnowyTown1","SnowyTown2","SophieIntro","SpaceCaptainBedroom","SpookyForest","StreetNight","SunTemple","SynthWave","ThroneRoom","TiledBathroom","UnderwaterOne","VaultCorridor","Wagons","WeddingArch","WeddingBeach","WeddingRoom","WesternStreet","White","WitchWood","WoodenCabin","WrestlingRing","XmasDay","XmasEve","Yacht1","Yacht2","Yacht3","grey"]');function Dk(){Ik("forcesay",{name:"Forced say",helpDescription:"<text>",shortDescription:"Makes PLAYER_NAME instantly say the text",longDescription:"This command forces PLAYER_NAME to directly say the given text loudly in the chat room, without any way to react to it. The command is intentionally not supporting emotes, whispers or OOC text.\nUsage:\n!forcesay HELP_DESCRIPTION",defaultLimit:bd.blocked,playerUsable:!1,trigger:(e,t,n,r)=>{if(e.length<1)return n(Ow(t,`!forcesay usage:\n!forcesay ${r.commandDefinition.helpDescription}`)),!1;const o=e.join(" ").trim();return o.includes("(")?(n("The text after '.forcesay' must not contain OOC parts in round brackets"),!1):/^[*!/.]/.test(o[0])?(n("The text after '.forcesay' must not start with '*', '/', '!', or '.'"),!1):(ServerSend("ChatRoomChat",{Content:o,Type:"Chat"}),!0)}});let e="",t=null,n="",r=0;Ik("say",{name:"Say",helpDescription:"<text> | cancel",shortDescription:"Blocks PLAYER_NAME until she typed the text",longDescription:"This command makes PLAYER_NAME unable to say anything else than the given text loudly in the chat (she can still use emotes and whispers). The blocking lasts until the command giver cancels it with 'say cancel' command, leaves the room or until PLAYER_NAME leaves the room. The text is supposed to be typed out manually, otherwise the giver of the command will be notified of this. The command is intentionally not supporting emotes, whispers or OOC text.\nUsage:\n!say HELP_DESCRIPTION",defaultLimit:bd.blocked,playerUsable:!1,load(){Zd("ChatRoomSync",0,((r,o)=>{r[0].Name!==e&&(n="",t=null),o(r)}),md.Commands),Zd("ChatRoomKeyDown",4,((e,t)=>{var o;return"ChatRoom"===CurrentScreen&&n&&"InputChat"===(null===(o=document.activeElement)||void 0===o?void 0:o.id)&&r++,t(e)}),md.Commands)},init(){Ab({allowSend:o=>n&&"Chat"===o.type?((null===ChatRoomData||void 0===ChatRoomData?void 0:ChatRoomData.Name)&&(e=ChatRoomData.Name),zA().some((e=>e.MemberNumber===t))?(e=>{var t;return(null!==(t=e.noOOCMessage)&&void 0!==t?t:e.originalMessage).toLocaleLowerCase()===n.trim().toLocaleLowerCase()&&"Chat"===e.type})(o)?(t&&n.length>=r&&(gE(`Note: SourceCharacter did not type out the text '${n}' fully and likely used copy & paste or the chat history instead.`,t,[{Tag:"SourceCharacter",MemberNumber:Player.MemberNumber,Text:CharacterNickname(Player)}]),yE(`Note: It appears you didn't type out the text '${n}' fully and likelyused copy & paste or the chat history instead. The giver of the command has been notified of this.`)),n="",t=null,2):(yE(`You are ordered to say '${n}'.`),1):(n="",t=null,0)):0})},trigger:(e,i,a,s)=>{if(n&&1===e.length&&"cancel"===e[0].toLowerCase())return a(`You canceled ${Player.Name}'s say-command. She is now able to chat normally again.`),yE(`${i.toNicknamedString()} canceled your say-command. You are now able to chat normally again.`),n="",t=null,!0;if(n)return a(`${Player.Name} is already ordered to say something else. Please wait until she is done or cancel the current say-command with '.say cancel'.`),!1;if(o)return a(`${Player.Name} cannot receive a say-command, while still dealing with a typing task command.`),!1;const l=e.join(" ").trim();return!l||e.length<1?(a(Ow(i,`!say usage:\n!say ${s.commandDefinition.helpDescription}\n!say cancel - Cancel the last unfulfilled say-command and stop ${Player.Name}'s chat block.`)),!1):l.includes("(")?(a("The text after '.say' must not contain OOC parts in round brackets"),!1):/^[*!/.]/.test(l[0])?(a("The text after '.say' must not start with '*', '/', '!', or '.'"),!1):(r=0,n=l,t=i.MemberNumber,yE(`${i.toNicknamedString()} orders you to loudly say '${n}'.`),!0)},autoCompleter:e=>1===e.length&&n?$w(e[0],["cancel"]):[]});let o="",i=!1,a=!1,s=0;function l(){o="",i=!1,t=null,s=0,a=!1}function c(e,c,u,d){if(o&&i!==d)return u(`Currently ${Player.Name} has a ${i?"forced":"non-forced"} typetask-command ordered. These two commands cannot be combined.`),!1;if(o&&1===e.length&&"cancel"===e[0])return u(`You canceled ${Player.Name}'s typetask-command. She is now able to chat normally again.`),yE(`${c.toNicknamedString()} canceled your typetask-command. You are now able to chat normally again.`),l(),!0;if(o)return u(`${Player.Name} already has a typing task currently. Please wait until she is done or cancel the current one with '.typetask cancel'.`),!1;if(n)return u(`${Player.Name} cannot receive a typing task, while still blocked from a recent say-command.`),!1;if(0===e.length)return u(Ow(c,`!typetask usage:\n!typetask <number> <text>\n!typetask cancel - Cancel the last unfulfilled say-command and stop ${Player.Name}'s chat block.`)),!1;if(a=/^[0-9]+$/.test(e[0])&&Number.parseInt(e[0],10),!a||0===a)return u(`Needs a number (at least '1') for how often typing the text needs to be repeated after '.typetask' or specifically '.typetask cancel' to cancel the last unfulfilled typetask-command and stop ${Player.Name}'s chat and whisper block.'`),!1;const h=e.slice(1).join(" ").trim();return e.length<2||!h?(u("Needs a word or sentence after the number which is the text that needs to be repeatedly typed"),!1):h.includes("(")?(u("The text after '.typetask' must not contain OOC parts in round brackets"),!1):/^[*!/.]/.test(h[0])?(u("The text after '.typetask' must not start with '*', '/', '!', or '.'"),!1):(r=0,s=1,o=h,i=d,t=c.MemberNumber,u(`Successfully gave a new typing task to ${Player.Name}.`),yE(`${c.toNicknamedString()} gives you the task of typing '${o}' ${a} times in a whisper to her.`),!0)}function u(e,t){return 1===e.length&&o&&i===t?$w(e[0],["cancel"]):[]}Ik("typetask",{name:"Typing task",helpDescription:"<number> <text> | cancel",shortDescription:"Orders PLAYER_NAME to type a text several times or until she makes a mistake",longDescription:"This command gives PLAYER_NAME the task to type the given text in a whisper to the task giver for the number of times defined in the command. This will block PLAYER_NAME from chatting or whispering to anyone other than the task giver (she can still use emotes). This state lasts until the task giver cancels it with 'typetask cancel' command, leaves the room or until PLAYER_NAME either makes a mistake or leaves the room. The command is intentionally not supporting emotes, whispers or OOC text.\nUsage:\n!typetask HELP_DESCRIPTION",defaultLimit:bd.blocked,playerUsable:!1,load(){Zd("ChatRoomSync",0,((t,n)=>{t[0].Name!==e&&l(),n(t)}),md.Commands),Zd("ChatRoomKeyDown",4,((e,t)=>{var n;return"ChatRoom"===CurrentScreen&&o&&"InputChat"===(null===(n=document.activeElement)||void 0===n?void 0:n.id)&&r++,t(e)}),md.Commands)},init(){Ab({allowSend:n=>{if(o&&"number"==typeof a&&t&&("Chat"===n.type||"Whisper"===n.type)){if((null===ChatRoomData||void 0===ChatRoomData?void 0:ChatRoomData.Name)&&(e=ChatRoomData.Name),!zA().some((e=>e.MemberNumber===t)))return yE("Your current typing task ended prematurely, as the task giver is no longer in the room."),l(),0;if((e=>{var n;return(null!==(n=e.noOOCMessage)&&void 0!==n?n:e.originalMessage).toLocaleLowerCase()===o.trim().toLocaleLowerCase()&&"Whisper"===e.type&&ChatRoomTargetMemberNumber===t})(n)){if(t&&o.length>=r){if(i)return gE("SourceCharacter failed one instance of her typing task, since she did not type out the required text fully and likely used copy & paste or the chat history instead.",t,[{Tag:"SourceCharacter",MemberNumber:Player.MemberNumber,Text:CharacterNickname(Player)}]),yE("You are required to type the text out fully yourself. This try did not count!"),1;gE(`SourceCharacter failed the typing task as she did not type out the required text '${o}' fully and likely used copy & paste or the chat history instead.`,t,[{Tag:"SourceCharacter",MemberNumber:Player.MemberNumber,Text:CharacterNickname(Player)}]),yE("You failed the typing task as you did not type out the text fully"),l()}else s>=a?(gE("SourceCharacter completed the typing task successfully",t,[{Tag:"SourceCharacter",MemberNumber:Player.MemberNumber,Text:CharacterNickname(Player)}]),yE("You completed the typing task successfully."),l()):(yE(`Success: ${s} of ${a} times`),r=0,s++);return 2}return ChatRoomTargetMemberNumber!==t?(yE(`You are not allowed to whisper to someone else than ${xE(t,"[unknown name]")} (${t}) while you have not finished your typing task.`),1):"Chat"===n.type?(yE(`You are not allowed to speak loudly in the room until you complete your typing task by whispering the required text to ${ME(t,"[unknown name]")} (${t}).`),1):i?(gE("SourceCharacter typed the required text incorrectly. This try did not count.",t,[{Tag:"SourceCharacter",MemberNumber:Player.MemberNumber,Text:CharacterNickname(Player)}]),yE(`You did not type out the correct text '${o}'. This try did not count!`),1):(gE(`SourceCharacter typed the required text incorrectly and failed her task after ${s} ${1===s?"time":"times"} out of ${a}.`,t,[{Tag:"SourceCharacter",MemberNumber:Player.MemberNumber,Text:CharacterNickname(Player)}]),yE(`You typed the required text incorrectly and failed your task after ${s} ${1===s?"time":"times"} out of ${a}.`),l(),0)}return 0}})},trigger:(e,t,n,r)=>c(e,t,n,!1),autoCompleter:e=>u(e,!1)}),Ik("forcetypetask",{name:"Forced typing task",helpDescription:"<number> <text> | cancel",shortDescription:"Orders PLAYER_NAME to type a text a set number of times",longDescription:"This command gives PLAYER_NAME the task to type the given text in a whisper to the task giver for the number of times defined in the command. This will block PLAYER_NAME from chatting or whispering to anyone other than the task giver (she can still use emotes). This state lasts until the task giver cancels it with 'typetask cancel' command, leaves the room or until PLAYER_NAME either finishes the whole task successfully or leaves the room. The command is intentionally not supporting emotes, whispers or OOC text.\nUsage:\n!forcetypetask HELP_DESCRIPTION",defaultLimit:bd.blocked,playerUsable:!1,load(){},init(){},trigger:(e,t,n,r)=>c(e,t,n,!0),autoCompleter:e=>u(e,!0)})}function Mk(e){return"string"==typeof e&&xk.has(e)}const xk=new Map,Nk=[];function Ik(e,t){if(EA!==yd.init)throw new Error("Commands can be registered only during init");if(xk.has(e))throw new Error(`Command "${e}" already defined!`);xk.set(e,{...t,state:new Pk(e,t)}),Nk.push(e)}function Rk(e){const t=xk.get(e);if(!t)throw new Error(`Attempt to get display definition for unknown command '${e}'`);return{name:t.name,shortDescription:t.shortDescription,longDescription:t.longDescription,helpDescription:t.helpDescription,playerUsable:t.playerUsable,defaultLimit:t.defaultLimit}}function Lk(e,t){e=e.toLocaleLowerCase();const n=Array.from(xk.entries()).filter((e=>!t||t(e[0]))).find((([t,n])=>t.toLocaleLowerCase()===e||n.name.toLocaleLowerCase()===e));return n?[!0,n[0]]:[!1,`Unknown command "${e}".`]}function Tk(){return Nk.map((e=>[e,Rk(e)]))}class Pk{constructor(e,t){this.command=e,this.commandDefinition=t}}class Bk extends Ap{constructor(e,t,n){super(),this.character=e,this.back=t,this.command=n,this.commandDefinition=Rk(n)}onChange(e){e===this.character.MemberNumber&&this.Exit()}Run(){MainCanvas.textAlign="left",DrawText(`- Commands: Description of the command: "${this.commandDefinition.name}" -`,125,125,"Black","Gray"),function(e,t,n,r,o,i,a,s){if(MainCanvas.save(),!e)return;"center"===MainCanvas.textAlign&&(t+=Math.floor(875));const l=BE(e,r,void 0);n=Math.round(n+250-23*(l.length-1));for(const e of l)MainCanvas.fillText(e,t,n),n+=46;MainCanvas.restore()}(Pd(this.commandDefinition.longDescription,{PLAYER_NAME:this.character.Name,HELP_DESCRIPTION:this.commandDefinition.helpDescription}),125,220,1750),MainCanvas.textAlign="center",DrawButton(900,800,200,80,"Back","White")}Click(){MouseIn(900,800,200,80)&&this.Exit()}Exit(){jk(this.back)}}let Ok=!1,$k=!1;class Fk extends Ap{constructor(e){super(),this.commandsData=null,this.failed=!1,this.permissionMode=!1,this.commandList=[],this.page=0,this.showHelp=!1,this.filterInput=Bd("text",30),this.character=e,this.filterInput.addEventListener("input",(e=>{this.rebuildList()}))}Load(){this.requestData()}onChange(e){e===this.character.MemberNumber&&this.requestData()}requestData(){this.character.conditionsGetByCategory("commands").then((e=>{this.commandsData=e,this.commandsData.access_changeLimits||(this.permissionMode=!1),this.failed=!1,this.rebuildList()}),(e=>{console.error(`HardCoreClub: Failed to get commands info for ${this.character}`,e),this.commandsData=null,this.failed=!0,this.rebuildList()}))}rebuildList(){if(!this.active)return;if(this.commandList=[],null===this.commandsData)return void this.filterInput.remove();this.filterInput.parentElement||document.body.appendChild(this.filterInput);const e=this.filterInput.value.trim().toLocaleLowerCase().split(" ").filter(Boolean);for(const t of Tk())e.some((e=>{var n;return!t[0].toLocaleLowerCase().includes(e)&&!t[1].name.toLocaleLowerCase().includes(e)&&!(null===(n=t[1].shortDescription)||void 0===n?void 0:n.toLocaleLowerCase().includes(e))}))||this.commandList.push({name:t[0],definition:t[1]});const t=this.commandsData;Ok&&this.commandList.sort(((e,t)=>e.definition.name.localeCompare(t.definition.name))),$k&&this.commandList.sort(((e,n)=>(this.HasAccess(n)?1:0)-(this.HasAccess(e)?1:0)||(t.conditions[e.name]?1:0)-(t.conditions[n.name]?1:0)));const n=Math.ceil(this.commandList.length/6);this.page<0?this.page=Math.max(n-1,0):this.page>=n&&(this.page=0)}Run(){var e;if(MainCanvas.textAlign="left",DrawText(`- Commands: List all commands for ${this.character.Name} -`,125,125,"Black","Gray"),MainCanvas.textAlign="center",DrawButton(1815,75,90,90,"","White","Icons/Exit.png","BCX main menu"),DrawButton(1815,190,90,90,"","White","Icons/Question.png"),null===this.commandsData)return void(this.failed?fA(`get commands data from ${this.character.Name}`):DrawText("Loading...",1e3,480,"Black"));DrawButton(1815,305,90,90,"",this.commandsData.access_changeLimits?"White":"#ddd",this.permissionMode?"Icons/Reset.png":"Icons/Preference.png",this.commandsData.access_changeLimits?this.permissionMode?"Leave permission mode":"Edit commands permissions":"You have no permission to change limits",!this.commandsData.access_changeLimits),MainCanvas.textAlign="left",DrawText("Filter:",130,215,"Black"),Od(this.filterInput,550,210,600,64),MainCanvas.textAlign="center",this.filterInput.value&&DrawButton(870,182,64,64,"X","White"),DrawButton(1483,182,64,64,"","White",void 0,"Toggle availability-based sorting"),CE("Icons/LockMenu.png",1486,185,{Alpha:$k?1:.2,Width:58,Height:58}),DrawButton(1583,182,64,64,"","white",void 0,"Toggle alphabetical sorting"),DrawTextFit("A-Z",1615,215,60,Ok?"black":"#bbb"),MainCanvas.textAlign="left";for(let t=0;t<6;t++){const n=6*this.page+t;if(n>=this.commandList.length)break;const r=this.commandList[n];if(null===r)continue;const o=275+100*t,i=null!==(e=this.commandsData.limits[r.name])&&void 0!==e?e:bd.normal,a=this.HasAccess(r);let s,l;this.permissionMode?(s=["#50ff56","#f6fe78","#ffa7a7"][i],l=["Normal","Limited","Blocked"][i]):(s=a?"White":"#ccc",l=a?"":"You don't have permission to use this rule"),DrawButton(130,o,1350,64,"",s,"","",this.permissionMode);let c=r.definition.name;r.definition.shortDescription&&(c+=` (${Pd(r.definition.shortDescription,{PLAYER_NAME:this.character.Name})})`),DrawTextFit(c,140,o+34,1340,"Black"),MouseIn(130,o,1350,64)&&DrawHoverElements.push((()=>{DrawButtonHover(1200,o,60,60,l)}))}const t=Math.max(1,Math.ceil(this.commandList.length/6));MainCanvas.textAlign="center",DrawBackNextButton(1605,800,300,90,`${InterfaceTextGet("Page")} ${this.page+1} / ${t}`,"White","",(()=>""),(()=>"")),this.permissionMode&&(DrawRect(1739,574,166,64,"#50ff56"),DrawRect(1739,638,166,64,"#f6fe78"),DrawRect(1739,702,166,64,"#ffa7a7"),MainCanvas.textAlign="center",DrawText("Normal",1822,608,"Black"),DrawText("Limited",1822,672,"Black"),DrawText("Blocked",1822,736,"Black")),this.showHelp&&IE(Mp[this.permissionMode?Dp.CommandsPermissionMode:Dp.Commands])}Click(){var e;if(MouseIn(1815,75,90,90))return this.Exit();if(MouseIn(1815,190,90,90))return void(this.showHelp=!this.showHelp);if(null===this.commandsData)return;if(MouseIn(1815,305,90,90))return void(this.permissionMode=this.commandsData.access_changeLimits&&!this.permissionMode);MouseIn(870,182,64,64)&&(this.filterInput.value="",this.rebuildList()),MouseIn(1483,182,64,64)&&($k=!$k,this.rebuildList()),MouseIn(1583,182,64,64)&&(Ok=!Ok,this.rebuildList());for(let t=0;t<6;t++){const n=6*this.page+t;if(n>=this.commandList.length)break;const r=this.commandList[n];if(null===r)continue;const o=275+100*t,i=null!==(e=this.commandsData.limits[r.name])&&void 0!==e?e:bd.normal;if(MouseIn(130,o,1350,64)){const e=r.name;return void(this.permissionMode?this.character.conditionSetLimit("commands",r.name,(i+1)%3):jk(new Bk(this.character,this,e)))}}const t=Math.ceil(this.commandList.length/6);MouseIn(1605,800,150,90)?(this.page--,this.page<0&&(this.page=Math.max(t-1,0))):MouseIn(1755,800,150,90)&&(this.page++,this.page>=t&&(this.page=0))}HasAccess(e){var t;if(!this.commandsData)throw new Error("HardCoreClub: Commands data was unexpectedly 'null'");const n=null!==(t=this.commandsData.limits[e.name])&&void 0!==t?t:bd.normal;return[this.commandsData.access_normal,this.commandsData.access_limited,!1][n]}Exit(){jk(new Wk(this.character))}Unload(){this.filterInput.remove()}}const Hk=[{module:md.Global,onclick:e=>{jk(new i_(e))}},{module:md.Authority,onclick:e=>{jk(new Ip(e))}},{module:md.Log,onclick:e=>{jk(new s_(e))}},{module:md.Curses,onclick:e=>{jk(new pk(e))}},{module:md.Rules,onclick:e=>{jk(new Ck(e))}},{module:md.Commands,onclick:e=>{jk(new Fk(e))}},{module:md.Relationships,onclick:e=>{jk(new d_(e))}},{module:md.ExportImport,onclick:e=>{jk(new u_(e))}},{module:md.Misc,onclick:e=>{jk(new l_(e))}}];class Wk extends Ap{constructor(e){super(),this.disabledModules=gd,this.character=e}Load(){this.character.getDisabledModules(5e3).then((e=>{this.disabledModules=e})).catch((e=>{this.disabledModules=[],console.error("HardCoreClub: error getting disabled modules",e)}))}onChange(e){e===this.character.MemberNumber&&this.Load()}Run(){var n;let r;if(DrawText("- Hard Core Club -",125,125,"Black","Gray"),DrawButton(1815,75,90,90,"","White","Icons/Exit.png"),DrawButton(1815,190,90,90,"","White","Icons/Question.png","Show the StrictBCX tutorial again"),"supporter"===this.character.supporterStatus?(DrawText("BCX Supporter",690,125,"#DAA520","#FFD700"),r=[[.7,"#fff3b3"],[.75,"#ffef99"],[.8,"#ffeb80"],[.85,"#ffe766"],[.9,"#ffe34d"],[.95,"#ffdf33"],[1,"#ffdb19"],[1,"#FFD700"],[1,"#FFD700"],[1,"#FFD700"],[1,"#FFD700"]]):"developer"===this.character.supporterStatus&&(DrawText("BCX Developer",690,125,"#6e6eff","Black"),r=[[1,"#37377f"],[1,"#424299"],[1,"#4d4db2"],[1,"#5858cc"],[1,"#6363e5"],[1,"#6e6eff"],[1,"#6e6eff"],[1,"#6e6eff"],[1,"#6e6eff"]]),void 0!==this.character.supporterStatus&&r){const e=Math.floor(Date.now()/60%(2*r.length)),n=r[e<r.length?e:2*r.length-1-e];TE(MainCanvas,t,630,100,50,50,50,n[0],4,n[1])}this.character.isPlayer()&&tA.menuShouldDisplayTutorialHelp&&(DrawRect(950,190,850,90,"Black"),DrawText("New advanced tutorial pages are now available ",980,235,"White"));for(let e=0;e<Hk.length;e++){const t=Hk[e],n=Math.floor(e/6),r=e%6,o=this.disabledModules.includes(t.module);DrawButton(150+430*n,190+120*r,400,90,"",o?"#ddd":"White",fd[t.module],o?"Module is deactivated":"",o),DrawTextFit(pd[t.module],250+430*n,235+120*r,310,"Black")}MainCanvas.textAlign="center",this.character.isPlayer()?(DrawText(`Your Hard Core Club version: ${ad.replace(/-[0-f]+$/i,"")}`,1650,500,"Black",""),DrawButton(1450,590,400,90,"","White","","Open changelog on GitHub"),!0===e_?Date.now()%6e3<3e3?DrawText("New version available",1650,555,"Red","Black"):DrawText("Login again to upgrade",1650,555,"Red","Black"):!1===e_&&DrawText("This is the latest version",1650,555,"Black",""),DrawText("View changelog",1625,635,"Black",""),CE(e,1770,620,{Width:30,Height:30}),DrawButton(1450,700,400,90,"","White","","For saying 'thank you' with a tip"),MainCanvas.textAlign="center"):(DrawText(`Your Hard Core Club version: ${ad.replace(/-[0-f]+$/i,"")}`,1650,765,"Black",""),DrawText(`${this.character.Name}'s BCX version: ${null===(n=this.character.BCXVersion)||void 0===n?void 0:n.replace(/-[0-f]+$/i,"")}`,1650,845,"Black",""))}Click(){if(MouseIn(1815,75,90,90))return this.Exit();MouseIn(1815,190,90,90)&&(tA.menuShouldDisplayTutorialHelp&&(delete tA.menuShouldDisplayTutorialHelp,sA()),jk(new Ek(this.character,!1))),MouseIn(1450,590,400,90)&&this.character.isPlayer()&&window.open(`https://github.com/kinksideofthemoon/StrictBCX/releases/tag/${ad.replace(/-[0-f]+$/i,"")}`,"_blank");for(let e=0;e<Hk.length;e++){const t=Hk[e],n=Math.floor(e/6);if(MouseIn(150+430*n,190+e%6*120,400,90)&&!this.disabledModules.includes(t.module))return t.onclick(this.character)}}}function Gk(){return Uk.instance&&Uk.instance.currentSubscreen}function jk(e){if(!Uk.instance)throw new Error("Attempt to set subscreen before init");Uk.instance.currentSubscreen=e}class Uk extends Cd{get currentSubscreen(){return this._currentSubscreen}set currentSubscreen(e){this._currentSubscreen&&this._currentSubscreen.Unload(),this._currentSubscreen=e,this._currentSubscreen&&this._currentSubscreen.Load(),Kk.UpdateStatus(),Fy.emitEvent("bcxSubscreenChange",{inBcxSubscreen:null!=e})}constructor(){if(super(),this._currentSubscreen=null,Uk.instance)throw new Error("Duplicate initialization");Uk.instance=this}getInformationSheetCharacter(){const e=InformationSheetSelection;return e&&"number"==typeof e.MemberNumber?XA(e.MemberNumber):null}init(){dA.push((e=>{this._currentSubscreen&&this._currentSubscreen.onChange(e)}))}load(){Jd("InformationSheetRun",{"DrawButton(1815, 765, 90, 90,":"DrawButton(1815, 800, 90, 90,"}),Jd("InformationSheetClick",{"MouseIn(1815, 765, 90, 90)":"MouseIn(1815, 800, 90, 90)"}),Zd("InformationSheetRun",10,((e,t)=>{if(this._currentSubscreen)return MainCanvas.textAlign="left",this._currentSubscreen.Run(),MainCanvas.textAlign="center",void(cE&&(MouseX>0||MouseY>0)&&(MainCanvas.save(),MainCanvas.lineWidth=1,MainCanvas.strokeStyle="red",MainCanvas.beginPath(),MainCanvas.moveTo(0,MouseY),MainCanvas.lineTo(2e3,MouseY),MainCanvas.moveTo(MouseX,0),MainCanvas.lineTo(MouseX,1e3),MainCanvas.stroke(),MainCanvas.fillStyle="black",MainCanvas.strokeStyle="white",MainCanvas.fillRect(0,950,250,50),MainCanvas.strokeRect(0,950,250,50),DrawText(`X: ${MouseX} Y: ${MouseY}`,125,975,"white"),MainCanvas.restore()));t(e);const n=this.getInformationSheetCharacter();if(rA)n&&n.isPlayer()&&(DrawButton(1815,685,90,90,"","White",r),DrawRect(1300,685,500,90,"Black"),DrawText("You can find BCX here ",1550,730,"White"));else if(n&&null!==n.BCXVersion){const e=n.playerHasAccessToCharacter();DrawButton(1815,685,90,90,"",e?"White":"#ddd",r,e?"BCX":"Needs BC item permission",!e)}})),Zd("InformationSheetClick",10,((e,t)=>{if(this._currentSubscreen)return this._currentSubscreen.Click();const n=this.getInformationSheetCharacter();if(!MouseIn(1815,685,90,90))return t(e);rA?n&&n.isPlayer()&&(ServerBeep={Message:"",Timer:0},this.currentSubscreen=new Ek(n,!0)):n&&null!==n.BCXVersion&&n.playerHasAccessToCharacter()&&(this.currentSubscreen=new Wk(n))})),Zd("InformationSheetExit",10,((e,t)=>this._currentSubscreen?this._currentSubscreen.Exit():t(e)))}unload(){this.currentSubscreen=null}}var Yk;Uk.instance=null,function(e){e.None="None",e.Typing="Typing",e.Emote="Emote",e.Whisper="Whisper",e.DMS1="DMS1",e.DMS2="DMS2",e.Color="Color",e.Wardrobe="Wardrobe",e.Profile="Profile",e.Action="Action",e.Afk="Afk"}(Yk||(Yk={}));const qk=new WeakMap;class Xk{constructor(){this.InputTimeoutMs=3e3,this.StatusTypes={},this.InputElement=null,this.InputTimeout=null,this.Status=Yk.None,this.StatusTarget=null,this.DMS=0,this.DMSUnlock=!1,this.TypingStatus=Yk.None,this.WhisperTarget=null}GetCharacterStatus(e){return 0===e.ID?Kk.Status:qk.get(e)}SetInputElement(e){this.InputElement!==e&&(this.InputElement=e,null!==e&&(e.addEventListener("blur",this.InputEnd.bind(this)),e.addEventListener("input",this.InputChange.bind(this))))}GetStatus(){if(2===this.DMS)return this.DMSUnlock=!0,Yk.DMS2;if(1===this.DMS&&this.DMSUnlock)return Yk.DMS1;if(tA.screenIndicatorEnable){if("Appearance"===CurrentScreen)return Yk.Wardrobe;if("OnlineProfile"===CurrentScreen||null!=Gk())return Yk.Profile;if(null!=ItemColorItem)return Yk.Color}return tA.typingIndicatorEnable?this.TypingStatus:Yk.None}UpdateStatus(){const e=this.Status,t=this.StatusTarget;if(this.Status=this.GetStatus(),this.StatusTarget=this.Status===Yk.Whisper?this.WhisperTarget:null,this.Status!==e||this.StatusTarget!==t){if(this.StatusTarget!==t&&e!==Yk.None&&(this.SendUpdate(Yk.None,t),this.Status===Yk.None))return;this.SendUpdate(this.Status,this.StatusTarget)}}SendUpdate(e,t=null){hA("ChatRoomStatusEvent",{Type:e,Target:t},t)}InputChange(){var e;const t=null===(e=this.InputElement)||void 0===e?void 0:e.value;if("string"==typeof t&&t.length>1){if(this.TypingStatus=Yk.Typing,this.WhisperTarget=null,t.startsWith("*")||t.startsWith("/me ")||t.startsWith("/emote ")||t.startsWith("/action "))this.TypingStatus=Yk.Emote;else{if(t.startsWith("/")&&!t.startsWith("//")||t.startsWith(".")&&!t.startsWith(".."))return this.InputEnd();ChatRoomTargetMemberNumber>=0&&(this.TypingStatus=Yk.Whisper,this.WhisperTarget=ChatRoomTargetMemberNumber)}null!==this.InputTimeout&&clearTimeout(this.InputTimeout),this.InputTimeout=u(this.InputEnd.bind(this),this.InputTimeoutMs),this.UpdateStatus()}else this.InputEnd()}InputEnd(){null!==this.InputTimeout&&(clearTimeout(this.InputTimeout),this.InputTimeout=null),this.TypingStatus=Yk.None,this.UpdateStatus()}unload(){this.DMS=0,this.InputEnd()}}function zk(e){e.altKey&&"NumpadEnter"===e.code?(e.preventDefault(),e.stopImmediatePropagation(),document.activeElement instanceof HTMLElement&&document.activeElement.blur(),Kk.DMS=2,Kk.UpdateStatus()):e.altKey&&0===Kk.DMS&&(Kk.DMS=1,Kk.UpdateStatus())}function Vk(e){Kk.DMS>0&&("Alt"===e.key||"NumpadEnter"===e.code)&&(e.preventDefault(),e.stopImmediatePropagation(),Kk.DMS=e.altKey?1:0,Kk.UpdateStatus())}function Zk(){Kk.DMS>0&&(Kk.DMS=0,Kk.UpdateStatus())}let Kk;function Jk(e=!1){const t=VA(),n={version:ad,request:e,effects:t.Effects,typingIndicatorEnable:tA.typingIndicatorEnable,screenIndicatorEnable:tA.screenIndicatorEnable};KC&&JC&&!tA.supporterHidden&&(n.supporterStatus=KC,n.supporterSecret=JC),hA("hello",n)}const Qk=function(e,t){return e===t||Hy(e,t,Gy(t))};var eA;!function(e){e[e.OnlineSettings=0]="OnlineSettings",e[e.LocalStorage=1]="LocalStorage"}(eA||(eA={}));let tA={},nA=!1,rA=!1,oA=eA.OnlineSettings;function iA(){return`BCX_${Player.MemberNumber}`}function aA(){return`BCX_${Player.MemberNumber}_backup`}function sA(){if(EA!==yd.ready&&EA!==yd.destroy)return;if(nA||rA)return;if(!Player.OnlineSettings)return void console.error("HardCoreClub: Player OnlineSettings not defined during storage sync!");const e=LZString.compressToBase64(JSON.stringify(tA));try{if("string"!=typeof e)throw new Error("Data compression failed");const t=JSON.parse(LZString.decompressFromBase64(e));if(!Qk(tA,t))throw console.warn("Current data:\n",tA,"\nSaved data:\n",t),new Error("Saved data differs after load")}catch(e){return void $C("Save data failed to validate!",e)}if(oA===eA.OnlineSettings)Player.OnlineSettings.BCX=e,ServerAccountUpdate.QueueData({OnlineSettings:Player.OnlineSettings});else{if(oA!==eA.LocalStorage)throw new Error("Unknown StorageLocation");localStorage.setItem(iA(),e)}localStorage.setItem(aA(),e)}const lA=new Map,cA=new Map,uA={},dA=[];function hA(e,t,n=null){ServerPlayerIsInChatRoom()&&!rA&&ServerSend("ChatRoomChat",{Content:"BCXMsg",Type:"Hidden",Target:n,Dictionary:{type:e,message:t}})}function mA(e,t,n,r=!1){ServerSend("AccountBeep",{MemberNumber:n,BeepType:r?"Leash":"BCX",Message:{BCX:{type:e,message:t}}})}const pA=new Map;function fA(e,t=1e3){DrawTextWrap(`Failed to ${e}. This can be caused by missing permission to interact with their items, the user having left the room meanwhile, or the user not having the BC tab focused.`,200,280,2*(t-200),400,"Black")}function gA(e,t,n,r=1e4){return rA?Promise.reject("Unavailable during init"):new Promise(((o,i)=>{const a="10000000-1000-4000-8000-100000000000".replace(/[018]/g,(e=>(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16))),s={target:n,resolve:o,reject:i,timeout:u((()=>{console.warn("HardCoreClub: Query timed out",n,e),pA.delete(a),i("Timed out")}),r)};pA.set(a,s);const l=VA();n===l.MemberNumber?yA(l,kp({id:a,query:e,data:t})).then((e=>{vA(l.MemberNumber,e)}),(e=>{vA(l.MemberNumber,{id:a,ok:!1,data:e})})):hA("query",{id:a,query:e,data:t},n)}))}async function yA(e,t){const n=uA[t.query];if(!n)return console.warn("HardCoreClub: Query no handler",e,t),{id:t.id,ok:!1};const r=await n(e,t.data);return{id:t.id,ok:void 0!==r,data:r}}function vA(e,t){const n=pA.get(t.id);n?n.target==n.target?(clearTimeout(n.timeout),pA.delete(t.id),t.ok?n.resolve(t.data):n.reject(t.data)):console.warn("HardCoreClub: Response to query not from target",e,t,n):console.warn("HardCoreClub: Response to unknown query",e,t)}lA.set("query",((e,t)=>{if(!Ed(t)||"string"!=typeof t.id||"string"!=typeof t.query)return void console.warn("HardCoreClub: Invalid query",e,t);const n=XA(e);if(!n||!n.hasAccessToPlayer())return hA("queryAnswer",{id:t.id,ok:!1},e);yA(n,t).then((t=>{hA("queryAnswer",t,e)}),(n=>{hA("queryAnswer",{id:t.id,ok:!1,data:String(n)},e)}))})),lA.set("queryAnswer",((e,t)=>{Ed(t)&&"string"==typeof t.id&&"boolean"==typeof t.ok?vA(e,t):console.warn("HardCoreClub: Invalid queryAnswer",e,t)})),lA.set("somethingChanged",(e=>{dA.forEach((t=>t(e)))}));let bA=null;function wA(){if(EA!==yd.ready)return;const e=VA().MemberNumber;dA.forEach((t=>t(e))),null===bA&&(bA=u((()=>{bA=null,hA("somethingChanged",void 0)}),100))}const CA={[hd.dominant]:[md.Log,md.Curses,md.Rules,md.Commands],[hd.switch]:[],[hd.submissive]:[],[hd.slave]:[]};function _A(){var e;return null!==(e=tA.preset)&&void 0!==e?e:hd.switch}function kA(){return Array.isArray(tA.disabledModules)?tA.disabledModules.slice():[]}function AA(e){return!gd.includes(e)||!Array.isArray(tA.disabledModules)||!tA.disabledModules.includes(e)}let EA=yd.construct;const SA=[];function DA(e){if(EA!==yd.construct)throw new Error("Modules can be registered only before initialization");return SA.push(e),e}function MA(){if(EA!==yd.ready)return console.error("HardCoreClub: Attempt to reload modules, while not ready"),!1;for(const e of SA)e.reload(_A());return!0}var xA;!function(e){e[e.self=0]="self",e[e.clubowner=1]="clubowner",e[e.owner=2]="owner",e[e.lover=3]="lover",e[e.mistress=4]="mistress",e[e.whitelist=5]="whitelist",e[e.friend=6]="friend",e[e.public=7]="public"}(xA||(xA={}));const NA=new Map;function IA(e,t){if(EA!==yd.init)throw new Error("Permissions can be registered only during init");if(NA.has(e))throw new Error(`Permission "${e}" already defined!`);for(const[n,r]of Object.entries(t.defaults))r[1]!==xA.self||r[0]||console.error(`HardCoreClub: register permission "${e}": default for ${n} has invalid self value`);NA.set(e,{...t,self:t.defaults[hd.switch][0],min:t.defaults[hd.switch][1]})}function RA(e){var t,n,r;const o="number"==typeof e?e:e.MemberNumber;if(Player.MemberNumber===o)return xA.self;if(null!==o){if(Player.IsOwnedByMemberNumber(o))return xA.clubowner;if(null===(t=tA.owners)||void 0===t?void 0:t.includes(o))return xA.owner;if(Player.IsLoverOfMemberNumber(o))return xA.lover;if(null===(n=tA.mistresses)||void 0===n?void 0:n.includes(o))return xA.mistress;if(Player.WhiteList.includes(o))return xA.whitelist;if(null===(r=Player.FriendList)||void 0===r?void 0:r.includes(o))return xA.friend}return xA.public}function LA(){let e=null;for(const t of zA()){const n=RA(t);n!==xA.self&&(!e||n<e)&&(e=n)}return e}function TA(e,t){const n=NA.get(e);return n?!!t.hasAccessToPlayer()&&!!AA(n.category)&&(!t.isPlayer()||!function(e){return!(!lw("block_BCX_permissions").isEnforced||e.self&&e.min===xA.self)}(n))&&PA(n,RA(t)):(console.error(new Error(`Check for unknown permission "${e}"`)),!1)}function PA(e,t){return t===xA.self?e.self||e.min===xA.self:t<=e.min}function BA(){const e={};for(const[t,n]of NA.entries())AA(n.category)&&(e[t]=[n.self,n.min]);return e}function OA(e,t,n,r=!1){const o=NA.get(e);if(!o)throw new Error(`Attempt to edit unknown permission "${e}"`);return!!AA(o.category)&&(t=t||o.min===xA.self,o.self===t||(!n||r||TA(t?"authority_grant_self":"authority_revoke_self",n)&&(n.isPlayer()||TA(e,n))?(n&&(lv("permission_change",av.plaintext,`${n} `+(t?`gave ${n.isPlayer()?"herself":Player.Name}`:"removed "+((null==n?void 0:n.isPlayer())?"her":Player.Name+"'s"))+` control over permission "${o.name}"`),n.isPlayer()||yE(`${n.toNicknamedString()} `+(t?`gave ${n.isPlayer()?"herself":VA().Nickname}`:"removed "+((null==n?void 0:n.isPlayer())?"her":VA().Nickname+"'s"))+` control over permission "${o.name}"`,void 0,n.MemberNumber)),o.self=t,FA(),wA(),!0):(console.warn(`HardCoreClub: Unauthorized self permission edit attempt for "${e}" by ${n}`),!1)))}function $A(e,t,n,r=!1){const o=NA.get(e);if(!o)throw new Error(`Attempt to edit unknown permission "${e}"`);return!!AA(o.category)&&(o.min===t||(!n||r||n.isPlayer()&&o.min<t&&t<=xA.owner||TA("authority_edit_min",n)&&TA(e,n)&&(n.isPlayer()||RA(n)<=t)?(n&&(lv("permission_change",av.plaintext,`${n} changed permission "${o.name}" from "${WA(o.min,n)}" to "${WA(t,n)}"`),n.isPlayer()||yE(`${n.toNicknamedString()} changed permission "${o.name}" from "${WA(o.min,n)}" to "${WA(t,n)}"`,void 0,n.MemberNumber)),o.min=t,t===xA.self&&(o.self=!0),FA(),wA(),!0):(console.warn(`HardCoreClub: Unauthorized min permission edit attempt for "${e}" by ${n}`),!1)))}function FA(){tA.permissions=BA(),sA()}function HA(){const e={};for(const[t,n]of NA.entries())AA(n.category)&&(e[t]={...n});return e}function WA(e,t){return e===xA.self?t?t.Name:"Self":Nd(xA[e])}function GA(e){var t,n,r,o;const i=e=>[e,ME(e,"")];let a=[],s=[];return TA("authority_view_roles",e)||TA("authority_mistress_remove",e)?a=(null!==(t=tA.mistresses)&&void 0!==t?t:[]).map(i):(null===(n=tA.mistresses)||void 0===n?void 0:n.includes(e.MemberNumber))&&(a=[[e.MemberNumber,e.Name]]),TA("authority_view_roles",e)||TA("authority_owner_remove",e)?s=(null!==(r=tA.owners)&&void 0!==r?r:[]).map(i):(null===(o=tA.owners)||void 0===o?void 0:o.includes(e.MemberNumber))&&(s=[[e.MemberNumber,e.Name]]),{mistresses:a,owners:s,allowAddMistress:TA("authority_mistress_add",e),allowRemoveMistress:TA("authority_mistress_remove",e),allowAddOwner:TA("authority_owner_add",e),allowRemoveOwner:TA("authority_owner_remove",e)}}function jA(e,t,n,r){if(n===Player.MemberNumber)return!1;if(!tA.owners||!tA.mistresses)throw new Error("Not initialized");if(r){let o="authority_mistress_add";if("mistress"===e&&"remove"===t?o="authority_mistress_remove":"owner"===e&&"add"===t?o="authority_owner_add":"owner"===e&&"remove"===t&&(o="authority_owner_remove"),!TA(o,r)&&("remove"!==t||n!==r.MemberNumber))return!1;if("mistress"===e&&"add"===t&&tA.owners.includes(n)&&!TA("authority_owner_remove",r))return!1}if("owner"===e&&"remove"===t&&!tA.owners.includes(n)||"mistress"===e&&"remove"===t&&!tA.mistresses.includes(n))return!0;if(r){let o=r.MemberNumber===n?"herself":`${ME(n,"[unknown name]")} (${n})`;if(lv("authority_roles_change",av.plaintext,"add"===t?`${r} added ${o} as ${e}.`:`${r} removed ${o} from being ${e}.`),r.isPlayer()||(o=r.MemberNumber===n?"herself":`${xE(n,"[unknown name]")} (${n})`,yE("add"===t?`${r.toNicknamedString()} added ${o} as ${e}.`:`${r.toNicknamedString()} removed ${o} from being ${e}.`,void 0,r.MemberNumber)),"add"===t&&r.MemberNumber!==n){const t=r.isPlayer()?"her":`TargetCharacterName's (${Player.MemberNumber})`;gE(`SourceCharacter (${r.MemberNumber}) added you as ${t} BCX ${e}.`,n,[{Tag:"SourceCharacter",MemberNumber:r.MemberNumber,Text:CharacterNickname(r.Character)},{Tag:"TargetCharacterName",MemberNumber:Player.MemberNumber,Text:CharacterNickname(Player)}])}}const o=tA.owners.indexOf(n);o>=0&&tA.owners.splice(o,1);const i=tA.mistresses.indexOf(n);return i>=0&&tA.mistresses.splice(i,1),"add"===t&&("owner"===e?tA.owners.push(n):"mistress"===e&&tA.mistresses.push(n)),sA(),wA(),!0}class UA{isPlayer(){return!1}get MemberNumber(){if("number"!=typeof this.Character.MemberNumber)throw new Error("Character without MemberNumber");return this.Character.MemberNumber}get Name(){return this.Character.Name}get Nickname(){var e;return null!==(e=Rb(this))&&void 0!==e?e:CharacterNickname(this.Character)}get supporterStatus(){const e=n_.get(this.MemberNumber);return(null==e?void 0:e.verified)?e.status:void 0}toString(){return`${this.Name} (${this.MemberNumber})`}toNicknamedString(){return`${this.Nickname} (${this.MemberNumber})`}constructor(e){this.BCXVersion=null,this.typingIndicatorEnable=!0,this.screenIndicatorEnable=!0,this.Character=e,0===e.ID&&(this.BCXVersion=ad),this.Effects=kp(wd),console.debug(`HardCoreClub Loaded character ${e.Name} (${e.MemberNumber})`)}getDisabledModules(e){return gA("disabledModules",void 0,this.MemberNumber,e).then((e=>{if(!Array.isArray(e))throw console.error("HardCoreClub Bad data during 'disabledModules' query\n",e),new Error("Bad data");return e.filter((e=>gd.includes(e)))}))}getPermissions(){return gA("permissions",void 0,this.MemberNumber).then((e=>{if(!Ed(e)||Object.values(e).some((e=>!Array.isArray(e)||"boolean"!=typeof e[0]||"number"!=typeof e[1]||void 0===xA[e[1]])))throw console.error("HardCoreClub Bad data during 'permissions' query\n",e),new Error("Bad data");return function(e){const t={};for(const[n,r]of NA.entries())e[n]&&(t[n]={...r,self:e[n][0],min:e[n][1]});return t}(e)}))}getPermissionAccess(e){return gA("permissionAccess",e,this.MemberNumber).then((e=>{if("boolean"!=typeof e)throw console.error("HardCoreClub Bad data during 'permissionAccess' query\n",e),new Error("Bad data");return e})).catch((t=>(console.error(`HardCoreClub Error while querying permission "${e}" access for ${this}`,t),!1)))}getMyAccessLevel(){return gA("myAccessLevel",void 0,this.MemberNumber).then((e=>{if("number"!=typeof e||void 0===xA[e])throw console.error("HardCoreClub Bad data during 'myAccessLevel' query\n",e),new Error("Bad data");return e}))}setPermission(e,t,n){return gA("editPermission",{permission:e,edit:t,target:n},this.MemberNumber).then((e=>{if("boolean"!=typeof e)throw console.error("HardCoreClub Bad data during 'editPermission' query\n",e),new Error("Bad data");return e}))}getRolesData(){return gA("rolesData",void 0,this.MemberNumber).then((e=>{if(!(Ed(e)&&Array.isArray(e.mistresses)&&e.mistresses.every((e=>Array.isArray(e)&&2===e.length&&"number"==typeof e[0]&&"string"==typeof e[1]))&&Array.isArray(e.owners)&&e.owners.every((e=>Array.isArray(e)&&2===e.length&&"number"==typeof e[0]&&"string"==typeof e[1]))&&"boolean"==typeof e.allowAddMistress&&"boolean"==typeof e.allowRemoveMistress&&"boolean"==typeof e.allowAddOwner&&"boolean"==typeof e.allowRemoveOwner))throw console.error("HardCoreClub Bad data during 'rolesData' query\n",e),new Error("Bad data");return e}))}editRole(e,t,n){return gA("editRole",{type:e,action:t,target:n},this.MemberNumber).then((e=>{if("boolean"!=typeof e)throw console.error("HardCoreClub Bad data during 'editRole' query\n",e),new Error("Bad data");return e}))}getLogEntries(){return gA("logData",void 0,this.MemberNumber).then((e=>{if(!Array.isArray(e)||!e.every((e=>Array.isArray(e)&&4===e.length&&"number"==typeof e[0]&&"number"==typeof e[1]&&"number"==typeof e[2])))throw console.error("HardCoreClub Bad data during 'logData' query\n",e),new Error("Bad data");return e}))}logMessageDelete(e){return gA("logDelete",e,this.MemberNumber).then((e=>{if("boolean"!=typeof e)throw console.error("HardCoreClub Bad data during 'logDelete' query\n",e),new Error("Bad data");return e}))}getLogConfig(){return gA("logConfigGet",void 0,this.MemberNumber).then((e=>{if(!Ed(e)||Object.values(e).some((e=>"number"!=typeof e)))throw console.error("HardCoreClub Bad data during 'logConfigGet' query\n",e),new Error("Bad data");for(const t of Object.keys(e))null!=e[t]&&void 0!==wv[t]&&void 0!==sv[e[t]]||delete e[t];return e}))}setLogConfig(e,t){return gA("logConfigEdit",{category:e,target:t},this.MemberNumber).then((e=>{if("boolean"!=typeof e)throw console.error("HardCoreClub Bad data during 'logConfigEdit' query\n",e),new Error("Bad data");return e}))}logClear(){return gA("logClear",void 0,this.MemberNumber).then((e=>{if("boolean"!=typeof e)throw console.error("HardCoreClub Bad data during 'logClear' query\n",e),new Error("Bad data");return e}))}logPraise(e,t){return gA("logPraise",{message:t,value:e},this.MemberNumber).then((e=>{if("boolean"!=typeof e)throw console.error("HardCoreClub Bad data during 'logPraise' query\n",e),new Error("Bad data");return e}))}logGetAllowedActions(){return gA("logGetAllowedActions",void 0,this.MemberNumber).then((e=>{if(!Ed(e)||"boolean"!=typeof e.delete||"boolean"!=typeof e.configure||"boolean"!=typeof e.praise||"boolean"!=typeof e.leaveMessage)throw console.error("HardCoreClub Bad data during 'logGetAllowedActions' query\n",e),new Error("Bad data");return e}))}curseItem(e,t){return gA("curseItem",{Group:e,curseProperties:t},this.MemberNumber).then((e=>{if("boolean"!=typeof e)throw console.error("HardCoreClub Bad data during 'curseItem' query\n",e),new Error("Bad data");return e}))}curseLift(e){return gA("curseLift",e,this.MemberNumber).then((e=>{if("boolean"!=typeof e)throw console.error("HardCoreClub Bad data during 'curseLift' query\n",e),new Error("Bad data");return e}))}curseBatch(e,t){return gA("curseBatch",{mode:e,includingEmpty:t},this.MemberNumber).then((e=>{if("boolean"!=typeof e)throw console.error("HardCoreClub Bad data during 'curseBatch' query\n",e),new Error("Bad data");return e}))}curseLiftAll(){return gA("curseLiftAll",void 0,this.MemberNumber).then((e=>{if("boolean"!=typeof e)throw console.error("HardCoreClub Bad data during 'curseLiftAll' query\n",e),new Error("Bad data");return e}))}conditionsGetByCategory(e){return gA("conditionsGet",e,this.MemberNumber).then((t=>{if(!function(e,t,n=!1){const r=t,o=Zw.get(e);return!!o&&Ed(r)&&"boolean"==typeof r.access_normal&&"boolean"==typeof r.access_limited&&"boolean"==typeof r.access_configure&&"boolean"==typeof r.access_changeLimits&&(null===r.highestRoleInRoom||"number"==typeof r.highestRoleInRoom&&void 0!==xA[r.highestRoleInRoom])&&Ed(r.conditions)&&Sd(r.conditions).every((([t,o])=>{const i=Vw(e,t,o);return!i&&n?(console.warn(`HardCoreClub: Removing invalid ${t}:${e} condition from public data`,o),delete r.conditions[t],!0):i}))&&(null===r.timer||"number"==typeof r.timer)&&"boolean"==typeof r.timerRemove&&o.validateCategorySpecificGlobalData(r.data)&&zw(r.requirements)&&Ed(r.limits)&&Object.entries(r.limits).every((([e,t])=>void 0===t||"number"==typeof t&&void 0!==bd[t]))}(e,t,!0))throw console.error("HardCoreClub Bad data during 'conditionsGet' query\n",t),new Error("Bad data");return t}))}conditionSetLimit(e,t,n){return gA("conditionSetLimit",{category:e,condition:t,limit:n},this.MemberNumber).then((e=>{if("boolean"!=typeof e)throw console.error("HardCoreClub Bad data during 'conditionSetLimit' query\n",e),new Error("Bad data");return e}))}conditionUpdate(e,t,n){return gA("conditionUpdate",{category:e,condition:t,data:n},this.MemberNumber).then((e=>{if("boolean"!=typeof e)throw console.error("HardCoreClub Bad data during 'conditionUpdate' query\n",e),new Error("Bad data");return e}))}conditionUpdateMultiple(e,t,n){return gA("conditionUpdateMultiple",{category:e,conditions:t,data:n},this.MemberNumber).then((e=>{if("boolean"!=typeof e)throw console.error("HardCoreClub Bad data during 'conditionUpdateMultiple' query\n",e),new Error("Bad data");return e}))}conditionCategoryUpdate(e,t){return gA("conditionCategoryUpdate",{category:e,data:t},this.MemberNumber).then((e=>{if("boolean"!=typeof e)throw console.error("HardCoreClub Bad data during 'conditionCategoryUpdate' query\n",e),new Error("Bad data");return e}))}ruleCreate(e){return gA("ruleCreate",e,this.MemberNumber).then((e=>{if("boolean"!=typeof e)throw console.error("HardCoreClub Bad data during 'ruleCreate' query\n",e),new Error("Bad data");return e}))}ruleDelete(e){return gA("ruleDelete",e,this.MemberNumber).then((e=>{if("boolean"!=typeof e)throw console.error("HardCoreClub Bad data during 'ruleDelete' query\n",e),new Error("Bad data");return e}))}exportImportDoExport(e,t=!0){return gA("export_import_do_export",{category:e,compress:t},this.MemberNumber).then((e=>{if("string"!=typeof e)throw console.error("HardCoreClub Bad data during 'export_import_do_export' query\n",e),new Error("Bad data");return e}))}exportImportDoImport(e,t){return gA("export_import_do_import",{category:e,data:t},this.MemberNumber).then((e=>{if("string"!=typeof e)throw console.error("HardCoreClub Bad data during 'export_import_do_import' query\n",e),new Error("Bad data");return e}))}relatonshipsGet(){return gA("relatonshipsGet",void 0,this.MemberNumber).then((e=>{if(!Ed(e)||!Array.isArray(e.relationships)||!e.relationships.every(Ib)||"boolean"!=typeof e.access_view_all||"boolean"!=typeof e.access_modify_self||"boolean"!=typeof e.access_modify_others)throw console.error("HardCoreClub Bad data during 'relatonshipsGet' query\n",e),new Error("Bad data");return e}))}relationshipsRemove(e){return gA("relationshipsRemove",e,this.MemberNumber).then((e=>{if("boolean"!=typeof e)throw console.error("HardCoreClub Bad data during 'relationshipsRemove' query\n",e),new Error("Bad data");return e}))}relationshipsSet(e){return gA("relationshipsSet",e,this.MemberNumber).then((e=>{if("boolean"!=typeof e)throw console.error("HardCoreClub Bad data during 'relationshipsSet' query\n",e),new Error("Bad data");return e}))}hasAccessToPlayer(){return ServerChatRoomGetAllowItem(this.Character,Player)}playerHasAccessToCharacter(){return ServerChatRoomGetAllowItem(Player,this.Character)}}class YA extends UA{constructor(){super(...arguments),this.playerObject=!0}get supporterStatus(){return KC}isPlayer(){return!0}getMyAccessLevel(){return Promise.resolve(xA.self)}}const qA=[];function XA(e){if("number"!=typeof e)return null;!function(){for(let e=qA.length-1;e>=0;e--)qA[e].isPlayer()||ChatRoomCharacter.includes(qA[e].Character)||qA.splice(e,1)}();let t=qA.find((t=>t.Character.MemberNumber===e));if(!t){if(Player.MemberNumber===e)t=new YA(Player);else{const n=ChatRoomCharacter.find((t=>t.MemberNumber===e));if(!n)return null;t=new UA(n)}qA.push(t)}return t}function zA(){return ServerPlayerIsInChatRoom()?ChatRoomCharacter.map((e=>XA(e.MemberNumber))).filter(Boolean):[VA()]}function VA(){let e=qA.find((e=>e.Character===Player));return e||(e=new YA(Player),qA.push(e)),e}const ZA=[];function KA(){const e=kp(wd);for(const t of ZA)t(e);const t=VA();zp(e,t.Effects)||(t.Effects=e,CharacterRefresh(Player,!1),Jk(!1))}const JA=function(e,t){return t.length<2?e:mf(e,function(e,t,n){var r=-1,o=e.length;t<0&&(t=-t>o?0:o+t),(n=n>o?o:n)<0&&(n+=o),o=t>n?0:n-t>>>0,t>>>=0;for(var i=Array(o);++r<o;)i[r]=e[r+t];return i}(t,0,-1))},QA=function(e,t){return t=df(t,e),null==(e=JA(e,t))||delete e[hf(function(e){var t=null==e?0:e.length;return t?e[t-1]:void 0}(t))]};var eE=Function.prototype,tE=Object.prototype,nE=eE.toString,rE=tE.hasOwnProperty,oE=nE.call(Object);const iE=function(e){return function(e){if(!Vh(e)||"[object Object]"!=yh(e))return!1;var t=$m(e);if(null===t)return!0;var n=rE.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&nE.call(n)==oE}(e)?void 0:e},aE=Nf((function(e,t){var n={};if(null==e)return n;var r=!1;t=af(t,(function(t){return t=df(t,e),r||(r=t.length>1),t})),zh(e,Gm(e),n),r&&(n=_p(n,7,iE));for(var o=t.length;o--;)QA(n,t[o]);return n})),sE={ItemNeckAccessories:"Collar Addon",ItemNeckRestraints:"Collar Restraint",ItemNipplesPiercings:"Nipple Piercing",ItemHood:"Hood",ItemMisc:"Miscellaneous",ItemDevices:"Devices",ItemHoodAddon:"Hood Addon",ItemAddon:"General Addon",ItemLegs:"Upper Leg",ItemFeet:"Lower Leg",ItemBoots:"Feet",ItemMouth:"Mouth (1)",ItemMouth2:"Mouth (2)",ItemMouth3:"Mouth (3)",HairAccessory2:"Ears Accessory",Height:"Character Height",Mouth:"Mouth Style",Pussy:"Pussy Style"};let lE=!1,cE=!1;function uE(e){if(e){if(!Gd.dev)return console.info("Cheats are only allowed in developer version"),!1;console.warn("Cheats enabled; please be careful not to break things")}else{if(!dE(!1))return!1;console.info("Cheats disabled")}return lE=e,!0}function dE(e){if(e){if(!uE(!0))return console.info("To use developer mode, cheats must be enabled first!"),!1;window.BCX_Devel=!0,AssetGroup.forEach((e=>e.Description=e.Name)),Asset.forEach((e=>e.Description=e.Group.Name+":"+e.Name)),BackgroundSelectionAll.forEach((e=>{e.Description=e.Name,e.Low=e.Description.toLowerCase()})),console.warn("Developer mode enabled")}else delete window.BCX_Devel,AssetLoadDescription("Female3DCG"),BackgroundSelectionAll.forEach((e=>{e.Description=BackgroundsTextGet(e.Name),e.Low=e.Description.toLowerCase()})),console.info("Developer mode disabled");return cE=e,!0}let hE=null,mE=!1;function pE(e){var t;return cE?e.Name:null!==(t=sE[e.Name])&&void 0!==t?t:e.Description}function fE(e,t=3e3){ServerBeep={Timer:CommonTime()+t,Message:e}}function gE(e,t=null,n=[]){e&&ServerSend("ChatRoomChat",{Content:"BCX_PLAYER_CUSTOM_DIALOG",Type:"Action",Target:null!=t?t:void 0,Dictionary:[{Tag:'MISSING TEXT IN "Interface.csv": BCX_PLAYER_CUSTOM_DIALOG',Text:e},...n]})}function yE(e,t,n){var r,o;u((()=>{Fy.emitEvent("bcxLocalMessage",{message:e,timeout:t,sender:n})}),0);const i=document.createElement("div");i.setAttribute("class","ChatMessage ChatMessageLocalMessage"),i.setAttribute("data-time",ChatRoomCurrentTime()),i.setAttribute("data-sender",`${null!==(r=null!=n?n:Player.MemberNumber)&&void 0!==r?r:0}`),i.style.background="#6e6eff54",i.style.margin="0.15em 0","string"==typeof e?i.innerText=e:i.appendChild(e),t&&u((()=>i.remove()),t);const a="InputChat"===(null===(o=document.activeElement)||void 0===o?void 0:o.id),s=ElementIsScrolledToEnd("TextAreaChatLog"),l=document.getElementById("TextAreaChatLog");return null!=l?(l.appendChild(i),s&&ElementScrollToEnd("TextAreaChatLog"),a&&ElementFocus("InputChat"),i):null}function vE(){return"function"==typeof window.ChatRoomDrawFriendList}function bE(){const e=window;return{NMod:vE(),BondageClubTools:!0===window.BCX_BondageClubToolsPatch||ServerSocket.listeners("ChatRoomMessage").some((e=>e.toString().includes("window.postMessage"))),BCFriendList:ServerSocket.listeners("AccountQueryResult").some((e=>e.toString().includes("f_t_body.innerText"))),Curse:"function"==typeof e.CursedStarter&&(`${e.currentManifestVersion}`||!0),RPScript:"string"==typeof(null===Player||void 0===Player?void 0:Player.RPSScriptstatus)&&(`${null===Player||void 0===Player?void 0:Player.RPSScriptstatus}`||!0),Moaner:void 0!==e.M_MOANER_scriptOn&&(`${e.M_MOANER_scriptOn}`||!0),BcUtil:"function"==typeof e.StartBcUtil,QuickAccessMenu:"function"==typeof e.OLDmenu&&"function"==typeof e.NEWmenu,ImprovedStruggle:"function"==typeof e.OLDclick&&"function"==typeof e.NEWclick,BCE:void 0!==e.BCE_VERSION&&(`${e.BCE_VERSION}`||!0)}}function wE(){const e=Ud().getModsInfo(),t=new Array,{BondageClubTools:n}=bE();return n&&t.push("BC Tools"),e.forEach((e=>{cd.includes(e.name)&&(t.push(e.name),console.warn("--\x3e Found forbidden mod: "+e.name))})),t}function CE(e,t,n,{Canvas:r=MainCanvas,Alpha:o=1,SourcePos:i,Width:a,Height:s,Invert:l=!1,Mirror:c=!1,Zoom:u=1}={}){if("string"==typeof e){if(!(e=DrawGetImage(e)).complete)return!1;if(!e.naturalWidth)return!0}const d=null!=a||null!=s;return null==a&&(a=i?i[2]:e.width),null==s&&(s=i?i[3]:e.height),r.save(),r.globalCompositeOperation="source-over",r.globalAlpha=o,r.translate(t,n),1!==u&&r.scale(u,u),l&&r.transform(1,0,0,-1,0,s),c&&r.transform(-1,0,0,1,a,0),i?r.drawImage(e,i[0],i[1],i[2],i[3],0,0,a,s):d?r.drawImage(e,0,0,a,s):r.drawImage(e,0,0),r.restore(),!0}function _E(e){const t=AssetGroup.includes(e)?e:Asset.includes(e)?e.Group:e.Asset.Group;if(!AssetGroup.includes(t))throw new Error("Failed to convert item to group");return t}function kE(e){return AssetGroup.some((t=>t.Name===e))}function AE(e,t=!1){const n=_E(e);return"Appearance"===n.Category&&n.AllowNone&&n.Clothing&&(t||!n.BodyCosplay)}function EE(e){const t=_E(e);return"Appearance"===t.Category&&t.AllowNone&&t.Clothing&&t.BodyCosplay}function SE(e){const t=_E(e);return"Appearance"===t.Category&&!t.Clothing}function DE(e,t=["ItemNeck","ItemNeckAccessories","ItemNeckRestraints"]){const n=_E(e);return"Item"===n.Category&&!n.BodyCosplay&&!t.includes(n.Name)}function ME(e,t=null){var n,r;const o=XA(e);if(o)return o.Name;if(Player.MemberNumber===e)return Player.Name;for(const t of ChatRoomCharacter){if(t.MemberNumber===e)return t.Name;if((null===(n=t.Ownership)||void 0===n?void 0:n.MemberNumber)===e)return t.Ownership.Name;if(Array.isArray(t.Lovership))for(const n of t.Lovership)if(n.MemberNumber===e)return n.Name}return(null===(r=Player.FriendNames)||void 0===r?void 0:r.get(e))||t}function xE(e,t=null){const n=Rb(e);if(null!=n)return n;const r=XA(e);return r?r.Nickname:ME(e,t)}function NE(e,t){return null==e?e="Default":Array.isArray(e)&&1===e.length&&(e=e[0]),null==t?t="Default":Array.isArray(t)&&1===t.length&&(t=t[0]),Array.isArray(e)&&Array.isArray(t)?CommonArraysEqual(e,t):e===t}function IE(e){DrawHoverElements.push((()=>{MainCanvas.save(),DrawRect(1e3,190,800,600,"#ffff88"),DrawEmptyRect(1e3,190,800,600,"Black"),MainCanvas.textAlign="left",DrawTextWrap(e,640,210,760,560,"black"),MainCanvas.restore()}))}function RE(e){const t=ChatRoomData?aE(ChatRoomData,"Character"):null;if(!ServerPlayerIsInChatRoom()||!ChatRoomPlayerIsAdmin()||!t)return!1;const n={...t,...e};return n.Limit=String(n.Limit),ServerSend("ChatRoomAdmin",{MemberNumber:Player.ID,Action:"Update",Room:n}),!0}function LE(e,t,n,r,o,i,a=!1){e.save(),e.globalAlpha=i,e.translate(t,n),e.scale(r/50,o/50),e.fillStyle="white",e.strokeStyle="black",e.lineWidth=3;let s=new Path2D("m16.224 3.7453 18.537-0.00135c8.045 0.12979 14.142 7.9048 13.74 13.256v5c-0.07394 7.8789-4.2176 15.139-12.946 15.375l-13.663 0.17306-10.992 8.5772-0.13168-8.8861c-4.4316-3.095-9.4592-6.006-9.113-12.266l-0.15485-7.9735c-0.11565-6.8309 6.3297-13.251 14.724-13.255z");e.fill(s),e.stroke(s),e.fillStyle="black",s=new Path2D(a?"m11.902 16.017 0.16893 3.7841-3.5814-1.2839-0.64194 1.9934 3.6489 1.0136-2.3313 3.007 1.6893 1.2163 2.1285-3.1421 2.0948 3.1421 1.7231-1.2163-2.365-3.007 3.6489-1.0136-0.64194-1.9934-3.5814 1.2839 0.16893-3.7841z":"m15.793 19.891a3.5336 3.5336 0 0 1-2.5515 4.2857 3.5336 3.5336 0 0 1-4.2954-2.5351 3.5336 3.5336 0 0 1 2.5186-4.3051 3.5336 3.5336 0 0 1 4.3147 2.5021");for(const t of[0,12,12])e.translate(t,0),e.fill(s);e.restore()}function TE(e,t,n,r,o,i,a,s,l,c,u="black"){e.save(),e.globalAlpha=s,e.translate(n,r),e.scale(o/a,i/a),e.fillStyle=c,u&&(e.strokeStyle=u),e.lineWidth=l;const d=new Path2D(t);e.fill(d),u&&e.stroke(d),e.restore()}function PE(e,t){if(MainCanvas.measureText(e).width<=t)return[e];const n=[];let r="";for(const o of e.split(" ")){const e=r+" "+o;r&&MainCanvas.measureText(e).width>t?(n.push(r),r=o):r=e}return r&&n.push(r),n}function BE(e,t,n){const r=e.split("\n").map((e=>e.trim()));n&&r.length>n&&(n=void 0);const o=[];for(const e of r)o.push(...PE(e,t));return n&&o.length>n?(MainCanvas.font=(parseInt(MainCanvas.font.substring(0,2),10)-2).toString()+"px arial",BE(e,t,n)):o}var OE,$E;!function(e){e[e.Afk=0]="Afk",e[e.Rp=1]="Rp",e[e.Chill=2]="Chill",e[e.Kidnap=3]="Kidnap",e[e.Tie=4]="Tie",e[e.Market=5]="Market",e[e.Game=6]="Game",e[e.Other=99]="Other"}(OE||(OE={})),function(e){e[e.Adventure=0]="Adventure",e[e.Fantasy=1]="Fantasy",e[e.Historic=2]="Historic",e[e.Modern=3]="Modern",e[e.Romantic=4]="Romantic",e[e.School=5]="School",e[e.SciFi=6]="SciFi"}($E||($E={}));const FE={[OE.Afk]:"AFK/Storage",[OE.Rp]:"Roleplaying",[OE.Chill]:"Chill/Chat",[OE.Kidnap]:"Kidnap/Danger",[OE.Tie]:"Tying all up",[OE.Market]:"Market/Auction",[OE.Game]:"Game",[OE.Other]:"Undefined"};function HE(e){return Array.from(e.Limits.values()).sort(((e,t)=>WE.indexOf(e)-WE.indexOf(t))).join(", ")}const WE=["no-anal","no-animals","no-fantasy","no-limits","no-males","no-sexual","no-tentacles"];let GE,jE=!1,UE=!1;const YE=72-Math.max(...Object.values(FE).map((e=>e.length)))-Math.max(...Object.keys($E).map((e=>e.length))),qE=new Map,XE={Type:OE.Other,Setting:void 0,Limits:new Set,BlockCategories:[],Background:"",IntroText:""};let zE=!1,VE="",ZE=!1,KE=document.getElementById("INTRO_TEXT");function JE(e){let t;if(e.length<1)fE("HardCoreClub: Import error: No data",5e3);else{try{if(t=JSON.parse(e),!Ed(t))return void fE("HardCoreClub: Import error: Bad data",5e3)}catch(e){return console.warn(e),void fE("HardCoreClub: Import error: Bad data",5e3)}XE.Type="number"==typeof t.Type&&void 0!==OE[t.Type]?t.Type:OE.Other,XE.Setting="number"==typeof t.Setting&&void 0!==$E[t.Setting]?t.Setting:void 0,XE.Limits=new Set(Array.isArray(t.Limits)?t.Limits.filter((e=>WE.includes(e))):[]),XE.BlockCategories=Array.isArray(t.BlockCategories)?t.BlockCategories.filter((e=>"string"==typeof e)):[],XE.Background="string"==typeof t.Background?t.Background:"",XE.IntroText="string"==typeof t.IntroText?t.IntroText:""}}function QE(){zE&&nS()}function eS(e){zE&&document.activeElement!==KE&&(e.preventDefault(),e.stopImmediatePropagation(),JE((e.clipboardData||window.clipboardData).getData("text")))}function tS(e){XE.Setting!==e?XE.Setting=e:XE.Setting=void 0}function nS(){zE=!1,KE&&(KE.remove(),KE=void 0)}function rS(){var e;if(zE)return function(){MainCanvas.textAlign="left",DrawText("1. Select the room type:",120,100,"Black","Gray"),DrawText("2. Optionally, select one room setting:",745,100,"Black","Gray"),DrawText("3. Optionally, select limits for the room:",120,480,"Black","Gray"),DrawText("4. Optionally, write a room introduction message/greeting that everyone joining will see as emote:",120,700,"Black","Gray"),MainCanvas.textAlign="center",CE("Backgrounds/"+XE.Background+".jpg",1480,75,{Width:420,Height:245}),Id&&(DrawButton(1480,340,193,50,"Export","White","","Export everything onscreen"),DrawButton(1705,340,193,50,"Import","White","","Import everything onscreen")),DrawButton(120,130,260,60,FE[OE.Afk],XE.Type===OE.Afk?"#FEC5C5":"White"),DrawButton(120,205,260,60,FE[OE.Chill],XE.Type===OE.Chill?"#FEC5C5":"white"),DrawButton(120,280,260,60,FE[OE.Tie],XE.Type===OE.Tie?"#FEC5C5":"white"),DrawButton(120,355,260,60,FE[OE.Game],XE.Type===OE.Game?"#FEC5C5":"white"),DrawButton(395,130,260,60,FE[OE.Rp],XE.Type===OE.Rp?"#FEC5C5":"white"),DrawButton(395,205,260,60,FE[OE.Kidnap],XE.Type===OE.Kidnap?"#FEC5C5":"white"),DrawButton(395,280,260,60,FE[OE.Market],XE.Type===OE.Market?"#FEC5C5":"white"),DrawButton(395,355,260,60,FE[OE.Other],XE.Type===OE.Other?"#FEC5C5":"white"),DrawButton(735,130,200,60,$E[0],XE.Setting===$E.Adventure?"#FEC5C5":"White"),DrawButton(735,205,200,60,$E[2],XE.Setting===$E.Historic?"#FEC5C5":"white"),DrawButton(735,280,200,60,$E[4],XE.Setting===$E.Romantic?"#FEC5C5":"white"),DrawButton(735,355,200,60,$E[6],XE.Setting===$E.SciFi?"#FEC5C5":"white"),DrawButton(950,130,200,60,$E[1],XE.Setting===$E.Fantasy?"#FEC5C5":"white"),DrawButton(950,205,200,60,$E[3],XE.Setting===$E.Modern?"#FEC5C5":"white"),DrawButton(950,280,200,60,$E[5],XE.Setting===$E.School?"#FEC5C5":"white");for(const e of WE)DrawButton(120+245*WE.indexOf(e),510,230,54,e,XE.Limits.has(e)?"#FEC5C5":"white");MainCanvas.textAlign="left",DrawText("Blocked items:",910,465,"Black","Gray"),DrawCheckbox(1170,433,60,60,"ABDL",XE.BlockCategories.includes("ABDL")),DrawCheckbox(1400,433,60,60,"Fantasy",XE.BlockCategories.includes("Fantasy")),DrawCheckbox(1660,433,60,60,"SciFi",XE.BlockCategories.includes("SciFi")),MainCanvas.textAlign="center",KE?KE.value=XE.IntroText:(KE=document.createElement("textarea"),KE.id="INTRO_TEXT",KE.name="INTRO_TEXT",KE.value=XE.IntroText,KE.maxLength=990,KE.setAttribute("screen-generated",CurrentScreen),KE.className="HideOnPopup",KE.oninput=()=>{KE&&(XE.IntroText=KE.value)},document.body.appendChild(KE)),KE&&document.activeElement===KE?ElementPositionFix("INTRO_TEXT",36,120,85,1150,795):ElementPositionFix("INTRO_TEXT",28,120,732,1150,150),DrawButton(1450,830,180,64,"OK","white"),DrawButton(1670,830,200,64,"Cancel","white")}();DrawText("Back",169,110,"Black","Gray"),DrawButton(124,147,90,90,"","White","Icons/West.png"),DrawText("Standardize your room description so the room's purpose is clear and it can easily be filtered:",1e3,300,"Black","Gray"),DrawButton(800,360,380,80,"Create a theme room","white"),DrawText("Templates for storing / overwriting current room information & settings (press a name to toggle auto-apply)",1e3,650,"Black","Gray");for(let t=0;t<4;t++){const n=124+455*t,r=null===(e=tA.roomTemplates)||void 0===e?void 0:e[t];let o=r?""===r.Name?"- template without room name -":r.Name:"- empty template slot -";const i=Date.now()%6e3;(null==r?void 0:r.AutoApply)&&i<3e3&&(o="- auto-applied default -"),r&&CE("Backgrounds/"+r.Background+".jpg",n,700,{Alpha:MouseIn(n,700,400,200)?.3:1,Width:400,Height:200}),DrawButton(n,700,340,64,"",r?r.AutoApply?"rgba(136 , 136 , 204, 0.5)":"rgba(255, 255, 255, 0.5)":"#ddd","",r?"Use as room creation dialog default":void 0,!r),DrawTextFit(o,n+170,734,325,"Black","Gray"),DrawButton(n+340,700,60,64,"X",r?"rgba(255, 255, 255, 0.3)":"#ddd","",r?"Delete template":void 0,!r),GE===t?(DrawButton(n,835,150,64,"",r?"rgba(255, 255, 255, 0.2)":"#ddd","",void 0,!r),DrawText("Load",n+51,867,"Black"),DrawButton(n+170,835,230,64,"Overwrite ?","rgba(255, 242, 0, 0.2)","")):(DrawButton(n,835,230,64,"",r?"rgba(255, 255, 255, 0.2)":"#ddd","",void 0,!r),DrawText("Load",n+51,867,"Black"),DrawButton(n+250,835,150,64,"    Save","rgba(255, 255, 255, 0.2)",""))}}function oS(e,t){var n;if(zE)return function(){MouseIn(1480,75,420,245)&&(ElementToggleGeneratedElements("ChatCreate",!1),BackgroundSelectionMake(ChatCreateBackgroundList,ChatCreateBackgroundList.indexOf(UE?ChatCreateBackgroundSelect:ChatAdminBackgroundSelect),(e=>{XE.Background=e}))),Id&&(MouseIn(1480,340,193,50)&&u((async()=>{var e;await navigator.clipboard.writeText((e=XE,JSON.stringify({...e,Limits:Array.from(e.Limits)}))),fE("HardCoreClub: Copied to clipboard!",5e3)}),0),MouseIn(1705,340,193,50)&&u((async()=>{if("function"!=typeof navigator.clipboard.readText)return void fE("HardCoreClub: Please press Ctrl+V",5e3);const e=await navigator.clipboard.readText();console.info(e),JE(e)}),0)),MouseIn(120,130,260,60)&&(XE.Type=OE.Afk),MouseIn(120,205,260,60)&&(XE.Type=OE.Chill),MouseIn(120,280,260,60)&&(XE.Type=OE.Tie),MouseIn(120,355,260,60)&&(XE.Type=OE.Game),MouseIn(395,130,260,60)&&(XE.Type=OE.Rp),MouseIn(395,205,260,60)&&(XE.Type=OE.Kidnap),MouseIn(395,280,260,60)&&(XE.Type=OE.Market),MouseIn(395,355,260,60)&&(XE.Type=OE.Other),MouseIn(735,130,200,60)&&tS($E.Adventure),MouseIn(735,205,200,60)&&tS($E.Historic),MouseIn(735,280,200,60)&&tS($E.Romantic),MouseIn(735,355,200,60)&&tS($E.SciFi),MouseIn(950,130,200,60)&&tS($E.Fantasy),MouseIn(950,205,200,60)&&tS($E.Modern),MouseIn(950,280,200,60)&&tS($E.School);for(const e of WE)MouseIn(120+245*WE.indexOf(e),510,230,54)&&(XE.Limits.has(e)?XE.Limits.delete(e):(XE.Limits.add(e),HE(XE).length+2>YE&&(XE.Limits.delete(e),fE("HardCoreClub: No more space to add this limit.",5e3))));if(MouseIn(1170,433,60,60)&&(XE.BlockCategories.includes("ABDL")?XE.BlockCategories.splice(XE.BlockCategories.indexOf("ABDL"),1):XE.BlockCategories.push("ABDL")),MouseIn(1400,433,60,60)&&(XE.BlockCategories.includes("Fantasy")?XE.BlockCategories.splice(XE.BlockCategories.indexOf("Fantasy"),1):XE.BlockCategories.push("Fantasy")),MouseIn(1660,433,60,60)&&(XE.BlockCategories.includes("SciFi")?XE.BlockCategories.splice(XE.BlockCategories.indexOf("SciFi"),1):XE.BlockCategories.push("SciFi")),MouseIn(1450,830,180,64)){const e=document.getElementById("InputDescription");return UE?(ChatBlockItemCategory=XE.BlockCategories,ChatCreateBackgroundSelect=XE.Background):(ChatAdminBlockCategory=XE.BlockCategories,ChatAdminBackgroundSelect=XE.Background),e&&(e.value=`[${FE[XE.Type]}]`+(XE.Setting?" ["+$E[XE.Setting]+"]":"")+(0===XE.Limits.size?"":" ["+HE(XE)+"]")),VE=XE.IntroText,jE=!jE,void nS()}MouseIn(1670,830,200,64)&&nS()}();if(MouseIn(124,147,90,90))return GE=void 0,jE=!jE,void ElementToggleGeneratedElements(CurrentScreen,!0);if(MouseIn(800,360,380,80))return GE=void 0,zE=!zE,void(UE?(XE.Background=ChatCreateBackgroundSelect,XE.BlockCategories=ChatBlockItemCategory.slice()):(XE.Background=ChatAdminBackgroundSelect,XE.BlockCategories=ChatAdminBlockCategory.slice()));if(tA.roomTemplates)for(let r=0;r<4;r++){const o=124+455*r,i=tA.roomTemplates[r];if(MouseIn(o,700,340,64)&&i){if(i.AutoApply)delete i.AutoApply;else{for(const e of tA.roomTemplates)e&&delete e.AutoApply;i.AutoApply=!0}return sA(),void(GE=void 0)}if(MouseIn(o+340,700,60,64))return tA.roomTemplates[r]=null,sA(),void(GE=void 0);if(GE===r&&MouseIn(o,835,150,64)||MouseIn(o,835,230,64)){if(i){const e=lw("alt_room_admin_limit");if(e.isEnforced&&ServerPlayerIsInChatRoom()&&ChatRoomPlayerIsAdmin()&&Player.IsRestrained())return void e.triggerAttempt();t(i),GE=void 0,jE=!jE,ElementToggleGeneratedElements(CurrentScreen,!0)}return}if(MouseIn(o+250,835,150,64)&&!tA.roomTemplates[r]||GE===r&&MouseIn(o+170,835,230,64))return tA.roomTemplates[r]={Name:ElementValue("InputName")?ElementValue("InputName").trim():"",Description:ElementValue("InputDescription")?ElementValue("InputDescription").trim():"",Background:e?ChatCreateBackgroundSelect:ChatAdminBackgroundSelect,Private:e?ChatCreatePrivate||!1:ChatAdminPrivate,Locked:e?ChatCreateLocked||!1:ChatAdminLocked,Game:e?ChatCreateGame:ChatAdminGame,Admin:ElementValue("InputAdminList")?CommonConvertStringToArray(ElementValue("InputAdminList").trim()):[],Limit:ElementValue("InputSize")?ElementValue("InputSize").trim():"",Language:e?ChatCreateLanguage:ChatAdminLanguage,BlockCategory:kp(e?ChatBlockItemCategory:ChatAdminBlockCategory),AutoApply:null===(n=tA.roomTemplates[r])||void 0===n?void 0:n.AutoApply},sA(),void(GE=void 0);if(MouseIn(o+250,835,150,64))return void(GE=r)}}var iS=Array.prototype.splice;const aS=function(e,t){var n=[];if(!e||!e.length)return n;var r=-1,o=[],i=e.length;for(t=qy(t);++r<i;){var a=e[r];t(a,r,e)&&(n.push(a),o.push(r))}return function(e,t){for(var n=e?t.length:0,r=n-1;n--;){var o=t[n];if(n==r||o!==i){var i=o;sm(o)?iS.call(e,o,1):QA(e,o)}}}(e,o),n},sS="[BCX] Hidden";function lS(e){if(""===e.trim())return yE('Try pressing the "tab"-key to show autocomplete options'),!1;const t=Sk.find((t=>t.toLocaleLowerCase()===e.toLocaleLowerCase()));return t?(RE({Background:t})||yE("Failed to update room. Are you admin?"),!0):(yE("Invalid/unknown background"),!1)}function cS(e){return $w(e,Sk)}let uS=!1,dS=[],hS=[];function mS(){dS=[],hS=[];const e=["A","2","3","4","5","6","7","8","9","10","J","Q","K"];["","","",""].forEach((t=>{e.forEach((e=>{dS.push(e+t)}))})),function(e){for(let t=e.length-1;t>0;t--){const n=Math.floor(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}}(dS),gE(`The dealer took the remaining ${dS.length} cards from the deck and shuffled all cards for a new deck.`)}function pS(e){0===dS.length&&mS();const t=dS.pop();gE(e?`The dealer dealt you this card face down: ${t}`:`The dealer openly drew this card face up: ${t}`,e),hS.push(`${t} ${null===e?"was drawn face up":`was dealt to ${ME(e,"[unknown name]")} (${e})`}`)}function fS(e,t){const n=[];for(let r=0;r<t;r++)n.push(Math.floor(Math.random()*e)+1);yE(`You secretly roll a ${t}D${e}. The result is: ${1===n.length?n:n.join(",")+" = "+n.reduce(((e,t)=>e+t),0).toString()}.`)}function gS(){return BackgroundsTagList}const yS=new Set;var vS,bS=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};class wS{constructor(e,t){vS.set(this,void 0),this.modName=e,this.rule=t.rule,function(e,t,n,r,o){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!o:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");"a"===r?o.call(e,n):o?o.value=n:t.set(e,n)}(this,vS,t,"f")}get ruleDefinition(){return kp(bS(this,vS,"f").ruleDefinition)}get condition(){return kp(bS(this,vS,"f").condition)}get inEffect(){return bS(this,vS,"f").inEffect}get isEnforced(){return bS(this,vS,"f").isEnforced}get isLogged(){return bS(this,vS,"f").isLogged}get customData(){return kp(bS(this,vS,"f").customData)}get internalData(){return kp(bS(this,vS,"f").internalData)}trigger(e=null,t={}){if(null!==e&&"number"!=typeof e||!Ed(t)||!Object.values(t).every((e=>"string"==typeof e)))throw Error("Invalid data");{const n=m("ModApiRuleTrigger",{modArea:this.modName,extraInfo:()=>`mod: ${this.modName}; rule: ${this.rule}`});bS(this,vS,"f").trigger(e,t),n.end()}}triggerAttempt(e=null,t={}){if(null!==e&&"number"!=typeof e||!Ed(t)||!Object.values(t).every((e=>"string"==typeof e)))throw Error("Invalid data");{const n=m("ModApiRuleTriggerAttempt",{modArea:this.modName,extraInfo:()=>`mod: ${this.modName}; rule: ${this.rule}`});bS(this,vS,"f").triggerAttempt(e,t),n.end()}}}vS=new WeakMap;class CS extends $y{constructor(e){super(),this.modName=e,Fy.onAny((e=>{const t=m("ModApiEvent",{modArea:this.modName,extraInfo:()=>`mod: ${this.modName}; event: ${e.event}`});try{this.emit(e.event,e.data)}catch(e){$C("While emitting BCX event",e)}t.end()}))}getRuleState(e){try{const t=lw(e);return Object.freeze(new wS(this.modName,t))}catch(e){return null}}}const _S=Object.freeze(new class{get version(){return ad}get versionParsed(){return kp(Gd)}getCharacterVersion(e){if(void 0!==e&&"number"!=typeof e)return null;const t=void 0===e?VA():XA(e);return t?t.BCXVersion:null}get isAllow(){return lE}AllowCheats(e){return("boolean"==typeof e||void 0===e)&&(lE===e||(void 0===e&&(e=!lE),uE(e)))}get isDevel(){return cE}Devel(e){return("boolean"==typeof e||void 0===e)&&(cE===e||(void 0===e&&(e=!cE),dE(e)))}j_WardrobeExportSelectionClothes(e=!1){return C_(e)}j_WardrobeImportSelectionClothes(e,t,n=!1){return x_(e,t,n)}ToggleInvisibilityEarbuds(){return function(){var e;if("BluetoothEarbuds"===(null===(e=InventoryGet(Player,"ItemEars"))||void 0===e?void 0:e.Asset.Name))InventoryRemove(Player,"ItemEars");else{const e=Asset.find((e=>"BluetoothEarbuds"===e.Name));if(!e)return;Player.Appearance=Player.Appearance.filter((e=>"ItemEars"!==e.Asset.Group.Name)),Player.Appearance.push({Asset:e,Color:"Default",Difficulty:-100,Property:{Type:"Light",Effect:[],Hide:AssetGroup.map((e=>e.Name)).filter((e=>"ItemEars"!==e))}}),CharacterRefresh(Player)}ChatRoomCharacterUpdate(Player)}()}Unload(){return zC()}get storage(){return cE?tA:"Development mode required"}devGetCharacter(e){return!(!cE||void 0!==e&&"number"!=typeof e)&&(void 0===e?VA():XA(e))}devSendQuery(e,t,n){return!(!cE||"number"!=typeof e||"string"!=typeof t||(gA(t,n,e).then((n=>{console.info(`Query ${t} to ${e} resolved:`,n)}),(n=>{console.warn(`Query ${t} to ${e} failed:`,n)})),0))}switchStorageLocation(e){return"number"==typeof e&&(function(e){if(e!==eA.LocalStorage&&e!==eA.OnlineSettings)throw new Error("Unknown storage location");oA!==e&&(console.info(`HardCoreClub: Switching storage location to: ${eA[e]}`),oA=e,Player.OnlineSettings&&(delete Player.OnlineSettings.BCX,Player.OnlineSettings.BCXDataCleared=Date.now()),localStorage.removeItem(iA()),localStorage.removeItem(aA()),ServerAccountUpdate.QueueData({OnlineSettings:Player.OnlineSettings},!0),sA())}(e),!0)}showDebugReport(){RC("BCX Debug Report","This is manually created debug report.\nYou can use the 'Close' button at the bottom to close this overlay.",xC())}debugSetLogServerMessages(e){return"boolean"==typeof e&&(function(e){MC=e}(e),!0)}getModApi(e){if(!Ud().getModsInfo().some((t=>t.name===e))||"bcx"===e.trim().toLowerCase())throw new Error("Only mods registered to ModSDK can request BCX API");return Object.freeze(new CS(e))}inBcxSubscreen(){return null!=Gk()}});DA(new class extends Cd{init(){IA("authority_grant_self",{name:"Allow granting self access",category:md.Authority,defaults:{[hd.dominant]:[!0,xA.self],[hd.switch]:[!0,xA.self],[hd.submissive]:[!1,xA.owner],[hd.slave]:[!1,xA.owner]}}),IA("authority_revoke_self",{name:"Allow forbidding self access",category:md.Authority,defaults:{[hd.dominant]:[!0,xA.self],[hd.switch]:[!0,xA.self],[hd.submissive]:[!0,xA.self],[hd.slave]:[!1,xA.owner]}}),IA("authority_edit_min",{name:"Allow lowest access modification",category:md.Authority,defaults:{[hd.dominant]:[!0,xA.self],[hd.switch]:[!0,xA.self],[hd.submissive]:[!0,xA.self],[hd.slave]:[!1,xA.owner]}}),IA("authority_mistress_add",{name:"Allow granting Mistress status",category:md.Authority,defaults:{[hd.dominant]:[!0,xA.self],[hd.switch]:[!0,xA.self],[hd.submissive]:[!0,xA.lover],[hd.slave]:[!0,xA.mistress]}}),IA("authority_mistress_remove",{name:"Allow revoking Mistress status",category:md.Authority,defaults:{[hd.dominant]:[!0,xA.self],[hd.switch]:[!0,xA.self],[hd.submissive]:[!1,xA.lover],[hd.slave]:[!1,xA.lover]}}),IA("authority_owner_add",{name:"Allow granting Owner status",category:md.Authority,defaults:{[hd.dominant]:[!0,xA.self],[hd.switch]:[!0,xA.self],[hd.submissive]:[!0,xA.clubowner],[hd.slave]:[!0,xA.owner]}}),IA("authority_owner_remove",{name:"Allow revoking Owner status",category:md.Authority,defaults:{[hd.dominant]:[!0,xA.self],[hd.switch]:[!0,xA.self],[hd.submissive]:[!1,xA.clubowner],[hd.slave]:[!1,xA.clubowner]}}),IA("authority_view_roles",{name:"Allow viewing list of owners/mistresses",category:md.Authority,defaults:{[hd.dominant]:[!0,xA.self],[hd.switch]:[!0,xA.mistress],[hd.submissive]:[!0,xA.whitelist],[hd.slave]:[!0,xA.public]}}),uA.permissions=()=>BA(),uA.permissionAccess=(e,t)=>"string"==typeof t?TA(t,e):void 0,uA.myAccessLevel=e=>RA(e),uA.editPermission=(e,t)=>{if(!Ed(t)||"string"!=typeof t.permission||"min"!==t.edit&&"self"!==t.edit||"min"===t.edit&&"number"!=typeof t.target||"self"===t.edit&&"boolean"!=typeof t.target)console.warn(`HardCoreClub: Bad editPermission query from ${e}`,t);else{if(NA.has(t.permission)){if("self"===t.edit){if("boolean"!=typeof t.target)throw new Error("Assertion failed");return OA(t.permission,t.target,e)}if("number"!=typeof t.target)throw new Error("Assertion failed");return void 0===xA[t.target]?(console.warn(`HardCoreClub: editPermission query from ${e}; unknown access level`,t),!1):$A(t.permission,t.target,e)}console.warn(`HardCoreClub: editPermission query from ${e}; unknown permission`,t)}},uA.rolesData=e=>{var t,n;if(e.isPlayer()||TA("authority_view_roles",e)||TA("authority_mistress_add",e)||TA("authority_mistress_remove",e)||TA("authority_owner_add",e)||TA("authority_owner_remove",e)||(null===(t=tA.mistresses)||void 0===t?void 0:t.includes(e.MemberNumber))||(null===(n=tA.owners)||void 0===n?void 0:n.includes(e.MemberNumber)))return GA(e)},uA.editRole=(e,t)=>{if(!(!Ed(t)||"owner"!==t.type&&"mistress"!==t.type||"add"!==t.action&&"remove"!==t.action||"number"!=typeof t.target))return jA(t.type,t.action,t.target,e);console.warn(`HardCoreClub: Bad editRole query from ${e}`,t)},Aw("modules","role","- Manage Owner & Mistress roles",((e,t,n)=>{var r,o;const i=(e[0]||"").toLocaleLowerCase();if("list"===i){if(!(TA("authority_view_roles",t)||TA("authority_mistress_add",t)||TA("authority_mistress_remove",t)||TA("authority_owner_add",t)||TA("authority_owner_remove",t)||(null===(r=tA.mistresses)||void 0===r?void 0:r.includes(t.MemberNumber))||(null===(o=tA.owners)||void 0===o?void 0:o.includes(t.MemberNumber))))return n(yw);const e=GA(t);let i="Visible list:";for(const t of e.owners)i+=`\nOwner ${t[1]||"[unknown name]"} (${t[0]})`;for(const t of e.mistresses)i+=`\nMistress ${t[1]||"[unknown name]"} (${t[0]})`;n(i)}else if("owner"===i||"mistress"===i){const r=(e[1]||"").toLocaleLowerCase();if("add"!==r&&"remove"!==r)return n(`Expected either 'add' or 'remove', got '${r}'`);if(!e[2])return n("Missing required argument: target");const o=Hw(e[2],!0);if("string"==typeof o)return n(o);n(jA(i,r,o,t)?"Ok!":yw)}else n(Ow(t,"!role usage:\n!role list - List all current owners/mistresses\n!role owner <add/remove> <target> - Add or remove target as owner\n!role mistress <add/remove> <target> - Add or remove target as mistress"))}),((e,t)=>{if(e.length<=1){const t=e[0].toLocaleLowerCase();return["list","owner","mistress"].filter((e=>e.startsWith(t)))}const n=e[0].toLocaleLowerCase();if("owner"===n||"mistress"===n){if(2===e.length){const t=e[1].toLocaleLowerCase();return["add","remove"].filter((e=>e.startsWith(t)))}const t=e[1].toLocaleLowerCase();if("add"===t||"remove"===t)return Ww(e[2])}return[]})),Aw("modules","permission","- Manage permissions",((e,t,n)=>{const r=(e[0]||"").toLocaleLowerCase(),o=HA();if("list"===r){const t=new Map;let r=!1;const i=e.slice(1).map((e=>e.toLocaleLowerCase()));for(const[e,n]of Object.entries(o)){if(i.some((t=>!pd[n.category].toLocaleLowerCase().includes(t)&&!n.name.toLocaleLowerCase().includes(t)&&!e.toLocaleLowerCase().includes(t))))continue;let o=t.get(n.category);o||t.set(n.category,o={}),r=!0,o[e]=n}if(!r)return n("No permission matches the filter!");for(const[e,r]of Array.from(t.entries()).sort(((e,t)=>e[0]-t[0]))){let t=`List of ${pd[e]} module permissions:`;for(const[e,n]of Object.entries(r).sort(((e,t)=>e[1].name.localeCompare(t[1].name))))t+=`\n${e}:\n  ${n.name} - ${n.self?"self":"not self"}, ${WA(n.min,VA())}`;n(t),t=""}}else if(void 0!==o[r]){const i=(e[1]||"").toLocaleLowerCase();let a=(e[2]||"").toLocaleLowerCase();if(""===i){const e=o[r];n(`${r}:\n  ${e.name} - ${e.self?"self":"not self"}, ${WA(e.min,VA())}`)}else if("selfaccess"===i)n("yes"===a||"no"===a?OA(r,"yes"===a,t)?"Ok!":yw:"Expected 'selfaccess yes' or 'selfaccess no'");else if("lowestaccess"===i){a===Player.Name.toLocaleLowerCase()&&(a="self");const e=xA[a];n("number"==typeof e?$A(r,e,t)?"Ok!":yw:`Unknown AccessLevel '${a}';\nexpected one of: ${Player.Name}, clubowner, owner, lover, mistress, whitelist, friend, public`)}else n(`Unknown setting '${i}'; expected 'selfaccess' or 'lowestaccess'`)}else n("help"!==r?`Unknown permission '${r}'.\nTo get list of permissions use '${t.isPlayer()?".":"!"}permission list'`:Ow(t,`!permission usage:\n!permission list [filter] - List all permissions and their current settings\n!permission <name> selfaccess <yes|no> - Gives or revokes ${Player.Name}'s access to permission <name>\n!permission <name> lowestaccess <${Player.Name}|clubowner|owner|lover|mistress|whitelist|friend|public> - Sets the lowest permitted role for the permission <name>`))}),((e,t)=>{const n=Object.keys(HA());if(e.length<=1){const t=e[0].toLocaleLowerCase();return["list",...n].filter((e=>e.startsWith(t)))}const r=e[0].toLocaleLowerCase();if(n.includes(r)){const t=e[1].toLocaleLowerCase(),n=(e[2]||"").toLocaleLowerCase();if(2===e.length)return["selfaccess","lowestaccess"].filter((e=>e.startsWith(t)));if(3===e.length){if("selfaccess"===t)return["yes","no"].filter((e=>e.startsWith(n)));if("lowestaccess"===t)return[Player.Name.toLocaleLowerCase(),"self","clubowner","owner","lover","mistress","whitelist","friend","public"].filter((e=>e.startsWith(n)))}}return[]})),ev({category:"authorityPermissions",name:"Authority - Permissions",module:md.Authority,export:()=>BA(),import:(e,t)=>{let n="";for(const[r,o]of Object.entries(e)){const e=r,i=NA.get(e);i?AA(i.category)&&(o[0]||o[1]!==xA.self?!t||t.isPlayer()||PA(i,RA(t))?(t&&!t.isPlayer()&&RA(t)>o[1]&&(n+=`Skipped importing permission '${i.name}' min access: No access to target level\n`),$A(e,o[1],t,!0)||(n+=`Error setting minimal access for '${i.name}'\n`),OA(e,o[0],t,!0)||(n+=`Error setting self access for '${i.name}'\n`)):n+=`Skipped importing permission '${i.name}': No access\n`:n+=`Error importing permission '${i.name}': Inconsistent data\n`):n+=`Skipped unknown permission '${r}'\n`}return n+"Done!"},importPermissions:["authority_grant_self","authority_revoke_self","authority_edit_min"],importValidator:Oy.record(Oy.tuple([Oy.boolean(),Oy.nativeEnum(xA)]))})}setDefultPermissionsForPreset(e){for(const t of NA.values())t.self=t.defaults[e][0],t.min=t.defaults[e][1]}applyPreset(e){this.setDefultPermissionsForPreset(e),tA.permissions=BA()}load(e){var t;if(this.setDefultPermissionsForPreset(e),Ed(tA.permissions)){const e={log_leaveMessage:"log_add_note"};for(const[n,r]of Object.entries(tA.permissions)){void 0!==e[n]&&console.info(`HardCoreClub: Updating permission name "${n}"->"${e[n]}"`);const o=NA.get(null!==(t=e[n])&&void 0!==t?t:n);Array.isArray(r)&&"boolean"==typeof r[0]&&"number"==typeof r[1]?void 0===xA[r[1]]?console.warn(`HardCoreClub: Storage: bad permission ${n} level ${r[1]}`):void 0===o?console.warn(`HardCoreClub: Storage: unknown permission ${n}`):(o.self=r[0],o.min=r[1]):console.warn(`HardCoreClub: Storage: bad permission ${n}`)}}tA.permissions=BA();const n=new Set,r=e=>"number"==typeof e&&e!==Player.MemberNumber&&!n.has(e)&&(n.add(e),!0);Array.isArray(tA.owners)?tA.owners=tA.owners.filter(r):tA.owners=[],Array.isArray(tA.mistresses)?tA.mistresses=tA.mistresses.filter(r):tA.mistresses=[]}reload(e){this.load(e)}}),DA(new class extends Cd{constructor(){super(...arguments),this.timer=null}load(){Zd("CharacterLoadEffect",0,((e,t)=>{t(e);const n=e[0],r="number"==typeof n.MemberNumber&&XA(n.MemberNumber);if(r)for(const e of r.Effects.Effect)n.Effect.includes(e)||n.Effect.push(e)}))}run(){this.timer=c(KA,2e3)}unload(){null!==this.timer&&(clearInterval(this.timer),this.timer=null)}}),DA(new class extends Cd{constructor(){super(...arguments),this.o_ChatRoomSM=null}init(){Kk=new Xk}load(){"boolean"!=typeof tA.typingIndicatorEnable&&(tA.typingIndicatorEnable=!0),"boolean"!=typeof tA.typingIndicatorHideBC&&(tA.typingIndicatorHideBC=!0),"boolean"!=typeof tA.screenIndicatorEnable&&(tA.screenIndicatorEnable=!0),lA.set("hello",((e,t)=>{const n=XA(e);if(!n)return void console.warn("HardCoreClub: Hello from character not found in room",e);if("string"!=typeof(null==t?void 0:t.version)||void 0!==t.supporterStatus&&"string"!=typeof t.supporterStatus||void 0!==t.supporterSecret&&"string"!=typeof t.supporterSecret)return void console.warn("HardCoreClub: Invalid hello",e,t);n.BCXVersion=t.version;const r=Ed(t.effects)?t.effects:{};n.Effects=kp(wd),Array.isArray(r.Effect)&&r.Effect.every((e=>"string"==typeof e))&&(n.Effects.Effect=r.Effect),CharacterRefresh(n.Character,!1),"boolean"==typeof t.typingIndicatorEnable&&(n.typingIndicatorEnable=t.typingIndicatorEnable),"boolean"==typeof t.screenIndicatorEnable&&(n.screenIndicatorEnable=t.screenIndicatorEnable),function(e,t,n){if(e===Player.MemberNumber)return;const r=n_.get(e);r&&r.secret===t&&r.secret===n&&r.verified||(t&&n?(n_.set(e,{verified:void 0===t,status:t,secret:n}),t&&n&&mA("supporterCheck",{memberNumber:e,status:t,secret:n},sd,!0)):n_.delete(e))}(e,t.supporterStatus,t.supporterSecret),!0===t.request&&Jk(!1)})),lA.set("goodbye",(e=>{const t=XA(e);t&&(t.BCXVersion=null,t.Effects=kp(wd),CharacterRefresh(t.Character,!1))})),Zd("ChatRoomMessage",10,((e,t)=>{const n=e[0];return"Action"===(null==n?void 0:n.Type)&&"ServerEnter"===n.Content&&Jk(!1),t(e)})),Zd("ChatRoomCharacterViewDrawOverlay",0,((e,n)=>{var r,o;n(e);const[i,a,s,l]=e,c=XA(i.MemberNumber),u=0===i.ID||(null!==(r=Player.FriendList)&&void 0!==r?r:[]).includes(i.MemberNumber),d=(null!==(o=Player.GhostList)&&void 0!==o?o:[]).includes(i.MemberNumber);!(null==c?void 0:c.BCXVersion)||d||0!==ChatRoomHideIconState||tA.chatroomIconHidden||(u?TE(MainCanvas,t,a+375*l,s+5,30*l,30*l,50,.7,4,"#6e6eff"):TE(MainCanvas,"m7.3532 5.3725 10.98 19.412-10.98 19.803h15.294l2.3528-5.4898c0.78426 1.8299 1.5685 3.6599 2.3528 5.4898h15.294l-10.98-19.803c3.6599-6.4706 7.3197-12.941 10.98-19.412h-15.294l-2.3528 5.4898-2.3528-5.4898z",a+375*l,s+5,30*l,30*l,50,.5,3,"#6e6eff"))})),vE()||Zd("ChatRoomCreateElement",0,((e,t)=>{const n=t(e);return Kk.SetInputElement(document.getElementById("InputChat")),n})),Zd("ChatRoomCharacterViewDrawOverlay",0,((e,t)=>{if(t(e),ChatRoomHideIconState>=2)return;const[n,r,o,i]=e;switch(Kk.GetCharacterStatus(n)){case Yk.Typing:LE(MainCanvas,r+375*i,o+54*i,50*i,48*i,1);break;case Yk.Whisper:LE(MainCanvas,r+375*i,o+54*i,50*i,48*i,.5);break;case Yk.Emote:LE(MainCanvas,r+375*i,o+54*i,50*i,48*i,1,!0);break;case Yk.DMS1:DrawRect(r+380*i,o+53*i,40*i,40*i,"White");break;case Yk.DMS2:DrawRect(r+380*i,o+53*i,40*i,40*i,"White"),CE("Icons/Import.png",r+375*i,o+50*i,{Width:50*i,Height:50*i});break;case Yk.Color:CE("Assets/Female3DCG/Emoticon/Spectator/Icon.png",r+375*i,o+50*i,{Width:50*i,Height:50*i}),CE("Icons/ColorPick.png",r+380*i,o+51*i,{Width:40*i,Height:40*i});break;case Yk.Wardrobe:CE("Assets/Female3DCG/Emoticon/Wardrobe/Icon.png",r+375*i,o+50*i,{Width:50*i,Height:50*i});break;case Yk.Profile:CE("Assets/Female3DCG/Emoticon/Read/Icon.png",r+375*i,o+50*i,{Width:50*i,Height:50*i})}})),window.addEventListener("keydown",zk),window.addEventListener("keyup",Vk),window.addEventListener("blur",Zk),Zd("ChatRoomStatusUpdate",10,((e,t)=>{if("Talk"===e[0]){const t=ElementValue("InputChat");t&&t.startsWith(".")&&!t.startsWith("..")&&(e[0]=null)}return t(e)})),Zd("DrawStatus",10,((e,t)=>{const n=e[0],r=XA(n.MemberNumber);if(!(null!=(null==r?void 0:r.BCXVersion)&&r.typingIndicatorEnable&&tA.typingIndicatorHideBC&&"Talk"===n.Status||null!=(null==r?void 0:r.BCXVersion)&&r.screenIndicatorEnable&&tA.typingIndicatorHideBC&&"Wardrobe"===n.Status))return t(e)})),Zd("ChatRoomSendChat",0,((e,t)=>{t(e),Kk.InputEnd()})),Zd("ChatRoomClearAllElements",0,((e,t)=>{t(e),Kk.SetInputElement(null)})),Zd("CommonSetScreen",0,((e,t)=>{t(e),Kk.UpdateStatus()})),Zd("ItemColorStateBuild",0,((e,t)=>{t(e),Kk.UpdateStatus()})),Zd("ItemColorReset",0,((e,t)=>{t(e),Kk.UpdateStatus()})),Zd("ServerSend",5,((e,t)=>{tA.screenIndicatorEnable&&"ChatRoomCharacterExpressionUpdate"===e[0]&&Ed(e[1])&&"Emoticon"===e[1].Group&&"Wardrobe"===e[1].Name||t(e)})),Zd("ChatSearchLoad",5,((e,t)=>{t(e);const n=document.getElementById("InputSearch");n&&tA.roomSearchAutoFill&&""===ChatSearchMode&&(n.value=tA.roomSearchAutoFill)})),lA.set("ChatRoomStatusEvent",((e,t)=>{for(const n of ChatRoomCharacter)n.MemberNumber===e&&qk.set(n,null==t.Target||t.Target===Player.MemberNumber?t.Type:"None")}))}run(){null!=document.getElementById("InputChat")&&Kk.SetInputElement(document.getElementById("InputChat")),Jk(!0)}unload(){Kk.unload(),this.o_ChatRoomSM&&(window.ChatRoomSM=this.o_ChatRoomSM),hA("goodbye",void 0),window.removeEventListener("keydown",zk),window.removeEventListener("keyup",Vk),window.removeEventListener("blur",Zk)}}),DA(new class extends Cd{load(){for(document.addEventListener("paste",eS),Zd("ChatRoomSyncMemberLeave",5,((e,t)=>{t(e);const n=e[0];qE.has(n.SourceMemberNumber)&&qE.set(n.SourceMemberNumber,Date.now()+6e5)})),Zd("ChatRoomAddCharacterToChatRoom",6,((e,t)=>{const n=ChatRoomCharacter.length;if(t(e),""!==VE&&ChatRoomPlayerIsAdmin()&&n<ChatRoomCharacter.length){const t=e[0];void 0!==t.MemberNumber&&qE.has(t.MemberNumber)&&qE.get(t.MemberNumber)<Date.now()&&qE.delete(t.MemberNumber),u((()=>{!ChatRoomCharacter.includes(t)||void 0===t.MemberNumber||qE.has(t.MemberNumber)&&qE.get(t.MemberNumber)>=Date.now()||(qE.set(t.MemberNumber,0),ServerSend("ChatRoomChat",{Content:`*${VE}`,Type:"Emote",Target:t.MemberNumber}))}),5e3)}})),Zd("ChatRoomSync",4,((e,t)=>{t(e),!ZE&&""!==VE&&ChatRoomPlayerIsAdmin()&&(ZE=!0,yE("Every person newly joining this room will be greeted with the introduction message you set during theme room creation. You and everyone else in the room will not see the greeting. It will also only be sent while you are room admin. Leaving this room will cancel sending it."))})),Zd("ChatRoomClearAllElements",3,((e,t)=>(ZE=!1,VE="",t(e)))),Array.isArray(tA.roomTemplates)||(tA.roomTemplates=[]),tA.roomTemplates.length>4&&(tA.roomTemplates=tA.roomTemplates.filter(Boolean).slice(0,3));tA.roomTemplates.length<4;)tA.roomTemplates.push(null);for(let e=0;e<tA.roomTemplates.length;e++)null===tA.roomTemplates[e]||Ed(tA.roomTemplates[e])||(console.warn(`HardCoreClub: Resetting invalid room template slot ${e}`,tA.roomTemplates[e]),tA.roomTemplates[e]=null);Zd("ChatCreateExit",0,((e,t)=>{t(e),QE()})),Jd("ChatCreateRun",{'DrawText(TextGet("RoomName"), 250, 120,':'DrawText(TextGet("RoomName"), 370, 120,'}),Jd("ChatCreateRun",{'ElementPosition("InputName", 815, 115, 820);':'ElementPosition("InputName", 865, 115, 720);'}),Jd("ChatCreateRun",{'DrawText(TextGet("RoomLanguage"), 250, 205,':'DrawText(TextGet("RoomLanguage"), 390, 205,'}),Jd("ChatCreateRun",{"DrawButton(405, 172,":"DrawButton(505, 172,"}),Jd("ChatCreateRun",{'DrawText(TextGet("RoomSize"), 850, 205,':'DrawText(TextGet("RoomSize"), 950, 205,'}),Jd("ChatCreateRun",{'ElementPosition("InputSize", 1099, 200, 250);':'ElementPosition("InputSize", 1149, 200, 150);'}),Jd("ChatCreateClick",{"if (MouseIn(405, 172,":"if (MouseIn(505, 172,"}),Zd("ChatCreateRun",0,((e,t)=>{if(UE=!0,jE)return rS();t(e),ChatCreateShowBackgroundMode||(DrawText("More",169,110,"Black","Gray"),DrawButton(124,147,90,90,"","White",r),MouseIn(124,147,90,90)&&DrawButtonHover(-36,70,64,64,"More options [BCX]"))})),Zd("ChatAdminExit",0,((e,t)=>{t(e),QE(),ChatBlockItemReturnData={}})),Zd("ChatCreateLoad",0,((e,t)=>{var n;t(e);const r=null===(n=tA.roomTemplates)||void 0===n?void 0:n.find((e=>null==e?void 0:e.AutoApply));if(r&&BackgroundSelectionPreviousScreen!==CurrentScreen&&0===Object.keys(ChatBlockItemReturnData).length){const e=document.getElementById("InputName"),t=document.getElementById("InputDescription"),n=document.getElementById("InputAdminList"),o=document.getElementById("InputSize");e&&(e.value=r.Name),t&&(t.value=r.Description),ChatCreateBackgroundSelect=r.Background,ChatCreatePrivate=r.Private,ChatCreateLocked=r.Locked,ChatCreateGame=r.Game,n&&(n.value=r.Admin.toString()),o&&(o.value=r.Limit),r.Language&&(ChatCreateLanguage=r.Language),ChatBlockItemCategory=r.BlockCategory}BackgroundSelectionPreviousScreen="",ChatBlockItemReturnData={}})),Zd("ChatCreateClick",0,((e,t)=>jE?oS(UE,(e=>{const t=document.getElementById("InputName"),n=document.getElementById("InputDescription"),r=document.getElementById("InputAdminList"),o=document.getElementById("InputSize");t&&(t.value=e.Name),n&&(n.value=e.Description),ChatCreateBackgroundSelect=e.Background,ChatCreatePrivate=e.Private,ChatCreateLocked=e.Locked,ChatCreateGame=e.Game,r&&(r.value=e.Admin.toString()),o&&(o.value=e.Limit),e.Language&&(ChatCreateLanguage=e.Language),ChatBlockItemCategory=e.BlockCategory})):MouseIn(124,147,90,90)?(jE=!jE,void ElementToggleGeneratedElements("ChatCreate",!1)):void t(e))),Jd("ChatAdminRun",{'DrawText(TextGet("RoomName"), 250, 120,':'DrawText(TextGet("RoomName"), 370, 120,'}),Jd("ChatAdminRun",{'ElementPosition("InputName", 815, 115, 820);':'ElementPosition("InputName", 865, 115, 720);'}),Jd("ChatAdminRun",{'DrawText(TextGet("RoomLanguage"), 250, 205,':'DrawText(TextGet("RoomLanguage"), 390, 205,'}),Jd("ChatAdminRun",{"DrawButton(405, 172,":"DrawButton(505, 172,"}),Jd("ChatAdminRun",{'DrawText(TextGet("RoomSize"), 850, 205,':'DrawText(TextGet("RoomSize"), 950, 205,'}),Jd("ChatAdminRun",{'ElementPosition("InputSize", 1099, 200, 250);':'ElementPosition("InputSize", 1149, 200, 150);'}),Jd("ChatAdminClick",{"if (MouseIn(405, 172,":"if (MouseIn(505, 172,"}),Zd("ChatAdminRun",0,((e,t)=>{if(UE=!1,jE)return rS();t(e),DrawText("More",169,110,"Black","Gray"),DrawButton(124,147,90,90,"","White",r),MouseIn(124,147,90,90)&&DrawButtonHover(-36,70,64,64,"More options [BCX]")})),Zd("ChatAdminClick",0,((e,t)=>jE?oS(UE,(e=>{const t=document.getElementById("InputName"),n=document.getElementById("InputDescription"),r=document.getElementById("InputAdminList"),o=document.getElementById("InputSize");t&&(t.value=e.Name),n&&(n.value=e.Description),ChatAdminBackgroundSelect=e.Background,ChatAdminPrivate=e.Private,ChatAdminLocked=e.Locked,ChatAdminGame=e.Game,r&&(r.value=e.Admin.toString()),o&&(o.value=e.Limit),e.Language&&(ChatAdminLanguage=e.Language),ChatAdminBlockCategory=e.BlockCategory})):MouseIn(124,147,90,90)?(jE=!jE,void ElementToggleGeneratedElements("ChatAdmin",!1)):void t(e)))}unload(){document.removeEventListener("paste",eS),KE&&(KE.remove(),KE=void 0)}}),DA(new class extends Cd{init(){IA("misc_cheat_allowactivities",{name:"Allow using the allowactivities command on this player",category:md.Misc,defaults:{[hd.dominant]:[!0,xA.whitelist],[hd.switch]:[!0,xA.friend],[hd.submissive]:[!0,xA.friend],[hd.slave]:[!0,xA.friend]}})}load(){kw("utility","dice","[dice sides | <rolls>d<dice sides>] - Shows only you the result of rolling a dice the given number of times",(e=>{let t=6,n=1;if(e.length<1)fS(6,1);else if(/^[0-9]+$/.test(e[0])){if(t=Number.parseInt(e[0],10),t<2||t>100)return yE("The <dice sides> need to be between 2 and 100"),!1;fS(t,1)}else{if(!/^[0-9]+d[0-9]+$/i.test(e[0]))return yE("Usage: .dice [dice sides | <rolls>d<dice sides>] - for instance '.dice 4d6' - all parameters are optional"),!1;{const r=e[0].split("d");if(t=Number.parseInt(r[1],10),n=Number.parseInt(r[0],10),t<2||t>100)return yE("The <dice sides> in <rolls>d<dice sides> need to be between 2 and 100"),!1;if(n<1||n>100)return yE("The <rolls> in <rolls>d<dice sides> need to be between 1 and 100"),!1;fS(t,n)}}return!0})),kw("utility","deck","- Draw, deal or shuffle with a 52-card deck. Use '.deck' for more help",(e=>{const t=(e[0]||"").toLowerCase();if("shuffle"===t)mS();else if("showlog"===t)!function(){const e=Math.ceil(hS.length/2),t=hS.slice().splice(0,e),n=hS.slice().splice(-e);t.forEach((e=>gE(e))),n.forEach((e=>{u((()=>{gE(e)}),1100)}))}();else if("draw"===t||"deal"===t){let n,r=1;if(e.length>=2){if(!/^[0-9]+$/.test(e[1]))return yE("draw"===t?"Usage: .deck draw <number of cards>":"Usage: .deck deal <number of cards> <...targets>"),!1;if(r=Number.parseInt(e[1],10),r>26||r<1)return yE(`You can ${t} at most 26 cards (half the deck) in one go`),!1}if(e.length>2&&"draw"===t)return yE('Cards are "drawn" openly. Did you mean to deal instead?'),!1;if(e.length<=2&&"deal"===t)return yE('Cards are "dealt" to someone. Did you mean to draw instead?'),!1;if(e.length>2){n=[];for(const t of e.slice(2)){const e=Fw(t);if("string"==typeof e)return yE(e),!1;n.push(e.MemberNumber)}}!function(e,t){for(const n of null!=t?t:[null])for(let t=0;t<e;t++)pS(n)}(r,n)}else yE("Usage:\n.deck shuffle - Shuffles all remaining and drawn cards into a new deck\n.deck draw <number of cards> - Draws the < number of cards > from the card deck and reveals them to all players\n.deck deal <number of cards> <...targets> - Deals the < number of cards > to each of the specified player names or member numbers in a hidden way\n.deck showlog - Lists who got each card drawn from the current deck openly in the chat (if proof is needed)\nThe deck is a standard 52-card deck. If the deck is empty, it shuffles automatically.");return!0}),(e=>{const t=e[0].toLowerCase();return e.length<=1?$w(t,["shuffle","draw","deal","showlog"]):"deal"===t&&e.length>=3?Ww(e[e.length-1]):[]})),kw("utility","room","- Change or administrate the current chat room. Use '.room' for more help",(e=>{var t;const n=(e[0]||"").toLowerCase();if(!ChatRoomData)return!1;if(!ChatRoomPlayerIsAdmin())return yE("You need to be admin in this room to use a .room command"),!1;if("locked"===n||"private"===n){if(1===e.length||"yes"!==e[1]&&"no"!==e[1])return yE("Add 'yes' or 'no' behind '.room locked' or '.room private'"),!1;RE("locked"===n?{Locked:"yes"===e[1]}:{Private:"yes"===e[1]})}else if("size"===n||"limit"===n||"slots"===n){const t=2===e.length&&/^[0-9]+$/.test(e[1])&&Number.parseInt(e[1],10);if(!t||t<2||t>10)return yE("Needs a number between 2 and 10 as <number> in '.room size <number>'"),!1;RE({Limit:t})}else{if("background"===n)return 2!==e.length?(yE(`Needs the name of a background (for example: 'MainHall') behind '.room ${n}'`),!1):lS(e[1]);if("promoteall"===n)for(const e of zA())e.isPlayer()||(null===(t=null===ChatRoomData||void 0===ChatRoomData?void 0:ChatRoomData.Admin)||void 0===t?void 0:t.includes(e.MemberNumber))||ServerSend("ChatRoomAdmin",{MemberNumber:e.MemberNumber,Action:"Promote"});else if("promote"===n||"demote"===n||"kick"===n||"ban"===n||"permaban"===n){if(1===e.length)return yE(`Needs at least one character name oder member number as <target> in '.room ${n} <target1> <target2> <targetN>'`),!1;const t=[];for(const n of e.slice(1)){const e=Fw(n);if("string"==typeof e)return yE(e),!1;t.push(e.MemberNumber)}if("promote"===n)RE({Admin:xd(ChatRoomData.Admin.concat(t))});else if("demote"===n){const e=new Set(t);RE({Admin:ChatRoomData.Admin.filter((t=>!e.has(t)))})}else if("kick"===n)for(const e of t)ServerSend("ChatRoomAdmin",{MemberNumber:e,Action:"Kick",Publish:!1});else if("ban"===n)for(const e of t)ServerSend("ChatRoomAdmin",{MemberNumber:e,Action:"Ban",Publish:!1});else if("permaban"===n)for(const e of t)ServerSend("ChatRoomAdmin",{MemberNumber:e,Action:"Ban",Publish:!1}),ChatRoomListUpdate(Player.BlackList,!0,e)}else if("template"===n){const t=2===e.length&&/^[0-9]+$/.test(e[1])&&Number.parseInt(e[1],10);if(!t||t<1||t>4)return yE("Needs a template slot number between 1 and 4 behind '.room template'"),!1;const n=tA&&tA.roomTemplates&&tA.roomTemplates[t-1];if(!n)return yE(`Unable to find a valid room template in slot ${t}. You likely need to set one in the chat room creation screen.`),!1;const r=Number.parseInt(n.Limit,10);RE({Name:n.Name,Description:n.Description,Background:n.Background,Private:n.Private,Locked:n.Locked,Game:n.Game,Admin:n.Admin,Limit:r,BlockCategory:n.BlockCategory})}else yE("Usage:\n.room locked <yes/no> - Locks or unlocks the room\n.room private <yes/no> - Sets the room to be private or public\n.room size <number> - Sets the number of open character slots in the room\n.room background <name> - Changes room background (same as .background)\n.room kick <...targets> - Kicks all space-seperated player names or member numbers\n.room ban <...targets> - Bans all space-seperated player names or member numbers\n.room permaban <...targets> - Bans and blacklists all specified player names or numbers\n.room <promote/demote> <...targets> - Adds or removes admin on all specified player names or numbers\n.room promoteall - Gives admin to all non-admin players in the room\n.room template <1/2/3/4> - Changes the room according to the given BCX room template slot")}return!0}),(e=>{const t=e[0].toLowerCase();return e.length<=1?$w(t,["locked","private","size","background","promoteall","promote","demote","kick","ban","permaban","template"]):("locked"===t||"private"===t)&&e.length>=2?$w(e[1],["yes","no"]):("promote"===t||"demote"===t||"kick"===t||"ban"===t||"permaban"===t)&&e.length>=2?Ww(e[e.length-1]):"background"===t&&2===e.length?cS(e[1]):[]})),Cw("cheats","antiblind","- Toggles ability to always see despite items",(()=>!!function(){if(!uS){const e=lw("block_antiblind");if(e.isEnforced)return e.triggerAttempt(),!1;e.inEffect&&e.trigger()}return uS=!uS,!0}()&&(yE("Antiblind switched "+(uS?"on":"off")),!0))),Zd("Player.GetBlindLevel",9,((e,t)=>uS?0:t(e))),Zd("Player.GetBlurLevel",9,((e,t)=>uS?0:t(e))),Zd("Player.HasTints",9,((e,t)=>!uS&&t(e))),Cw("utility","background","<name> - Changes chat room background",lS,cS);const e=new Set;for(const t of BackgroundsList)t.Tag.forEach((t=>e.add(t)));for(const t of e)gS().includes(t)||gS().push(t);gS().includes(sS)||gS().push(sS);for(const e of Sk)BackgroundsList.some((t=>t.Name===e))||(BackgroundsList.push({Name:e,Tag:[sS]}),Xb(e,`[Hidden] ${e}`));Zd("BackgroundSelectionRun",0,((e,t)=>{BackgroundSelectionOffset>=BackgroundSelectionView.length&&(BackgroundSelectionOffset=0),t(e)})),kw("utility","colour","<source> <item> <target> - Copies color of certain item from source character to target character",(e=>{if(3!==e.length)return yE("Expected three arguments: <source> <item> <target>"),!1;const t=Fw(e[0]);if("string"==typeof t)return yE(t),!1;const n=Fw(e[2]);if("string"==typeof n)return yE(n),!1;const r=Gw(t,e[1]);if("string"==typeof r)return yE(r),!1;const o=n.Character.Appearance.find((e=>e.Asset===r.Asset));return o?(o.Color=Array.isArray(r.Color)?r.Color.slice():r.Color,CharacterRefresh(n.Character),ChatRoomCharacterUpdate(n.Character),!0):(yE("Target must be wearing the same item"),!1)}),(e=>{if(1===e.length)return Ww(e[0]);if(2===e.length){const t=Fw(e[0]);if("string"!=typeof t)return jw(t,e[1])}else if(3===e.length)return Ww(e[2]);return[]})),kw("cheats","allowactivities","<character> - Allows you to use all activities on target",(e=>{if(1!==e.length)return yE("Expected one argument: <character>"),!1;const t=Fw(e[0]);return"string"==typeof t?(yE(t),!1):(yS.has(t.MemberNumber)?(yS.delete(t.MemberNumber),yE(`You can no longer use all activities on ${t.toNicknamedString()}`)):t.BCXVersion?t.getPermissionAccess("misc_cheat_allowactivities").then((e=>{e?(yS.add(t.MemberNumber),yE(`You can now use any activities on ${t.toNicknamedString()}, independent of items or clothes she is wearing`)):yE(`You are missing the permission 'Allow using the allowactivities command on this player' for ${t.toNicknamedString()}.`)}),(e=>{console.warn("Error getting permission for allowactivities",e),yE(`Error getting permission to use all activities on ${t.toNicknamedString()}:\n${e}`)})):yE("This cheat can only be used on characters that are using BCX too."),!0)}),(e=>1===e.length?Ww(e[0]):[])),Zd("ActivityCheckPrerequisite",6,((e,t)=>{const n=e[0],r=e[2];return!(n.startsWith("Has")||n.startsWith("TargetHas")||null==r.MemberNumber||!yS.has(r.MemberNumber))||t(e)}),null),Cw("utility","garble","<level> <message> - Converts the given message to gag talk",(e=>{const t=document.getElementById("InputChat");if(!t)return!1;const n=/^\s*([0-9]+) (.+)$/.exec(e);if(!n)return yE("Expected two arguments: <level> <message>"),!1;const r=eh("SpeechGarbleByGagLevel",[Number.parseInt(n[1],10),n[2].trim()]);return t.value=r,!1}))}run(){null!=ChatCreateBackgroundList&&(ChatCreateBackgroundList=BackgroundsGenerateList(BackgroundSelectionTagList))}unload(){aS(gS(),(e=>e===sS)),aS(BackgroundsList,(e=>e.Tag.includes(sS))),null!=ChatCreateBackgroundList&&(ChatCreateBackgroundList=BackgroundsGenerateList(BackgroundSelectionTagList))}}),DA(new class extends Cd{load(){Zd("ChatRoomFirstTimeHelp",0,((e,t)=>{t(e),!ww&&tA.chatShouldDisplayFirstTimeHelp&&(ww=yE("[ Hard Core Club commands tutorial ]\nHard Core Club also provides helpful chat commands.\nAll commands start with a dot ( . )\nThe commands also support auto-completion: While writing a command, press 'Tab' to try automatically completing the currently typed word.\nOther club members can also use commands of your Hard Core Club, without needing Hard Core Club themselves. They will get a list of all commands they have permission using by whispering '!help' ( ! instead of . ) to you.\nNote: Messages colored like this text can only be seen by you and no one else.\n\nTo complete this tutorial, use '.help' command by writing '.he' and pressing 'Tab' to complete it to '.help', it will show you list of available Hard Core Club commands."))})),Zd("ChatRoomClearAllElements",1,((e,t)=>(ww=null,t(e)))),Zd("ChatRoomSendChat",10,((e,t)=>{const n=document.getElementById("InputChat");let r=null;if(n&&!rA){const e=n.value.trim();if(/^[.\s]*$/.test(e));else if(e.startsWith(".."))n.value=r=e.substring(1);else if(e.startsWith("."))return void(function(e){Pw();const[t,n]=Ew(e),r=vw.get(t);return r?r.parse?r.callback(Sw(n)):r.callback(n):(yE(`Unknown command "${t}"\nTo see list of valid commands use '.help'`,15e3),!1)}(e.substring(1))&&(ChatRoomLastMessage.push(e),ChatRoomLastMessageIndex=ChatRoomLastMessage.length,n.value=""));Pw()}const o=t(e);return ChatRoomLastMessage.length>0&&ChatRoomLastMessage[ChatRoomLastMessage.length-1]===r&&(ChatRoomLastMessage[ChatRoomLastMessage.length-1]="."+ChatRoomLastMessage[ChatRoomLastMessage.length-1]),o})),Zd("ChatRoomKeyDown",10,((e,t)=>{var n,r;const o=e[0],i=document.getElementById("InputChat");if("Tab"===o.key&&i&&i.value.startsWith(".")&&!i.value.startsWith("..")&&!rA){const t=null!==(n=e[0])&&void 0!==n?n:o;return null==t||t.preventDefault(),null==t||t.stopImmediatePropagation(),i.value="."+function(e){if(Iw===e&&null===Rw&&Tw<Lw.length){Bw("autocomplete hint",Lw.map((e=>e[1])),Tw);const e=Lw[Tw][0].trim();return Tw=(Tw+1)%Lw.length,Iw=e,e}if(Pw(),Lw=function(e){e=e.trimStart();const[t,n]=Ew(e);if(e.length===t.length){const e=Array.from(vw.entries()).filter((e=>null!==e[1].description&&e[0].startsWith(t))).map((e=>e[0]+" "));return e.map((e=>[e,e]))}const r=vw.get(t);if(r&&r.autocomplete){if(r.parse){const e=Sw(n);Dw(n)&&e.push("");let o=r.autocomplete(e);const i=1===o.length;0===o.length&&(o=[e[e.length-1]]),e.pop();const a=o.some(Mw);return o.map((n=>[`${t} `+e.map((e=>xw(e))).concat(a?xw(n,!0):n).join(" ")+(i?" ":""),n]))}{const e=r.autocomplete(n);return 0===e.length?[]:e.map((e=>[`${t} ${e}`,e]))}}return[]}(e).sort(((e,t)=>e[1].localeCompare(t[1]))),0===Lw.length)return e;if(1===Lw.length)return Lw[0][0];const t=Md(Lw.map((e=>e[0])));return Bw("autocomplete hint",Lw.map((e=>e[1]))),Iw=t,Rw=null,Tw=0,t}(i.value.substring(1)),!0}if("Tab"===o.key&&ChatRoomTargetMemberNumber>=0&&i&&i.value.startsWith("!")&&!i.value.startsWith("!!")&&!rA){const t=null!==(r=e[0])&&void 0!==r?r:o;return null==t||t.preventDefault(),null==t||t.stopImmediatePropagation(),async function(e){const t=e.value,n=ChatRoomTargetMemberNumber;if(null==n)return;if(Iw===t&&Rw===n&&Tw<Lw.length){Bw("remote autocomplete hint",Lw.map((e=>e[1])),Tw);const t=Lw[Tw][0].trim();return Tw=(Tw+1)%Lw.length,Iw=t,Rw=n,void(e.value=t)}Pw();const r=await gA("commandHint",t,n);if(e.value!==t||ChatRoomTargetMemberNumber!==n)return;if(!Array.isArray(r)||!r.every((e=>Array.isArray(e)&&2===e.length&&"string"==typeof e[0]&&"string"==typeof e[1])))return;if(Lw=r.sort(((e,t)=>e[1].localeCompare(t[1]))),0===Lw.length)return;if(1===Lw.length)return void(e.value=Lw[0][0]);const o=Md(Lw.map((e=>e[0])));Bw("remote autocomplete hint",Lw.map((e=>e[1]))),Iw=o,Rw=n,Tw=0,e.value=o}(i).catch((()=>{})),!0}return t(e)})),Zd("ChatRoomMessage",9,((e,t)=>{const n=e[0],r="number"==typeof n.Sender&&XA(n.Sender);if("Whisper"===(null==n?void 0:n.Type)&&"string"==typeof n.Content&&!rA&&r&&!r.isPlayer()&&r.hasAccessToPlayer()){const e=Array.isArray(n.Dictionary)&&n.Dictionary.find((e=>Ed(e)&&"BCX_ORIGINAL_MESSAGE"===e.Tag&&"string"==typeof e.Text)),t=e&&e.Text||n.Content;if(n.Content.startsWith("!")&&!n.Content.startsWith("!!"))return console.debug(`HardCoreClub: Console command from ${r}: ${t}`,n),void function(e,t,n){const[r,o]=Ew(e),i=bw.get(r);if(i)return i.callback(Sw(o),t,n);n(`Unknown command "${r}"\nTo see list of valid commands whisper '!help'`)}(t.substring(1),r,(e=>{ServerSend("ChatRoomChat",{Content:`[HardCoreClub]\n${e}`,Type:"Whisper",Target:r.MemberNumber})}))}return t(e)})),Zd("PropertyAutoPunishParseMessage",6,((e,t)=>{const n=e[1];return!("string"==typeof n&&n.startsWith(".")&&!n.startsWith(".."))&&t(e)})),uA.commandHint=(e,t)=>{if("string"==typeof t&&t.startsWith("!")&&!t.startsWith("!!"))return function(e,t){e=e.trimStart();const[n,r]=Ew(e);if(e.length===n.length){const e=Array.from(bw.entries()).filter((e=>null!==e[1].description&&e[0].startsWith(n))).map((e=>e[0]+" "));return e.map((e=>[e,e]))}const o=bw.get(n);if(o&&o.autocomplete){const e=Sw(r);Dw(r)&&e.push("");let i=o.autocomplete(e,t);const a=1===i.length;0===i.length&&(i=[e[e.length-1]]),e.pop();const s=i.some(Mw);return i.map((t=>[`${n} `+e.map((e=>xw(e))).concat(s?xw(t,!0):t).join(" ")+(a?" ":""),t]))}return[]}(t.substring(1),e).map((e=>["!"+e[0],e[1]]))},Cw("hidden","help","- Display this help [alias: . ]",(e=>{if(void 0!==tA.chatShouldDisplayFirstTimeHelp&&(delete tA.chatShouldDisplayFirstTimeHelp,sA()),ww&&(ww.remove(),ww=null),e=e.trim().toLocaleLowerCase()){const t=gw.find((t=>t.toLocaleLowerCase()===e));yE(t?`Available commands in category ${t}:\n`+Array.from(vw.entries()).filter((e=>null!==e[1].description&&e[1].category===t)).map((e=>`.${e[0]}`+(e[1].description?` ${e[1].description}`:""))).sort().join("\n"):`Unknown category '${e}'\nList of available categories:\n`+gw.join("\n"))}else yE("HardCoreClub commands are organized into categories\nTo view help texts for all commands in a category, use '.help <category>' (e.g. '.help utility')\n\nList of categories:\n"+gw.join("\n"));return!0}),(e=>$w(e.trim(),gw))),_w("help","?"),Cw("utility","action","- Send custom (action) [alias: .a ]",(e=>{const t=lw("block_action");return t.isEnforced?(t.triggerAttempt(),!1):(t.inEffect&&t.trigger(),gE(e),!0)})),_w("action","a"),Aw("hidden","help","- Display this help",((e,t,n)=>{const r=Array.from(bw.entries()).filter((e=>null!==e[1].description)).map((e=>`!${e[0]}`+(e[1].description?` ${e[1].description}`:""))).sort();let o="Available commands:";for(;r.length>0;){const e=o+"\n"+r[0];e.length>990?(n(o),o=r[0]):o=e,r.shift()}return n(o),!0}),null,!1),Cw("utility","versions","- Check current version of HardCoreClub",(e=>(gE("1.0.2-STRICT-6585254c"),!0))),_w("action","a")}unload(){vw.clear()}}),DA(new class extends Cd{constructor(){super(...arguments),this.resetTimer=null,this.triggerCounts=new Map,this.suspendedUntil=null}init(){IA("commands_normal",{name:"Allows controlling non-limited commands",category:md.Commands,defaults:{[hd.dominant]:[!0,xA.lover],[hd.switch]:[!0,xA.lover],[hd.submissive]:[!1,xA.mistress],[hd.slave]:[!1,xA.mistress]}}),IA("commands_limited",{name:"Allows controlling limited commands",category:md.Commands,defaults:{[hd.dominant]:[!0,xA.owner],[hd.switch]:[!0,xA.owner],[hd.submissive]:[!1,xA.lover],[hd.slave]:[!1,xA.lover]}}),IA("commands_change_limits",{name:"Allows to limit/block specific commands",category:md.Commands,defaults:{[hd.dominant]:[!0,xA.self],[hd.switch]:[!0,xA.self],[hd.submissive]:[!0,xA.self],[hd.slave]:[!1,xA.owner]}}),uA.commandTrigger=(e,t)=>{if(!Array.isArray(t)||!t.every((e=>"string"==typeof e))||t.length<1)return;const n=t.shift();return Mk(n)?function(e,t,n,r){if(!AA(md.Commands))return!1;if(n&&!sC("commands",e,n))return!1;const o=xk.get(e);if(!o)throw new Error(`Attempt to trigger unknown command '${e}'`);return o.trigger(t,n,(()=>{}),o.state)}(n,t,e):void 0},Aw("modules","commands","- Manage the commands module",((e,t,n)=>{if(!AA(md.Commands))return n("Commands module is disabled.");const r=(e[0]||"").toLocaleLowerCase();if("setlimit"===r)return vC("commands",e,t,n);if("listall"===r){let e="List of commands:";for(const[t]of Tk()){const r=`\n${t}`;e.length+r.length>=990&&(e+="\n...",n(e),e="List of commands (continued):"),e+=r}n(e)}else if("description"===r){const t=Lk(e[1]||"");if(!t[0])return n(t[1]);const r=Rk(t[1]);n(Pd(r.longDescription,{PLAYER_NAME:Player.Name,HELP_DESCRIPTION:r.helpDescription}))}else n(Ow(t,"!commands usage:\n!commands listall - List all commands\n!commands description <command> - Show the command's description\n!commands setlimit <command> <normal/limited/blocked> - Set a limit on certain <command>\n\nNote: The commands can also be listed with '.help commands'. To use them on other BCX users, whisper the command with a leading '!' instead of '.'"))}),((e,t)=>AA(md.Commands)?e.length<=1?$w(e[0],["listall","description","setlimit"]):"setlimit"===e[0].toLocaleLowerCase()?bC("commands",e):[]:[])),Kw("commands",{category:md.Commands,permission_normal:"commands_normal",permission_limited:"commands_limited",permission_changeLimits:"commands_change_limits",loadValidateConditionKey:e=>Mk(e),loadValidateCondition:e=>(console.error(`HardCoreClub: Removing unexpected command condition ${e}`),!1),loadCategorySpecificGlobalData:()=>{},stateChangeHandler:()=>{},tickHandler:this.commandTick.bind(this),makePublicData:()=>{},validateCategorySpecificGlobalData:()=>!0,validatePublicData:()=>!0,updateCondition:()=>!1,parseConditionName:(e,t)=>Lk(e,t?e=>t.includes(e):void 0),autocompleteConditionName:(e,t)=>function(e,t){e=e.toLocaleLowerCase();let n=Array.from(xk.entries()).filter((n=>n[1].name.toLocaleLowerCase().startsWith(e)&&(!t||t(n[0])))).map((e=>e[1].name));return 0===n.length&&(n=Array.from(xk.entries()).filter((n=>n[0].toLocaleLowerCase().startsWith(e)&&(!t||t(n[0])))).map((e=>e[0]))),n}(e,t?e=>t.includes(e):void 0),logLimitChange:(e,t,n)=>{const r=Rk(e);lv("command_change",av.plaintext,`${t} changed ${Player.Name}'s '${r.name}' command permission to ${bd[n]}`),t.isPlayer()||yE(`${t.toNicknamedString()} changed '${r.name}' command permission to ${bd[n]}`,void 0,t.MemberNumber)},logConditionUpdate:()=>{},logCategoryUpdate:()=>{},getDefaultLimits:()=>{const e={};for(const[t,n]of xk.entries())e[t]=n.defaultLimit;return e},commandConditionSelectorHelp:"command"}),function(){const e={open:null,close:"Closed",up:"Lewd",down:"Shy"},t={open:"SENDER_NAME (SENDER_NUMBER) made you open your eyes",close:"SENDER_NAME (SENDER_NUMBER) made you close your eyes",up:"SENDER_NAME (SENDER_NUMBER) made you look up",down:"SENDER_NAME (SENDER_NUMBER) made you look down"};Ik("eyes",{name:"Eyes",helpDescription:`<${Object.keys(e).join(" | ")}>`,shortDescription:"Control PLAYER_NAME's eyes",longDescription:"This command forces PLAYER_NAME's eyes into the specified state, but they can still manually change it.\nUsage:\n!eyes HELP_DESCRIPTION",defaultLimit:bd.normal,playerUsable:!0,trigger:(n,r,o,i)=>{if(1!==n.length)return o(Ow(r,`!eyes usage:\n!eyes ${i.commandDefinition.helpDescription}`)),!1;const a=e[n[0].toLowerCase()];if(void 0===a)return o(`Bad value: ${n[0].toLowerCase()} is not one of '${Object.keys(e).join("', '")}'`),!1;if(CharacterSetFacialExpression(Player,"Eyes",a),!r.isPlayer()){const e=t[n[0].toLowerCase()];e&&yE(Pd(e,{SENDER_NAME:r.Nickname,SENDER_NUMBER:`${r.MemberNumber}`}),void 0,r.MemberNumber)}return!0},autoCompleter:t=>1===t.length?$w(t[0],Object.keys(e)):[]});const n={close:null,open:"HalfOpen",openwide:"Moan",tongue:"Ahegao",smile:"Smirk"},r={close:"SENDER_NAME (SENDER_NUMBER) made you close your mouth",open:"SENDER_NAME (SENDER_NUMBER) made you open your mouth",openwide:"SENDER_NAME (SENDER_NUMBER) made you open your mouth wide",tongue:"SENDER_NAME (SENDER_NUMBER) made you stick out your tongue",smile:"SENDER_NAME (SENDER_NUMBER) made you smile"};Ik("mouth",{name:"Mouth",helpDescription:`<${Object.keys(n).join(" | ")}>`,shortDescription:"Control PLAYER_NAME's mouth",longDescription:"This command forces PLAYER_NAME's mouth into the specified state, but they can still manually change it.\nUsage:\n!mouth HELP_DESCRIPTION",defaultLimit:bd.normal,playerUsable:!0,trigger:(e,t,o,i)=>{if(1!==e.length)return o(Ow(t,`!mouth usage:\n!mouth ${i.commandDefinition.helpDescription}`)),!1;const a=n[e[0].toLowerCase()];if(void 0===a)return o(`Bad value: ${e[0].toLowerCase()} is not one of '${Object.keys(n).join("', '")}'`),!1;if(CharacterSetFacialExpression(Player,"Mouth",a),!t.isPlayer()){const n=r[e[0].toLowerCase()];n&&yE(Pd(n,{SENDER_NAME:t.Nickname,SENDER_NUMBER:`${t.MemberNumber}`}),void 0,t.MemberNumber)}return!0},autoCompleter:e=>1===e.length?$w(e[0],Object.keys(n)):[]});const o={down:"BaseUpper",spread:"Yoked",up:"OverTheHead",back:"BackBoxTie",elbows:"BackElbowTouch",wrists:"BackCuffs"},i={normal:"BaseLower",kneel:"Kneel",kneelspread:"KneelingSpread",close:"LegsClosed"},a={down:"SENDER_NAME (SENDER_NUMBER) made you relax your arms",spread:"SENDER_NAME (SENDER_NUMBER) made you spread your hands",up:"SENDER_NAME (SENDER_NUMBER) made you raise your hands",back:"SENDER_NAME (SENDER_NUMBER) made you put your hands behind your back",elbows:"SENDER_NAME (SENDER_NUMBER) made you put your elbows together behind your back",wrists:"SENDER_NAME (SENDER_NUMBER) made you put your wrists together behind your back"},s={normal:"SENDER_NAME (SENDER_NUMBER) made you put your legs into a relaxed standing stance",kneel:"SENDER_NAME (SENDER_NUMBER) made you kneel with closed legs",kneelspread:"SENDER_NAME (SENDER_NUMBER) made you kneel with spread legs",close:"SENDER_NAME (SENDER_NUMBER) made you close your legs while standing"};Ik("arms",{name:"Arms",helpDescription:`<${Object.keys(o).join(" | ")}>`,shortDescription:"Control PLAYER_NAME's arm poses",longDescription:"This command forces PLAYER_NAME's arms into the specified pose, but they can still manually change it. Some may be unavailable, due to restricting items, etc.\nUsage:\n!arms HELP_DESCRIPTION",defaultLimit:bd.normal,playerUsable:!0,trigger:(e,t,n,r)=>{var i;if(1!==e.length)return n(Ow(t,`!arms usage:\n!arms ${r.commandDefinition.helpDescription}`)),!1;const s=o[e[0].toLowerCase()];if(void 0===s)return n(`Bad value: ${e[0].toLowerCase()} is not one of '${Object.keys(o).join("', '")}'`),!1;if(Array.isArray(Player.ActivePose)&&Player.ActivePose.includes(s))return n("This character is already in the chosen pose."),!1;const l=lw("block_restrict_allowed_poses");if(t.isPlayer()&&l.isEnforced&&(null===(i=l.customData)||void 0===i?void 0:i.poseButtons.includes(s)))return n(`You cannot change into this pose as the rule '${l.ruleDefinition.name}' forbids it.`),!1;if(PoseSetActive(Player,s),ServerSend("ChatRoomCharacterPoseUpdate",{Pose:Player.ActivePose}),!t.isPlayer()){const n=a[e[0].toLowerCase()];n&&yE(Pd(n,{SENDER_NAME:t.Nickname,SENDER_NUMBER:`${t.MemberNumber}`}),void 0,t.MemberNumber)}return!0},autoCompleter:e=>1===e.length?$w(e[0],Object.keys(o)):[]}),Ik("legs",{name:"Legs",helpDescription:`<${Object.keys(i).join(" | ")}>`,shortDescription:"Control PLAYER_NAME's leg poses",longDescription:"This command forces PLAYER_NAME's legs into the specified pose, but they can still manually change it. Some may be unavailable, due to restricting items, etc.\nUsage:\n!legs HELP_DESCRIPTION",defaultLimit:bd.normal,playerUsable:!0,trigger:(e,t,n,r)=>{var o;if(1!==e.length)return n(Ow(t,`!legs usage:\n!legs ${r.commandDefinition.helpDescription}`)),!1;const a=i[e[0].toLowerCase()];if(void 0===a)return n(`Bad value: ${e[0].toLowerCase()} is not one of '${Object.keys(i).join("', '")}'`),!1;if(Array.isArray(Player.ActivePose)&&Player.ActivePose.includes(a))return n("This character is already in the chosen pose."),!1;const l=lw("block_restrict_allowed_poses");if(t.isPlayer()&&l.isEnforced&&(null===(o=l.customData)||void 0===o?void 0:o.poseButtons.includes(a)))return n(`You cannot change into this pose as the rule '${l.ruleDefinition.name}' forbids it.`),!1;if(PoseSetActive(Player,a),ServerSend("ChatRoomCharacterPoseUpdate",{Pose:Player.ActivePose}),!t.isPlayer()){const n=s[e[0].toLowerCase()];n&&yE(Pd(n,{SENDER_NAME:t.Nickname,SENDER_NUMBER:`${t.MemberNumber}`}),void 0,t.MemberNumber)}return!0},autoCompleter:e=>1===e.length?$w(e[0],Object.keys(i)):[]}),Ik("allfours",{name:"Allfours",helpDescription:"",shortDescription:"Make PLAYER_NAME get on all fours",longDescription:"This command forces PLAYER_NAME's to get on all fours, but they can still manually change their pose. This pose requires specific items to work.\nUsage:\n!allfours",defaultLimit:bd.normal,playerUsable:!0,trigger:(e,t,n,r)=>{var o;if(0!==e.length)return n(Ow(t,"!allfours expects no arguments.")),!1;const i="AllFours";if(Array.isArray(Player.ActivePose)&&Player.ActivePose.includes(i))return n("This character is already in the chosen pose."),!1;if(!Player.AllowedActivePose.includes(i))return n("You cannot change into this pose as this pose requires items that support it to work."),!1;const a=lw("block_restrict_allowed_poses");if(t.isPlayer()&&a.isEnforced&&(null===(o=a.customData)||void 0===o?void 0:o.poseButtons.includes(i)))return n(`You cannot change into this pose as the rule '${a.ruleDefinition.name}' forbids it.`),!1;if(PoseSetActive(Player,i),ServerSend("ChatRoomCharacterPoseUpdate",{Pose:Player.ActivePose}),!t.isPlayer()){const e="SENDER_NAME (SENDER_NUMBER) made you get on all fours";e&&yE(Pd(e,{SENDER_NAME:t.Nickname,SENDER_NUMBER:`${t.MemberNumber}`}),void 0,t.MemberNumber)}return!0}}),Ik("goandwait",{name:"Go and wait",helpDescription:"<public|private> <background name> <room name>",shortDescription:"Makes PLAYER_NAME leave and wait in another chat room.",longDescription:"This command forces PLAYER_NAME to leave the current room and join an existing chat room or otherwise create a new public or private one with the given background name and room name. PLAYER_NAME is not prevented from leaving that room, if she is able to. Tip: If you want to make PLAYER_NAME wait in a certain way, the pose command could for instance be used before this one.\nUsage:\n!goandwait HELP_DESCRIPTION",defaultLimit:bd.blocked,playerUsable:!1,trigger:(e,t,n,r)=>{var o,i,a;if(e.length<1||"public"!==e[0]&&"private"!==e[0])return n(Ow(t,`!goandwait usage:\n!goandwait ${r.commandDefinition.helpDescription}`)),!1;if(e.length<2)return n("The second argument needs to be the name of a background (for example: 'BDSMRoomRed' or 'BondageBedChamber')"),!1;const s=Sk.find((t=>t.toLocaleLowerCase()===e[1].toLocaleLowerCase()));if(!s)return n("Invalid/unknown background. Example of correct ones: 'BDSMRoomRed' or 'BondageBedChamber'"),!1;if(e.length<3)return n("Please add a room name behind the room background name."),!1;const l=e.slice(2).join(" "),c="private"===e[0],u=Player.MemberNumber;if(!u)return console.error("Player member number was unexpectedly undefined."),!1;const d=[u,t.MemberNumber];return/^[A-Za-z0-9\s]*$/.test(l)?l.length>20?(n("The room name part of the command cannot be longer than 20 characters."),!1):(fE(`You got ordered by ${t} to wait in another room.`,8e3),gE(`TargetCharacterName received an order by SourceCharacter (${t.MemberNumber}) to wait in another room.`,null,[{Tag:"TargetCharacterName",MemberNumber:Player.MemberNumber,Text:CharacterNickname(Player)},{Tag:"SourceCharacter",MemberNumber:t.MemberNumber,Text:CharacterNickname(t.Character)}]),ChatRoomLeave(),CommonSetScreen("Online","ChatSearch"),CharacterDeleteAllOnline(),ChatRoomPlayerCanJoin=!0,ServerSend("ChatRoomCreate",{Name:l,Description:"",Background:s,Private:c,Locked:!1,Space:"",Game:"",Admin:d,Ban:[],Limit:10,BlockCategory:[],Language:null!==(a=null!==(o=null===ChatRoomData||void 0===ChatRoomData?void 0:ChatRoomData.Language)&&void 0!==o?o:null===(i=Player.LastChatRoom)||void 0===i?void 0:i.Language)&&void 0!==a?a:ChatCreateLanguage}),ServerSend("ChatRoomJoin",{Name:l}),!0):(n("The room name part of the command contains characters that are not A-Z, numbers or whitespaces."),!1)},autoCompleter:e=>1===e.length?$w(e[0],["public","private"]):2===e.length?$w(e[1],Sk):[]}),Ik("cell",{name:"Send to cell",helpDescription:"<time>",shortDescription:"Lock PLAYER_NAME in a singleplayer isolation cell",longDescription:"This command sends PLAYER_NAME to the timer cell for up to 60 minutes. There is no way for you to get her out before the time is up.\nIMPORTANT: The effects of this command is not going away if BCX is turned off or not activated after reloading. This is because this command uses a function present in the base game.\nUsage:\n!cell HELP_DESCRIPTION",defaultLimit:bd.blocked,playerUsable:!1,trigger:(e,t,n,r)=>{if(e.length<1)return n(Ow(t,`!cell usage:\n!cell ${r.commandDefinition.helpDescription}`)),!1;let o=0;for(const t of e){const e=qw(t);if("string"==typeof e)return n(e),!1;o+=e}const i=o/6e4;return i<1?(n("Time needs to be more than 1 hour"),!1):(fE(`Two maids locked you into a timer cell, following ${t}'s command.`,8e3),gE(`TargetCharacterName gets grabbed by two maids and locked in a timer cell, following SourceCharacter's (${t.MemberNumber}) command.`,null,[{Tag:"TargetCharacterName",MemberNumber:Player.MemberNumber,Text:CharacterNickname(Player)},{Tag:"SourceCharacter",MemberNumber:t.MemberNumber,Text:CharacterNickname(t.Character)}]),ChatRoomLeave(),CharacterDeleteAllOnline(),CellLock(i),!0)}}),Ik("asylum",{name:"Send to asylum",helpDescription:"<time> | cancel",shortDescription:"Lock PLAYER_NAME into the aslyum",longDescription:"This command sends and locks PLAYER_NAME into the asylum for up to 1 week, where she can freely walk around, but cannot leave the area. You can free PLAYER_NAME early by visiting her in the aslyum and using '.asylum cancel'.\nIMPORTANT: The effects of this command is not going away if BCX is turned off or not activated after reloading. This is because this command uses a function present in the base game.\nUsage:\n!asylum HELP_DESCRIPTION",defaultLimit:bd.blocked,playerUsable:!1,trigger:(e,t,n,r)=>{if(e.length<1)return n(Ow(t,`!asylum usage:\n!asylum ${r.commandDefinition.helpDescription}`)),!1;if("cancel"===e[0])return LogDelete("Committed","Asylum",!0),n(`You freed ${Player.Name}. She can now leave the Asylum again.`),yE(`${t.toNicknamedString()} freed you. You are now able to leave the Asylum again.`),!0;let o=0;for(const t of e){const e=qw(t);if("string"==typeof e)return n(e),!1;o+=e}return o<6e4?(n("Time needs to be between 1 minute and 1 week"),!1):(fE(`Two nurses locked you in the Asylum, following ${t}'s command.`,8e3),gE(`TargetCharacterName gets grabbed by two nurses and locked in the Asylum, following SourceCharacter's (${t.MemberNumber}) command.`,null,[{Tag:"TargetCharacterName",MemberNumber:Player.MemberNumber,Text:CharacterNickname(Player)},{Tag:"SourceCharacter",MemberNumber:t.MemberNumber,Text:CharacterNickname(t.Character)}]),ChatRoomLeave(),CharacterDeleteAllOnline(),LogAdd("Committed","Asylum",CurrentTime+o,!0),CommonSetScreen("Room","AsylumEntrance"),!0)},autoCompleter:e=>1===e.length?$w(e[0],["cancel"]):[]}),Ik("keydeposit",{name:"Deposit all keys",helpDescription:"<time> | cancel",shortDescription:"Store away PLAYER_NAME's keys",longDescription:"This command removes all of PLAYER_NAME's keys for up to 1 week. You can give them back to her early by using '.keydeposit cancel'.\nIMPORTANT: The effects of this command is not going away if BCX is turned off or not activated after reloading. This is because this command uses a function present in the base game.\nUsage:\n!keydeposit HELP_DESCRIPTION",defaultLimit:bd.limited,playerUsable:!1,trigger:(e,t,n,r)=>{if(e.length<1)return n(Ow(t,`!keydeposit usage:\n!keydeposit ${r.commandDefinition.helpDescription}`)),!1;if("cancel"===e[0])return LogDelete("KeyDeposit","Cell",!0),n(`You let ${Player.Name} have her keys back.`),yE(`${t.toNicknamedString()} let you have your keys back.`),!0;let o=0;for(const t of e){const e=qw(t);if("string"==typeof e)return n(e),!1;o+=e}return o<6e4?(n("Time needs to be between 1 minute and 1 week"),!1):(gE(`A nurse took all keys from TargetCharacterName, following SourceCharacter's (${t.MemberNumber}) command. The keys will be deposited for ${Td(o)}.`,null,[{Tag:"TargetCharacterName",MemberNumber:Player.MemberNumber,Text:CharacterNickname(Player)},{Tag:"SourceCharacter",MemberNumber:t.MemberNumber,Text:CharacterNickname(t.Character)}]),LogAdd("KeyDeposit","Cell",CurrentTime+o,!0),!0)},autoCompleter:e=>1===e.length?$w(e[0],["cancel"]):[]}),Ik("timeleft",{name:"Show remaining time",helpDescription:"asylum | ggts | keydeposit",shortDescription:"Remaining time of keyhold, asylum stay, or GGTS training",longDescription:"This command shows the remaining time of either having all of PLAYER_NAME's keys deposited, her being locked in the asylum, or having to do GGTS training sessions in the asylum.\nUsage:\n!timeleft HELP_DESCRIPTION",defaultLimit:bd.normal,playerUsable:!0,trigger:(e,t,n,r)=>{if(1!==e.length||"asylum"!==e[0]&&"keydeposit"!==e[0]&&"ggts"!==e[0])return n(Ow(t,`!timeleft usage:\n!timeleft ${r.commandDefinition.helpDescription}`)),!1;let o,i;if("asylum"===e[0]?(o=LogValue("Committed","Asylum"),i=`${Player.Name} can leave the asylum in`):"ggts"===e[0]?(o=LogValue("ForceGGTS","Asylum"),i=`${Player.Name} still has to undergo this amount of GGTS training time:`):(o=LogValue("KeyDeposit","Cell"),i=`${Player.Name} will get her keys back in`),o&&o>0&&"ggts"===e[0])n(`${i} ${Td(o)}.`);else{if(!(o&&CurrentTime<o))return n(`${Player.Name} is not under the effect of the '${e[0]}'-command currently.`),!1;n(`${i} ${Td(o-CurrentTime)}.`)}return!0},autoCompleter:e=>1===e.length?$w(e[0],["asylum","ggts","keydeposit"]):[]}),Ik("servedrinks",{name:"Send to serve drinks",helpDescription:"",shortDescription:"Force PLAYER_NAME to do bound maid work",longDescription:"This command sends PLAYER_NAME to sell 5 drinks as a maid in multiplayer chat rooms. She must be a maid recognized by the maid sorority and be able to walk and talk, to be taken in by the maid.\nUsage:\n!servedrinks",defaultLimit:bd.blocked,playerUsable:!1,trigger:(e,t,n)=>{if(ReputationCharacterGet(Player,"Maid")<1)return n(`${Player.Name} must be a maid recognized by the maid sorority to be taken in for the job.`),!1;if(!Player.CanWalk()||!Player.CanTalk())return n(`${Player.Name} must be able to walk and talk or the maids will not take her in for the job.`),!1;PoseSetActive(Player,null);const r=`(Two maids grab you and escort you to their quarters.  Another maid addresses you.)  ${t.Name} sent you here to work.`;if(gE(`TargetCharacterName gets grabbed by two maids and escorted to the maid quarters to serve drinks, following SourceCharacter's (${t.MemberNumber}) command.`,null,[{Tag:"TargetCharacterName",MemberNumber:Player.MemberNumber,Text:CharacterNickname(Player)},{Tag:"SourceCharacter",MemberNumber:t.MemberNumber,Text:CharacterNickname(t.Character)}]),ChatRoomLeave(),CommonSetScreen("Room","MaidQuarters"),null==MaidQuartersMaid)throw new Error("HardCoreClub: Missing MaidQuartersMaid when expected");return CharacterSetCurrent(MaidQuartersMaid),MaidQuartersMaid.CurrentDialog=r,MaidQuartersMaid.Stage="205",MaidQuartersOnlineDrinkFromOwner=!0,!0}}),Ik("orgasm",{name:"Manipulate the arousal meter",helpDescription:"<number from 1 to 100> | forced | ruined | stop",shortDescription:"Controls PLAYER_NAME's orgasms directly",longDescription:"This command controls PLAYER_NAME's arousal meter directly, allowing four things:\n1. Setting the bar directly to a number from 1 to 100, whereas 100 triggers a normal orgasm.\n2. Triggering a forced orgasm that cannot be resisted.\n3. Triggering an orgasm that gets ruined.\n4. Stopping an orgasm already triggered (e.g. by a toy).\nUsage:\n!orgasm HELP_DESCRIPTION",defaultLimit:bd.limited,playerUsable:!1,trigger:(e,t,n,r)=>{if(e.length<1)return n(Ow(t,`!orgasm usage:\n!orgasm ${r.commandDefinition.helpDescription}`)),!1;if("stop"===e[0])return Player.ArousalSettings&&Player.ArousalSettings.OrgasmTimer?(ActivityOrgasmRuined=!0,!0):(n("There is no orgasm to stop currently."),!1);if(Player.ArousalSettings&&Player.ArousalSettings.OrgasmTimer)return n("This is not possible right now."),!1;if("forced"===e[0])return ActivitySetArousal(Player,99),ActivityOrgasmGameResistCount=496.5,ActivityOrgasmPrepare(Player),!0;if("ruined"===e[0]){ActivitySetArousal(Player,99);const e=Player.Effect;return Player.Effect=e.concat("DenialMode","RuinOrgasms"),ActivityOrgasmPrepare(Player,!0),Player.Effect=e,!0}const o=/^[0-9]+$/.test(e[0])&&Number.parseInt(e[0],10);return!o||o<0||o>100?(n(Ow(t,`!orgasm usage:\n!orgasm ${r.commandDefinition.helpDescription}`)),!1):(ActivitySetArousal(Player,o),o>99&&ActivityOrgasmPrepare(Player),!0)},autoCompleter:e=>1===e.length?$w(e[0],["forced","ruined","stop"]):[]});const l={none:null,afk:"Afk",whisper:"Whisper",sleep:"Sleep",hearts:"Hearts",sweatdrop:"Tear",ear:"Hearing",question:"Confusion",exclamation:"Exclamation",angry:"Annoyed",book:"Read",hand:"RaisedHand",eye:"Spectator",thumbsdown:"ThumbsDown",thumbsup:"ThumbsUp",rope:"LoveRope",gag:"LoveGag",lock:"LoveLock",wardrobe:"Wardrobe",game:"Gaming"};Ik("emoticon",{name:"Emoticon",helpDescription:`<${Object.keys(l).join(" | ")}>`,shortDescription:"Control PLAYER_NAME's emoticon",longDescription:"This command changes PLAYER_NAME's emoticon into the specified state, but the player can still manually change it.\nUsage:\n!emoticon HELP_DESCRIPTION",defaultLimit:bd.normal,playerUsable:!0,trigger:(e,t,n,r)=>{if(1!==e.length)return n(Ow(t,`!emoticon usage:\n!emoticon ${r.commandDefinition.helpDescription}`)),!1;const o=lw("block_changing_emoticon");if(o.isEnforced&&t.isPlayer())return o.triggerAttempt(),!1;o.inEffect&&t.isPlayer()&&o.trigger();const i=l[e[0].toLowerCase()];return void 0===i?(n(`Bad value: ${e[0].toLowerCase()} is not one of '${Object.keys(l).join("', '")}'`),!1):(CharacterSetFacialExpression(Player,"Emoticon",i),t.isPlayer()||yE(Pd("SENDER_NAME (SENDER_NUMBER) changed your emoticon.",{SENDER_NAME:t.Nickname,SENDER_NUMBER:`${t.MemberNumber}`}),void 0,t.MemberNumber),!0)},autoCompleter:e=>1===e.length?$w(e[0],Object.keys(l)):[]})}(),Dk();for(const[e,t]of xk.entries()){t.init&&t.init(t.state);const n=t.autoCompleter;Aw("commands",e,null!=t.shortDescription?`${t.helpDescription} - ${Pd(t.shortDescription,{})}`:t.helpDescription,((n,r,o)=>{r.isPlayer()&&t.playerUsable||AA(md.Commands)&&sC("commands",e,r)?t.trigger(n,r,o,t.state):o(yw)}),n?(r,o)=>o.isPlayer()&&t.playerUsable||AA(md.Commands)&&sC("commands",e,o)?n(r,o):[]:void 0,!!t.playerUsable)}}load(){if(AA(md.Commands))for(const e of xk.values())e.load&&e.load(e.state)}run(){AA(md.Commands)&&(this.resetTimer=c((()=>{this.triggerCounts.clear()}),6e4))}unload(){null!==this.resetTimer&&(clearInterval(this.resetTimer),this.resetTimer=null);for(const e of xk.values())e.unload&&e.unload()}reload(){this.unload(),this.load(),this.run()}commandTick(e,t){var n;if(null!==this.suspendedUntil){if(!(Date.now()>=this.suspendedUntil))return;this.suspendedUntil=null,this.triggerCounts.clear(),gE("All of SourceCharacter's temporarily blocked commands can be used again.",null,[{Tag:"SourceCharacter",MemberNumber:Player.MemberNumber,Text:CharacterNickname(Player)}])}const r=xk.get(e);if(!r)throw new Error(`Definition for command ${e} not found`);if(r.tick&&r.tick(r.state)){const t=(null!==(n=this.triggerCounts.get(e))&&void 0!==n?n:0)+1;this.triggerCounts.set(e,t),t>=10&&(gE("Protection triggered: Commands have been blocked for 10 minutes. Please refrain from using commands so rapidly, as it creates strain on the server and may lead to unwanted side effects! If you believe this message was triggered by a bug, please report it to BCX Discord."),this.suspendedUntil=Date.now()+6e5)}}}),DA(new class extends Cd{constructor(){super(...arguments),this.timer=null}load(){var e;Ed(tA.conditions)||(tA.conditions={});for(const t of Object.keys(tA.conditions)){const n=Zw.get(t);if(!n||!AA(n.category)){console.debug(`HardCoreClub: Removing unknown or disabled conditions category ${t}`),delete tA.conditions[t];continue}const r=tA.conditions[t];if(Ed(r)&&Ed(r.conditions)){void 0!==r.timer&&"number"!=typeof r.timer&&(console.warn(`HardCoreClub: Removing category ${t} invalid timer`,r.timer),delete r.timer),void 0!==r.timerRemove&&!0!==r.timerRemove&&(console.warn(`HardCoreClub: Removing category ${t} invalid timerRemove`,r.timerRemove),delete r.timerRemove),Ed(r.limits)||(console.warn(`HardCoreClub: Resetting category ${t} limits with invalid data`),r.limits={});for(const[o,i]of Sd(r.limits))n.loadValidateConditionKey(o)?"number"==typeof i&&i!==(null!==(e=n.getDefaultLimits()[o])&&void 0!==e?e:bd.normal)&&void 0!==bd[i]||(console.warn(`HardCoreClub: Bad condition ${t}:${o} limit value, removing it`,i),delete r.limits[o]):(console.warn(`HardCoreClub: Unknown condition ${t}:${o} limit, removing it`),delete r.limits[o]);zw(r.requirements)||(console.warn(`HardCoreClub: Resetting category ${t} requirements with invalid data`),r.requirements={}),r.data=n.loadCategorySpecificGlobalData(r.data);for(const[e,o]of Sd(r.conditions))o&&(n.loadValidateConditionKey(e)?n.loadValidateCondition(e,o)?"boolean"!=typeof o.active||void 0!==o.requirements&&!zw(o.requirements)||void 0!==o.timer&&"number"!=typeof o.timer||void 0!==o.timerRemove&&!0!==o.timerRemove||void 0!==o.favorite&&!0!==o.favorite?(console.warn(`HardCoreClub: Condition ${t}:${e} has bad data, removing it`),delete r.conditions[e]):aC(t,e)!==bd.blocked?(o.timerRemove&&!o.active&&(console.warn(`HardCoreClub: Condition ${t}:${e} had timerRemove while inactive, cleaning up`),delete o.timerRemove),"boolean"!=typeof o.lastActive&&(console.warn(`HardCoreClub: Condition ${t}:${e} missing lastActive, adding`),o.lastActive=!1),void 0===o.addedBy||Number.isInteger(o.addedBy)||(console.warn(`HardCoreClub: Condition ${t}:${e} bad addedBy, cleaning up`,o.addedBy),delete o.addedBy)):(console.warn(`HardCoreClub: Condition ${t}:${e} became blocked while active, removing it`),delete r.conditions[e]):delete r.conditions[e]:(console.warn(`HardCoreClub: Unknown condition ${t}:${e}, removing it`),delete r.conditions[e]))}else console.warn(`HardCoreClub: Removing category ${t} with invalid data`),delete tA.conditions[t]}for(const[e,t]of Zw.entries())AA(t.category)&&!Ed(tA.conditions[e])&&(console.debug(`HardCoreClub: Adding missing conditions category ${e}`),tA.conditions[e]={conditions:{},limits:{},requirements:{},data:t.loadCategorySpecificGlobalData(void 0)});uA.conditionsGet=(e,t)=>"string"==typeof t&&Zw.has(t)&&Qw(t)?rC(t,e):void 0,uA.conditionSetLimit=(e,t)=>Ed(t)&&"string"==typeof t.category&&Zw.has(t.category)&&"string"==typeof t.condition&&"number"==typeof t.limit&&void 0!==bd[t.limit]?cC(t.category,t.condition,t.limit,e):void 0,uA.conditionUpdate=(e,t)=>Ed(t)&&"string"==typeof t.category&&Zw.has(t.category)&&"string"==typeof t.condition&&Vw(t.category,t.condition,t.data)?dC(t.category,t.condition,t.data,e):void 0,uA.conditionUpdateMultiple=(e,t)=>!(Ed(t)&&"string"==typeof t.category&&Zw.has(t.category)&&Array.isArray(t.conditions)&&t.conditions.every((e=>{var n;return"string"==typeof e&&(null===(n=Zw.get(t.category))||void 0===n?void 0:n.loadValidateConditionKey(e))}))&&Ed(t.data))||void 0!==t.data.active&&"boolean"!=typeof t.data.active||void 0!==t.data.timer&&null!==t.data.timer&&"number"!=typeof t.data.timer||void 0!==t.data.timerRemove&&"boolean"!=typeof t.data.timerRemove||void 0!==t.data.requirements&&null!==t.data.requirements&&!zw(t.data.requirements)||void 0!==t.data.favorite&&"boolean"!=typeof t.data.favorite?void 0:function(e,t,n,r){const o=Jw(e);if(!AA(o.category))return!1;let i=!1;for(const a of t){const t=oC(e,a);if(!t)continue;const s=tC(o,a,t,r);let l=!1;void 0!==n.active&&n.active!==s.active&&(s.active=n.active,l=!0),void 0!==n.timer&&n.timer!==s.timer&&(s.timer=n.timer,l=!0),void 0!==n.timerRemove&&n.timerRemove!==s.timerRemove&&(s.timerRemove=n.timerRemove,l=!0),void 0!==n.requirements&&n.requirements!==s.requirements&&(s.requirements=n.requirements,l=!0),void 0!==n.favorite&&n.favorite!==s.favorite&&(s.favorite=n.favorite,l=!0),l&&(i=dC(e,a,s,r)||i)}return i}(t.category,t.conditions,t.data,e),uA.conditionCategoryUpdate=(e,t)=>Ed(t)&&"string"==typeof t.category&&Zw.has(t.category)&&Ed(t.data)&&(null===t.data.timer||"number"==typeof t.data.timer)&&"boolean"==typeof t.data.timerRemove&&zw(t.data.requirements)?hC(t.category,t.data,e):void 0}run(){this.timer=c((()=>this.conditionsTick()),2e3)}unload(){null!==this.timer&&(clearInterval(this.timer),this.timer=null)}reload(){this.unload(),this.load(),this.run()}conditionsTick(){var e,t;if(!ServerIsConnected||!tA.conditions)return;let n=!1;const r=Date.now();for(const[o,i]of Zw.entries()){const a=tA.conditions[o];if(AA(i.category)&&a){for(const[t,s]of Sd(a.conditions)){if(!s)continue;if(void 0!==s.timer&&s.timer<=r){if(s.timerRemove&&s.active)return void lC(o,t);delete s.timer,delete s.timerRemove,s.active=!s.active,n=!0}const l=s.active&&mC(null!==(e=s.requirements)&&void 0!==e?e:a.requirements);if(l!==s.lastActive){s.lastActive=l,n=!0;const e=kp(s);i.stateChangeHandler(t,s,l),zp(e,s)||(n=!0)}if(!l)continue;const c=kp(s);i.tickHandler(t,s),zp(c,s)||(n=!0)}null===(t=i.afterTickHandler)||void 0===t||t.call(i)}}n&&(sA(),wA())}}),DA(new class extends Cd{load(){window.bcx=_S,Zd("DialogDrawItemMenu",0,((e,t)=>{var n;return cE&&(DialogTextDefault=(null===(n=e[0].FocusGroup)||void 0===n?void 0:n.Description)||""),t(e)})),DialogSelfMenuOptions.forEach((e=>{"Pose"===e.Name&&(e.IsAvailable=()=>!0)}))}run(){window.BCX_Devel&&dE(!0)}unload(){delete window.bcx}}),DA(new class extends Cd{constructor(){super(...arguments),this.resetTimer=null,this.triggerCounts=new Map,this.suspendedUntil=new Map,this.pendingMessages={remove:[],add:[],swap:[],update:[],color:[],autoremove:[]}}init(){IA("curses_normal",{name:"Allows handling curses on non-limited object slots",category:md.Curses,defaults:{[hd.dominant]:[!0,xA.lover],[hd.switch]:[!0,xA.lover],[hd.submissive]:[!1,xA.mistress],[hd.slave]:[!1,xA.mistress]}}),IA("curses_limited",{name:"Allows handling curses on limited object slots",category:md.Curses,defaults:{[hd.dominant]:[!0,xA.owner],[hd.switch]:[!0,xA.owner],[hd.submissive]:[!1,xA.lover],[hd.slave]:[!1,xA.lover]}}),IA("curses_global_configuration",{name:"Allows editing the global curses configuration",category:md.Curses,defaults:{[hd.dominant]:[!0,xA.owner],[hd.switch]:[!0,xA.owner],[hd.submissive]:[!1,xA.lover],[hd.slave]:[!1,xA.lover]}}),IA("curses_change_limits",{name:"Allows to limit/block individual curse object slots",category:md.Curses,defaults:{[hd.dominant]:[!0,xA.self],[hd.switch]:[!0,xA.self],[hd.submissive]:[!0,xA.self],[hd.slave]:[!1,xA.owner]}}),IA("curses_color",{name:"Allow changing colors of cursed objects",category:md.Curses,defaults:{[hd.dominant]:[!0,xA.lover],[hd.switch]:[!0,xA.lover],[hd.submissive]:[!0,xA.mistress],[hd.slave]:[!1,xA.mistress]}}),IA("curses_view_originator",{name:"Allow to view who added the curse originally",category:md.Curses,defaults:{[hd.dominant]:[!0,xA.self],[hd.switch]:[!0,xA.self],[hd.submissive]:[!0,xA.mistress],[hd.slave]:[!0,xA.mistress]}}),uA.curseItem=(e,t)=>Ed(t)&&"string"==typeof t.Group&&kE(t.Group)&&("boolean"==typeof t.curseProperties||null===t.curseProperties)?ek(t.Group,t.curseProperties,e):void 0,uA.curseLift=(e,t)=>"string"==typeof t&&kE(t)?nk(t,e):void 0,uA.curseBatch=(e,t)=>Ed(t)&&"string"==typeof t.mode&&"boolean"==typeof t.includingEmpty?tk(t.mode,t.includingEmpty,e):void 0,uA.curseLiftAll=e=>rk(e),Aw("modules","curses","- Manage curses",((e,t,n)=>{var r;if(!AA(md.Curses))return n("Curses module is disabled.");const o=(e[0]||"").toLocaleLowerCase(),i=rC("curses",t).conditions;if(pC.includes(o))return vC("curses",e,t,n);if("list"===o){let e="Current curses:";for(const[t,o]of Sd(i)){if(!o)continue;const i=AssetGroup.find((e=>e.Name===t));if(!i){console.warn(`HardCoreClub: Unknown group ${t}`);continue}let a=`\n[${"Item"===i.Category?"Item":i.Clothing?"Clothing":"Body"}] `;if(null===o.data)a+=`Blocked: ${pE(i)}`;else{const e=AssetGet(Player.AssetFamily,t,o.data.Name),n=`Timer: ${o.timer?Td(o.timer-Date.now(),"short"):""}`;a+=`${null!==(r=null==e?void 0:e.Description)&&void 0!==r?r:o.data.Name} (${pE(i)}) | ${n}`+(o.data.curseProperties?" | Item configuration also cursed":"")}e.length+a.length>=990&&(e+="\n...",n(e),e="Current curses (continued):"),e+=a}n(e)}else if("listgroups"===o){const r=(e[1]||"").toLocaleLowerCase();if("items"===r){let e="List of item groups:";const t=AssetGroup.filter((e=>"Item"===e.Category));for(const n of t){const t=InventoryGet(Player,n.Name),r=void 0!==i[n.Name];e+=`\n${pE(n)}: ${t?t.Asset.Description:"[Nothing]"}`,r&&(e+=" [cursed]")}n(e)}else if("clothes"===r){let e="List of clothes groups:";const t=AssetGroup.filter((e=>"Appearance"===e.Category&&e.Clothing));for(const n of t){const t=InventoryGet(Player,n.Name),r=void 0!==i[n.Name];e+=`\n${pE(n)}: ${t?t.Asset.Description:"[Nothing]"}`,r&&(e+=" [cursed]")}n(e)}else if("body"===r){let e="List of body groups:";const t=AssetGroup.filter((e=>"Appearance"===e.Category&&!e.Clothing&&e.AllowCustomize));for(const n of t){const t=InventoryGet(Player,n.Name),r=void 0!==i[n.Name];e+=`\n${pE(n)}: ${t?t.Asset.Description:"[Nothing]"}`,r&&(e+=" [cursed]")}n(e)}else n(Ow(t,"Expected one of:\n!curses listgroups items\n!curses listgroups clothes\n!curses listgroups body"))}else if("curse"===o){const r=Uw(e[1]||"",VA());if("string"==typeof r)return n(r);if(void 0!==i[r.Name])return n("This group or item is already cursed");n(ek(r.Name,null,t)?"Ok.":yw)}else if("curseworn"===o||"curseall"===o){const r=(e[1]||"").toLocaleLowerCase();if("items"===r||"clothes"===r||"body"===r)return n(tk(r,"curseall"===o,t)?"Ok.":yw);n(Ow(t,`Expected one of:\n!curses ${o} items\n!curses ${o} clothes\n!curses ${o} body`))}else if("lift"===o){const r=Uw(e[1]||"",VA());if("string"==typeof r)return n(r);if(void 0===i[r.Name])return n("This group or item is not cursed");n(nk(r.Name,t)?"Ok.":yw)}else if("liftall"===o)n(rk(t)?"Ok.":yw);else if("configuration"===o){const r=Uw(e[1]||"",VA());if("string"==typeof r)return n(r);const o=i[r.Name];if(!o)return n("This group or item is not cursed");const a=(e[2]||"").toLocaleLowerCase();if("yes"!==a&&"no"!==a)return n("Expected yes or no");if(null==o.data)return n("Empty groups cannot have configuration cursed");const s=AssetGet(Player.AssetFamily,r.Name,o.data.Name);if(s&&"yes"===a&&!J_(s))return n("This item cannot have configuration cursed");o.data.curseProperties="yes"===a,n(dC("curses",r.Name,o,t)?"Ok.":yw)}else if("autoremove"===o){const r=Uw(e[1]||"",VA());if("string"==typeof r)return n(r);const o=i[r.Name];if(!o)return n("This group or item is not cursed");if(!o.requirements)return n("Cannot change autoremove while the curse uses the global configuration. First use:\ncurses triggers <curse> global no");const a=(e[2]||"").toLocaleLowerCase();if("yes"!==a&&"no"!==a)return n("Expected yes or no");if(null==o.data)return n("Empty groups have no item to be automatically removed");o.data.itemRemove="yes"===a,n(dC("curses",r.Name,o,t)?"Ok.":yw)}else n(Ow(t,"!curses usage (page 1):\n!curses list - List all cursed <group>s and related info (eg. cursed items)\n!curses listgroups <items|clothes|body> - Lists all possible item or cloth <group> slots and worn items\n!curses curse <group> - Places a curse on the specified item/cloth <group>\n!curses curseworn <items|clothes|body> - Place a curse on all currently worn items/clothes\n!curses curseall <items|clothes|body> - Place a curse on all item/cloth slots, both used and empty\n!curses lift <group> - Lifts (removes) the curse from the specified item/cloth <group>\n!curses liftall - Lifts (removes) all curses\n!curses configuration <group> <yes|no> - Curses or uncurses the item configuration of an item/cloth in <group>\n!curses autoremove <group> <yes|no> - Removes an item/cloth in <group> when the curse is no longer in effect")),n(Ow(t,'!curses usage (page 2):\n!curses setactive <group> <yes/no> - Switch the curse and its conditions on and off\n!curses triggers <group> global <yes/no> - Set the trigger condition of this curse to the global configuration\n!curses triggers <group> help - Set the trigger configuration of a curse\n!curses globaltriggers help - Set global trigger configuration\n!curses timer <group> help - Set timer options of a curse\n!curses defaulttimer help - Set default timer options used on new curses\n!curses setlimit <group> <normal/limited/blocked> - Set a limit on certain <group>\n\nHint: If an argument contains spaces: "put it in quotes"'))}),((e,t)=>{if(!AA(md.Curses))return[];if(e.length<=1)return $w(e[0],["list","listgroups","curse","curseworn","curseall","lift","liftall","configuration","autoremove",...pC]);const n=e[0].toLocaleLowerCase(),r=rC("curses",t).conditions;if(pC.includes(n))return bC("curses",e);if("listgroups"===n){if(2===e.length)return $w(e[1],["items","clothes"])}else if("curse"===n){if(2===e.length)return Yw(e[1]||"",VA())}else if("curseworn"===n||"curseall"===n){if(2===e.length)return $w(e[1],["items","clothes"])}else if("lift"===n){if(2===e.length)return Yw(e[1]||"",VA(),(e=>void 0!==r[e.Name]))}else if("configuration"===n){if(2===e.length)return Yw(e[1]||"",VA(),(e=>void 0!==r[e.Name]));if(3===e.length)return $w(e[2],["yes","no"])}else if("autoremove"===n){if(2===e.length)return Yw(e[1]||"",VA(),(e=>void 0!==r[e.Name]));if(3===e.length)return $w(e[2],["yes","no"])}return[]})),Kw("curses",{category:md.Curses,permission_normal:"curses_normal",permission_limited:"curses_limited",permission_configure:"curses_global_configuration",permission_changeLimits:"curses_change_limits",permission_viewOriginator:"curses_view_originator",loadValidateConditionKey:e=>AssetGroup.some((t=>t.Name===e&&t.AllowCustomize)),loadValidateCondition:(e,t)=>{const n=t.data,r=AssetGroupGet(Player.AssetFamily,e);return!(!r||!r.AllowCustomize||(null===n?!r.AllowNone&&(console.warn(`HardCoreClub: Invalid empty cursed slot without none allowed for '${e}', removing it`,n),1):Ed(n)&&"string"==typeof n.Name&&"boolean"==typeof n.curseProperty?n.itemRemove&&!r.AllowNone?(console.warn(`HardCoreClub: Invalid itemRemove for curse ${e}:${n.Name}, removing it`,n),1):null==AssetGet("Female3DCG",e,n.Name)&&(console.warn(`HardCoreClub: Unknown cursed item ${e}:${n.Name}, removing it`,n),1):(console.error(`HardCoreClub: Bad data for cursed item in group ${e}, removing it`,n),1)))},loadCategorySpecificGlobalData:e=>(Ed(e)||(console.warn("HardCoreClub: Bad curses global data, resetting"),e={itemRemove:!1}),"boolean"!=typeof e.itemRemove&&(e.itemRemove=!1),e),stateChangeHandler:this.curseStateChange.bind(this),tickHandler:this.curseTick.bind(this),afterTickHandler:this.afterCurseTick.bind(this),makePublicData:(e,t)=>{var n;return null===t.data?null:{Name:t.data.Name,curseProperties:t.data.curseProperty,itemRemove:null!==(n=t.data.itemRemove)&&void 0!==n&&n}},validateCategorySpecificGlobalData:e=>Ed(e)&&"boolean"==typeof e.itemRemove,validatePublicData:(e,t)=>{var n;return null===t||Ed(t)&&"string"==typeof t.Name&&"boolean"==typeof t.curseProperties&&"boolean"==typeof t.itemRemove&&(!t.itemRemove||!!(null===(n=AssetGroupGet(Player.AssetFamily,e))||void 0===n?void 0:n.AllowNone))},updateCondition:(e,t,n,r,o)=>{var i;const a=AssetGroupGet(Player.AssetFamily,e);if(!a)return!1;if((null===(i=t.data)||void 0===i?void 0:i.Name)!==(null==n?void 0:n.Name))return!1;if(!t.data||!n)return!0;const s=AssetGet(Player.AssetFamily,e,t.data.Name);return s?(t.data.curseProperty=n.curseProperties,!J_(s)&&t.data.curseProperty&&(console.warn(`HardCoreClub: Attempt to curse properties of item ${e}:${t.data.Name}, while not allowed`),t.data.curseProperty=!1),n.itemRemove&&o.requirements&&a.AllowNone?t.data.itemRemove=!0:delete t.data.itemRemove,!0):(console.warn(`HardCoreClub: Curse asset ${e}:${t.data.Name} not found during update`),!1)},parseConditionName:(e,t)=>{const n=Uw(e,VA(),(e=>!t||t.includes(e.Name)));return"string"==typeof n?[!1,n]:[!0,n.Name]},autocompleteConditionName:(e,t)=>Yw(e,VA(),(e=>!t||t.includes(e.Name))),logLimitChange:(e,t,n)=>{lv("curse_change",av.plaintext,`${t} changed ${Player.Name}'s curse slot '${e}' permission to ${bd[n]}`),t.isPlayer()||yE(`${t.toNicknamedString()} changed curse slot '${e}' permission to ${bd[n]}`,void 0,t.MemberNumber)},logConditionUpdate:(e,t,n,r)=>{var o,i,a,s,l,c;const u=AssetGroup.find((t=>t.Name===e)),d=u?pE(u):"[ERROR]",h=n.active!==r.active,m=n.timer!==r.timer||n.timerRemove!==r.timerRemove,p=!zp(n.requirements,r.requirements),f=null!=n.requirements&&(null===(o=n.data)||void 0===o?void 0:o.itemRemove)!==(null===(i=r.data)||void 0===i?void 0:i.itemRemove),g=(null===(a=n.data)||void 0===a?void 0:a.curseProperties)!==(null===(s=r.data)||void 0===s?void 0:s.curseProperties),y=[];if(h&&y.push("active state"),m&&y.push("timer"),p&&y.push("trigger condition"),f&&y.push("autoremove option"),g&&y.push("item config curse"),y.length>0&&lv("curse_change",av.plaintext,`${t} changed the ${y.join(", ")} of ${Player.Name}'s curse on slot '${d}'`),!t.isPlayer()){if(h&&yE(`${t.toNicknamedString()} ${n.active?"reactivated":"deactivated"} the curse on slot '${d}'`,void 0,t.MemberNumber),n.timer!==r.timer&&(null===n.timer?yE(`${t.toNicknamedString()} disabled the timer of the curse on slot '${d}'`,void 0,t.MemberNumber):yE(`${t.toNicknamedString()} changed the remaining time of the timer of the curse on slot '${d}' to ${Td(n.timer-Date.now())}`,void 0,t.MemberNumber)),null!==n.timer&&n.timerRemove!==r.timerRemove&&yE(`${t.toNicknamedString()} changed the timer behavior of the curse on slot '${d}' to ${n.timerRemove?"remove":"disable"} the curse when time runs out`,void 0,t.MemberNumber),f&&yE(`${t.toNicknamedString()} set the curse on slot '${d}' to ${(null===(l=n.data)||void 0===l?void 0:l.itemRemove)?"remove":"keep"} the item when the curse is no longer in effect`,void 0,t.MemberNumber),p)if(null===n.requirements)yE(`${t.toNicknamedString()} set the curse on slot '${d}' to use the global curses configuration`,void 0,t.MemberNumber);else{const e=[],r=n.requirements;if(r.room&&e.push(`When ${r.room.inverted?"not in":"in"} ${r.room.type} room`),r.roomName&&e.push(`When ${r.roomName.inverted?"not in":"in"} room named '${r.roomName.name}'`),r.role){const t=Nd(xA[r.role.role])+(r.role.role!==xA.clubowner?" ":"");e.push(`When ${r.role.inverted?"not in":"in"} room with role '${t}'`)}if(r.player){const t=ME(r.player.memberNumber,null);e.push(`When ${r.player.inverted?"not in":"in"} room with member '${r.player.memberNumber}'${t?` (${t})`:""}`)}e.length>0?yE(`${t.toNicknamedString()} set the curse on slot ${d} to trigger under following conditions:\n`+e.join("\n"),void 0,t.MemberNumber):yE(`${t.toNicknamedString()} deactivated all trigger conditions of the curse on slot ${d}. The curse will now always trigger, while it is active`,void 0,t.MemberNumber)}g&&yE(`${t.toNicknamedString()} ${(null===(c=n.data)||void 0===c?void 0:c.curseProperties)?"cursed":"lifted the curse of"} the '${d}' item's configuration`,void 0,t.MemberNumber)}},logCategoryUpdate:(e,t,n)=>{var r,o,i;const a=t.timer!==n.timer||t.timerRemove!==n.timerRemove,s=!zp(t.requirements,n.requirements),l=(null===(r=t.data)||void 0===r?void 0:r.itemRemove)!==(null===(o=n.data)||void 0===o?void 0:o.itemRemove),c=[];if(a&&c.push("default timer"),s&&c.push("trigger condition"),l&&c.push("autoremove option"),c.length>0&&lv("curse_change",av.plaintext,`${e} changed the ${c.join(", ")} of ${Player.Name}'s global curses config`),!e.isPlayer()&&(t.timer!==n.timer&&(null===t.timer?yE(`${e.toNicknamedString()} removed the default timer of the global curses configuration`,void 0,e.MemberNumber):yE(`${e.toNicknamedString()} changed the default timer of the global curses configuration to ${Td(t.timer)}`,void 0,e.MemberNumber)),null!==t.timer&&t.timerRemove!==n.timerRemove&&yE(`${e.toNicknamedString()} changed the default timeout behavior of the global curses configuration to ${t.timerRemove?"removal of curses":"disabling curses"} when time runs out`,void 0,e.MemberNumber),l&&yE(`${e.toNicknamedString()} changed the default curses behaviour to ${(null===(i=t.data)||void 0===i?void 0:i.itemRemove)?"remove":"keep"} an item when the curse on it is no longer in effect`,void 0,e.MemberNumber),s)){const n=[],r=t.requirements;if(r.room&&n.push(`When ${r.room.inverted?"not in":"in"} ${r.room.type} room`),r.roomName&&n.push(`When ${r.roomName.inverted?"not in":"in"} room named '${r.roomName.name}'`),r.role){const e=Nd(xA[r.role.role])+(r.role.role!==xA.clubowner?" ":"");n.push(`When ${r.role.inverted?"not in":"in"} room with role '${e}'`)}if(r.player){const e=ME(r.player.memberNumber,null);n.push(`When ${r.player.inverted?"not in":"in"} room with member '${r.player.memberNumber}'${e?` (${e})`:""}`)}n.length>0?yE(`${e.toNicknamedString()} set the global curses configuration to trigger curses under following conditions:\n`+n.join("\n"),void 0,e.MemberNumber):yE(`${e.toNicknamedString()} deactivated all trigger conditions for the global curses configuration. Curses set to this default configuration will now always trigger, while active`,void 0,e.MemberNumber)}},getDefaultLimits:()=>{const e={};for(const t of AssetGroup)"Appearance"===t.Category&&!t.Clothing&&t.AllowCustomize&&(e[t.Name]=bd.limited);return e},commandConditionSelectorHelp:"group",currentExportImport:{export:(e,t)=>t,import(e,t,n){const r=Oy.object({Name:Oy.string(),curseProperty:Oy.boolean(),Color:Oy.union([Oy.string(),Oy.array(Oy.string())]).optional(),Difficulty:Oy.number().optional(),Property:Oy.custom(Ed).optional(),Craft:Oy.any(),itemRemove:Oy.literal(!0).optional()}).nullable().safeParse(t);if(!r.success)return[!1,JSON.stringify(r.error.format(),void 0,"\t")];const o=r.data;if(null!=o&&null==AssetGet("Female3DCG",e,o.Name))return[!1,`Unknown item "${e}:${o.Name}"`];if(null!=(null==o?void 0:o.Craft)){const t=D_(o.Craft,AssetGet("Female3DCG",e,o.Name));if(!t.result)return[!1,"Crafting validation failed:\n"+t.messages.join("\n")];o.Craft=t.result}return[!0,o]},importLog(e,t,n){const r=AssetGroupGet(Player.AssetFamily,e);n&&r&&(lv("curse_change",av.plaintext,`${n} imported a curse on ${Player.Name}'s ${pE(r)}`),n.isPlayer()||yE(`${n.toNicknamedString()} imported a curse on your ${pE(r)}`))},importRemove:(e,t)=>!!nk(e,t)||"Failed."}})}load(){AA(md.Curses)&&(Zd("ValidationResolveModifyDiff",0,((e,t)=>{const n=e[2],r=t(e);if(0===n.C.ID&&r.item){const e=oC("curses",r.item.Asset.Group.Name),t=null==e?void 0:e.data,o=XA(n.sourceMemberNumber);t&&r.item.Asset.Name===t.Name&&!NE(t.Color,r.item.Color)&&o&&TA("curses_color",o)&&(r.item.Color&&"Default"!==r.item.Color?t.Color=kp(r.item.Color):delete t.Color,sA())}return r}),md.Curses),Zd("ColorPickerDraw",0,((e,t)=>{const n=e[5];return n===ItemColorOnPickerChange&&(e[5]=e=>{if(ItemColorCharacter===Player&&ItemColorItem){const t=ItemColorState.colors.slice();ItemColorPickerIndices.forEach((n=>t[n]=e)),ItemColorItem.Color=t,CharacterLoadCanvas(ItemColorCharacter);const n=oC("curses",ItemColorItem.Asset.Group.Name),r=null==n?void 0:n.data;r&&!NE(r.Color,ItemColorItem.Color)&&TA("curses_color",VA())&&(ItemColorItem.Color?r.Color=kp(ItemColorItem.Color):delete r.Color,sA())}else n(e)}),t(e)})),Vd("CharacterAppearanceGenderAllowed"))}run(){AA(md.Curses)&&(this.resetTimer=c((()=>{this.triggerCounts.clear()}),6e4))}unload(){null!==this.resetTimer&&(clearInterval(this.resetTimer),this.resetTimer=null),Kd(md.Curses)}reload(){this.unload(),this.load(),this.run()}curseTick(e,t){var n,r,o;const i=AssetGroupGet(Player.AssetFamily,e);if(!i)return void console.error(`HardCoreClub: AssetGroup not found for curse ${e}`,t);if(this.suspendedUntil.has(e)){if(!(Date.now()>=this.suspendedUntil.get(e)))return;this.suspendedUntil.delete(e),this.triggerCounts.clear(),gE(`The dormant curse on SourceCharacter's ${pE(i)} wakes up again.`,null,[{Tag:"SourceCharacter",MemberNumber:Player.MemberNumber,Text:CharacterNickname(Player)}])}if(V_.includes(CurrentScreen)||(null===CurrentCharacter||void 0===CurrentCharacter?void 0:CurrentCharacter.IsNpc()))return;const a=t.data;let s=InventoryGet(Player,e);if(s&&z_.includes(s.Asset.Name)||a&&z_.includes(a.Name))return;if(null===a)return void(s&&s.Asset.Group.AllowNone&&(InventoryRemove(Player,e,!1),CharacterRefresh(Player,!0),ChatRoomCharacterUpdate(Player),this.pendingMessages.remove.push(s.Asset.Description),Fy.emitEvent("curseTrigger",{action:"remove",group:e})));const l=AssetGet("Female3DCG",e,a.Name);if(!l)return void console.error(`HardCoreClub: Asset not found for curse ${e}:${a.Name}`,a);if(!eh("CharacterAppearanceGenderAllowed",[l]))return;let c="";if(s&&s.Asset.Name!==a.Name&&(InventoryRemove(Player,e,!1),c="swap",s=null),s||(s={Asset:l,Color:null!=a.Color?kp(a.Color):"Default",Property:null!=a.Property?kp(a.Property):{},Craft:D_(a.Craft,l).result,Difficulty:null!=a.Difficulty?a.Difficulty:0},ExtendedItemInit(Player,s,!1,!1),a.Property=K_(s).Property,Player.Appearance.push(s),c||(c="add")),a.curseProperty){const e=s.Property=null!==(n=s.Property)&&void 0!==n?n:{},t=null!==(r=a.Property)&&void 0!==r?r:{};for(const n of xd(Object.keys(t).concat(Object.keys(e))))"Effect"!==n&&(q_.includes(n)?delete t[n]:void 0===t[n]?void 0!==e[n]&&(delete e[n],c||(c="update")):typeof t[n]==typeof e[n]&&zp(t[n],e[n])||(e[n]=kp(t[n]),c||(c="update")));const o=Array.isArray(e.Effect)?e.Effect.filter((e=>X_.includes(e))):[],i=Array.isArray(e.Effect)?e.Effect.filter((e=>!X_.includes(e))).sort():[],l=Array.isArray(t.Effect)?t.Effect.filter((e=>!X_.includes(e))).sort():[];CommonArraysEqual(i,l)||(e.Effect=l.concat(o)),ExtendedItemInit(Player,s,!1,!1),a.Property=K_(s).Property}else a.Property=K_(s).Property;const u=D_(a.Craft,l).result;if(zp(D_(s.Craft,s.Asset).result,u)||(void 0===u?delete s.Craft:s.Craft={...Ed(s.Craft)?s.Craft:{},...u},c||(c="update")),NE(a.Color,s.Color)||(void 0===a.Color||"Default"===a.Color?delete s.Color:s.Color=kp(a.Color),c||(c="color")),c){CharacterRefresh(Player,!0),ChatRoomCharacterUpdate(Player),this.pendingMessages[c].push(l.Description),Fy.emitEvent("curseTrigger",{action:c,group:e});const t=(null!==(o=this.triggerCounts.get(e))&&void 0!==o?o:0)+1;this.triggerCounts.set(e,t),t>=10&&(gE(`Protection triggered: Curses on SourceCharacter's ${pE(i)} have been disabled for 10 minutes. Please refrain from triggering curses so rapidly, as it creates strain on the server and may lead to unwanted side effects! If you believe this message was triggered by a bug, please report it to BCX Discord.`,null,[{Tag:"SourceCharacter",MemberNumber:Player.MemberNumber,Text:CharacterNickname(Player)}]),this.suspendedUntil.set(e,Date.now()+6e5))}}afterCurseTick(){for(const e of Object.keys(this.pendingMessages)){const t=this.pendingMessages[e];if(0!==t.length){if(t.length>=3)gE(Pd(nv[e],{PLAYER_NAME:"SourceCharacter"}),null,[{Tag:"SourceCharacter",MemberNumber:Player.MemberNumber,Text:CharacterNickname(Player)}]),"autoremove"!==e&&lv("curse_trigger",av.curseTriggerBatch,e);else for(const n of t)gE(Pd(tv[e],{PLAYER_NAME:"SourceCharacter",ASSET_NAME:n}),null,[{Tag:"SourceCharacter",MemberNumber:Player.MemberNumber,Text:CharacterNickname(Player)}]),"autoremove"!==e&&lv("curse_trigger",av.curseTrigger,[e,n]);this.pendingMessages[e]=[]}}}curseStateChange(e,t,n){var r;const o=AssetGroupGet(Player.AssetFamily,e);if(!n&&t.data&&(t.requirements?t.data.itemRemove:null===(r=eC("curses").data)||void 0===r?void 0:r.itemRemove)&&(null==o?void 0:o.AllowNone)){const n=InventoryGet(Player,e);n&&n.Asset.Name===t.data.Name&&null==InventoryGetLock(n)&&(InventoryRemove(Player,e,!0),ChatRoomCharacterUpdate(Player),this.pendingMessages.autoremove.push(n.Asset.Description),Fy.emitEvent("curseTrigger",{action:"autoremove",group:e}))}}}),DA(new class extends Cd{load(){const e={};var t,n;(null===(n=null===(t=Player.OnlineSettings)||void 0===t?void 0:t.BCX_Custom)||void 0===n?void 0:n.includes("c"))&&(e.ctoggle=[()=>{const e=InventoryGet(Player,"ItemVulva"),t=AssetGet(Player.AssetFamily,"ItemVulva","DoubleEndDildo");!e&&t?(CharacterAppearanceSetItem(Player,"ItemVulva",t,"#A7806F"),ChatRoomCharacterUpdate(Player)):e&&e.Asset===t&&(InventoryRemove(Player,"ItemVulva"),ChatRoomCharacterUpdate(Player))},null],e.ccage=[e=>{var t;const n=Fw(null!==(t=e[1])&&void 0!==t?t:"");if("string"==typeof n)return void yE(n,1e4);const r=InventoryGet(n.Character,"ItemVulva"),o=AssetGet(n.Character.AssetFamily,"ItemVulva","DoubleEndDildo"),i=AssetGet(n.Character.AssetFamily,"ItemVulva","FuturisticVibrator");r&&r.Asset===o&&"#A7806F"===r.Color&&i?(InventoryRemove(n.Character,"ItemVulva"),n.Character.Appearance.push({Asset:i,Difficulty:20,Color:["#A7806F","Default","Default"],Property:{Mode:"Off",Intensity:-1,Effect:["Egged"],TriggerValues:",".repeat(7)+"",AccessMode:"LockMember"}}),CharacterRefresh(n.Character,!1),ChatRoomCharacterUpdate(n.Character)):r&&r.Asset===i&&zp(r.Color,["#A7806F","Default","Default"])&&o&&(CharacterAppearanceSetItem(n.Character,"ItemVulva",o,"#A7806F"),ChatRoomCharacterUpdate(n.Character))},e=>2===e.length?Ww(e[1]):[]]),Object.keys(e).length>0&&kw("hidden","custom","",(t=>{var n;const r=e[null!==(n=t[0])&&void 0!==n?n:""];return!!r&&(r[0](t),!0)}),(t=>{var n,r,o,i;return 1===t.length?$w(t[0],Object.keys(e)):null!==(i=null===(o=null===(r=e[null!==(n=t[0])&&void 0!==n?n:""])||void 0===r?void 0:r[1])||void 0===o?void 0:o.call(r,t))&&void 0!==i?i:[]}))}}),DA(new class extends Cd{load(){Xb("DialogMenuBCX_Search","Filter items"),Xb("DialogMenuBCX_SearchExit",""),Vb("Icons/BCX_Search.png","Icons/Search.png"),Vb("Icons/BCX_SearchExit.png","Icons/Remove.png"),Zd("DialogMenuButtonBuild",5,((e,t)=>{t(e),Bb()?Lb?(DialogMenuButton=["Exit","BCX_SearchExit"],DialogInventory.length>12&&Fb().push("Next")):Fb().splice(1,0,"BCX_Search"):$b(e[0])})),Kb("BCX_Search",(e=>(Ob(e),!0))),Kb("BCX_SearchExit",(e=>($b(e),!0))),Zd("DialogKeyDown",5,((e,t)=>{const n=e[0];return Lb||!CurrentCharacter||!Bb()||1!==n.key.length||document.activeElement!==MainCanvas.canvas||n.altKey||n.ctrlKey||n.metaKey||!(Pb<=Date.now())&&["a","s"].includes(n.key.toLowerCase())?t(e):(Ob(CurrentCharacter,n.key),Tb=!0,!0)})),Zd("StruggleStrengthDraw",0,((e,t)=>{t(e),Pb=Date.now()+2e3})),Zd("StableGenericDrawProgress",0,((e,t)=>{t(e),Pb=Date.now()+2e3})),Zd("DialogInventoryAdd",5,((e,t)=>{if(Lb){const t=e[1];if(!Lb.value.trim().toLocaleLowerCase().split(" ").every((e=>t.Asset.Description.toLocaleLowerCase().includes(e)||t.Asset.Name.toLocaleLowerCase().includes(e))))return}t(e)})),Zd("DialogDrawItemMenu",0,((e,t)=>{Lb&&ElementPositionFix("BCXSearch",40,1005,25,625,60),t(e)})),Zd("DialogChangeFocusToGroup",0,((e,t)=>{var n;return $b(null!==(n=CharacterGetCurrent())&&void 0!==n?n:Player),t(e)})),Zd("DialogItemClick",0,((e,t)=>{var n;t(e),"permissions"!==DialogMenuMode&&$b(null!==(n=CharacterGetCurrent())&&void 0!==n?n:Player)})),Zd("DialogMenuButtonBuild",10,((e,t)=>{t(e);const n=["Prev","BCX_Search"];for(const e of n){if(Fb().length<=9)break;const t=Fb().indexOf(e);t>=0&&Fb().splice(t,1)}}))}run(){const e=CharacterGetCurrent();e&&(DialogInventoryBuild(e),DialogMenuButtonBuild(e))}unload(){var e,t,n;$b(null!==(e=CharacterGetCurrent())&&void 0!==e?e:Player),DialogInventoryBuild(null!==(t=CharacterGetCurrent())&&void 0!==t?t:Player),DialogMenuButtonBuild(null!==(n=CharacterGetCurrent())&&void 0!==n?n:Player)}}),DA(new class extends Cd{init(){IA("exportimport_export",{name:"Allow exporting BCX module configurations",category:md.ExportImport,defaults:{[hd.dominant]:[!0,xA.self],[hd.switch]:[!0,xA.owner],[hd.submissive]:[!0,xA.mistress],[hd.slave]:[!0,xA.mistress]}})}load(){Jy.sort(((e,t)=>e.module-t.module)),uA.export_import_do_export=(e,t)=>Ed(t)&&"string"==typeof t.category&&Jy.some((e=>e.category===t.category))&&"boolean"==typeof t.compress?function(e,t,n){const r=Jy.find((t=>t.category===e));if(!r)throw new Error(`Unknown export category "${e}"`);if(n&&!TA("exportimport_export",n))throw new Error("Missing the following permission required to export:\nAllow exporting BCX module configurations");let o=JSON.stringify({__bcxExport:1,[e]:r.export(n)});return t&&(o=LZString.compressToBase64(o)),o}(t.category,t.compress,e):void 0,uA.export_import_do_import=(e,t)=>Ed(t)&&"string"==typeof t.category&&Jy.some((e=>e.category===t.category))&&"string"==typeof t.data?function(e,t,n){const r=Jy.find((t=>t.category===e));if(!r)throw new Error(`Unknown import category "${e}"`);let o;t=t.trim();try{if(t&&!t.startsWith("{")){if(!(t=LZString.decompressFromBase64(t)||"")||"string"!=typeof t||!t.startsWith("{"))return"Invalid input: decompression failed";t=t.trim()}o=JSON.parse(t)}catch(e){return`Invalid input: parse error: ${e}`}if(!Ed(o)||"number"!=typeof o.__bcxExport)return"Invalid input: Input is not data exported from BCX";if(1!==o.__bcxExport)return`Unable to load version ${o.__bcxExport} of export, maximum compatible version: 1`;if(void 0===o[e])return`Input doesn't include data for category "${r.name}"\nInput has data for following known categories:\n`+(Object.keys(o).map((e=>{const t=Jy.find((t=>t.category===e));return t?` - ${t.name}\n`:""})).join("")||"[NONE]\n");const i=r.importValidator.safeParse(o[e]);if(!i.success)return`Invalid input:\n${JSON.stringify(i.error.format(),void 0,"\t")}`;if(n){const e=r.importPermissions.filter((e=>!TA(e,n)));if(e.length>0)return"Missing the following permissions required to import:\n"+e.map((e=>{var t,n;return null!==(n=null===(t=HA()[e])||void 0===t?void 0:t.name)&&void 0!==n?n:e})).join("\n")}return r.import(i.data,n)}(t.category,t.data,e):void 0}}),DA(new Uk),DA(new class extends Cd{init(){IA("log_view_normal",{name:"Allow to see normal log entries",category:md.Log,defaults:{[hd.dominant]:[!0,xA.mistress],[hd.switch]:[!0,xA.mistress],[hd.submissive]:[!0,xA.friend],[hd.slave]:[!0,xA.public]}}),IA("log_view_protected",{name:"Allow to see protected log entries",category:md.Log,defaults:{[hd.dominant]:[!0,xA.lover],[hd.switch]:[!0,xA.lover],[hd.submissive]:[!0,xA.mistress],[hd.slave]:[!0,xA.mistress]}}),IA("log_configure",{name:"Allow to configure what is logged",category:md.Log,defaults:{[hd.dominant]:[!0,xA.self],[hd.switch]:[!0,xA.self],[hd.submissive]:[!0,xA.owner],[hd.slave]:[!1,xA.owner]}}),IA("log_delete",{name:"Allow deleting log entries",category:md.Log,defaults:{[hd.dominant]:[!0,xA.self],[hd.switch]:[!0,xA.self],[hd.submissive]:[!0,xA.owner],[hd.slave]:[!1,xA.owner]}}),IA("log_praise",{name:"Allow to praise or scold",category:md.Log,defaults:{[hd.dominant]:[!1,xA.friend],[hd.switch]:[!1,xA.friend],[hd.submissive]:[!1,xA.public],[hd.slave]:[!1,xA.public]}}),IA("log_add_note",{name:"Allow to attach notes to the body",category:md.Log,defaults:{[hd.dominant]:[!1,xA.mistress],[hd.switch]:[!1,xA.mistress],[hd.submissive]:[!1,xA.friend],[hd.slave]:[!1,xA.public]}}),uA.logData=e=>mv(e),uA.logDelete=(e,t)=>"number"==typeof t||Array.isArray(t)&&t.every((e=>"number"==typeof e))?uv(t,e):void 0,uA.logConfigGet=e=>e.isPlayer()||TA("log_configure",e)?yv():void 0,uA.logConfigEdit=(e,t)=>{if(Ed(t)&&"string"==typeof t.category&&"number"==typeof t.target)return dv(t.category,t.target,e);console.warn(`HardCoreClub: Bad logConfigEdit query from ${e}`,t)},uA.logClear=e=>hv(e),uA.logPraise=(e,t)=>{if(Ed(t)&&(null===t.message||"string"==typeof t.message)&&[-1,0,1].includes(t.value))return vv(t.value,t.message,e);console.warn(`HardCoreClub: Bad logPraise query from ${e}`,t)},uA.logGetAllowedActions=e=>gv(e),Aw("modules","log","- Manage the behaviour log",((e,t,n)=>{const r=(e[0]||"").toLocaleLowerCase();if("list"===r){const r=mv(t);if(0===r.length)return n("You have no permission to view the log.");const o=Math.ceil(r.length/5),i=Rd(Number.parseInt(e[1]||"",10)||1,1,o);let a=`Page ${i} / ${o}:`;for(let e=5*(i-1);e<Math.min(5*i,r.length);e++){const t=r[e];a+=`\n[${new Date(t[0]).toUTCString()}] (${t[0]})\n  ${pv(t,VA())}`}n(a)}else if("delete"===r){if(!/^[0-9]+$/.test(e[1]||""))return n("Expected number as timestamp.");const r=Number.parseInt(e[1],10);if(!mv(t).some((e=>e[0]===r)))return n("No such log entry found");n(uv(r,t)?"Ok.":yw)}else if("praise"===r||"scold"===r){if(!TA("log_praise",t))return n(yw);n(vv("praise"===r?1:-1,null,t)?"Ok.":`The command failed to execute, likely because you already did ${r} recently.`)}else{if("config"===r){if(!TA("log_configure",t))return n(yw);const r=e[1]||"",o=yv();if(r){if(void 0===wv[r])return n(`Unknown category "${r}".`);{const o=(e[2]||"").toLocaleLowerCase();return n("yes"!==o&&"protected"!==o&&"no"!==o?"Expected level to be one of:\nno, protected, yes":dv(r,"yes"===o?sv.normal:"protected"===o?sv.protected:sv.none,t)?"Ok.":yw)}}{let e="Current log config:";for(const[t,n]of Object.entries(o))void 0!==wv[t]&&void 0!==Cv[n]&&(e+=`\n[${t}]\n  ${wv[t]}: ${Cv[n]}`);return n(e)}}n(Ow(t,`!log usage:\n!log list [page] - List all visible logs\n!log delete <timestamp> - Deletes the log with the given <timestamp> (the number in parentheses in list)\n!log praise - Note that you praised ${Player.Name} in her log\n!log scold - Note that you scolded ${Player.Name} in her log\n!log config - Shows the current logging settings for ${Player.Name}\n!log config <category> <no|protected|yes> - Sets visibility of the given config <category>`))}}),((e,t)=>{if(e.length<=1){const t=e[0].toLocaleLowerCase();return["list","delete","praise","scold","config"].filter((e=>e.startsWith(t)))}const n=e[0].toLocaleLowerCase();if("delete"===n){if(2===e.length)return mv(t).map((e=>e[0].toString())).filter((t=>t.startsWith(e[1])))}else if("config"===n){if(!TA("log_configure",t))return[];if(2===e.length)return Object.keys(yv()).concat("").filter((t=>t.startsWith(e[1].toLocaleLowerCase())));if(3===e.length)return["no","protected","yes"].filter((t=>t.startsWith(e[2].toLocaleLowerCase())))}return[]})),ev({category:"logConfig",name:"Behaviour Log - Configuration",module:md.Log,export:()=>yv(),import:(e,t)=>{var n;let r="";for(const[o,i]of Object.entries(e)){const e=o;void 0!==(null===(n=tA.logConfig)||void 0===n?void 0:n[e])&&void 0!==wv[e]?dv(e,i,t)||(r+=`Error setting category '${wv[e]}'\n`):r+=`Skipped unknown log config category '${e}'\n`}return r+"Done!"},importPermissions:["log_configure"],importValidator:Oy.record(Oy.nativeEnum(sv))})}load(){if(!AA(md.Log))return delete tA.log,void delete tA.logConfig;if(Array.isArray(tA.log)?tA.log.every((e=>Array.isArray(e)&&4===e.length&&"number"==typeof e[0]&&"number"==typeof e[1]&&"number"==typeof e[2]))||(console.error("HardCoreClub: Some log entries have invalid format, reseting whole log!"),hv(null)):hv(null),tA.logConfig){const e={permissionChange:"permission_change",logConfigChange:"log_config_change",logDeleted:"log_deleted",userNote:"user_note",curseChange:"curse_change",curseTrigger:"curse_trigger",hadOrgasm:"had_orgasm",enteredPublicRoom:"entered_public_room",enteredPrivateRoom:"entered_private_room",ownershipChangesBCX:"authority_roles_change"};for(const t of Object.keys(tA.logConfig))void 0===e[t]?void 0===bv[t]&&(console.info(`HardCoreClub: Removing unknown log config category "${t}"`),delete tA.logConfig[t]):(console.info(`HardCoreClub: Updating log config name "${t}"->"${e[t]}"`),tA.logConfig[e[t]]=tA.logConfig[t],delete tA.logConfig[t]);for(const e of Object.keys(bv))void 0===tA.logConfig[e]&&(console.info(`HardCoreClub: Adding missing log category "${e}"`),tA.logConfig[e]=bv[e])}else tA.logConfig={...bv};Zd("ActivityOrgasmStart",0,((e,t)=>(0!==e[0].ID||"undefined"!=typeof ActivityOrgasmRuined&&ActivityOrgasmRuined||lv("had_orgasm",av.plaintext,`${Player.Name} had an orgasm`),t(e))),md.Log),Zd("ChatRoomSync",0,((e,t)=>{const n=e[0];return n.Private?lv("entered_private_room",av.plaintext,`${Player.Name} entered private room "${n.Name}"`):lv("entered_public_room",av.plaintext,`${Player.Name} entered public room "${n.Name}"`),t(e)}),md.Log)}reload(){Kd(md.Log),this.load()}}),DA(new class extends Cd{load(){Zd("ChatRoomMessage",10,((e,t)=>{const n=e[0];if("Hidden"!==(null==n?void 0:n.Type)||"BCXMsg"!==n.Content||"number"!=typeof n.Sender)return t(e);{if(n.Sender===Player.MemberNumber||rA)return;if(!Ed(n.Dictionary))return void console.warn("HardCoreClub: Hidden message no Dictionary",n);const{type:e,message:t}=n.Dictionary;if("string"==typeof e){const r=lA.get(e);void 0===r?console.warn("HardCoreClub: Hidden message no handler",n.Sender,e,t):r(n.Sender,t)}}})),Zd("ServerAccountBeep",10,((e,t)=>{var n;const r=e[0];if("string"!=typeof(null==r?void 0:r.BeepType)||!["Leash","BCX"].includes(r.BeepType)||!Ed(null===(n=r.Message)||void 0===n?void 0:n.BCX))return t(e);{const{type:e,message:t}=r.Message.BCX;if("string"==typeof e){const n=cA.get(e);void 0===n?console.warn("HardCoreClub: Hidden beep no handler",r.MemberNumber,e,t):n(r.MemberNumber,t)}}}))}unload(){cA.clear(),lA.clear()}}),DA(new class extends Cd{load(){Array.isArray(tA.cheats)?tA.cheats=tA.cheats.filter((e=>void 0!==vd[e])):tA.cheats=[],Zd("InterfaceTextGet",10,((e,t)=>{const n=qb.get(e[0]);return void 0!==n?n:t(e)})),Zd("DrawGetImage",10,((e,t)=>{const n=zb.get(e[0]);return void 0!==n&&(e[0]=n),t(e)})),Zd("DialogMenuButtonClick",5,((e,t)=>{const n=CharacterGetCurrent();for(let e=0;e<Fb().length;e++)if(MouseIn(1885-110*e,15,90,90)&&n){const t=Zb.get(Fb()[e]);if(null==t?void 0:t.some((e=>e(n))))return!0}return t(e)})),Zd("AsylumEntranceCanWander",0,(()=>!0)),Zd("CheatFactor",1,((e,t)=>{const[n,r]=e;return"CantLoseMistress"===n&&Wb(vd.CantLoseMistress)||"BlockRandomKidnap"===n&&Wb(vd.BlockRandomEvents)?r:t(e)})),Zd("PrivateRansomStart",0,((e,t)=>!Wb(vd.BlockRandomEvents)&&t(e))),Zd("MainHallWalk",0,((e,t)=>(Wb(vd.BlockRandomEvents)&&(MainHallRandomEventOdds=0),t(e)))),vE()||(Jd("LoginMistressItems",{'LogQuery("ClubMistress", "Management")':"true"}),Zd("LoginMistressItems",0,((e,t)=>{if(t(e),!Wb(vd.GiveMistressKey)&&!LogQuery("ClubMistress","Management"))for(const e of Ub)InventoryDelete(Player,e,"ItemMisc",!1)})),Hb[vd.GiveMistressKey]=()=>{LoginMistressItems(),ServerPlayerInventorySync()},Jd("LoginStableItems",{'LogQuery("JoinedStable", "PonyExam") || LogQuery("JoinedStable", "TrainerExam")':"true"})),Hb[vd.GivePandoraKey]=e=>{for(const t of Yb)e?InventoryAdd(Player,t,"ItemMisc",!1):InventoryDelete(Player,t,"ItemMisc",!1);ServerPlayerInventorySync()},Zd("InfiltrationStealItems",0,((e,t)=>{t(e),Wb(vd.GivePandoraKey)&&Hb[vd.GivePandoraKey](!0)})),Zd("Player.CanChangeClothesOn",1,((e,t)=>lE&&e[0].IsPlayer()||t(e))),Zd("ChatRoomCanLeave",0,((e,t)=>lE||t(e))),Zd("DrawCharacter",100,((e,t)=>{if(null!=e[0])return t(e)})),Zd("SpeechGarble",100,((e,t)=>(null==e[1]&&(e[1]=""),t(e)))),Zd("ServerPlayerIsInChatRoom",0,((e,t)=>t(e)||"GetUp"===CurrentScreen))}run(){LoginMistressItems(),LoginStableItems(),Wb(vd.GivePandoraKey)&&Hb[vd.GivePandoraKey](!0),ServerPlayerInventorySync()}}),DA(new class extends Cd{init(){uA.disabledModules=()=>kA()}load(){"number"==typeof tA.preset&&void 0!==hd[tA.preset]||(tA.preset=hd.switch),Array.isArray(tA.disabledModules)?tA.disabledModules=tA.disabledModules.filter((e=>gd.includes(e))):tA.disabledModules=[]}run(){rA&&u((()=>{rA&&null===Gk()&&fE("Please visit your profile to finish BCX setup",1/0)}),2e3)}}),DA(new class extends Cd{init(){IA("relationships_view_all",{name:"Allow viewing others in relationship list",category:md.Relationships,defaults:{[hd.dominant]:[!0,xA.self],[hd.switch]:[!0,xA.owner],[hd.submissive]:[!0,xA.mistress],[hd.slave]:[!0,xA.mistress]}}),IA("relationships_modify_self",{name:"Allow changing relationship config for herself",category:md.Relationships,defaults:{[hd.dominant]:[!0,xA.self],[hd.switch]:[!0,xA.owner],[hd.submissive]:[!1,xA.mistress],[hd.slave]:[!1,xA.mistress]}}),IA("relationships_modify_others",{name:"Allow changing relationship config for others",category:md.Relationships,defaults:{[hd.dominant]:[!0,xA.self],[hd.switch]:[!0,xA.owner],[hd.submissive]:[!1,xA.mistress],[hd.slave]:[!1,xA.mistress]}}),uA.relatonshipsGet=e=>{if(!AA(md.Relationships)||!tA.relationships)return;const t=TA("relationships_view_all",e);return{relationships:kp(t?tA.relationships:tA.relationships.filter((t=>t.memberNumber===e.MemberNumber))),access_view_all:t,access_modify_self:TA("relationships_modify_self",e),access_modify_others:t&&TA("relationships_modify_others",e)}},uA.relationshipsRemove=(e,t)=>{if(!AA(md.Relationships)||!tA.relationships||"number"!=typeof t)return;const n=tA.relationships.findIndex((e=>e.memberNumber===t));return n<0||!!TA(e.MemberNumber===t?"relationships_modify_self":"relationships_modify_others",e)&&(tA.relationships.splice(n,1),lv("relationships_change",av.plaintext,`${e} removed the set custom name for ${ME(t,"[unknown name]")} (${t})`),e.isPlayer()||yE(`${e.toNicknamedString()} removed the set custom name for ${xE(t,"[unknown name]")} (${t})`,void 0,e.MemberNumber),sA(),wA(),!0)},uA.relationshipsSet=(e,t)=>{var n;if(!AA(md.Relationships)||!tA.relationships||!Ib(t))return;t=If(t,["memberNumber","nickname","enforceNickname"]);const r=tA.relationships.findIndex((e=>e.memberNumber===t.memberNumber));if(r>=0&&zp(tA.relationships[r],t))return!0;if(!TA(e.MemberNumber===t.memberNumber?"relationships_modify_self":"relationships_modify_others",e))return!1;const o=r>=0?tA.relationships[r]:null;return r>=0?tA.relationships[r]=t:tA.relationships.push(t),(null==o?void 0:o.nickname)!==t.nickname&&(lv("relationships_change",av.plaintext,`${e} changed the custom name for ${ME(t.memberNumber,"[unknown name]")} (${t.memberNumber}) to '${t.nickname}'`),e.isPlayer()||yE(`${e.toNicknamedString()} changed the custom name for character ${t.memberNumber} to '${t.nickname}'`,void 0,e.MemberNumber)),(null!==(n=null==o?void 0:o.enforceNickname)&&void 0!==n&&n)!==t.enforceNickname&&(lv("relationships_change",av.plaintext,`${e} ${t.enforceNickname?"started":"stopped"} custom name enforcement for ${ME(t.memberNumber,"[unknown name]")} (${t.memberNumber})`),e.isPlayer()||yE(`${e.toNicknamedString()} ${t.enforceNickname?"now requires":"no longer requires"} you to only use ${xE(t.memberNumber,"[unknown name]")}'s (${t.memberNumber}) custom name.`,void 0,e.MemberNumber)),sA(),wA(),!0},Ab({allowSend:e=>{if(AA(md.Relationships)&&tA.relationships&&("Chat"===e.type||"Whisper"===e.type)){const t=new Set,n=new Set;for(const e of zA()){const r=tA.relationships.find((t=>t.memberNumber===e.MemberNumber));r&&t.add(r.nickname.toLowerCase()),r&&r.enforceNickname?(n.add(e.Character.Name.toLowerCase()),e.Character.Nickname&&Nb(e.Character.Nickname)&&n.add(e.Character.Nickname.toLowerCase())):(t.add(e.Character.Name.toLowerCase()),e.Character.Nickname&&Nb(e.Character.Nickname)&&t.add(e.Character.Nickname.toLowerCase()))}const r=Array.from(n).find((n=>{var r;return(null!==(r=e.noOOCMessage)&&void 0!==r?r:e.originalMessage).toLocaleLowerCase().match(new RegExp(`([^\\p{L}]|^)${$d(n.trim())}([^\\p{L}]|$)`,"iu"))&&!Array.from(t).some((t=>{var r;return function(e,t){"string"==typeof e&&(e=e.split(" ").map((e=>e.trim())).filter(Boolean)),"string"==typeof t&&(t=t.split(" ").map((e=>e.trim())).filter(Boolean));for(let n=0;n<t.length;n++){let r=!0;for(let o=0;o<e.length;o++)if(n+o>=t.length||e[o]!==t[n+o]){r=!1;break}if(r)return!0}return!1}(n,t)&&(null!==(r=e.noOOCMessage)&&void 0!==r?r:e.originalMessage).toLocaleLowerCase().match(new RegExp(`([^\\p{L}]|^)${$d(t.trim())}([^\\p{L}]|$)`,"iu"))}))}));if(void 0!==r)return yE(`You are not allowed to use the name '${r}'! You need to use the name for her that was given to you!`,7e3),1}return 0}}),ev({category:"relationships",name:"Relationships",module:md.Relationships,export:e=>{var t;if(e&&!TA("relationships_view_all",e))throw new Error("Missing the following permission required to export:\nAllow viewing others in relationship list");return null!==(t=tA.relationships)&&void 0!==t?t:[]},import:(e,t)=>(e=Ky(e,(e=>e.memberNumber)),tA.relationships=e,t&&(lv("relationships_change",av.plaintext,`${t} imported settings for relationships module`),t.isPlayer()||yE(`${t.toNicknamedString()} settings for relationships module`,void 0,t.MemberNumber)),"Done!"),importPermissions:["relationships_view_all","relationships_modify_self","relationships_modify_others"],importValidator:Oy.array(Mb)})}load(){if(!AA(md.Relationships))return void delete tA.relationships;Array.isArray(tA.relationships)||(tA.relationships=[]);const e=new Set;for(let t=0;t<tA.relationships.length;t++){const n=tA.relationships[t];Ib(n)&&!e.has(n.memberNumber)?e.add(n.memberNumber):(tA.relationships.splice(t,1),t--)}let t=!1;Zd("CharacterNickname",4,((e,n)=>{const r=e[0];if(t&&tA.relationships&&r){const e=tA.relationships.find((e=>e.memberNumber===r.MemberNumber));if(e)return e.nickname}return n(e)}),md.Relationships),Zd("ChatRoomRun",0,((e,n)=>{t=!0;const r=n(e);return t=!1,r}),md.Relationships),Zd("ChatRoomMessage",4,((e,n)=>{const r=e[0],o=t;Ed(r)&&["Action","Chat","Whisper","Emote","Activity","ServerMessage"].includes(r.Type)&&tA.relationships&&(t=!0);const i=n(e);return t=o,i})),Zd("CommandParse",0,((e,n)=>{const r=t;ChatRoomTargetMemberNumber>=0&&(t=!0);const o=n(e);return t=r,o}))}reload(){Kd(md.Relationships),this.load()}}),DA(new class extends Cd{constructor(){super(...arguments),this.resetTimer=null,this.triggerCounts=new Map,this.suspendedUntil=null}init(){IA("rules_normal",{name:"Allows controlling non-limited rules",category:md.Rules,defaults:{[hd.dominant]:[!0,xA.lover],[hd.switch]:[!0,xA.lover],[hd.submissive]:[!1,xA.mistress],[hd.slave]:[!1,xA.mistress]}}),IA("rules_limited",{name:"Allows controlling limited rules",category:md.Rules,defaults:{[hd.dominant]:[!0,xA.owner],[hd.switch]:[!0,xA.owner],[hd.submissive]:[!1,xA.lover],[hd.slave]:[!1,xA.lover]}}),IA("rules_global_configuration",{name:"Allows editing the global rules configuration",category:md.Rules,defaults:{[hd.dominant]:[!0,xA.owner],[hd.switch]:[!0,xA.owner],[hd.submissive]:[!1,xA.lover],[hd.slave]:[!1,xA.lover]}}),IA("rules_change_limits",{name:"Allows to limit/block specific rules",category:md.Rules,defaults:{[hd.dominant]:[!0,xA.self],[hd.switch]:[!0,xA.self],[hd.submissive]:[!0,xA.self],[hd.slave]:[!1,xA.owner]}}),IA("rules_view_originator",{name:"Allow to view who added the rule originally",category:md.Rules,defaults:{[hd.dominant]:[!0,xA.self],[hd.switch]:[!0,xA.self],[hd.submissive]:[!0,xA.mistress],[hd.slave]:[!0,xA.mistress]}}),uA.ruleCreate=(e,t)=>nw(t)?function(e,t){var n;if(!AA(md.Rules))return!1;if(t&&!sC("rules",e,t))return!1;const r=ow.get(e);if(!r)throw new Error(`Attempt to create unknown rule '${e}'`);if(!oC("rules",e)){const o={};if(r.dataDefinition){o.customData={};for(const[e,t]of Object.entries(r.dataDefinition))o.customData[e]=kp("function"==typeof t.default?t.default():t.default)}if(r.internalDataDefault&&(o.internalData=r.internalDataDefault(),!(null===(n=r.internalDataValidate)||void 0===n?void 0:n.call(r,o.internalData))))throw new Error(`Failed to create valid internal data for rule '${e}'`);iC("rules",e,o,t),t&&(lv("rule_change",av.plaintext,`${t} added a new rule: ${r.name}`),t.isPlayer()||yE(`${t.toNicknamedString()} gave you a new rule: "${r.name}"`))}return!0}(t,e):void 0,uA.ruleDelete=(e,t)=>nw(t)?pw(t,e):void 0,Aw("modules","rules","- Manage rules",((e,t,n)=>{if(!AA(md.Rules))return n("Rules module is disabled.");const r=(e[0]||"").toLocaleLowerCase(),o=rC("rules",t).conditions;if(pC.includes(r))return vC("rules",e,t,n);if("list"===r){let e="Current rules:";for(const[t,r]of Object.entries(o)){const o=sw(t),i=`Timer: ${r.timer?Td(r.timer-Date.now(),"short"):""}`,a=`\n${o.name} | ${i}`;e.length+a.length>=990&&(e+="\n...",n(e),e="Current rules (continued):"),e+=a}n(e)}else if("listall"===r){let e="All existing rules:";for(const[t]of mw()){const r=`\n${sw(t).name}`;e.length+r.length>=990&&(e+="\n...",n(e),e="All rules (continued):"),e+=r}n(e)}else if("description"===r){const t=hw(e[1]||"");if(!t[0])return n(t[1]);n(sw(t[1]).longDescription.replaceAll("PLAYER_NAME",Player.Name))}else if("remove"===r){const r=hw(e[1]||"");if(!r[0])return n(r[1]);n(pw(r[1],t)?"Ok.":yw)}else n(Ow(t,"!rules usage (page 1):\n!rules list - List the currently added rules\n!rules listall - List all existing rule names in BCX\n!rules description <rule> - Show the rule's description\n!rules remove <rule> - Remove a currently added rule if permitted to\n\nNote: Adding and setting up rules is only supported via using BCX's graphical user interface yourself.")),n(Ow(t,'!rules usage (page 2):\n!rules setactive <rule> <yes/no> - Switch the rule and its conditions on and off\n!rules triggers <rule> global <yes/no> - Set the trigger condition of this rule to the global configuration\n!rules triggers <rule> help - Set the trigger configuration of a rule\n!rules globaltriggers help - Set global trigger configuration\n!rules timer <rule> help - Set timer options of a rule\n!rules defaulttimer help - Set default timer options used on new rules\n!rules setlimit <rule> <normal/limited/blocked> - Set a limit on certain <rule>\n\nHint: If an argument contains spaces: "put it in quotes"'))}),((e,t)=>{if(!AA(md.Rules))return[];if(e.length<=1)return $w(e[0],["list","listall","description","remove",...pC]);const n=e[0].toLocaleLowerCase();return pC.includes(n)?bC("rules",e):[]})),Kw("rules",{category:md.Rules,permission_normal:"rules_normal",permission_limited:"rules_limited",permission_configure:"rules_global_configuration",permission_changeLimits:"rules_change_limits",permission_viewOriginator:"rules_view_originator",loadValidateConditionKey:e=>nw(e),loadValidateCondition:(e,t)=>{const n=t.data,r=ow.get(e);if(!r)return console.error(`HardCoreClub: Bad data for rule ${e}: descriptor not found, removing it`),!1;if(!Ed(n)||void 0!==n.enforce&&!1!==n.enforce||void 0!==n.log&&!1!==n.log)return console.error(`HardCoreClub: Bad data for rule ${e}, removing it`,n),!1;if(r.dataDefinition){Ed(n.customData)||(console.warn(`HardCoreClub: Missing custom data for rule ${e}, fixing`),n.customData={});for(const t of Object.keys(n.customData))r.dataDefinition[t]||(console.warn(`HardCoreClub: Unknown custom data attribute '${t}' for rule ${e}, cleaning up`,n.customData[t]),delete n.customData[t]);for(const[t,o]of Object.entries(r.dataDefinition)){const r=dw[o.type];if(!r)return console.error(`HardCoreClub: Custom data for rule ${e} unknown type ${o.type}, removing it`,n),!1;r.validate(n.customData[t],o)||(console.warn(`HardCoreClub: Bad custom data ${t} for rule ${e}, expected type ${o.type}, replacing with default`,n.customData[t]),n.customData[t]="function"==typeof o.default?o.default():o.default)}}else if(void 0!==n.customData)return console.error(`HardCoreClub: Custom data for rule ${e} without data definition, removing it`,n),!1;if(r.internalDataValidate){if(!r.internalDataValidate(n.internalData)){if(void 0!==n.internalData||!r.internalDataDefault)return console.error(`HardCoreClub: Bad internal data for rule ${e}, removing it`,n),!1;console.warn(`HardCoreClub: Missing internal data for rule ${e}, fixing`),n.internalData=r.internalDataDefault()}}else if(void 0!==n.internalData)return console.error(`HardCoreClub: Internal data for rule ${e} without validator, removing it`,n),!1;return!0},loadCategorySpecificGlobalData:()=>{},stateChangeHandler:this.ruleStateChange.bind(this),tickHandler:this.ruleTick.bind(this),makePublicData:(e,t)=>{var n,r;return{enforce:null===(n=t.data.enforce)||void 0===n||n,log:null===(r=t.data.log)||void 0===r||r,customData:kp(t.data.customData)}},validateCategorySpecificGlobalData:()=>!0,validatePublicData:(e,t)=>Ed(t)&&"boolean"==typeof t.enforce&&"boolean"==typeof t.log&&rw(e,t.customData),updateCondition:(e,t,n)=>(n.enforce?delete t.data.enforce:t.data.enforce=!1,n.log?delete t.data.log:t.data.log=!1,n.customData&&(t.data.customData=kp(n.customData)),!0),parseConditionName:(e,t)=>hw(e,t?e=>t.includes(e):void 0),autocompleteConditionName:(e,t)=>function(e,t){e=e.toLocaleLowerCase();let n=Array.from(ow.entries()).filter((n=>n[1].name.toLocaleLowerCase().startsWith(e)&&(!t||t(n[0])))).map((e=>e[1].name));return 0===n.length&&(n=Array.from(ow.entries()).filter((n=>n[0].toLocaleLowerCase().startsWith(e)&&(!t||t(n[0])))).map((e=>e[0]))),n}(e,t?e=>t.includes(e):void 0),logLimitChange:(e,t,n)=>{const r=sw(e);lv("rule_change",av.plaintext,`${t} changed ${Player.Name}'s '${r.name}' rule permission to ${bd[n]}`),t.isPlayer()||yE(`${t.toNicknamedString()} changed '${r.name}' rule permission to ${bd[n]}`,void 0,t.MemberNumber)},logConditionUpdate:(e,t,n,r)=>{var o,i,a,s,l,c;const u=sw(e),d=u.name,h=n.active!==r.active,m=n.timer!==r.timer||n.timerRemove!==r.timerRemove,p=!zp(n.requirements,r.requirements),f=n.data.enforce!==r.data.enforce,g=n.data.log!==r.data.log,y=[];if(h&&y.push("active state"),m&&y.push("timer"),p&&y.push("trigger condition"),f&&y.push("enforcement"),g&&y.push("logging"),u.dataDefinition)for(const[e,t]of Object.entries(u.dataDefinition))if(!zp(null===(o=r.data.customData)||void 0===o?void 0:o[e],null===(i=n.data.customData)||void 0===i?void 0:i[e])){let e=t.description;e.includes(":")&&(e=e.slice(0,e.lastIndexOf(":"))),y.push(`${y.length>0?"and ":""}the value of the setting '${e}'`)}if(y.length>0&&lv("rule_change",av.plaintext,`${t} changed the ${y.join(", ")} of ${Player.Name}'s '${d}' rule`),!t.isPlayer()){if(h&&yE(`${t.toNicknamedString()} ${n.active?"reactivated":"deactivated"} the '${d}' rule`,void 0,t.MemberNumber),n.timer!==r.timer&&(null===n.timer?yE(`${t.toNicknamedString()} disabled the timer of the '${d}' rule`,void 0,t.MemberNumber):yE(`${t.toNicknamedString()} changed the remaining time of the timer of the '${d}' rule to ${Td(n.timer-Date.now())}`,void 0,t.MemberNumber)),null!==n.timer&&n.timerRemove!==r.timerRemove&&yE(`${t.toNicknamedString()} changed the timer behavior of the '${d}' rule to ${n.timerRemove?"remove":"disable"} the rule when time runs out`,void 0,t.MemberNumber),p)if(null===n.requirements)yE(`${t.toNicknamedString()} set the triggers of '${d}' rule to the global rules configuration`,void 0,t.MemberNumber);else{const e=[],r=n.requirements;if(r.room&&e.push(`When ${r.room.inverted?"not in":"in"} ${r.room.type} room`),r.roomName&&e.push(`When ${r.roomName.inverted?"not in":"in"} room named '${r.roomName.name}'`),r.role){const t=Nd(xA[r.role.role])+(r.role.role!==xA.clubowner?" ":"");e.push(`When ${r.role.inverted?"not in":"in"} room with role '${t}'`)}if(r.player){const t=ME(r.player.memberNumber,null);e.push(`When ${r.player.inverted?"not in":"in"} room with member '${r.player.memberNumber}'${t?` (${t})`:""}`)}e.length>0?yE(`${t.toNicknamedString()} set the '${d}' rule to trigger under following conditions:\n`+e.join("\n"),void 0,t.MemberNumber):yE(`${t.toNicknamedString()} deactivated all trigger conditions of the '${d}' rule. The rule will now always trigger, while it is active`,void 0,t.MemberNumber)}if(f&&yE(`${t.toNicknamedString()} ${n.data.enforce?"enabled enforcement":"stopped enforcement"} of the '${d}' rule`,void 0,t.MemberNumber),g&&yE(`${t.toNicknamedString()} ${n.data.log?"enabled logging":"stopped logging"} of the '${d}' rule`,void 0,t.MemberNumber),u.dataDefinition)for(const[e,o]of Object.entries(u.dataDefinition))zp(null===(a=r.data.customData)||void 0===a?void 0:a[e],null===(s=n.data.customData)||void 0===s?void 0:s[e])||yE(`${t.toNicknamedString()} changed the '${d}' rule's setting '${o.description}' from '${null===(l=r.data.customData)||void 0===l?void 0:l[e]}' to '${null===(c=n.data.customData)||void 0===c?void 0:c[e]}'`,void 0,t.MemberNumber)}},logCategoryUpdate:(e,t,n)=>{const r=t.timer!==n.timer||t.timerRemove!==n.timerRemove,o=!zp(t.requirements,n.requirements),i=[];if(r&&i.push("default timer"),o&&i.push("trigger condition"),i.length>0&&lv("curse_change",av.plaintext,`${e} changed the ${i.join(", ")} of ${Player.Name}'s global rules config`),!e.isPlayer()&&(t.timer!==n.timer&&(null===t.timer?yE(`${e.toNicknamedString()} removed the default timer of the global rules configuration`,void 0,e.MemberNumber):yE(`${e.toNicknamedString()} changed the default timer of the global rules configuration to ${Td(t.timer)}`,void 0,e.MemberNumber)),null!==t.timer&&t.timerRemove!==n.timerRemove&&yE(`${e.toNicknamedString()} changed the default timeout behavior of the global rules configuration to ${t.timerRemove?"removal of rules":"disabling rules"} when time runs out`,void 0,e.MemberNumber),o)){const n=[],r=t.requirements;if(r.room&&n.push(`When ${r.room.inverted?"not in":"in"} ${r.room.type} room`),r.roomName&&n.push(`When ${r.roomName.inverted?"not in":"in"} room named '${r.roomName.name}'`),r.role){const e=Nd(xA[r.role.role])+(r.role.role!==xA.clubowner?" ":"");n.push(`When ${r.role.inverted?"not in":"in"} room with role '${e}'`)}if(r.player){const e=ME(r.player.memberNumber,null);n.push(`When ${r.player.inverted?"not in":"in"} room with member '${r.player.memberNumber}'${e?` (${e})`:""}`)}n.length>0?yE(`${e.toNicknamedString()} set the global rules configuration to trigger rules under following conditions:\n`+n.join("\n"),void 0,e.MemberNumber):yE(`${e.toNicknamedString()} deactivated all trigger conditions for the global rules configuration. Rules set to this default configuration will now always trigger, while active`,void 0,e.MemberNumber)}},getDefaultLimits:()=>{const e={};for(const[t,n]of ow.entries())e[t]=n.defaultLimit;return e},commandConditionSelectorHelp:"rule",currentExportImport:{export(e,t){var n,r;return{enforce:null===(n=t.enforce)||void 0===n||n,log:null===(r=t.log)||void 0===r||r,customData:kp(t.customData)}},import(e,t,n){var r;const o=Oy.object({enforce:Oy.boolean(),log:Oy.boolean(),customData:Oy.record(Oy.any()).optional()}).safeParse(t);if(!o.success)return[!1,JSON.stringify(o.error.format(),void 0,"\t")];const i=o.data,a=ow.get(e);if(!a)return[!1,`Unknown rule '${e}'`];if(!rw(e,i.customData))return[!1,"Invalid rule configuration"];const s=oC("rules",e),l=s?s.data.internalData:null===(r=a.internalDataDefault)||void 0===r?void 0:r.call(a);return a.internalDataValidate&&!a.internalDataValidate(l)?[!1,"Failed to validate internal data"]:[!0,{enforce:!(!i.enforce&&a.enforceable)&&void 0,log:!(!i.log&&a.loggable)&&void 0,customData:i.customData,internalData:l}]},importLog(e,t,n){const r=ow.get(e);n&&r&&(lv("rule_change",av.plaintext,`${n} imported rule '${r.name}'`),n.isPlayer()||yE(`${n.toNicknamedString()} imported the rule '${r.name}'`))},importRemove:(e,t)=>!!pw(e,t)||"Failed."}}),function(){const e=vE();aw("block_remoteuse_self",{name:"Forbid using remotes on self",type:0,shortDescription:"PLAYER_NAME using one on PLAYER_NAME",longDescription:"This rule forbids PLAYER_NAME to use or trigger a vibrator or similar remote controlled item on her own body. (Others still can use remotes on her)",keywords:["controling","preventing","limiting","vibrating","vibrations"],triggerTexts:{infoBeep:"You are not allowed to use a remote control for items on your body!",attempt_log:"PLAYER_NAME tried to use a remote control on her own body, which was forbidden",log:"PLAYER_NAME used a remote control on her own body, which was forbidden"},defaultLimit:bd.normal,load(e){Xb("BCX_RemoteDisabled","Usage blocked by BCX"),Vb("Icons/BCX_Remote.png","Icons/Remote.png"),Zd("DialogMenuButtonBuild",0,((t,n)=>{if(n(t),0===t[0].ID&&e.isEnforced){const e=Fb().indexOf("Remote");e>=0&&(Fb()[e]="BCX_RemoteDisabled")}}),md.Rules),Kb("Remote",(t=>(0===t.ID&&e.inEffect&&e.trigger(),!1))),Kb("BCX_RemoteDisabled",(t=>(0===t.ID&&e.inEffect&&e.triggerAttempt(),!1))),Zd("DialogItemClick",3,((t,n)=>{const r=null!=Player.FocusGroup?Player:CurrentCharacter;if(!r||0!==r.ID||!e.isEnforced||"VibratorRemote"!==t[0].Asset.Name)return r&&0===r.ID&&e.isLogged&&"VibratorRemote"===t[0].Asset.Name&&e.trigger(),n(t);e.triggerAttempt()}),md.Rules)}}),aw("block_remoteuse_others",{name:"Forbid using remotes on others",type:0,longDescription:"This rule forbids PLAYER_NAME to use or trigger a vibrator or similar remote controlled item on other club members.",keywords:["controling","preventing","limiting","vibrating","vibrations"],triggerTexts:{infoBeep:"You are not allowed to use a remote control on other's items!",attempt_log:"PLAYER_NAME tried to use a remote control on TARGET_PLAYER's body, which was forbidden",log:"PLAYER_NAME used a remote control on TARGET_PLAYER's body, which was forbidden"},defaultLimit:bd.normal,load(e){Xb("BCX_RemoteDisabled","Usage blocked by BCX"),Vb("Icons/BCX_Remote.png","Icons/Remote.png"),Zd("DialogMenuButtonBuild",0,((t,n)=>{if(n(t),0!==t[0].ID&&e.isEnforced){const e=Fb().indexOf("Remote");e>=0&&(Fb()[e]="BCX_RemoteDisabled")}}),md.Rules),Kb("Remote",(t=>(0!==t.ID&&e.inEffect&&e.trigger(t.MemberNumber),!1))),Kb("BCX_RemoteDisabled",(t=>(0!==t.ID&&e.inEffect&&e.triggerAttempt(t.MemberNumber),!1))),Zd("DialogItemClick",3,((t,n)=>{const r=null!=Player.FocusGroup?Player:CurrentCharacter;if(!r||0===r.ID||!e.isEnforced||"VibratorRemote"!==t[0].Asset.Name)return r&&0!==r.ID&&e.isLogged&&"VibratorRemote"===t[0].Asset.Name&&e.trigger(r.MemberNumber),n(t);e.triggerAttempt(r.MemberNumber)}),md.Rules)}}),aw("block_keyuse_self",{name:"Forbid using keys on self",type:0,shortDescription:"PLAYER_NAME using one on PLAYER_NAME",longDescription:"This rule forbids PLAYER_NAME to unlock any locked item on her own body. Note: Despite the name, this rule also blocks unlocking locks that don't require a key (e.g. exclusive lock). However, locks that can be unlocked in other ways (timer locks by removing time, code/password locks by entering correct code) can still be unlocked by PLAYER_NAME. Others can still unlock her items on her normally.",keywords:["controling","taking","away","limiting","confiscate","locks"],triggerTexts:{infoBeep:"You are not allowed to use a key on items on your body!",attempt_log:"PLAYER_NAME tried to use a key on a worn item, which was forbidden",log:"PLAYER_NAME used a key on a worn item, which was forbidden"},defaultLimit:bd.normal,load(e){Xb("BCX_UnlockDisabled","Usage blocked by BCX"),Vb("Icons/BCX_Unlock.png","Icons/Unlock.png"),Zd("DialogCanUnlock",0,((t,n)=>(0!==t[0].ID||!e.isEnforced)&&n(t)),md.Rules),Zd("DialogMenuButtonBuild",0,((t,n)=>{n(t),0===t[0].ID&&e.isEnforced&&Fb().includes("InspectLock")&&Fb().splice(-1,0,"BCX_UnlockDisabled")}),md.Rules),Kb("Unlock",(t=>(0===t.ID&&e.inEffect&&e.trigger(),!1))),Kb("BCX_UnlockDisabled",(t=>(0===t.ID&&e.inEffect&&e.triggerAttempt(),!1)))}}),aw("block_keyuse_others",{name:"Forbid using keys on others",type:0,longDescription:"This rule forbids PLAYER_NAME to unlock any locked item on other club members, with options to still allow unlocking of owner and/or lover locks and items. Note: Despite the name, this rule also blocks unlocking locks that don't require a key (e.g. exclusive lock). However, locks that can be unlocked in other ways (timer locks by removing time, code/password locks by entering correct code) can still be unlocked by PLAYER_NAME.",keywords:["controling","taking","away","limiting","confiscate","locks"],triggerTexts:{infoBeep:"You are not allowed to use a key on other's items!",attempt_log:"PLAYER_NAME tried to use a key to unlock TARGET_PLAYER's item, which was forbidden",log:"PLAYER_NAME used a key to unlock TARGET_PLAYER's item, which was forbidden"},defaultLimit:bd.normal,dataDefinition:{allowOwnerLocks:{type:"toggle",default:!1,description:"Still allow unlocking owner locks or items"},allowLoverLocks:{type:"toggle",default:!1,description:"Still allow unlocking lover locks or items",Y:530}},load(e){let t=!1;Xb("BCX_UnlockDisabled","Usage blocked by BCX"),Vb("Icons/BCX_Unlock.png","Icons/Unlock.png"),Zd("DialogCanUnlock",0,((n,r)=>{const o=n[0],i=n[1],a=InventoryGetLock(i);return e.customData&&0!==o.ID&&null!=i&&null!=i.Asset&&(e.customData.allowOwnerLocks&&(i.Asset.OwnerOnly||(null==a?void 0:a.Asset.OwnerOnly))&&o.IsOwnedByPlayer()||e.customData.allowLoverLocks&&(i.Asset.LoverOnly||(null==a?void 0:a.Asset.LoverOnly))&&o.IsLoverOfPlayer())?(t=!0,r(n)):(t=!1,(0===o.ID||!e.isEnforced)&&r(n))}),md.Rules),Zd("DialogMenuButtonBuild",0,((n,r)=>{r(n),t||0!==n[0].ID&&e.isEnforced&&Fb().includes("InspectLock")&&Fb().splice(-1,0,"BCX_UnlockDisabled")}),md.Rules),Kb("Unlock",(n=>(!t&&0!==n.ID&&e.inEffect&&e.trigger(n.MemberNumber),!1))),Kb("BCX_UnlockDisabled",(n=>(!t&&0!==n.ID&&e.inEffect&&e.triggerAttempt(n.MemberNumber),!1)))}}),aw("block_lockpicking_self",{name:"Forbid picking locks on self",type:0,shortDescription:"PLAYER_NAME picking one on PLAYER_NAME",longDescription:"This rule forbids PLAYER_NAME to lockpick any locked items on her own body. (Others still can pick locks on her normally)",keywords:["controling","limiting","secure","security"],triggerTexts:{infoBeep:"You are not allowed to lockpick worn items on your body!",attempt_log:"PLAYER_NAME tried to lockpick a worn item, which was forbidden",log:"PLAYER_NAME lockpicked a worn item, which was forbidden"},defaultLimit:bd.normal,load(e){Xb("BCX_PickLockDisabled","Usage blocked by BCX"),Vb("Icons/BCX_PickLock.png","Icons/PickLock.png"),Zd("DialogMenuButtonBuild",0,((t,n)=>{if(n(t),0===t[0].ID&&e.isEnforced){const e=Fb().indexOf("PickLock");e>=0&&(Fb()[e]="BCX_PickLockDisabled")}}),md.Rules),Kb("PickLock",(t=>(0===t.ID&&e.inEffect&&e.trigger(),!1))),Kb("BCX_PickLockDisabled",(t=>(0===t.ID&&e.inEffect&&e.triggerAttempt(),!1)))}}),aw("block_lockpicking_others",{name:"Forbid picking locks on others",type:0,longDescription:"This rule forbids PLAYER_NAME to lockpick any locked items on other club members.",keywords:["controling","limiting","secure","security"],triggerTexts:{infoBeep:"You are not allowed to lockpick items on others!",attempt_log:"PLAYER_NAME tried to lockpick an item on TARGET_PLAYER, which was forbidden",log:"PLAYER_NAME lockpicked an item on TARGET_PLAYER, which was forbidden"},defaultLimit:bd.normal,load(e){Xb("BCX_PickLockDisabled","Usage blocked by BCX"),Vb("Icons/BCX_PickLock.png","Icons/PickLock.png"),Zd("DialogMenuButtonBuild",0,((t,n)=>{if(n(t),0!==t[0].ID&&e.isEnforced){const e=Fb().indexOf("PickLock");e>=0&&(Fb()[e]="BCX_PickLockDisabled")}}),md.Rules),Kb("PickLock",(t=>(0!==t.ID&&e.inEffect&&e.trigger(t.MemberNumber),!1))),Kb("BCX_PickLockDisabled",(t=>(0!==t.ID&&e.inEffect&&e.triggerAttempt(t.MemberNumber),!1)))}}),aw("block_lockuse_self",{name:"Forbid using locks on self",type:0,shortDescription:"PLAYER_NAME using one on PLAYER_NAME",longDescription:"This rule forbids PLAYER_NAME to use any kind of lock on her own body. (Others still can add locks on her items normally)",keywords:["controling","limiting","locking","preventing"],triggerTexts:{infoBeep:"You are not allowed to lock items on your body!",attempt_log:"PLAYER_NAME tried to lock a worn item, which was forbidden",log:"PLAYER_NAME locked a worn item, which was forbidden"},defaultLimit:bd.normal,load(e){Xb("BCX_LockDisabled","Usage blocked by BCX"),Vb("Icons/BCX_Lock.png","Icons/Lock.png"),Zd("DialogMenuButtonBuild",0,((t,n)=>{if(n(t),0===t[0].ID&&e.isEnforced){const e=Fb().indexOf("Lock");e>=0&&(Fb()[e]="BCX_LockDisabled")}}),md.Rules),Kb("Lock",(t=>(0===t.ID&&e.inEffect&&e.trigger(),!1))),Kb("BCX_LockDisabled",(t=>(0===t.ID&&e.inEffect&&e.triggerAttempt(),!1)))}}),aw("block_lockuse_others",{name:"Forbid using locks on others",type:0,longDescription:"This rule forbids PLAYER_NAME to use any kind of lock on other club members.",keywords:["controling","limiting","locking","preventing"],triggerTexts:{infoBeep:"You are not allowed to lock other's items!",attempt_log:"PLAYER_NAME tried to lock TARGET_PLAYER's item, which was forbidden",log:"PLAYER_NAME locked TARGET_PLAYER's item, which was forbidden"},defaultLimit:bd.normal,load(e){Xb("BCX_LockDisabled","Usage blocked by BCX"),Vb("Icons/BCX_Lock.png","Icons/Lock.png"),Zd("DialogMenuButtonBuild",0,((t,n)=>{if(n(t),0!==t[0].ID&&e.isEnforced){const e=Fb().indexOf("Lock");e>=0&&(Fb()[e]="BCX_LockDisabled")}}),md.Rules),Kb("Lock",(t=>(0!==t.ID&&e.inEffect&&e.trigger(t.MemberNumber),!1))),Kb("BCX_LockDisabled",(t=>(0!==t.ID&&e.inEffect&&e.triggerAttempt(t.MemberNumber),!1)))}}),aw("block_wardrobe_access_self",{name:"Forbid wardrobe use on self",type:0,shortDescription:"PLAYER_NAME using PLAYER_NAME's wardrobe",longDescription:"This rule forbids PLAYER_NAME to access her own wardrobe. (Others still can change her clothes normally)",keywords:["controling","limiting","clothings","preventing","changing"],triggerTexts:{infoBeep:"You are not allowed to change what you are wearing!",attempt_log:"PLAYER_NAME tried to use their wardrobe, which was forbidden",log:"PLAYER_NAME used their wardrobe, which was forbidden"},defaultLimit:bd.normal,load(e){Zd("Player.CanChangeClothesOn",2,((t,n)=>(!t[0].IsPlayer()||!e.isEnforced)&&n(t)),md.Rules),Zd("CharacterAppearanceLoadCharacter",0,((t,n)=>(0===t[0].ID&&e.inEffect&&e.trigger(),n(t))),md.Rules)}}),aw("block_wardrobe_access_others",{name:"Forbid wardrobe use on others",type:0,longDescription:"This rule forbids PLAYER_NAME to use the wardrobe of other club members.",keywords:["controling","limiting","clothings","preventing","changing"],triggerTexts:{infoBeep:"You are not allowed to change what others wear!",attempt_log:"PLAYER_NAME tried to use TARGET_PLAYER's wardrobe, which was forbidden",log:"PLAYER_NAME used TARGET_PLAYER's wardrobe, which was forbidden"},defaultLimit:bd.normal,load(e){Zd("Player.CanChangeClothesOn",2,((t,n)=>!(!t[0].IsPlayer()&&e.isEnforced)&&n(t)),md.Rules),Zd("CharacterAppearanceLoadCharacter",0,((t,n)=>(0!==t[0].ID&&e.inEffect&&e.trigger(),n(t))),md.Rules)}}),aw("block_restrict_allowed_poses",{name:"Restrict allowed body poses",type:0,loggable:!1,longDescription:"Allows to restrict the body poses PLAYER_NAME is able to get into by herself.",keywords:["controling","limiting","preventing","changing"],defaultLimit:bd.normal,dataDefinition:{poseButtons:{type:"poseSelect",default:[],description:"Mark poses as being allowed or forbidden:"}},load(e){Zd("PoseCanChangeUnaidedStatus",0,(([t,n,...r],o)=>{var i;const a=o([t,n,...r]);return(null==t?void 0:t.IsPlayer())&&e.isEnforced&&(null===(i=e.customData)||void 0===i?void 0:i.poseButtons.includes(n))?Math.min(a,PoseChangeStatus.NEVER_WITHOUT_AID):a}),md.Rules)}}),aw("block_creating_rooms",{name:"Forbid creating new rooms",type:0,longDescription:"This rule forbids PLAYER_NAME to create new rooms.",keywords:["controling","limiting","preventing"],triggerTexts:{infoBeep:"You are not allowed to create a new room!",attempt_log:"PLAYER_NAME tried to create a chatroom, which was forbidden",log:"PLAYER_NAME created a chatroom, which was forbidden",announce:"",attempt_announce:""},defaultLimit:bd.blocked,load(t){e||Zd("ChatSearchRun",0,((e,n)=>{n(e),t.isEnforced&&""===ChatSearchMode&&DrawButton(1685,885,90,90,"","Gray","Icons/Plus.png",TextGet("CreateRoom")+"(Blocked by BCX)",!0)}),md.Rules),Zd("CommonSetScreen",5,((e,n)=>{if("Online"===e[0]&&"ChatCreate"===e[1]){if(t.isEnforced)return void t.triggerAttempt();t.inEffect&&t.trigger()}n(e)}),md.Rules)}}),aw("block_entering_rooms",{name:"Restrict entering rooms",type:0,shortDescription:"only allow entering specific ones",longDescription:'This rule forbids PLAYER_NAME to enter all rooms, that are not on an editable whitelist of still allowed ones. NOTE: As safety measure this rule is not in effect while the list is empty. TIP: This rule can be combined with the rule "Forbid creating new rooms".',keywords:["controling","limiting","preventing","entry"],triggerTexts:{infoBeep:"You are not allowed to enter this room!",attempt_log:"PLAYER_NAME tried to enter a forbidden room",log:"PLAYER_NAME entered a forbidden room",attempt_announce:"",announce:"PLAYER_NAME violated a rule to not enter this room"},defaultLimit:bd.blocked,dataDefinition:{roomList:{type:"stringList",default:[],description:"Only joining rooms with these names is allowed:"}},load(t){e||(Zd("ChatSearchJoin",5,((e,n)=>{if(t.inEffect&&t.customData&&t.customData.roomList.length>0){let e=25,n=25;for(let r=ChatSearchResultOffset;r<ChatSearchResult.length&&r<ChatSearchResultOffset+24;r++){if(MouseIn(e,n,630,85)&&!t.customData.roomList.some((e=>e.toLocaleLowerCase()===ChatSearchResult[r].Name.toLocaleLowerCase()))){if(t.isEnforced)return void t.triggerAttempt();t.trigger()}e+=660,e>1500&&(e=25,n+=109)}}n(e)}),md.Rules),Zd("ChatSearchNormalDraw",5,((e,n)=>{if(n(e),t.isEnforced&&t.customData&&t.customData.roomList.length>0){let e=25,n=25;for(let r=ChatSearchResultOffset;r<ChatSearchResult.length&&r<ChatSearchResultOffset+24;r++)t.customData.roomList.some((e=>e.toLocaleLowerCase()===ChatSearchResult[r].Name.toLocaleLowerCase()))||(DrawButton(e,n,630,85,"","#88c",void 0,"Blocked by BCX",!0),DrawTextFit((null!=ChatSearchResult[r].Friends&&ChatSearchResult[r].Friends.length>0?"("+ChatSearchResult[r].Friends.length+") ":"")+ChatSearchMuffle(ChatSearchResult[r].Name)+" - "+ChatSearchMuffle(ChatSearchResult[r].Creator)+" "+ChatSearchResult[r].MemberCount+"/"+ChatSearchResult[r].MemberLimit,e+315,n+25,620,"black"),DrawTextFit(ChatSearchMuffle(ChatSearchResult[r].Description),e+315,n+62,620,"black")),e+=660,e>1500&&(e=25,n+=109)}}),md.Rules))}}),aw("block_leaving_room",{name:"Prevent leaving the room",type:0,loggable:!1,shortDescription:"while defined roles are inside",longDescription:"This rule prevents PLAYER_NAME from leaving the room they are currently inside while at least one character with the set minimum role or a higher one is present inside. NOTE: Careful when setting the minimum role too low. If it is set to public for instance, it would mean that PLAYER_NAME can only leave the room when they are alone in it.",keywords:["controling","limiting","stopping","exiting"],triggerTexts:{infoBeep:"Someone's presence does not allowed you to leave!",attempt_announce:"PLAYER_NAME violated a rule by trying to leave this room"},defaultLimit:bd.blocked,dataDefinition:{minimumRole:{type:"roleSelector",default:xA.mistress,description:"Minimum role preventing room leaving:",Y:320}},load(e){const t=()=>e.isEnforced&&!!e.customData&&zA().some((t=>!t.isPlayer()&&RA(t)<=e.customData.minimumRole));Zd("ChatRoomCanLeave",6,((e,n)=>!t()&&n(e)),md.Rules),Zd("ChatRoomMenuClick",6,((n,r)=>{const o=870/(ChatRoomMenuButtons.length-1);for(let n=0;n<ChatRoomMenuButtons.length;n++)MouseXIn(1005+o*n,120)&&"Exit"===ChatRoomMenuButtons[n]&&t()&&e.triggerAttempt();return r(n)}),md.Rules)}}),aw("block_freeing_self",{name:"Forbid freeing self",type:0,shortDescription:"PLAYER_NAME removing any items from PLAYER_NAME's body",longDescription:"This rule forbids PLAYER_NAME to remove any items from her own body. Other people can still remove them. The rule has a toggle to optionally still allow to remove items which were given a low difficulty score by the original asset maker, such as hand-held items, plushies, etc. This means that custom crafted properties given to an item such as 'decoy' are not factored in.",keywords:["limiting","untying","unbinding","bondage"],triggerTexts:{infoBeep:"You are not allowed to remove an item from your body!",attempt_log:"PLAYER_NAME tried to remove a worn item, which was forbidden",log:"PLAYER_NAME removed a worn item, which was forbidden"},defaultLimit:bd.normal,dataDefinition:{allowEasyItemsToggle:{type:"toggle",default:!1,description:"Still allow removing low difficulty items"}},load(e){let t=999;Xb("BCX_RemoveDisabled","Usage blocked by BCX"),Xb("BCX_StruggleDisabled","Usage blocked by BCX"),Xb("BCX_DismountDisabled","Usage blocked by BCX"),Xb("BCX_EscapeDisabled","Usage blocked by BCX"),Vb("Icons/BCX_Remove.png","Icons/Remove.png"),Vb("Icons/BCX_Struggle.png","Icons/Struggle.png"),Vb("Icons/BCX_Dismount.png","Icons/Dismount.png"),Vb("Icons/BCX_Escape.png","Icons/Escape.png"),Zd("DialogMenuButtonBuild",0,((n,r)=>{var o,i,a;r(n);const s=n[0];if(0===s.ID&&s.FocusGroup&&e.isEnforced){const n=InventoryGet(s,s.FocusGroup.Name);if(n&&(null===(o=e.customData)||void 0===o?void 0:o.allowEasyItemsToggle)&&(t=(null!==(i=n.Asset.Difficulty)&&void 0!==i?i:0)+("number"==typeof(null===(a=n.Property)||void 0===a?void 0:a.Difficulty)?n.Property.Difficulty:0),t<=1))return;const r=Fb().indexOf("Remove"),l=Fb().indexOf("Struggle"),c=Fb().indexOf("Dismount"),u=Fb().indexOf("Escape");r>=0&&(Fb()[r]="BCX_RemoveDisabled"),l>=0&&(Fb()[l]="BCX_StruggleDisabled"),c>=0&&(Fb()[c]="BCX_DismountDisabled"),u>=0&&(Fb()[u]="BCX_EscapeDisabled")}}),md.Rules);const n=n=>(0===n.ID&&e.inEffect&&t>1&&e.trigger(),!1),r=n=>(0===n.ID&&e.inEffect&&t>1&&e.triggerAttempt(),!1);Kb("Remove",n),Kb("BCX_RemoveDisabled",r),Kb("Struggle",n),Kb("BCX_StruggleDisabled",r),Kb("Dismount",n),Kb("BCX_DismountDisabled",r),Kb("Escape",n),Kb("BCX_EscapeDisabled",r)}}),aw("block_tying_others",{name:"Forbid tying up others",type:0,shortDescription:"either everybody or only more dominant characters",longDescription:"This rule forbids PLAYER_NAME to use any items on other characters. Can be set to only affect using items on characters with a higher dominant / lower submissive score than PLAYER_NAME has.",keywords:["limiting","prevent","restraints","bondage"],triggerTexts:{infoBeep:"You are not allowed to use an item on TARGET_PLAYER!",attempt_log:"PLAYER_NAME tried to use an item on TARGET_PLAYER, which was forbidden",log:"PLAYER_NAME used an item on TARGET_PLAYER, which was forbidden"},defaultLimit:bd.normal,dataDefinition:{onlyMoreDominantsToggle:{type:"toggle",default:!0,description:"Only forbid tying people with higher dominance"}},load(e){Zd("DialogItemClick",5,((t,n)=>{if(e.inEffect&&e.customData){const t=e.customData.onlyMoreDominantsToggle,n=null!=Player.FocusGroup?Player:CurrentCharacter;if(n&&0!==n.ID&&(!t||ReputationCharacterGet(Player,"Dominant")<ReputationCharacterGet(n,"Dominant"))){if(e.isEnforced)return void e.triggerAttempt(n.MemberNumber);e.trigger(n.MemberNumber)}}n(t)}),md.Rules),Zd("AppearanceGetPreviewImageColor",5,((t,n)=>{var r;const o=null===(r=e.customData)||void 0===r?void 0:r.onlyMoreDominantsToggle,i=t[0];return i&&0!==i.ID&&e.isEnforced&&(!o||ReputationCharacterGet(Player,"Dominant")<ReputationCharacterGet(i,"Dominant"))?"grey":n(t)}),md.Rules)}}),aw("block_blacklisting",{name:"Prevent blacklisting",type:0,loggable:!1,shortDescription:"and ghosting of the defined roles",longDescription:"This rule prevents PLAYER_NAME from adding characters with the set minimum role or a higher one to their bondage club blacklist and ghostlist.",keywords:["limiting"],triggerTexts:{infoBeep:"You are not allowed to blacklist/ghost this person!",attempt_announce:"PLAYER_NAME violated a rule by trying to blacklist TARGET_PLAYER"},defaultLimit:bd.blocked,dataDefinition:{minimumRole:{type:"roleSelector",default:xA.mistress,description:"Minimum role forbidden to blacklist:",Y:320}},load(t){e||Zd("ChatRoomListUpdate",6,((e,n)=>{const r=parseInt(e[2],10);if(!(t.isEnforced&&t.customData&&(e[0]===Player.BlackList||e[0]===Player.GhostList)&&e[1]&&"number"==typeof r&&RA(r)<=t.customData.minimumRole))return n(e);t.triggerAttempt(r)}),md.Rules)}}),aw("block_whitelisting",{name:"Prevent whitelisting",type:0,loggable:!1,shortDescription:"of roles 'friend' or 'public'",longDescription:"This rule prevents PLAYER_NAME from adding characters with a role lower than a BCX Mistress to their bondage club whitelist.",keywords:["limiting"],triggerTexts:{infoBeep:"You are not allowed to whitelist this person!",attempt_announce:"PLAYER_NAME violated a rule by trying to whitelist TARGET_PLAYER"},defaultLimit:bd.blocked,load(t){e||Zd("ChatRoomListUpdate",6,((e,n)=>{const r=parseInt(e[2],10);if(!(t.isEnforced&&e[0]===Player.WhiteList&&e[1]&&"number"==typeof r&&RA(r)>xA.mistress))return n(e);t.triggerAttempt(r)}),md.Rules)}}),aw("block_antiblind",{name:"Forbid the antiblind command",type:0,shortDescription:"BCX's .antiblind command",longDescription:"This rule forbids PLAYER_NAME to use the antiblind command. Antiblind is a BCX feature that enables a BCX user to see the whole chat room and all other characters at all times, even when wearing a blinding item. If PLAYER_NAME should be forbidden to use the command, this rule should be used.",keywords:["limiting","preventing","controling"],triggerTexts:{infoBeep:"You are not allowed to use the antiblind command!",attempt_log:"PLAYER_NAME tried to use the antiblind command",log:"PLAYER_NAME used the antiblind command"},defaultLimit:bd.normal}),aw("block_difficulty_change",{name:"Forbid changing difficulty",type:0,shortDescription:"multiplayer difficulty preference",longDescription:"This rule forbids PLAYER_NAME to change her Bondage Club multiplayer difficulty, regardless of the current value.",keywords:["limiting","preventing","controling"],triggerTexts:{infoBeep:"You are not allowed to change your difficulty!",attempt_log:"PLAYER_NAME tried to change her multiplayer difficulty",log:"PLAYER_NAME changed her multiplayer difficulty"},defaultLimit:bd.blocked,load(e){Zd("PreferenceSubscreenDifficultyRun",5,((t,n)=>{var r,o;n(t);const i="number"!=typeof(null===(r=null===Player||void 0===Player?void 0:Player.Difficulty)||void 0===r?void 0:r.LastChange)?null!==(o=Player.Creation)&&void 0!==o?o:0:Player.Difficulty.LastChange;e.isEnforced&&null!=PreferenceDifficultyLevel&&PreferenceDifficultyLevel!==Player.GetDifficulty()&&(PreferenceDifficultyLevel<=1||i+6048e5<CurrentTime)&&PreferenceDifficultyAccept&&DrawButton(500,825,300,64,TextGet("DifficultyChangeMode")+" "+TextGet(`DifficultyLevel${PreferenceDifficultyLevel}`),"#88c",void 0,"Blocked by BCX",!0)})),Zd("PreferenceSubscreenDifficultyClick",5,((t,n)=>{var r,o;const i="number"!=typeof(null===(r=null===Player||void 0===Player?void 0:Player.Difficulty)||void 0===r?void 0:r.LastChange)?null!==(o=Player.Creation)&&void 0!==o?o:0:Player.Difficulty.LastChange;if(e.inEffect&&null!=PreferenceDifficultyLevel&&PreferenceDifficultyLevel!==Player.GetDifficulty()&&(PreferenceDifficultyLevel<=1||i+6048e5<CurrentTime)&&PreferenceDifficultyAccept&&MouseIn(500,825,300,64)){if(e.isEnforced)return void e.triggerAttempt();e.trigger()}n(t)}))}}),aw("block_activities",{name:"Prevent usage of all activities",type:0,loggable:!1,shortDescription:"any action buttons such as kissing or groping",longDescription:"This rule forbids PLAYER_NAME to use any (sexual) activities in chat rooms. Other players can still use activities on her, as this rules does not block the arousal & sexual activities system itself, as forcing the according BC setting would.",keywords:["limiting","forbid","controling"],defaultLimit:bd.blocked,load(e){Xb("BCX_ActivityDisabled","Usage blocked by BCX"),Vb("Icons/BCX_Activity.png","Icons/Activity.png"),Zd("DialogMenuButtonBuild",0,((t,n)=>{if(n(t),e.isEnforced){const e=Fb().indexOf("Activity");e>=0&&(Fb()[e]="BCX_ActivityDisabled")}}),md.Rules)}}),aw("block_mainhall_maidrescue",{name:"Forbid mainhall maid services",loggable:!1,type:0,shortDescription:"to get out of any restraints",longDescription:"This rule forbids PLAYER_NAME to use a maid's help to get out of restraints in the club's main hall. Recommended to combine with the rule: 'Force 'Cannot enter single-player rooms when restrained' (Existing BC setting)' to prevent NPCs in other rooms from helping.",keywords:["limiting","preventing","controling"],defaultLimit:bd.normal,load(e){Zd("LogValue",5,((t,n)=>e.isEnforced&&"MaidsDisabled"===t[0]&&"Maid"===t[1]?CurrentTime+5e8:n(t)),md.Rules),Zd("MainHallMaidsDisabledBegForMore",5,((t,n)=>!e.isEnforced&&n(t)),md.Rules)}}),aw("block_action",{name:"Forbid the action command",type:0,shortDescription:"BCX's .action/.a chat command",longDescription:"This rule forbids PLAYER_NAME to use the action command. Action is a BCX feature that enables to format a message to look like a BC chat action. If PLAYER_NAME should be forbidden to use the command to communicate, this rule should be used.",keywords:["limiting","preventing","controling"],triggerTexts:{infoBeep:"You are not allowed to use the action command!",attempt_log:"PLAYER_NAME tried to use the action command",log:"PLAYER_NAME used the action command"},defaultLimit:bd.blocked}),aw("block_BCX_permissions",{name:"Prevent using BCX permissions",loggable:!1,type:0,shortDescription:"PLAYER_NAME using her permissions for her own BCX, with some exceptions",longDescription:"This rule forbids PLAYER_NAME access to some parts of their own BCX they have permission to use, making it as if they do not have 'self access' (see BCX tutorial on permission system) while the rule is active. This rule still leaves access for all permissions where the lowest permitted role ('lowest access') is also set to PLAYER_NAME (to prevent getting stuck). This rule does not affect PLAYER_NAME's permissions to use another users's BCX.",keywords:["limiting","preventing","controlling","accessing","self","rights"],defaultLimit:bd.blocked}),aw("block_room_admin_UI",{name:"Forbid looking at room admin UI",type:0,loggable:!1,shortDescription:"while blindfolded",longDescription:"This rule forbids PLAYER_NAME from opening the room admin screen while blindfolded, as this discloses the room background and the member numbers of admins, potentially in the room right now. If PLAYER_NAME is a room admin, she can still use chat commands for altering the room or kicking/banning.",keywords:["limiting","preventing","controling","seeing"],triggerTexts:{infoBeep:"A BCX rule prevents you from using this while unable to see!"},defaultLimit:bd.normal,load(e){const t=()=>e.isEnforced&&Player.IsBlind();Zd("ChatRoomMenuDraw",6,((e,n)=>{n(e);const r=870/(ChatRoomMenuButtons.length-1);for(let e=0;e<ChatRoomMenuButtons.length;e++){const n=ChatRoomMenuButtons[e];"RoomAdmin"===n&&t()&&DrawButton(1005+r*e,2,120,60,"","Pink","Icons/Rectangle/"+n+".png",TextGet("Menu"+n))}}),md.Rules),Zd("ChatRoomMenuClick",6,((n,r)=>{const o=870/(ChatRoomMenuButtons.length-1);for(let n=0;n<ChatRoomMenuButtons.length;n++)if(MouseXIn(1005+o*n,120)&&"RoomAdmin"===ChatRoomMenuButtons[n]&&t())return e.triggerAttempt(),!1;return r(n)}),md.Rules)}}),aw("block_using_ggts",{name:"Forbid using GGTS",type:0,shortDescription:"training by GGTS is forbidden",longDescription:"This rule forbids PLAYER_NAME to revieve training by the base club's GGTS feature. If the rule is enforced while PLAYER_NAME has remaining GGTS training time, it is removed the moment PLAYER_NAME enters the GGTS room.",keywords:["limiting","preventing","controling"],triggerTexts:{infoBeep:"You are not allowed to recieve training by GGTS!",attempt_log:"PLAYER_NAME tried to recieve training by GGTS",log:"PLAYER_NAME started training by GGTS"},defaultLimit:bd.limited,load(e){Zd("AsylumGGTSLoad",0,((t,n)=>{if(e.isEnforced){const e=LogValue("ForceGGTS","Asylum");return e&&e>0&&LogDelete("ForceGGTS","Asylum",!0),!1}return n(t)}),md.Rules),Zd("AsylumGGTSClick",0,((t,n)=>{if(e.inEffect&&MouseIn(1e3,0,500,1e3)){if(e.isEnforced)return void e.triggerAttempt();e.trigger()}n(t)}),md.Rules)}}),aw("block_club_slave_work",{name:"Prevent working as club slave",type:0,loggable:!1,shortDescription:"the task from the mistress room",longDescription:"This rule prevents PLAYER_NAME to work as a club slave by picking up a club slave collar from the club management room.",keywords:["limiting","preventing","controling","task","money"],defaultLimit:bd.limited,load(e){Zd("ManagementCanBeClubSlave",0,((t,n)=>!e.isEnforced&&n(t)),md.Rules)}}),aw("block_using_unowned_items",{name:"Prevent using items of others",type:0,loggable:!1,shortDescription:"items not bought",longDescription:"This rule prevents PLAYER_NAME to use items she does not own herself, but can use on someone because this person owns them.",keywords:["limiting","forbid","controling","restraints","gear","characters"],defaultLimit:bd.normal,load(e){Zd("DialogInventoryBuild",1,((t,n)=>{const r=t[0];if(null==r)return n(t);const o=r.Inventory;try{e.isEnforced&&!r.IsPlayer()&&(r.Inventory=[]),n(t)}finally{r.Inventory=o}}),md.Rules)}}),aw("block_changing_emoticon",{name:"Prevent changing own emoticon",type:0,shortDescription:"for just PLAYER_NAME",longDescription:"This rule prevents PLAYER_NAME from showing, removing or changing an emoticon (afk, zZZ, etc.) over her head. It also blocks her from using the emoticon command on herself.",triggerTexts:{infoBeep:"You are not allowed to change the emoticon!",attempt_log:"PLAYER_NAME tried to use the emoticon command",log:"PLAYER_NAME used the emoticon command"},defaultLimit:bd.normal,load(e){Zd("DialogClickExpressionMenu",5,((t,n)=>{const r=DialogFacialExpressions.findIndex((e=>"Emoticon"===e.Appearance.Asset.Group.Name));if(e.inEffect&&MouseIn(20,185+100*r,90,90)){if(e.isEnforced)return void e.triggerAttempt();e.trigger()}return n(t)}))}});let t=!1;aw("block_ui_icons_names",{name:"Force-hide UI elements",type:0,loggable:!1,shortDescription:"e.g., icons, bars, or names",longDescription:"This rule enforces hiding of certain UI elements for PLAYER_NAME over all characters inside the room. Different levels of the effect can be set which follow exactly the behavior of the 'eye'-toggle in the button row above the chat. There is also an option to hide emoticon bubbles over all characters' heads.",keywords:["seeing","room","viewing","looking","eye","emoticons"],defaultLimit:bd.blocked,dataDefinition:{hidingStrength:{type:"listSelect",default:"icons",options:[["icons","Icons"],["arousal","Icons/Bar"],["names","Icons/Bar/Names"]],description:"Select what shall be hidden:"},alsoHideEmoticons:{type:"toggle",default:!1,description:"Also hide emoticons during the effect",Y:440}},load(e){Zd("ChatRoomCharacterViewDraw",1,((t,n)=>{const r=ChatRoomHideIconState;e.isEnforced&&e.customData&&("icons"===e.customData.hidingStrength?ChatRoomHideIconState=1:"arousal"===e.customData.hidingStrength?ChatRoomHideIconState=2:"names"===e.customData.hidingStrength?ChatRoomHideIconState=3:console.error(`Rule block_ui_icons_names state.customData.hidingStrength has illegal value: ${e.customData.hidingStrength}`)),n(t),ChatRoomHideIconState=r})),Zd("CharacterLoadCanvas",2,((t,n)=>{const r=InventoryGet(t[0],"Emoticon");if(!r||!r.Property||void 0===r.Property.Expression)return n(t);const o=r.Property.Expression;e.isEnforced&&e.customData&&e.customData.alsoHideEmoticons&&(r.Property.Expression=null),n(t),r.Property.Expression=o}))},tick(e){if(e.customData&&e.customData.alsoHideEmoticons!==t){t=e.customData.alsoHideEmoticons;for(const e of ChatRoomCharacter)CharacterLoadCanvas(e)}return!1},stateChange(e,t){for(const e of ChatRoomCharacter)CharacterLoadCanvas(e)}})}(),function(){aw("alt_restrict_hearing",{name:"Sensory deprivation: Sound",type:1,loggable:!1,shortDescription:"impacts PLAYER_NAME's hearing; adjustable",longDescription:"This rule impacts PLAYER_NAME's natural ability to hear in the same way items do, independent of them (strength of deafening can be adjusted).",keywords:["deafness","limit","permanent","ears"],defaultLimit:bd.normal,dataDefinition:{deafeningStrength:{type:"listSelect",options:[["light","Light"],["medium","Medium"],["heavy","Heavy"]],default:"light",description:"Hearing impairment:"}},load(e){const t={light:1,medium:2,heavy:4};Zd("Player.GetDeafLevel",1,((n,r)=>{var o;let i=r(n);return e.isEnforced&&e.customData&&(i+=null!==(o=t[e.customData.deafeningStrength])&&void 0!==o?o:0),i}),md.Rules)}}),aw("alt_hearing_whitelist",{name:"Hearing whitelist",type:1,loggable:!1,shortDescription:"of members whom PLAYER_NAME can always understand",longDescription:"This rule defines a list of members whose voice can always be understood by PLAYER_NAME - independent of any sensory deprivation items or hearing impairing BCX rules on PLAYER_NAME. There is an additional option to toggle whether PLAYER_NAME can still understand a white-listed member's voice if that member is speech impaired herself (e.g. by being gagged).",keywords:["deafness","bypass","ignore","antigarble","ears","exception","understanding"],defaultLimit:bd.normal,dataDefinition:{whitelistedMembers:{type:"memberNumberList",default:[],description:"Members numbers still heard while hearing impaired:",Y:350,options:{pageSize:3}},ignoreGaggedMembersToggle:{type:"toggle",default:!1,description:"Also understand if those are speech impaired",Y:710}},load(e){let t=!1;Zd("SpeechGarble",2,((t,n)=>{const r=t[0];return e.isEnforced&&e.customData&&null!=r.MemberNumber&&e.customData.whitelistedMembers.filter((e=>e!==Player.MemberNumber)).includes(r.MemberNumber)&&(r.CanTalk()||e.customData.ignoreGaggedMembersToggle)?t[1]:n(t)}),md.Rules),Zd("ChatRoomMessage",9,((n,r)=>{const o=n[0],i=n[0].Sender;if(e.isEnforced&&e.customData&&"number"==typeof i&&e.customData.whitelistedMembers.filter((e=>e!==Player.MemberNumber)).includes(i)){t=!0;const n=Array.isArray(o.Dictionary)&&o.Dictionary.find((e=>Ed(e)&&"BCX_ORIGINAL_MESSAGE"===e.Tag&&"string"==typeof e.Text));n&&e.customData.ignoreGaggedMembersToggle&&(o.Content=n.Text)}r(n),t=!1}),md.Rules),Vd("PreferenceIsPlayerInSensDep"),Zd("Player.GetDeafLevel",9,((e,n)=>t?0:n(e)),md.Rules)}}),aw("alt_restrict_sight",{name:"Sensory deprivation: Sight",type:1,loggable:!1,shortDescription:"impacts PLAYER_NAME's sight; adjustable",longDescription:"This rule impacts PLAYER_NAME's natural ability to see in the same way items do, independent of them (strength of blindness can be adjusted).",keywords:["seeing","blindfold","limit","permanent","eyes"],defaultLimit:bd.normal,dataDefinition:{blindnessStrength:{type:"listSelect",options:[["light","Light"],["medium","Medium"],["heavy","Heavy"]],default:"light",description:"Eyesight impairment:"}},load(e){const t={light:1,medium:2,heavy:3};Zd("Player.GetBlindLevel",1,((n,r)=>{var o,i;let a=r(n);return e.isEnforced&&e.customData&&(a+=null!==(o=t[e.customData.blindnessStrength])&&void 0!==o?o:0),Math.min(a,"SensDepLight"===(null===(i=Player.GameplaySettings)||void 0===i?void 0:i.SensDepChatLog)?2:3)}),md.Rules)}}),aw("alt_eyes_fullblind",{name:"Fully blind when eyes are closed",type:1,loggable:!1,longDescription:"This rule enforces full blindness when the eyes are closed. (Light sensory deprivation setting is still respected and doesn't blind fully)",keywords:["seeing","blindness","eyes","blindfold","realistic","room"],defaultLimit:bd.normal,dataDefinition:{affectPlayer:{type:"toggle",default:!1,description:"Player sees the effect also on herself"},hideNames:{type:"toggle",default:!1,description:"Hide names and icons during the effect",Y:440}},tick:e=>(e.isEnforced&&(DialogFacialExpressionsSelectedBlindnessLevel=3),!1),load(e){Zd("DialogClickExpressionMenu",5,((t,n)=>{if(!e.isEnforced||!MouseIn(220,50,90,90))return n(t)})),Zd("ChatRoomCharacterViewDraw",1,((t,n)=>{var r,o,i;const a=ChatRoomHideIconState,s=InventoryGet(Player,"Eyes"),l=InventoryGet(Player,"Eyes2");e.isEnforced&&(null===(r=e.customData)||void 0===r?void 0:r.hideNames)&&"Closed"===(null===(o=null==s?void 0:s.Property)||void 0===o?void 0:o.Expression)&&"Closed"===(null===(i=null==l?void 0:l.Property)||void 0===i?void 0:i.Expression)&&(ChatRoomHideIconState=3),n(t),ChatRoomHideIconState=a})),Zd("DrawCharacter",1,((t,n)=>{var r,o,i,a;const s=InventoryGet(Player,"Eyes"),l=InventoryGet(Player,"Eyes2");if(!(e.isEnforced&&"SensDepLight"!==(null===(r=Player.GameplaySettings)||void 0===r?void 0:r.SensDepChatLog)&&"Closed"===(null===(o=null==s?void 0:s.Property)||void 0===o?void 0:o.Expression)&&"Closed"===(null===(i=null==l?void 0:l.Property)||void 0===i?void 0:i.Expression)&&"Online"===CurrentModule&&"ChatRoom"===CurrentScreen&&t[0].IsPlayer()&&(null===(a=e.customData)||void 0===a?void 0:a.affectPlayer)))return n(t)}))}}),aw("alt_blindfolds_fullblind",{name:"Fully blind when blindfolded",type:1,loggable:!1,longDescription:"This rule enforces full blindness when wearing any item that limits sight in any way. (This rules does NOT respect Light sensory deprivation setting and always forces player to be fully blind. The crafting property 'thin' is not factored in either due to technical limitations. )",keywords:["seeing","blindness","limit","eyes","realistic","room","light"],defaultLimit:bd.normal,load(e){Zd("Player.GetBlindLevel",2,((t,n)=>e.isEnforced&&["BlindHeavy","BlindNormal","BlindLight"].some((e=>Player.Effect.includes(e)&&!Player.Effect.includes("VRAvatars")))?3:n(t)),md.Rules)}}),aw("alt_always_slow",{name:"Always leave rooms slowly",type:1,loggable:!1,longDescription:"This rule forces PLAYER_NAME to always leave the room slowly, independent of the items she is wearing. WARNING: Due to limitation in Bondage Club itself, only BCX users will be able to stop PLAYER_NAME from leaving the room. This rule will ignore BC's roleplay difficulty setting 'Cannot be slowed down' and slow down PLAYER_NAME regardless!",keywords:["slowness","limit","leaving","permanent","stopping","exit","blocking"],defaultLimit:bd.normal,init(e){var t;t=t=>{e.isEnforced&&!t.Effect.includes("Slow")&&t.Effect.push("Slow")},ZA.push(t),Zd("Player.IsSlow",2,((t,n)=>!!e.isEnforced||n(t)))}}),aw("alt_set_leave_slowing",{name:"Set slowed leave time",type:1,loggable:!1,longDescription:"This rule can set the time PLAYER_NAME needs to leave the current room, when items or a rule force her to leave it slowly. The time can be set between 1 and 600 seconds (10 mins).",keywords:["slowness","limit","leaving","customized","increase","higher","stopping","exit","blocking","room"],defaultLimit:bd.limited,dataDefinition:{leaveTime:{type:"number",default:10,options:{min:1,max:600},description:"New leave time in seconds:"}},init(e){Zd("ChatRoomMenuClick",2,((t,n)=>{if(!e.isEnforced)return n(t);const r=ChatRoomSlowtimer;n(t),e.customData&&0===r&&ChatRoomSlowtimer>0&&(ChatRoomSlowtimer=CurrentTime+1e3*e.customData.leaveTime)}))}}),aw("alt_control_orgasms",{name:"Control ability to orgasm",type:1,loggable:!1,shortDescription:"adjustable: only-edge, only-ruin, no-resist",longDescription:"This rule impacts PLAYER_NAME's ability to control their orgasms, independent of items. There are three control options, which are: Never cum (always edge, the bar never reaches 100%), force into ruined orgasm (orgasm screen starts, but doesn't let her actually cum) and prevent resisting orgasm (able to enter orgasm screen, but unable to resist it).",keywords:["deny","denial","prevent","edging","hypno","cumming"],defaultLimit:bd.limited,dataDefinition:{orgasmHandling:{type:"listSelect",default:"edge",options:[["edge","Edge"],["ruined","Ruin"],["noResist","Prevent resisting"]],description:"Orgasm attempts will be fixed to:"}},load(e){Zd("ServerSend",0,((t,n)=>{"ChatRoomChat"===t[0]&&Ed(t[1])&&"string"==typeof t[1].Content&&"Activity"===t[1].Type&&e.isEnforced&&(t[1].Content.startsWith("OrgasmFailPassive")?t[1].Content="OrgasmFailPassive0":t[1].Content.startsWith("OrgasmFailTimeout")?t[1].Content="OrgasmFailTimeout2":t[1].Content.startsWith("OrgasmFailResist")?t[1].Content="OrgasmFailResist2":t[1].Content.startsWith("OrgasmFailSurrender")&&(t[1].Content="OrgasmFailSurrender2")),n(t)})),Zd("ActivityOrgasmPrepare",5,((t,n)=>{const r=t[0];if(e.isEnforced&&e.customData&&r.IsPlayer()){if("edge"===e.customData.orgasmHandling)return void(r.ArousalSettings&&(r.ArousalSettings.Progress=95));if("ruined"===e.customData.orgasmHandling){const e=Player.Effect;return Player.Effect=e.concat("DenialMode","RuinOrgasms"),n(t),void(Player.Effect=e)}"noResist"===e.customData.orgasmHandling&&(ActivityOrgasmGameResistCount=496.5)}return n(t)}),md.Rules)}}),aw("alt_secret_orgasms",{name:"Secret orgasm progress",type:1,loggable:!1,shortDescription:"unable to see the own arousal meter",longDescription:"This rule prevents PLAYER_NAME from seeing their own arousal meter, even while it is active and working. This means, that it is a surprise to them, when the orgasm (quick-time event) happens. Does not effect other characters being able to see the meter, if club settings allow that.",keywords:["hide","hidden","control","cumming"],defaultLimit:bd.limited,load(e){Zd("DrawArousalMeter",5,((t,n)=>{if(0!==t[0].ID||!e.isEnforced)return n(t)})),Zd("ChatRoomCharacterViewClickCharacter",5,((t,n)=>{const r=t[0],o=t[1],i=t[2],a=t[3];if((0!==r.ID||!e.isEnforced||!MouseIn(o+60*a,i+400*a,80*a,100*a)||r.ArousalZoom)&&!(0===r.ID&&e.isEnforced&&MouseIn(o+50*a,i+200*a,100*a,500*a)&&r.ArousalZoom))return n(t)}))}});const e=new Set;function t(){return Player.Nickname&&Nb(Player.Nickname)?Player.Nickname:Nb(Player.Name)?Player.Name:""}aw("alt_room_admin_transfer",{name:"Room admin transfer",type:1,loggable:!1,shortDescription:"give admin to defined roles",longDescription:"This rule lets you define a minimum role which PLAYER_NAME will automatically give room admin rights to (if she has admin rights in the room). Also has the option to remove admin rights from PLAYER_NAME afterwards.",keywords:["automatic","authority","power","exchange","loss","control"],defaultLimit:bd.blocked,dataDefinition:{minimumRole:{type:"roleSelector",default:xA.owner,description:"Minimum role that gets admin:",Y:320},removeAdminToggle:{type:"toggle",default:!1,description:"Player loses admin afterwards",Y:470}},load(){Zd("ChatRoomSyncMemberLeave",3,((t,n)=>{n(t);const r=t[0];e.has(r.SourceMemberNumber)&&e.delete(r.SourceMemberNumber)}),md.Rules),Zd("ChatRoomClearAllElements",3,((t,n)=>{e.clear(),n(t)}),md.Rules)},tick(t){var n;let r=!1;if(t.isEnforced&&t.customData&&ChatRoomPlayerIsAdmin()&&ServerPlayerIsInChatRoom()){let o=!1;for(const i of zA())!i.isPlayer()&&RA(i)<=t.customData.minimumRole&&((null===(n=null===ChatRoomData||void 0===ChatRoomData?void 0:ChatRoomData.Admin)||void 0===n?void 0:n.includes(i.MemberNumber))?o=!0:e.has(i.MemberNumber)||(ServerSend("ChatRoomAdmin",{MemberNumber:i.MemberNumber,Action:"Promote"}),r=!0,e.add(i.MemberNumber)));"Online"===CurrentModule&&"ChatRoom"===CurrentScreen&&!r&&o&&ChatRoomData&&t.customData.removeAdminToggle&&(RE({Admin:ChatRoomData.Admin.filter((e=>e!==Player.MemberNumber))}),r=!0)}return r}}),aw("alt_room_admin_limit",{name:"Limit bound admin power",type:1,loggable:!1,shortDescription:"restrict room admin powers while restrained",longDescription:"This rule forbids PLAYER_NAME to do any room admin actions (except for kick/ban), when she is restrained. Note: This rule does not affect an admin's ability to bypass locked rooms, if restraints allow it. Tip: This rule can be combined with the rule 'Force Return to chatrooms on relog' to trap PLAYER_NAME in it.",keywords:["restraints","authority","suppressing","bindings","helpless"],defaultLimit:bd.limited,triggerTexts:{attempt_infoBeep:"You are forbidden from changing room settings while restrained"},load(e){Zd("ChatAdminLoad",0,((t,n)=>{var r,o,i,a;n(t),e.isEnforced&&ChatRoomPlayerIsAdmin()&&Player.IsRestrained()&&(null===(r=document.getElementById("InputName"))||void 0===r||r.setAttribute("disabled","disabled"),null===(o=document.getElementById("InputDescription"))||void 0===o||o.setAttribute("disabled","disabled"),null===(i=document.getElementById("InputSize"))||void 0===i||i.setAttribute("disabled","disabled"),null===(a=document.getElementById("InputAdminList"))||void 0===a||a.setAttribute("disabled","disabled"))})),Zd("ChatAdminRun",0,((t,n)=>{n(t),e.isEnforced&&ChatRoomPlayerIsAdmin()&&Player.IsRestrained()&&(DrawButton(505,172,300,60,TextGet("Language"+ChatAdminLanguage),"#ebebe4","","",!0),DrawButton(125,770,250,65,TextGet("AddOwnerAdminList"),"#ebebe4","","",!0),DrawButton(390,770,250,65,TextGet("AddLoverAdminList"),"#ebebe4","","",!0),DrawBackNextButton(1300,450,500,60,BackgroundsTextGet(ChatAdminBackgroundSelect),"#ebebe4","",(()=>BackgroundsTextGet(0===ChatAdminBackgroundIndex?ChatCreateBackgroundList[ChatCreateBackgroundList.length-1]:ChatCreateBackgroundList[ChatAdminBackgroundIndex-1])),(()=>BackgroundsTextGet(ChatAdminBackgroundIndex>=ChatCreateBackgroundList.length-1?ChatCreateBackgroundList[0]:ChatCreateBackgroundList[ChatAdminBackgroundIndex+1])),!0),DrawButton(1840,450,60,60,"","#ebebe4","Icons/Small/Preference.png","",!0),DrawBackNextButton(1625,550,275,60,TextGet("Game"+ChatAdminGame),"#ebebe4","",(()=>""),(()=>""),!0),DrawButton(1426,728,64,64,"","#ebebe4",ChatAdminPrivate?"Icons/Checked.png":"","",!0),DrawButton(1756,728,64,64,"","#ebebe4",ChatAdminLocked?"Icons/Checked.png":"","",!0),DrawRect(100,850,1125,70,"#ffff88"),DrawEmptyRect(100,850,1125,70,"Black"),DrawText("Some settings are not available due to a BCX rule.",650,885,"Black","Gray"))})),Zd("ChatAdminClick",5,((t,n)=>{if(!(e.isEnforced&&ChatRoomPlayerIsAdmin()&&Player.IsRestrained()&&(MouseIn(505,172,300,60)||MouseIn(1300,75,600,350)||MouseIn(1840,450,60,60)||MouseIn(1300,450,500,60)||MouseIn(1625,550,275,60)||MouseIn(1426,728,64,64)||MouseIn(1756,728,64,64)||MouseIn(125,770,250,65)||MouseIn(390,770,250,65))))return n(t)})),Zd("CommonSetScreen",5,((t,n)=>(e.isEnforced&&"Online"===t[0]&&"ChatBlockItem"===t[1]&&ChatRoomPlayerIsAdmin()&&Player.IsRestrained()&&(ChatBlockItemEditable=!1),n(t)))),Zd("ChatRoomAdminAction",5,((t,n)=>{const r=t[1];return e.isEnforced&&Player.IsRestrained()&&"Kick"!==r&&"Ban"!==r?(fE("HardCoreClub: You are not allowed to use this while restrained.",7e3),void DialogLeave()):n(t)}))}}),aw("alt_set_profile_description",{name:"Control profile online description",type:1,loggable:!1,shortDescription:"directly sets PLAYER_NAME's description",longDescription:"This rule sets PLAYER_NAME's online description (in her profile) to any text entered in the rule config, blocking changes to it. Warning: This rule is editing the actual profile text. This means that after saving a changed text, the original text is lost!",keywords:["edit","change","force","biography","information","story","control"],defaultLimit:bd.blocked,dataDefinition:{playersProfileDescription:{type:"textArea",default:()=>Player.Description||"",description:"Edit this player's profile description:"}},tick(e){if(e.isEnforced&&e.customData&&Player.Description!==e.customData.playersProfileDescription){let t=Player.Description=e.customData.playersProfileDescription;const n=""+LZString.compressToUTF16(t);return(n.length<t.length||t.startsWith(""))&&(t=n),ServerAccountUpdate.QueueData({Description:t}),e.trigger(),!0}return!1}}),aw("alt_set_nickname",{name:"Control nickname",type:1,loggable:!1,shortDescription:"directly sets PLAYER_NAME's nickname",longDescription:"This rule sets PLAYER_NAME's nickname (replacing her name in most cases) to any text entered in the rule config, blocking changes to it from BC's nickname menu. You can optionally choose whether the previous BC nickname will be restored while the rule is not in effect.",keywords:["edit","change","force","petname","naming","alias"],defaultLimit:bd.blocked,dataDefinition:{nickname:{type:"string",default:t,description:"Set this player's nickname:",options:/^[\p{L}0-9\p{Z}'-]{0,20}$/u},restore:{type:"toggle",description:"Restore the previous nickname at rule end",default:!0,Y:470}},internalDataValidate:e=>"string"==typeof e,internalDataDefault:t,stateChange(e,n){var r;if(n){const n=t();void 0!==n&&(e.internalData=n)}else if(null===(r=e.customData)||void 0===r?void 0:r.restore){let t=e.internalData;void 0!==t&&(t===Player.Name&&(t=""),Player.Nickname!==t&&(Player.Nickname=t,ServerAccountUpdate.QueueData({Nickname:t},!0)))}},tick(e){if(e.isEnforced&&e.customData){let t=e.customData.nickname.trim();if(t===Player.Name&&(t=""),Player.Nickname!==t)return Player.Nickname=t,ServerAccountUpdate.QueueData({Nickname:t},!0),e.trigger(),!0}return!1}}),aw("alt_force_suitcase_game",{name:"Always carry a suitcase",type:1,loggable:!1,shortDescription:"from the kidnappers league multiplayer game",longDescription:"This rule forces PLAYER_NAME to constantly participate in the kidnappers league's suitcase delivery task, by automatically giving her a new suitcase, whenever the suitcase item slot is empty.",keywords:["permanent","money","tasks"],defaultLimit:bd.normal,tick(e){const t=InventoryGet(Player,"ItemMisc");return!(!(e.isEnforced&&ReputationGet("Kidnap")>0&&Player.CanTalk())||t||(KidnapLeagueOnlineBountyStart(),0))}}),aw("alt_restrict_leashability",{name:"Restrict being leashed by others",type:1,loggable:!1,longDescription:"This rule only allows selected roles to leash PLAYER_NAME, responding with a message about unsuccessful leashing to others when they attempt to do so.",keywords:["limit","prevent","leashing","room"],defaultLimit:bd.limited,dataDefinition:{minimumRole:{type:"roleSelector",default:xA.owner,description:"Minimum role that is allowed to leash:",Y:320}},load(e){Zd("ChatRoomCanBeLeashedBy",4,((t,n)=>{const r=t[0];if(0!==r&&r!==Player.MemberNumber&&e.isEnforced&&e.customData&&RA(r)>e.customData.minimumRole){const e=XA(r);return gE("SourceCharacter's leash seems to be cursed and slips out of TargetCharacterName's hand.",null,[{Tag:"SourceCharacter",MemberNumber:Player.MemberNumber,Text:CharacterNickname(Player)},{Tag:"TargetCharacterName",MemberNumber:r,Text:e?CharacterNickname(e.Character):ME(r,"[unknown]")}]),!1}return n(t)}))}}),aw("alt_hide_friends",{name:"Hide online friends if blind",type:1,loggable:!1,shortDescription:"also preventing beeps from the friendlist - exceptions settable",longDescription:"This rule hides persons on PLAYER_NAME's friend list when she is fully blinded, which also makes sending beeps impossible. Received beeps can still be answered. The rule allows to manage a list of members who can be seen normally.",keywords:["blindfold","control"],defaultLimit:bd.blocked,dataDefinition:{allowedMembers:{type:"memberNumberList",default:[],description:"Members numbers that can always be seen:"}},load(e){Zd("FriendListLoadFriendList",1,((t,n)=>{var r;const o=n(t),i=null===(r=e.customData)||void 0===r?void 0:r.allowedMembers;return e.isEnforced&&i&&Player.GetBlindLevel()>=3&&document.querySelectorAll(".friend-list-row").forEach((e=>{var t;const n=e.querySelector(".MemberNumber"),r=e.querySelector(".MemberName"),o=e.querySelector("button.fl-online-friends-content");if(!n||!r||!o)return;const a=Number.parseInt(null!==(t=n.textContent)&&void 0!==t?t:"nan",10);i.includes(a)||(o.disabled=!0,n.textContent="######",r.textContent="Someone")})),o}))}}),aw("alt_forced_summoning",{name:"Ready to be summoned",type:1,loggable:!1,shortDescription:"leash PLAYER_NAME from anywhere using a beep with message",longDescription:"This rule forces PLAYER_NAME to switch rooms from anywhere in the club to the chat room of the summoner after 15 seconds. It works by sending a beep message with the set text or simply the word 'summon' to PLAYER_NAME. Members who are allowed to summon PLAYER_NAME can be set. NOTES: PLAYER_NAME can always be summoned no matter if she has a leash or is prevented from leaving the room (ignoring restraints or locked rooms). However, if the target room is full or locked, she will end up in the lobby. Summoning will not work if the room name is not included with the beep message!",keywords:["leashing","room","calling","ordering","move","moving","movement","warping","beaming","transporting"],triggerTexts:{infoBeep:"You are summoned by TARGET_PLAYER!"},defaultLimit:bd.blocked,dataDefinition:{allowedMembers:{type:"memberNumberList",default:[],description:"Members numbers allowed to summon:",Y:325,options:{pageSize:1}},summoningText:{type:"string",default:"Come to my room immediately",description:"The text used for summoning:",Y:705},summonTime:{type:"number",default:15,description:"Time in seconds before enforcing summon:",Y:550}},load(e){let t=!1;Zd("ServerAccountBeep",7,((n,r)=>{const o=n[0];Ed(o)&&!o.BeepType&&"number"==typeof o.MemberNumber&&e.isEnforced&&e.customData&&e.customData.allowedMembers.includes(o.MemberNumber)&&"string"==typeof o.Message&&(o.Message.toLocaleLowerCase().startsWith(e.customData.summoningText.trim().toLocaleLowerCase())||"summon"===o.Message.trim().toLocaleLowerCase())&&o.ChatRoomName&&ChatSelectGendersAllowed(o.ChatRoomSpace,Player.GetGenders())&&(gE(`SourceCharacter received a summon: "${e.customData.summoningText}".`,null,[{Tag:"SourceCharacter",MemberNumber:Player.MemberNumber,Text:CharacterNickname(Player)}]),t=!0,u((()=>{!e.isEnforced||ServerPlayerIsInChatRoom()&&(null===ChatRoomData||void 0===ChatRoomData?void 0:ChatRoomData.Name)===o.ChatRoomName||(gE("The demand for SourceCharacter's presence is now enforced.",null,[{Tag:"SourceCharacter",MemberNumber:Player.MemberNumber,Text:CharacterNickname(Player)}]),ChatRoomLeave(),ChatRoomStart(o.ChatRoomSpace,"",null,null,"Introduction",BackgroundsTagList),CharacterDeleteAllOnline(),ChatRoomPlayerCanJoin=!0,ServerSend("ChatRoomJoin",{Name:o.ChatRoomName}))}),1e3*e.customData.summonTime)),r(n),t&&e.triggerAttempt(o.MemberNumber),t=!1}),md.Rules)}}),aw("alt_allow_changing_appearance",{name:"Allow changing the whole appearance",type:1,loggable:!1,shortDescription:"of PLAYER_NAME - for the defined roles",keywords:["force","setting","wardrobe","body","modifications"],longDescription:"This rule lets you define a minimum role which (and all higher roles) has permission to fully change the whole appearance of PLAYER_NAME (body and cosplay items), ignoring the settings of the BC online preferences 'Allow others to alter your whole appearance' and 'Prevent others from changing cosplay items'. So this rule can define a group of people which is allowed, while everyone else is not. IMPORTANT: Only other BCX users will be able to change PLAYER_NAME's appearance if this rule allows them to, while the BC settings would forbid them to.",defaultLimit:bd.blocked,dataDefinition:{minimumRole:{type:"roleSelector",default:xA.owner,description:"Minimum role that is allowed:"}},init(e){uA.rule_alt_allow_changing_appearance=t=>e.inEffect&&!!e.customData&&RA(t)<=e.customData.minimumRole;let t=null;Zd("CharacterAppearanceLoadCharacter",0,((e,n)=>{t=null;const r=e[0],o=r.MemberNumber&&XA(r.MemberNumber);return!r.IsPlayer()&&o&&o.BCXVersion&&gA("rule_alt_allow_changing_appearance",void 0,o.MemberNumber).then((e=>{e&&(t=o.MemberNumber)})),n(e)}),null),Zd("WardrobeGroupAccessible",4,((e,n)=>{const r=e[0];if(!r.IsPlayer()&&r.MemberNumber&&r.MemberNumber===t&&r.OnlineSharedSettings){const t=r.OnlineSharedSettings.AllowFullWardrobeAccess,o=r.OnlineSharedSettings.BlockBodyCosplay;try{return r.OnlineSharedSettings.AllowFullWardrobeAccess=!0,r.OnlineSharedSettings.BlockBodyCosplay=!1,n(e)}finally{r.OnlineSharedSettings.AllowFullWardrobeAccess=t,r.OnlineSharedSettings.BlockBodyCosplay=o}}return n(e)}),null)},load(e){Zd("ValidationCanAddOrRemoveItem",4,((t,n)=>{const r=t[1];if(o=r.sourceMemberNumber,e.inEffect&&e.customData&&RA(o)<=e.customData.minimumRole&&r.C.IsPlayer()&&r.C.OnlineSharedSettings){const e=r.C.OnlineSharedSettings.AllowFullWardrobeAccess,o=r.C.OnlineSharedSettings.BlockBodyCosplay;try{return r.C.OnlineSharedSettings.AllowFullWardrobeAccess=!0,r.C.OnlineSharedSettings.BlockBodyCosplay=!1,n(t)}finally{r.C.OnlineSharedSettings.AllowFullWardrobeAccess=e,r.C.OnlineSharedSettings.BlockBodyCosplay=o}}var o;return n(t)}),md.Rules)}})}(),function(){function e(){ServerAccountUpdate.QueueData({ArousalSettings:Player.ArousalSettings,GameplaySettings:Player.GameplaySettings,ImmersionSettings:Player.ImmersionSettings,OnlineSettings:Player.OnlineSettings,OnlineSharedSettings:Player.OnlineSharedSettings,GraphicsSettings:Player.GraphicsSettings,ItemPermission:Player.ItemPermission})}function t(e,t,n="Existing BC setting"){return{name:`Force '${e}'`,type:2,loggable:!1,shortDescription:n,keywords:["control","settings","configure","change"],defaultLimit:t,longDescription:`This rule forces PLAYER_NAME's base game setting '${e}' to configurable value and prevents her from changing it.`,triggerTexts:{infoBeep:`Rule changed your '${e}' setting`}}}function n({id:n,setting:r,shortDescription:o,defaultValue:i,defaultLimit:a,get:s,set:l}){return aw(n,{...t(r,a,o),longDescription:`This rule forces PLAYER_NAME's base game or BCX setting '${r}' to the configured value and prevents her from changing it. There is also an option to restore the setting to the state it was in before the rule changed it. The restoration happens either when the rule becomes inactive (for instance through toggle or unfulfilled trigger conditions) or when it is removed.`,dataDefinition:{value:{type:"toggle",description:r,default:i},restore:{type:"toggle",description:"Restore previous value when rule ends",default:!0,Y:420}},internalDataValidate:e=>"boolean"==typeof e,internalDataDefault:()=>{var e;return null!==(e=s())&&void 0!==e&&e},stateChange(t,n){var r;if(n){const e=s();void 0!==e&&(t.internalData=e)}else if(null===(r=t.customData)||void 0===r?void 0:r.restore){const n=t.internalData;void 0!==n&&(l(n),e())}},tick(t){if(t.isEnforced&&t.customData){const n=s();if(null==n)return console.error(`HardCoreClub: Undfined value while forcing setting ${r}`),!1;if(n!==t.customData.value)return l(t.customData.value),t.trigger(),e(),!0}return!1}})}aw("setting_item_permission",{...t("Item permission",bd.limited),dataDefinition:{value:{type:"listSelect",options:[["everyone","Everyone, no exceptions"],["everyoneBlacklist","Everyone, except blacklist"],["dominants","Owner, Lovers, whitelist & Dominants"],["whitelist","Owner, Lovers and whitelist only"]],default:"everyone",description:"Item permission"}},tick(t){var n;if(t.isEnforced&&t.customData){const r=null!==(n={everyone:0,everyoneBlacklist:1,dominants:2,whitelist:3}[t.customData.value])&&void 0!==n?n:0;if(Player.ItemPermission!==r)return Player.ItemPermission=r,t.trigger(),e(),!0}return!1}}),n({id:"setting_forbid_lockpicking",setting:"Locks on you can't be picked",defaultValue:!0,defaultLimit:bd.limited,get:()=>{var e;return null===(e=Player.OnlineSharedSettings)||void 0===e?void 0:e.DisablePickingLocksOnSelf},set:e=>Player.OnlineSharedSettings.DisablePickingLocksOnSelf=e}),n({id:"setting_forbid_SP_rooms",setting:"Cannot enter single-player rooms when restrained",defaultValue:!0,defaultLimit:bd.limited,get:()=>{var e;return null===(e=Player.GameplaySettings)||void 0===e?void 0:e.OfflineLockedRestrained},set:e=>Player.GameplaySettings.OfflineLockedRestrained=e}),n({id:"setting_forbid_safeword",setting:"Allow safeword use",defaultValue:!1,defaultLimit:bd.limited,get:()=>{var e;return null===(e=Player.GameplaySettings)||void 0===e?void 0:e.EnableSafeword},set:e=>Player.GameplaySettings.EnableSafeword=e}),aw("setting_arousal_meter",{...t("Arousal meter",bd.limited),dataDefinition:{active:{type:"listSelect",options:[["Inactive","Disable sexual activities"],["NoMeter","Allow without a meter"],["Manual","Allow with a manual meter"],["Hybrid","Allow with a hybrid meter"],["Automatic","Allow with a locked meter"]],default:"Hybrid",description:"Sexual activities - Activation"},visible:{type:"listSelect",options:[["All","Show arousal to everyone"],["Access","Show if they have access"],["Self","Show to yourself only"]],default:"All",description:"Meter visibility",Y:480}},tick(t){let n=!1;return t.isEnforced&&t.customData&&Player.ArousalSettings&&(Player.ArousalSettings.Active!==t.customData.active&&(Player.ArousalSettings.Active=t.customData.active,n=!0),Player.ArousalSettings.Visible!==t.customData.visible&&(Player.ArousalSettings.Visible=t.customData.visible,n=!0),n&&(t.trigger(),e())),n}}),n({id:"setting_block_vibe_modes",setting:"Block advanced vibrator modes",defaultValue:!1,defaultLimit:bd.limited,get:()=>{var e;return null===(e=Player.ArousalSettings)||void 0===e?void 0:e.DisableAdvancedVibes},set:e=>Player.ArousalSettings.DisableAdvancedVibes=e}),aw("setting_arousal_stutter",{...t("Arousal speech stuttering",bd.limited),dataDefinition:{value:{type:"listSelect",options:[["None","Never stutter"],["Arousal","When you're aroused"],["Vibration","When you're vibrated"],["All","Aroused & vibrated"]],default:"All",description:"Speech stuttering"}},tick:t=>!!(t.isEnforced&&t.customData&&Player.ArousalSettings&&Player.ArousalSettings.AffectStutter!==t.customData.value)&&(Player.ArousalSettings.AffectStutter=t.customData.value,t.trigger(),e(),!0)}),n({id:"setting_show_afk",setting:"Show AFK bubble",defaultValue:!0,defaultLimit:bd.blocked,get:()=>{var e;return null===(e=Player.OnlineSettings)||void 0===e?void 0:e.EnableAfkTimer},set:e=>Player.OnlineSettings.EnableAfkTimer=e}),n({id:"setting_allow_body_mod",setting:"Allow others to alter your whole appearance",defaultValue:!0,defaultLimit:bd.blocked,get:()=>{var e;return null===(e=Player.OnlineSharedSettings)||void 0===e?void 0:e.AllowFullWardrobeAccess},set:e=>Player.OnlineSharedSettings.AllowFullWardrobeAccess=e}),n({id:"setting_forbid_cosplay_change",setting:"Prevent others from changing cosplay items",defaultValue:!1,defaultLimit:bd.blocked,get:()=>{var e;return null===(e=Player.OnlineSharedSettings)||void 0===e?void 0:e.BlockBodyCosplay},set:e=>Player.OnlineSharedSettings.BlockBodyCosplay=e}),aw("setting_sensdep",{...t("Sensory deprivation setting",bd.blocked),dataDefinition:{value:{type:"listSelect",options:[["SensDepLight","Light"],["Normal","Normal"],["SensDepNames","Hide names"],["SensDepTotal","Heavy"],["SensDepExtreme","Total"]],default:"Normal",description:"Sensory deprivation setting"},disableExamine:{type:"toggle",default:!1,description:"Disable examining when blind",Y:480},hideMessages:{type:"toggle",default:!1,description:"Hide others' messages",Y:580}},tick(t){let n=!1;if(t.isEnforced&&t.customData&&Player.GameplaySettings&&Player.ImmersionSettings){Player.GameplaySettings.SensDepChatLog!==t.customData.value&&(Player.GameplaySettings.SensDepChatLog=t.customData.value,n=!0);const r="SensDepLight"===t.customData.value,o="SensDepExtreme"===t.customData.value,i=t.customData.disableExamine&&!r||o;Player.GameplaySettings.BlindDisableExamine!==i&&(Player.GameplaySettings.BlindDisableExamine=i,n=!0);const a="SensDepLight"!==t.customData.value&&t.customData.hideMessages;Player.ImmersionSettings.SenseDepMessages!==a&&(Player.ImmersionSettings.SenseDepMessages=a,n=!0),n&&(t.trigger(),e())}return n}}),n({id:"setting_hide_non_adjecent",setting:"Hide non-adjacent players while partially blind",defaultValue:!0,defaultLimit:bd.blocked,get:()=>{var e;return null===(e=Player.ImmersionSettings)||void 0===e?void 0:e.BlindAdjacent},set:e=>Player.ImmersionSettings.BlindAdjacent=e}),n({id:"setting_blind_room_garbling",setting:"Garble chatroom names and descriptions while blind",defaultValue:!0,defaultLimit:bd.blocked,get:()=>{var e;return null===(e=Player.ImmersionSettings)||void 0===e?void 0:e.ChatRoomMuffle},set:e=>Player.ImmersionSettings.ChatRoomMuffle=e}),n({id:"setting_relog_keeps_restraints",setting:"Keep all restraints when relogging",defaultValue:!0,defaultLimit:bd.limited,get:()=>{var e;return null===(e=Player.GameplaySettings)||void 0===e?void 0:e.DisableAutoRemoveLogin},set:e=>Player.GameplaySettings.DisableAutoRemoveLogin=e}),n({id:"setting_leashed_roomchange",setting:"Players can drag you to rooms when leashed",defaultValue:!0,defaultLimit:bd.blocked,get:()=>{var e;return null===(e=Player.OnlineSharedSettings)||void 0===e?void 0:e.AllowPlayerLeashing},set:e=>Player.OnlineSharedSettings.AllowPlayerLeashing=e}),aw("setting_room_rejoin",{...t("Return to chatrooms on relog",bd.limited),dataDefinition:{value:{type:"toggle",default:!0,description:"Return to chatrooms on relog"},remakeRooms:{type:"toggle",default:!1,description:"Auto-remake rooms",Y:425}},tick(t){let n=!1;if(t.isEnforced&&t.customData&&Player.ImmersionSettings){Player.ImmersionSettings.ReturnToChatRoom!==t.customData.value&&(Player.ImmersionSettings.ReturnToChatRoom=t.customData.value,n=!0);const r=t.customData.value&&t.customData.remakeRooms;Player.ImmersionSettings.ReturnToChatRoomAdmin!==r&&(Player.ImmersionSettings.ReturnToChatRoomAdmin=r,n=!0),n&&(t.trigger(),e())}return n}}),n({id:"setting_plug_vibe_events",setting:"Events while plugged or vibed",defaultValue:!0,defaultLimit:bd.normal,get:()=>{var e;return null===(e=Player.ImmersionSettings)||void 0===e?void 0:e.StimulationEvents},set:e=>Player.ImmersionSettings.StimulationEvents=e}),n({id:"setting_allow_tint_effects",setting:"Allow item tint effects",defaultValue:!0,defaultLimit:bd.limited,get:()=>{var e;return null===(e=Player.ImmersionSettings)||void 0===e?void 0:e.AllowTints},set:e=>Player.ImmersionSettings.AllowTints=e}),n({id:"setting_allow_blur_effects",setting:"Allow item blur effects",defaultValue:!0,defaultLimit:bd.blocked,get:()=>{var e;return null===(e=Player.GraphicsSettings)||void 0===e?void 0:e.AllowBlur},set:e=>Player.GraphicsSettings.AllowBlur=e}),n({id:"setting_upsidedown_view",setting:"Flip room vertically when upside-down",defaultValue:!0,defaultLimit:bd.blocked,get:()=>{var e;return null===(e=Player.GraphicsSettings)||void 0===e?void 0:e.InvertRoom},set:e=>Player.GraphicsSettings.InvertRoom=e}),n({id:"setting_random_npc_events",setting:"Prevent random NPC events",shortDescription:"from BCX's Misc module",defaultValue:!0,defaultLimit:bd.normal,get:()=>Wb(vd.BlockRandomEvents),set:e=>Gb(vd.BlockRandomEvents,e)})}(),aw("rc_club_owner",{name:"Forbid club owner changes",type:3,shortDescription:"getting or leaving owner",longDescription:"This rule forbids PLAYER_NAME to leave their current club owner or get a new one. Advancing ownership from trial to full ownership is unaffected. Doesn't prevent the club owner from releasing her.",keywords:["prevent","ownership","collaring","break"],loggable:!1,defaultLimit:bd.blocked,load(e){Zd("ChatRoomOwnershipOptionIs",5,((t,n)=>{const r=t[0];return(!e.isEnforced||"CanStartTrial"!==r)&&n(t)}),md.Rules);for(const t of["ManagementCanBeReleasedOnline","ManagementCanBreakTrialOnline","ManagementCannotBeReleasedOnline","ManagementCanBeReleased","ManagementCannotBeReleased"])Zd(t,5,((t,n)=>!e.isEnforced&&n(t)),md.Rules);Zd("ManagementCannotBeReleasedExtreme",5,((t,n)=>e.isEnforced||n(t)),md.Rules)}}),aw("rc_lover_new",{name:"Forbid getting new lovers",type:3,longDescription:"This rule forbids PLAYER_NAME to get a new lover. Advancing lovership from dating to engagement or from engagement to marriage is unaffected.",keywords:["prevent","lovership","dating"],loggable:!1,defaultLimit:bd.blocked,load(e){Zd("ChatRoomLovershipOptionIs",5,((t,n)=>{const r=t[0];return(!e.isEnforced||"CanOfferBeginDating"!==r&&"CanBeginDating"!==r)&&n(t)}),md.Rules)}}),aw("rc_lover_leave",{name:"Forbid breaking up with lovers",type:3,longDescription:"This rule forbids PLAYER_NAME to leave any of their lovers, independent of lovership stage (leaving dating, engaged and married characters is forbidden). Doesn't prevent her lovers from breaking up with her.",keywords:["prevent","lovership","dating","leave","leaving"],loggable:!1,defaultLimit:bd.blocked,load(e){for(const t of["ManagementCanBreakDatingLoverOnline","ManagementCanBreakUpLoverOnline"])Zd(t,5,((t,n)=>!e.isEnforced&&n(t)),md.Rules)}}),aw("rc_sub_new",{name:"Forbid taking new submissives",type:3,shortDescription:"by offering them an ownership trial",longDescription:"This rule forbids PLAYER_NAME to start a trial with new submissive. Advancing ownership from trial to full ownership is unaffected.",keywords:["prevent","subbies","collaring"],loggable:!1,defaultLimit:bd.blocked,load(e){Zd("ChatRoomOwnershipOptionIs",5,((t,n)=>{const r=t[0];return(!e.isEnforced||"Propose"!==r)&&n(t)}),md.Rules)}}),aw("rc_sub_leave",{name:"Forbid disowning submissives",type:3,longDescription:"This rule forbids PLAYER_NAME to let go of any of their subs. (affects both trial and full ownerships). Doesn't prevent her submissives from breaking the bond.",keywords:["prevent","subbies","collar","freeing","releasing","release"],loggable:!1,defaultLimit:bd.blocked,load(e){Zd("ChatRoomIsOwnedByPlayer",5,((t,n)=>!e.isEnforced&&n(t)),md.Rules)}}),function(){aw("speech_specific_sound",{name:"Allow specific sounds only",type:4,shortDescription:"such as an animal sound",longDescription:"This rule allows PLAYER_NAME to only communicate using a list of specific sound patterns in chat messages and whispers. These patterns cannot be mixed in the same message, though. Only one sound from the list per message is valid. That said, any variation of a sound in the list is allowed as long as the letters are in order. (Example: if the set sound is 'Meow', then this is a valid message: 'Me..ow? meeeow! mmeooowwwwwww?! meow. me.. oo..w ~')",keywords:["filter","speech","talking","letters"],triggerTexts:{infoBeep:"You are allowed to speak only using one of the defined sounds!",attempt_log:"PLAYER_NAME tried to break a rule to only speak using specific sound patterns",log:"PLAYER_NAME broke a rule to only speak using specific sound patterns"},defaultLimit:bd.normal,dataDefinition:{soundWhitelist:{type:"stringList",default:[],description:"Set the allowed sounds:",options:{validate:/^\p{L}*$/iu}}},init(e){const t=t=>{var n;const r=null===(n=e.customData)||void 0===n?void 0:n.soundWhitelist;return!(r&&r.length>0)||"Chat"!==t.type&&"Whisper"!==t.type||ew(r,t.originalMessage.toLocaleLowerCase())};Ab({allowSend:n=>e.isEnforced&&!t(n)?(e.triggerAttempt(),1):0,onSend:n=>{e.inEffect&&!t(n)&&e.trigger()}})}}),aw("speech_garble_whispers",{name:"Garble whispers while gagged",type:4,loggable:!1,shortDescription:"same as normal messages",longDescription:"This rule alters PLAYER_NAME's outgoing whisper messages while gagged to be garbled the same way normal chat messages are. This means, that strength of the effect depends on the type of gag and (OOC text) is not affected. Note: While the rule is in effect, the BC immersion preference 'Prevent OOC & whispers while gagged' is altered, to allow gagged whispers, since those are now garbled by the rule. OOC ARE ALSO AFFECTED.",keywords:["garbling","whispering"],defaultLimit:bd.limited,init(e){Ab({modify:(t,n)=>e.isEnforced&&"Whisper"===t.type?eh("SpeechGarble",[Player,n,!0]):n})},load(e){Zd("ChatRoomShouldBlockGaggedOOCMessage",2,((t,n)=>!(e.isEnforced&&ChatRoomTargetMemberNumber>=0)&&n(t)),md.Rules)}}),aw("speech_block_gagged_ooc",{name:"Block OOC chat while gagged",type:4,shortDescription:"no more misuse of OOC for normal chatting while gagged",longDescription:"This rule forbids PLAYER_NAME to use OOC (messages between round brackets) in chat or OOC whisper messages while she is gagged.",keywords:["parentheses","prevent","forbid"],triggerTexts:{infoBeep:"You are not allowed to use OOC in messages while gagged.",attempt_log:"PLAYER_NAME tried to use OOC in a message while gagged",log:"PLAYER_NAME used OOC in a message while gagged"},defaultLimit:bd.blocked,init(e){Ab({allowSend:t=>e.isEnforced&&t.hasOOC&&!Player.CanTalk()?(e.triggerAttempt(),console.log("OOC talk was blocked while gagged"),1):0,onSend:t=>{e.inEffect&&t.hasOOC&&e.trigger()}})}}),aw("speech_block_ooc",{name:"Block OOC chat",type:4,shortDescription:"blocks use of OOC in messages",longDescription:"This rule forbids PLAYER_NAME to use OOC (messages between round brackets) in chat or OOC whisper messages at any moment. This is a very extreme rule and should be used with great caution!",keywords:["parentheses","prevent","forbid"],triggerTexts:{infoBeep:"You are not allowed to use OOC in messages!",attempt_log:"PLAYER_NAME tried to use OOC in a message",log:"PLAYER_NAME used OOC in a message"},defaultLimit:bd.blocked,init(e){Ab({allowSend:t=>e.isEnforced&&t.hasOOC?(console.log("OOC talk whas blocked"),e.triggerAttempt(),1):0,onSend:t=>{e.inEffect&&t.hasOOC&&e.trigger()}})}}),aw("speech_doll_talk",{name:"Doll talk",type:4,shortDescription:"allows only short sentences with simple words",longDescription:"This rule forbids PLAYER_NAME to use any words longer than set limit and limits number of words too. Both limits are configurable independently. Doesn't affect OOC text, but does affect whispers. Note: Setting '0' means this part is not limited (), as there is another rule to forbid open alking completely.",keywords:["limit","restrict","length","count"],triggerTexts:{infoBeep:"You broke the doll talk rule!",attempt_log:"PLAYER_NAME tried to break the doll talk rule",log:"PLAYER_NAME broke the doll talk rule"},defaultLimit:bd.normal,dataDefinition:{maxWordLength:{type:"number",default:6,description:"Max. character length of any word:",Y:420},maxNumberOfWords:{type:"number",default:5,description:"Max. number of words per message:",Y:570}},init(e){const t=t=>{if("Chat"!==t.type&&"Whisper"!==t.type||null==e.customData)return!0;const n=Array.from(t.originalMessage.matchAll(/[^\t\p{Z}\v.:!?~,;^]+/gmu)).map((e=>e[0]));return!(e.customData.maxNumberOfWords&&n.length>e.customData.maxNumberOfWords||e.customData.maxWordLength&&n.some((t=>t.length>e.customData.maxWordLength)))};Ab({allowSend:n=>e.isEnforced&&!t(n)?(e.triggerAttempt(),1):0,onSend:n=>{e.inEffect&&!t(n)&&e.trigger()}})}}),aw("speech_ban_words",{name:"Forbid saying certain words in chat",type:4,shortDescription:"based on a configurable blacklist",longDescription:"This rule forbids PLAYER_NAME to use certain words in the chat. The list of banned words can be configured. Checks are not case sensitive (forbidding 'no' also forbids 'NO' and 'No'). Doesn't affect emotes and OOC text, but does affect whispers.",keywords:["limit","restrict","blacklist","blocklist","forbidden"],triggerTexts:{infoBeep:"You are not allowed to use the word 'USED_WORD'!",attempt_log:"PLAYER_NAME tried to use the banned word 'USED_WORD'",log:"PLAYER_NAME used the banned word 'USED_WORD'"},defaultLimit:bd.normal,dataDefinition:{bannedWords:{type:"stringList",default:[],description:"All forbidden words:",options:{validate:/^[\p{L} ]*$/iu}}},init(e){let t;const n=n=>{var r,o;return t=void 0,"Chat"!==n.type&&"Whisper"!==n.type||!(null===(r=e.customData)||void 0===r?void 0:r.bannedWords)||(null===(o=e.customData)||void 0===o||o.bannedWords.forEach((e=>(n.originalMessage.split(" ").forEach((r=>{const o=r.replace(/\b(\w+)\b.*\b\1\b/g,"$1");if(console.log("Message to Check: "+o),function(e,t){if(e===t)return 0;const n=e;e.length>t.length&&(e=t,t=n);let r=e.length,o=t.length;for(;r>0&&e.charCodeAt(~-r)===t.charCodeAt(~-o);)r--,o--;let i,a,s,l,c=0;for(;c<r&&e.charCodeAt(c)===t.charCodeAt(c);)c++;if(r-=c,o-=c,0===r)return o;let u=0,d=0;for(;u<r;)Qb[u]=e.charCodeAt(c+u),Jb[u]=++u;for(;d<o;)for(i=t.charCodeAt(c+d),s=d++,a=d,u=0;u<r;u++)l=i===Qb[u]?s:s+1,s=Jb[u],a=Jb[u]=s>a?l>a?a+1:l:l>s?s+1:l;return a}(o.replace(/(.)\1+/g,"$1"),e.replace(/(.)\1+/g,"$1"))<1)return console.log("Found similarity to "+e+" in message: "+n.originalMessage+". Message blocked."),t=r+"(similar to "+e+")",e})),t))),void 0===t)};Ab({allowSend:r=>e.isEnforced&&!n(r)&&void 0!==t?(e.triggerAttempt(null,{USED_WORD:t}),1):0,onSend:r=>{e.inEffect&&!n(r)&&void 0!==t&&e.trigger(null,{USED_WORD:t})}})}}),aw("speech_ban_words_in_emotes",{name:"Forbid saying certain words in emotes",type:4,shortDescription:"based on a configurable blacklist",longDescription:"This rule forbids PLAYER_NAME to use certain words as part of any emote messages. The list of banned words can be configured. Checks are not case sensitive (forbidding 'no' also forbids 'NO' and 'No').",keywords:["limit","restrict","blacklist","blocklist","forbidden"],triggerTexts:{infoBeep:"You are not allowed to use the word 'USED_WORD'!",attempt_log:"PLAYER_NAME tried to use the banned word 'USED_WORD'",log:"PLAYER_NAME used the banned word 'USED_WORD'"},defaultLimit:bd.limited,dataDefinition:{bannedWords:{type:"stringList",default:[],description:"All forbidden words:",options:{validate:/^[\p{L} ]*$/iu}}},init(e){let t;const n=n=>{var r,o;return"Emote"!==n.type||!(null===(r=e.customData)||void 0===r?void 0:r.bannedWords)||(t=null===(o=e.customData)||void 0===o?void 0:o.bannedWords.find((e=>n.originalMessage.toLocaleLowerCase().match(new RegExp(`([^\\p{L}]|^)${$d(e.trim())}([^\\p{L}]|$)`,"iu")))),void 0===t)};Ab({allowSend:r=>e.isEnforced&&!n(r)&&void 0!==t?(e.triggerAttempt(null,{USED_WORD:t}),1):0,onSend:r=>{e.inEffect&&!n(r)&&void 0!==t&&e.trigger(null,{USED_WORD:t})}})}}),aw("speech_forbid_open_talking",{name:"Forbid talking openly",type:4,shortDescription:"in a chat room",longDescription:"This rule forbids PLAYER_NAME to send a message to all people inside a chat room. Does not affect whispers or emotes, but does affect OOC.",keywords:["limit","restrict","loud","saying","speaking","chatting"],triggerTexts:{infoBeep:"You are not allowed to talk openly in chatrooms!",attempt_log:"PLAYER_NAME tried to openly speak in a room",log:"PLAYER_NAME spoke openly in a room"},defaultLimit:bd.blocked,init(e){const t=e=>"Chat"!==e.type;Ab({allowSend:n=>e.isEnforced&&!t(n)?(e.triggerAttempt(),1):0,onSend:n=>{e.inEffect&&!t(n)&&e.trigger()}})}}),aw("speech_limit_open_talking",{name:"Limit talking openly",type:4,loggable:!1,shortDescription:"only allow a set number of chat messages per minute",longDescription:"This rule limits PLAYER_NAME's ability to send a message to all people inside a chat room to only the set number per minute. Does not affect whispers or emotes, but does affect OOC. Note: Setting '0' will have no effect, as there is another rule to forbid open talking completely.",keywords:["limit","restrict","loud","saying","speaking","chatting","slow","fast"],triggerTexts:{infoBeep:"You exceeded the number of allowed chat messages per minute!"},dataDefinition:{maxNumberOfMsg:{type:"number",default:42,description:"Maximum allowed number of chat messages per minute (> 0):",Y:380}},defaultLimit:bd.blocked,init(e){let t=0;const n=e=>"Chat"!==e.type;Ab({allowSend:r=>{var o;if((null===(o=e.customData)||void 0===o?void 0:o.maxNumberOfMsg)&&0!==e.customData.maxNumberOfMsg&&e.isEnforced&&!n(r)){if(t>=e.customData.maxNumberOfMsg)return e.triggerAttempt(),1;u((()=>{t>0&&t--}),6e4)}return 0},onSend:r=>{var o;(null===(o=e.customData)||void 0===o?void 0:o.maxNumberOfMsg)&&0!==e.customData.maxNumberOfMsg&&e.isEnforced&&!n(r)&&t++}})}}),aw("speech_forbid_emotes",{name:"Forbid using emotes",type:4,shortDescription:"in a chat room",longDescription:"This rule forbids PLAYER_NAME to send an emote (with * or /me) to all people inside a chat room.",keywords:["limit","restrict","emoting","acting"],triggerTexts:{infoBeep:"You are not allowed to use emotes in chatrooms!",attempt_log:"PLAYER_NAME tried to use an emote in a room",log:"PLAYER_NAME used an emote in a room"},defaultLimit:bd.blocked,init(e){const t=e=>"Emote"!==e.type;Ab({allowSend:n=>e.isEnforced&&!t(n)?(e.triggerAttempt(),1):0,onSend:n=>{e.inEffect&&!t(n)&&e.trigger()}})}}),aw("speech_limit_emotes",{name:"Limit using emotes",type:4,loggable:!1,shortDescription:"only allow a set number of emotes per minute",longDescription:"This rule forbids PLAYER_NAME to send an emote (with * or /me) to all people inside a chat room to only the set number per minute. Note: Setting '0' will have no effect, as there is another rule to forbid using emotes completely.",keywords:["restrict","emoting","acting","slow","fast"],triggerTexts:{infoBeep:"You exceeded the number of allowed emotes per minute!"},dataDefinition:{maxNumberOfEmotes:{type:"number",default:42,description:"Maximum allowed number of emotes per minute (> 0):",Y:380}},defaultLimit:bd.blocked,init(e){let t=0;Ab({allowSend:n=>{var r;if((null===(r=e.customData)||void 0===r?void 0:r.maxNumberOfEmotes)&&0!==e.customData.maxNumberOfEmotes&&e.isEnforced&&!(e=>"Emote"!==e.type)(n)){if(t>=e.customData.maxNumberOfEmotes)return e.triggerAttempt(),1;t++,u((()=>{t>0&&t--}),6e4)}return 0}})}}),aw("speech_restrict_whisper_send",{name:"Restrict sending whispers",type:4,shortDescription:"except to defined roles",longDescription:"This rule forbids PLAYER_NAME to whisper anything to most people inside a chat room, except to the defined roles. Also affects whispered OOC messages.",keywords:["limit","forbid","whispering","allowlist","block","whitelist"],triggerTexts:{infoBeep:"You are not allowed to whisper to TARGET_PLAYER!",attempt_log:"PLAYER_NAME tried to whisper to TARGET_PLAYER",log:"PLAYER_NAME whispered to TARGET_PLAYER"},defaultLimit:bd.limited,dataDefinition:{minimumPermittedRole:{type:"roleSelector",default:xA.mistress,description:"Minimum role whispering is still allowed to:"}},init(e){const t=t=>{var n;const r=null!=t.target&&XA(t.target);return"Whisper"!==t.type||!r||!(null===(n=e.customData)||void 0===n?void 0:n.minimumPermittedRole)||RA(r)<=e.customData.minimumPermittedRole};Ab({allowSend:n=>e.isEnforced&&!t(n)&&null!=n.target?(e.triggerAttempt(n.target),1):0,onSend:n=>{e.inEffect&&!t(n)&&null!=n.target&&e.trigger(n.target)}})}}),aw("speech_restrict_whisper_receive",{name:"Restrict receiving whispers",type:4,loggable:!1,shortDescription:"except from defined roles",longDescription:"This rule prevents PLAYER_NAME from receiving any whispers, except from the defined roles. If someone tries to send PLAYER_NAME a whisper message while this rule blocks them from doing so, they get an auto reply whisper, if the rule has an auto reply set (text field is not empty). PLAYER_NAME won't get any indication that she would have received a whisper unless the rule is not enforced,  in which case she will see both the whisper and the auto reply. This rule can also be used (by dommes) to prevent getting unwanted whispersfrom strangers in public.",keywords:["limit","forbid","prevent","whispering","hearing","listening","allowlist","block","whitelist"],defaultLimit:bd.blocked,dataDefinition:{minimumPermittedRole:{type:"roleSelector",default:xA.whitelist,description:"Minimum role still allowed to send whisper:",Y:480},autoreplyText:{type:"string",default:"PLAYER_NAME is currently forbidden to receive whispers.",description:"Auto replies blocked sender with this:",Y:320,options:/^([^/.*].*)?$/}},load(e){Zd("ChatRoomMessage",5,((t,n)=>{var r;const o=t[0];if(Ed(o)&&"string"==typeof o.Content&&""!==o.Content&&"Whisper"===o.Type&&"number"==typeof o.Sender&&e.inEffect&&e.customData){const t=XA(o.Sender);if(t&&RA(t)>=e.customData.minimumPermittedRole){if(e.customData.autoreplyText&&!(null===(r=o.Content)||void 0===r?void 0:r.startsWith("[Automatic reply by BCX]\n"))){const t=`[Automatic reply by BCX]\n${Pd(e.customData.autoreplyText,{})}`;ServerSend("ChatRoomChat",{Content:t,Type:"Whisper",Target:o.Sender}),e.isEnforced||yE(t)}if(e.isEnforced)return}}return n(t)}),md.Rules)}}),aw("speech_restrict_beep_send",{name:"Restrict sending beep messages",type:4,shortDescription:"except to selected members",longDescription:"This rule forbids PLAYER_NAME to send any beeps with message, except to the defined list of member numbers. Sending beeps without a message is not affected. Optionally, it can be set that PLAYER_NAME is only forbidden to send beeps while she is unable to use her hands (e.g. fixed to a cross).",triggerTexts:{infoBeep:"You broke the rule that forbids sending a beep message to TARGET_PLAYER!",attempt_log:"PLAYER_NAME broke a rule by trying to send a beep message to TARGET_PLAYER",log:"PLAYER_NAME broke a rule by sending a beep message to TARGET_PLAYER"},keywords:["limit","forbid","prevent","whitelist","allowlist"],defaultLimit:bd.blocked,dataDefinition:{whitelistedMemberNumbers:{type:"memberNumberList",default:[],description:"Member numbers still allowed to be beeped:",options:{pageSize:2}},onlyWhenBound:{type:"toggle",default:!1,description:"Only in effect when unable to use hands",Y:700}},load(e){Zd("FriendListBeepMenuSend",5,((t,n)=>{var r;if(e.inEffect&&e.customData&&(null===(r=document.getElementById("FriendListBeepTextArea"))||void 0===r?void 0:r.value)&&null!=FriendListBeepTarget&&!e.customData.whitelistedMemberNumbers.includes(FriendListBeepTarget)&&(!Player.CanInteract()||!e.customData.onlyWhenBound)){if(e.isEnforced)return void e.triggerAttempt(FriendListBeepTarget);e.trigger(FriendListBeepTarget)}return n(t)}),md.Rules)}}),aw("speech_restrict_beep_receive",{name:"Restrict receiving beeps",type:4,loggable:!1,shortDescription:"and beep messages, except from selected members",longDescription:"This rule prevents PLAYER_NAME from receiving any beep (regardless if the beep carries a message or not), except for beeps from the defined list of member numbers. If someone tries to send PLAYER_NAME a beep message while this rule blocks them from doing so, they get an auto reply beep, if the rule has an auto reply set. PLAYER_NAME won't get any indication that she would have received a beep unless the rule is not enforced, in which case she will see both the beep and the auto reply. Optionally, the rule can be set to only activate while PLAYER_NAME is unable to use her hands (e.g. fixed to a cross).",keywords:["limit","forbid","prevent","reading","whitelist","allowlist"],defaultLimit:bd.blocked,dataDefinition:{whitelistedMemberNumbers:{type:"memberNumberList",default:[],description:"Member numbers still allowed to send beeps:",Y:470,options:{pageSize:2}},autoreplyText:{type:"string",default:"PLAYER_NAME is currently forbidden to receive beeps.",description:"Auto replies blocked sender with this:",Y:300},onlyWhenBound:{type:"toggle",default:!1,description:"Only in effect when unable to use hands",Y:740}},load(e){Zd("ServerAccountBeep",5,((t,n)=>{var r;const o=t[0];if(Ed(o)&&!o.BeepType&&"number"==typeof o.MemberNumber&&e.inEffect&&e.customData&&!e.customData.whitelistedMemberNumbers.includes(o.MemberNumber)&&(!Player.CanInteract()||!e.customData.onlyWhenBound)){if(e.customData.autoreplyText&&(null==o.Message||"string"==typeof o.Message&&!o.Message.startsWith("[Automatic reply by BCX]\n"))){const t=`[Automatic reply by BCX]\n${Pd(e.customData.autoreplyText,{})}`;ServerSend("AccountBeep",{MemberNumber:o.MemberNumber,BeepType:"",Message:t,IsSecret:!0}),e.isEnforced||(yE(t),FriendListBeepLog.push({MemberNumber:o.MemberNumber,MemberName:(null===(r=Player.FriendNames)||void 0===r?void 0:r.get(o.MemberNumber))||"Unknown",ChatRoomName:void 0,Sent:!0,Private:!1,Time:new Date,Message:t}))}if(e.isEnforced)return}return n(t)}),md.Rules)}}),aw("speech_greet_order",{name:"Order to greet club",type:4,loggable:!1,shortDescription:"when entering it through the login portal",longDescription:"PLAYER_NAME will automatically send all defined member numbers (if they are currently online and friends with PLAYER_NAME) a beep the moment PLAYER_NAME joins the club or the moment she start BCX to make her presence known. Disconnects don't count as coming into the club again, as far as detectable. NOTE: Trigger conditions should not be selected when using this rule, as if you for instance select 'when in public room' the rule will only greet when you load BCX in a public room.",keywords:["beep","loging","in","online"],triggerTexts:{infoBeep:"A BCX rule made you greet one or more people (if currently online) with a beep.",attempt_log:"",log:""},defaultLimit:bd.blocked,dataDefinition:{toGreetMemberNumbers:{type:"memberNumberList",default:[],description:"Member numbers that will be greeted:"}},load(e){if(e.isEnforced&&e.customData){for(const t of e.customData.toGreetMemberNumbers)ServerSend("AccountBeep",{MemberNumber:t,BeepType:"",IsSecret:!0});e.customData.toGreetMemberNumbers.length>0&&u((()=>{e.trigger()}),5e3)}}}),aw("speech_block_antigarble",{name:"Forbid the antigarble option",type:4,shortDescription:"BCX's .antigarble command",longDescription:"This rule forbids PLAYER_NAME to use the antigarble command. Antigarble is a BCX feature that enables a BCX user to understand muffled voices from other gagged characters or when wearing a deafening item. If PLAYER_NAME should be forbidden to use the command, this rule should be used.",keywords:["limit","forbid","prevent","garbling","deafness","gagged","gagtalk"],triggerTexts:{infoBeep:"You are not allowed to use the antigarble command!",attempt_log:"PLAYER_NAME tried to use the antigarble command",log:"PLAYER_NAME used the antigarble command"},defaultLimit:bd.normal}),aw("speech_force_retype",{name:"Force to retype",type:4,loggable:!1,shortDescription:"if sending a message in chat is rejected by BCX due to a rule violation",longDescription:"This rule forces PLAYER_NAME to retype any chat/whisper/emote/OOC message as a punishment when they try to send it and another enforced BCX speech rule determines that there is any rule violation in that message.",keywords:["punish","retry","clear","input","blocked","forbidden"],defaultLimit:bd.limited});let e=!1,t="";aw("greet_room_order",{name:"Order to greet room",type:4,shortDescription:"with a settable sentence when entering it newly",longDescription:"Sets a specific sentence that PLAYER_NAME must say loud after entering a room that is not empty. The sentence is autopopulating the chat window text input. When to say it is left to PLAYER_NAME, but when the rule is enforced, it is the only thing that can be said in this room after joining it. Emotes can still be used, though, unless toggled to be forbidden. Disconnects don't count as coming into a new room again, as far as detectable.",keywords:["say","present","introduce"],triggerTexts:{infoBeep:"You broke the rule to greet this room like taught!",attempt_infoBeep:"You need to greet this room like taught!",attempt_log:"PLAYER_NAME almost broke a rule by not greeting the room like taught",log:"PLAYER_NAME broke a rule by not greeting the room like taught"},defaultLimit:bd.limited,dataDefinition:{greetingSentence:{type:"string",default:"",description:"The sentence that has to be used to greet any joined room:",options:/^([^/.*()\s][^()]*)?$/},affectEmotes:{type:"toggle",default:!1,description:"Also forbid emote messages before greeting",Y:560}},load(n){Zd("ChatRoomSync",0,((r,o)=>{const i=r[0];i.Name!==t&&(e=!1),o(r);const a=document.getElementById("InputChat");a&&n.customData&&n.inEffect&&!e&&i.Name!==t?a.value=n.customData.greetingSentence:e=!0}),md.Rules)},init(n){const r=e=>{var t;return e.originalMessage.toLocaleLowerCase()===(null===(t=n.customData)||void 0===t?void 0:t.greetingSentence.trim().toLocaleLowerCase())&&"Chat"===e.type};Ab({allowSend:o=>{var i,a;return n.isEnforced&&(null===(i=n.customData)||void 0===i?void 0:i.greetingSentence.trim())&&!e&&("Emote"!==o.type||"Emote"===o.type&&n.customData.affectEmotes)?((null===ChatRoomData||void 0===ChatRoomData?void 0:ChatRoomData.Name)&&(t=ChatRoomData.Name),r(o)?(e=!0,2):(n.triggerAttempt(),yE(`You are expected to greet the room with "${null===(a=n.customData)||void 0===a?void 0:a.greetingSentence}".`),1)):0},onSend:t=>{var o;"Emote"!==t.type&&n.inEffect&&(null===(o=n.customData)||void 0===o?void 0:o.greetingSentence.trim())&&!e&&(r(t)||n.trigger(),e=!0)}})}}),aw("greet_new_guests",{name:"Greet new guests",type:4,loggable:!1,shortDescription:"when they join the current room",longDescription:"Forces PLAYER_NAME to greet people newly entering the current chat room with the set sentence. NOTE: Only PLAYER_NAME and the new guest can see the message not to make it spammy. After a new person has been greeted, she will not be greeted for 10 minutes after she left (including disconnect) the room PLAYER_NAME is in. Setting an emote as a greeting is also supported by starting the set message with one or two '*' characters.",keywords:["say","present","introduce"],defaultLimit:bd.limited,dataDefinition:{greetingSentence:{type:"string",default:"",description:"The sentence that will be used to greet new guests:",options:/^([^/.].*)?$/}},load(e){const t=new Map;Zd("ChatRoomSyncMemberLeave",2,((e,n)=>{n(e);const r=e[0];t.has(r.SourceMemberNumber)&&t.set(r.SourceMemberNumber,Date.now()+6e5)}),md.Rules),Zd("ChatRoomAddCharacterToChatRoom",3,((n,r)=>{const o=ChatRoomCharacter.length;if(r(n),e.customData&&e.isEnforced&&o<ChatRoomCharacter.length){const r=n[0];void 0!==r.MemberNumber&&t.has(r.MemberNumber)&&t.get(r.MemberNumber)<Date.now()&&t.delete(r.MemberNumber),u((()=>{if(e.customData&&e.isEnforced&&ChatRoomCharacter.includes(r)&&void 0!==r.MemberNumber&&!(t.has(r.MemberNumber)&&t.get(r.MemberNumber)>=Date.now()))if(t.set(r.MemberNumber,0),e.customData.greetingSentence.startsWith("*")){const t=e.customData.greetingSentence.slice(1);ServerSend("ChatRoomChat",{Content:t,Type:"Emote",Target:r.MemberNumber}),ServerSend("ChatRoomChat",{Content:t,Type:"Emote",Target:Player.MemberNumber})}else ServerSend("ChatRoomChat",{Content:e.customData.greetingSentence,Type:"Chat",Target:r.MemberNumber}),ServerSend("ChatRoomChat",{Content:e.customData.greetingSentence,Type:"Chat",Target:Player.MemberNumber})}),5e3)}}),md.Rules)}}),aw("speech_alter_faltering",{name:"Enforce faltering speech",type:4,loggable:!1,shortDescription:"an enhanced studder effect is added to PLAYER_NAME's chat texts",longDescription:"Thus rule converts PLAYER_NAME's messages, so she is only able to speak studdering and with random filler sounds, for some [RP] reason (anxiousness, arousal, fear, etc.). Converts the typed chat text automatically. Affects chat messages and whispers, but not OOC.",keywords:["garble","saying","talking"],defaultLimit:bd.limited,init(e){Ab({modify:(t,n)=>!e.inEffect||"Chat"!==t.type&&"Whisper"!==t.type?n:function(e){const t=["uuh","ah","uhm","mnn","nn","fuck","tie me up","hardcore kink","bind me","harder","spank me","blind me","gag me","never release","strict","punish","forever","love you","restrain me","I love hardcore","chain me","aaaah"],n=[""," ","  ",".","..","...","....",".....","......","......."],r=[];t.forEach((e=>{const t=n[Math.floor(Math.random()*n.length)],o=n[Math.floor(Math.random()*n.length)];r.push(t+e+o)})),console.log("sounds: "+JSON.stringify(r));let o=!0,i=!1,a=e.length;for(let n=0;n<e.length;n++){const s=e.charAt(n).toLowerCase();if(!i&&/\p{L}/giu.test(s)){const s=Math.floor(1e5*Math.sin(a++))%10;(!i&&s>=6||o)&&(e=e.substring(0,n+1)+"-"+e.substring(n,e.length),a++,Math.random()<.25&&!o&&(e=e.substring(0,n)+r[Math.floor(Math.random()*t.length)]+e.substring(n,e.length)),n+=2,o&&(o=!1)),i=!0}" "===s&&(i=!1)}return e}(n)})}}),aw("speech_mandatory_words",{name:"Establish mandatory words",type:4,shortDescription:"of which at least one needs to always be included when speaking",longDescription:"This rule gives PLAYER_NAME a list of words from which at least one has to always be used in any chat message. The list of mandatory words can be configured. Checks are not case sensitive (adding 'miss' also works for 'MISS' and 'Miss' - Note: 'Miiiiissss' would also match). Doesn't affect whispers, emotes and OOC text. There is a toggle for affecting whispers, too.",keywords:["force","require","talking","saying","certain","specific"],triggerTexts:{infoBeep:"You forgot to include one of the mandatory words!",attempt_log:"PLAYER_NAME almost forgot to use a mandatory word while talking",log:"PLAYER_NAME did not use a mandatory word while talking"},defaultLimit:bd.normal,dataDefinition:{mandatoryWords:{type:"stringList",default:[],description:"At least one of these words always needs to be used:",options:{validate:/^[\p{L} ]*$/iu,pageSize:3}},affectWhispers:{type:"toggle",default:!1,description:"Also affect whispered messages",Y:740}},init(e){const t=t=>{var n,r,o,i,a;if("Chat"!==t.type&&("Whisper"!==t.type||t.originalMessage.startsWith("!")&&!t.originalMessage.startsWith("!!")||!(null===(n=e.customData)||void 0===n?void 0:n.affectWhispers))||!(null===(o=null===(r=e.customData)||void 0===r?void 0:r.mandatoryWords)||void 0===o?void 0:o.length))return!0;const s=t.originalMessage.toLocaleLowerCase(),l=null===(i=e.customData)||void 0===i?void 0:i.mandatoryWords.filter((e=>/^[\p{L}]*$/iu.test(e)));return""===s.trim()||(null===(a=e.customData)||void 0===a?void 0:a.mandatoryWords.some((e=>s.match(new RegExp(`([^\\p{L}]|^)${$d(e.trim())}([^\\p{L}]|$)`,"iu")))))||s.split(/[^\p{L}]+/u).some((e=>ew(l,e,!1)))};Ab({allowSend:n=>e.isEnforced&&!t(n)?(e.triggerAttempt(),1):0,onSend:n=>{e.inEffect&&!t(n)&&e.trigger()}})}}),aw("speech_mandatory_words_in_emotes",{name:"Establish mandatory words in emotes",type:4,shortDescription:"of which at least one needs to always be included",longDescription:"This rule gives PLAYER_NAME a list of words from which at least one has to always be used in any emote message. The list of mandatory words can be configured. Checks are not case sensitive (adding 'miss' also works for 'MISS' and 'Miss' - Note: 'Miiiiissss' would also match).",keywords:["force","require","talking","saying","certain","specific"],triggerTexts:{infoBeep:"You forgot to include one of the mandatory words!",attempt_log:"PLAYER_NAME almost forgot to use a mandatory word while talking",log:"PLAYER_NAME did not use a mandatory word while talking"},defaultLimit:bd.blocked,dataDefinition:{mandatoryWords:{type:"stringList",default:[],description:"At least one of these words always needs to be used:",options:{validate:/^[\p{L} ]*$/iu}}},init(e){const t=t=>{var n,r,o,i;if("Emote"!==t.type||!(null===(r=null===(n=e.customData)||void 0===n?void 0:n.mandatoryWords)||void 0===r?void 0:r.length))return!0;const a=t.originalMessage.toLocaleLowerCase(),s=null===(o=e.customData)||void 0===o?void 0:o.mandatoryWords.filter((e=>/^[\p{L}]*$/iu.test(e)));return""===a.trim()||(null===(i=e.customData)||void 0===i?void 0:i.mandatoryWords.some((e=>a.match(new RegExp(`([^\\p{L}]|^)${$d(e.trim())}([^\\p{L}]|$)`,"iu")))))||a.split(/[^\p{L}]+/u).some((e=>ew(s,e,!1)))};Ab({allowSend:n=>e.isEnforced&&!t(n)?(e.triggerAttempt(),1):0,onSend:n=>{e.inEffect&&!t(n)&&e.trigger()}})}}),aw("speech_partial_hearing",{name:"Partial hearing",type:4,shortDescription:"of muffled speech - random & word list based",longDescription:"This rule gives PLAYER_NAME ability to understand parts of a muffled sentence ungarbled, based on a white list of words and/or randomly. On default, applies only to muffled hearing from deafening effects on PLAYER_NAME, but optionally can be enhanced to allow also partially understanding the muffled speech of other persons who are speech impaired. Doesn't affect emotes and OOC text.",keywords:["deafness","garbling","antigarble","understanding","ungarble","specific","words","whitelist","allowlist"],loggable:!1,defaultLimit:bd.normal,dataDefinition:{alwaysUnderstandableWords:{type:"stringList",default:[],description:"Words that can always be understood:",options:{validate:/^[\p{L}]*$/iu,pageSize:3}},randomUnderstanding:{type:"toggle",default:!0,description:"Some words are randomly understood",Y:650},affectGaggedMembersToggle:{type:"toggle",default:!1,description:"Can also understand gagged persons",Y:740}},load(e){Zd("SpeechGarble",2,((t,n)=>{const r=t[0];return!e.isEnforced||!r.CanTalk()&&e.customData&&!e.customData.affectGaggedMembersToggle?n(t):t[1].replace(/\([^)]+\)?|\p{L}+/gimu,(n=>{var r,o;return n.startsWith("(")||(null===(r=e.customData)||void 0===r?void 0:r.randomUnderstanding)&&Math.random()<.25||(null===(o=e.customData)||void 0===o?void 0:o.alwaysUnderstandableWords.some((e=>n.toLocaleLowerCase()===e.toLocaleLowerCase())))?n:eh("SpeechGarble",[t[0],n,t[2]])}))}),md.Rules)}}),aw("speech_garble_while_talking",{name:"Force garbled speech",type:4,loggable:!1,shortDescription:"force PLAYER_NAME to talk as if they were gagged",longDescription:'This rule forces PLAYER_NAME to talk as if they were gagged, automatically garbling all of their speech. This rule does not affect OOC. This rule only affects whispers if the rule "Garble whispers while gagged" is also in effect.',keywords:["saying","talking","gagtalk","garbling","forced"],defaultLimit:bd.normal,dataDefinition:{gagLevel:{type:"number",default:5,options:{min:1,max:25},description:"The level of forced garbling"}},init(e){Ab({modify:(t,n)=>e.isEnforced&&"Chat"===t.type?eh("SpeechGarble",[Player,n,!0]):n})},load(e){Zd("SpeechGetTotalGagLevel",0,((t,n)=>{var r;const o=n(t);return e.isEnforced&&(null===(r=e.customData)||void 0===r?void 0:r.gagLevel)&&t[0].IsPlayer()?Math.max(o,e.customData.gagLevel):o}),md.Rules)}})}(),function(){let e=Date.now(),t=!1;function n(){e=Date.now(),t=!1}aw("other_forbid_afk",{name:"Forbid going afk",type:99,enforceable:!1,shortDescription:"logs whenever PLAYER_NAME is inactive",longDescription:"This rule forbids PLAYER_NAME to go afk and logs when the allowed inactivity threshold is overstepped.",keywords:["inactivity","detect","record"],triggerTexts:{log:"PLAYER_NAME became inactive, which was forbidden",announce:""},defaultLimit:bd.blocked,dataDefinition:{minutesBeforeAfk:{type:"number",default:10,description:"Amount of minutes, before being considered inactive:"}},load(){AfkTimerEventsList.forEach((e=>document.addEventListener(e,n,!0)))},tick:n=>!!(!t&&n.inEffect&&n.customData&&Date.now()>e+60*n.customData.minutesBeforeAfk*1e3)&&(t=!0,n.trigger(),yE("You broke a BCX rule by being inactive for too long. The transgression was logged."),!0),unload(){AfkTimerEventsList.forEach((e=>document.removeEventListener(e,n,!0)))}});let r=0;aw("other_track_time",{name:"Track rule effect time",type:99,enforceable:!1,loggable:!1,shortDescription:"counts the time this rule's trigger conditions were fulfilled",longDescription:"This rule shows the amount of time that PLAYER_NAME spent (online) in the club, since the rule was added, while all of the rule's trigger conditions were fulfilled. So it can for instance log the time spent in public rooms / in the club in general, or in a specific room or with some person as part of a roleplayed task or order. The currently tracked time can be inquired by whispering '!ruletime' to PLAYER_NAME. To reset the counter, remove and add the rule again.",keywords:["record","stopwatch","timer","online"],internalDataValidate:e=>"number"==typeof e,internalDataDefault:()=>0,defaultLimit:bd.blocked,dataDefinition:{minimumPermittedRole:{type:"roleSelector",default:xA.lover,description:"Minimum role able to request counted time:"}},init(e){Aw("hidden","ruletime",null,((t,n,o)=>{if(e.condition&&e.customData&&void 0!==e.internalData&&RA(n)<=e.customData.minimumPermittedRole){const t=e.inEffect?Date.now()-r:0;return o(`Since the time tracking rule was added, ${Td(e.internalData+t)} were counted, where all trigger conditions were true.`),!0}return!1}),null,!1)},load(){r=Date.now()},tick(e){if(e.inEffect&&void 0!==e.internalData){const t=Math.floor(Date.now()-r);t>=6e4&&(e.internalData+=t,r=Date.now())}return!1},stateChange(e,t){if(t)r=Date.now();else if(void 0!==e.internalData){const t=Math.floor(Date.now()-r);e.internalData+=t,r=Date.now()}}});let o=0;aw("other_constant_reminder",{name:"Listen to my voice",type:99,loggable:!1,enforceable:!1,shortDescription:"regularly show configurable sentences to PLAYER_NAME",longDescription:"This rule reminds or tells PLAYER_NAME one of the recorded sentences at random in a settable interval. Only PLAYER_NAME can see the set message and it is only shown if in a chat room.",keywords:["hear","voices","in","head","messages","periodic"],defaultLimit:bd.limited,dataDefinition:{reminderText:{type:"stringList",default:[],description:"The sentences that will be shown at random:",Y:296},reminderFrequency:{type:"number",default:15,description:"Frequency of a sentence being shown (in minutes):",Y:715}},tick:e=>!!(e.inEffect&&e.customData&&e.customData.reminderText.length>0&&ServerPlayerIsInChatRoom()&&Date.now()>o+60*e.customData.reminderFrequency*1e3)&&(o=Date.now(),yE("[Voice] "+e.customData.reminderText[Math.floor(Math.random()*e.customData.reminderText.length)]),!0)}),aw("other_log_money",{name:"Log money changes",type:99,enforceable:!1,shortDescription:"spending and/or getting money",longDescription:"This rule logs whenever money is used to buy something. It also shows how much money PLAYER_NAME currently has in the log entry. Optionally, earning money can also be logged. Note: Please be aware that this last option can potentially fill the whole behaviour log rapidly.",keywords:["record","balance","earnings","using","tracking","logging","entry","financial","findom"],triggerTexts:{infoBeep:"A BCX rule has logged this financial transaction!",log:"PLAYER_NAME TYPE money: AMOUNT $ | new balance: BALANCE $",announce:""},defaultLimit:bd.normal,dataDefinition:{logEarnings:{type:"toggle",default:!1,description:"Also log getting money"}},internalDataValidate:e=>"number"==typeof e,internalDataDefault:()=>-1,stateChange(e,t){t||(e.internalData=-1)},tick(e){if(!e.internalData||!Number.isFinite(Player.Money))return!1;let t=!1;return e.inEffect&&(e.internalData<0&&(e.internalData=Player.Money),e.internalData>Player.Money?(e.trigger(null,{TYPE:"spent",AMOUNT:""+(e.internalData-Player.Money),BALANCE:`${Player.Money}`}),t=!0):e.internalData<Player.Money&&e.customData&&e.customData.logEarnings&&(e.trigger(null,{TYPE:"earned",AMOUNT:""+(Player.Money-e.internalData),BALANCE:`${Player.Money}`}),t=!0),e.internalData!==Player.Money&&(e.internalData=Player.Money)),t}});const i=(e,t)=>{var n;return!!(null===(n=e["BCX/GoodGirl"])||void 0===n?void 0:n.TypePermissions[t.toString()])},a=(e,t)=>{var n;const r=e;null!==(n=r["BCX/GoodGirl"])&&void 0!==n||(r["BCX/GoodGirl"]=PreferencePermissionGetDefault()),r["BCX/GoodGirl"].TypePermissions={[t.toString()]:"Favorite"}};aw("other_track_BCX_activation",{name:"Track BCX activation",type:99,enforceable:!1,shortDescription:"logs if PLAYER_NAME enters the club without BCX",longDescription:"This rule observes PLAYER_NAME, logging it as a rule violation if the club was previously entered at least once without BCX active.",keywords:["record","online","force","useage","using","login"],triggerTexts:{infoBeep:"You logged in without starting BCX beforehand!",log:"PLAYER_NAME logged in without starting BCX beforehand at least once",announce:""},internalDataValidate:e=>"number"==typeof e,internalDataDefault:()=>Math.floor(1e6*Math.random()),defaultLimit:bd.blocked,load(e){if(Jd("ServerUnPackItemPermissions",{'let asset = AssetGet("Female3DCG", Group, Name);':"let asset = Group !== 'BCX' ? AssetGet(\"Female3DCG\", Group, Name) : {};"}),e.inEffect&&void 0!==e.internalData){const{permissions:t}=ServerUnPackItemPermissions(l,Player.GetDifficulty()>=3);s&&i(t,e.internalData)?(e.internalData=Math.floor(1e6*Math.random()),a(Player.PermissionItems,e.internalData),ServerPlayerBlockItemsSync()):u((()=>{e.trigger(),e.internalData=Math.floor(1e6*Math.random()),a(Player.PermissionItems,e.internalData),ServerPlayerBlockItemsSync()}),3500)}},stateChange(e,t){t?(e.internalData=Math.floor(1e6*Math.random()),a(Player.PermissionItems,e.internalData),ServerPlayerBlockItemsSync()):(delete Player.PermissionItems["BCX/GoodGirl"],ServerPlayerBlockItemsSync())},tick:e=>(e.inEffect&&void 0!==e.internalData&&(!i(Player.PermissionItems,e.internalData)||Math.random()<.01)&&(e.internalData=Math.floor(1e6*Math.random()),a(Player.PermissionItems,e.internalData),ServerPlayerBlockItemsSync()),!1)})}();for(const e of ow.values())e.init&&e.init(e.state)}load(){if(AA(md.Rules))for(const e of ow.values())e.load&&e.load(e.state)}run(){AA(md.Rules)&&(this.resetTimer=c((()=>{this.triggerCounts.clear()}),6e4))}unload(){null!==this.resetTimer&&(clearInterval(this.resetTimer),this.resetTimer=null);for(const e of ow.values())e.unload&&e.unload()}reload(){this.unload(),this.load(),this.run()}ruleStateChange(e,t,n){var r;const o=ow.get(e);if(!o)throw new Error(`Definition for rule ${e} not found`);null===(r=o.stateChange)||void 0===r||r.call(o,o.state,n)}ruleTick(e,t){var n;if(null!==this.suspendedUntil){if(!(Date.now()>=this.suspendedUntil))return;this.suspendedUntil=null,this.triggerCounts.clear(),gE("All of SourceCharacter's temporarily suspended rules are in effect again.",null,[{Tag:"SourceCharacter",MemberNumber:Player.MemberNumber,Text:CharacterNickname(Player)}])}const r=ow.get(e);if(!r)throw new Error(`Definition for rule ${e} not found`);if(r.tick&&r.tick(r.state)){const t=(null!==(n=this.triggerCounts.get(e))&&void 0!==n?n:0)+1;this.triggerCounts.set(e,t),t>=10&&(gE("Protection triggered: The effects of rules have been suspended for 10 minutes. Please refrain from triggering rules so rapidly, as it creates strain on the server and may lead to unwanted side effects! If you believe this message was triggered by a bug, please report it to BCX Discord."),this.suspendedUntil=Date.now()+6e5)}}}),DA(new class extends Cd{load(){let e=null;Zd("CommandParse",5,((t,n)=>{const r=t[0].trim();if(r){const n=Eb(r);if(n){const r=Sb(n);if(null===r)return!0;t[0]=r,e={result:r.startsWith("//")?r.substring(1):r,original:n.originalMessage.startsWith("//")?n.originalMessage.substring(1):n.originalMessage,target:n.target}}}const o=n(t);return e=null,o})),Zd("ServerSend",1,((t,n)=>{const r=t[1];return"ChatRoomChat"===t[0]&&e&&Ed(r)&&("Whisper"===r.Type||"Chat"===r.Type)&&("number"==typeof r.Target?r.Target:null)===e.target&&r.Content!==e.original&&(Array.isArray(r.Dictionary)||(r.Dictionary=[]),r.Dictionary.push({Tag:"BCX_ORIGINAL_MESSAGE",Text:e.original})),n(t)})),Zd("ChatRoomMessage",1,((e,t)=>(e[0],t(e)))),Zd("CommandParse",0,((e,t)=>t(e))),Zd("ChatRoomSendEmote",5,((e,t)=>{const n=Eb(e[0]),r=Sb(n);if(null!==r&&"Emote"===(null==n?void 0:n.type))return t(["*"+r])})),Zd("SpeechGarble",6,((e,t)=>t(e)))}}),DA(new class extends Cd{init(){let e=null;if(e=localStorage.getItem(iA()),"string"==typeof e&&(console.info("HardCoreClub: Detected storage location: local storage"),oA=eA.LocalStorage),"string"!=typeof e){if(!Ed(Player.OnlineSettings))return console.error("HardCoreClub: Missing OnlineSettings during load"),alert("HardCoreClub: Failed to load data, please see console for more details"),!1;e=Player.OnlineSettings.BCX,oA=eA.OnlineSettings}if("string"!=typeof e){const t=localStorage.getItem(aA());"string"==typeof t&&confirm("HardCoreClub: Error loading saved data, but found local backup.\nDo you want to load the backup?")&&(e=t)}if("string"==typeof e)try{const t=JSON.parse(LZString.decompressFromBase64(e));if(!Ed(t))throw new Error("Bad data");tA=t}catch(e){if(console.error("HardCoreClub: Error while loading saved data, full reset.",e),!confirm(`HardCoreClub Failed to load saved data! Continue anyway, resetting all data?\n(${e})`))return!1;rA=!0}else{if(void 0!==e)return console.error("HardCoreClub: Unknown save data type:",e),alert("HardCoreClub: Failed to load data, please see console for more details"),!1;console.log("HardCoreClub: First time init"),rA=!0}return!0}run(){sA()}}),DA(new class extends Cd{load(){cA.set("versionResponse",((e,t)=>{var n,r;if(e===sd)if(Ed(t)&&"string"==typeof t.status){if(null!==QC&&(clearTimeout(QC),QC=null),QC=u(r_,6e4*(15+5*Math.random())),console.log("==> Next Check timer: "+QC),"current"===t.status)e_=!1;else if("newAvailable"===t.status)e_=!0,t_||(t_=!0,ServerPlayerIsInChatRoom()?yE("New HardCoreClub version is available! You can upgrade by logging in again."):fE("New HardCoreClub version is available! You can upgrade by logging in again.",1e4));else if("deprecated"===t.status){if(e_=!0,!t_){t_=!0;const e=document.createElement("div");e.style.position="fixed",e.style.top="0px",e.style.right="0px",e.style.bottom="0px",e.style.left="0px",e.style.background="#00000090",e.style.display="flex",e.style.alignItems="center",e.style.justifyContent="center";const t=document.createElement("div");e.appendChild(t),t.style.background="white",t.style.display="flex",t.style.flexDirection="column",t.style.padding="1em";const o=document.createElement("h1");t.appendChild(o),o.innerText="Deprecated HardCoreClub version";const i=document.createElement("p");t.appendChild(i),i.innerText="The HardCoreClub version you are using is too old and either contains critical bugs or is no longer compatible with the current Bondage Club release version.\nUnless you are using additional mods preventing this, please refresh the page and log into the club again to load the newest version.";const a=document.createElement("button");a.style.cursor="pointer",t.appendChild(a),a.innerText="Close",a.onclick=()=>{e.remove()},null===(r=null===(n=document.activeElement)||void 0===n?void 0:n.blur)||void 0===r||r.call(n),window.document.body.appendChild(e)}}else"unsupported"===t.status?(zC(),alert("The HardCoreClub version you are trying to load is too old and either contains critical bugs or is no longer compatible with the current Bondage Club release version. Please update your BCX.")):console.warn(`HardCoreClub: bad versionResponse status "${t.status}"`);KC===t.supporterStatus&&JC===t.supporterSecret||(KC=t.supporterStatus,JC=t.supporterSecret,Jk()),o_()}else console.warn("HardCoreClub: bad versionResponse",t);else console.warn(`HardCoreClub: got versionResponse from unexpected sender ${e}, ignoring`)})),cA.set("supporterCheckResult",((e,t)=>{if(e!==sd)return void console.warn(`HardCoreClub: got supporterCheckResult from unexpected sender ${e}, ignoring`);if(!Ed(t)||"number"!=typeof t.memberNumber||void 0!==t.status&&"string"!=typeof t.status)return void console.warn("HardCoreClub: bad supporterCheckResult",t);const n=n_.get(t.memberNumber);n?(n.status=t.status,n.verified=!0):console.warn("HardCoreClub: supporterCheckResult unknown memberNumber",t)})),Zd("LoginResponse",0,((e,t)=>{t(e);const n=e[0];Ed(n)&&"string"==typeof n.Name&&"string"==typeof n.AccountName&&r_()}))}run(){r_()}unload(){null!==QC&&(clearTimeout(QC),QC=null)}}),DA(new class extends Cd{init(){IA("misc_wardrobe_item_import",{name:"Allow importing items using wardrobe",category:md.Misc,defaults:{[hd.dominant]:[!0,xA.whitelist],[hd.switch]:[!0,xA.friend],[hd.submissive]:[!0,xA.friend],[hd.slave]:[!0,xA.friend]}}),function(){for(const e of[m_.clothes,m_.cosplay])AssetGroup.filter((t=>e.filter(t))).forEach((e=>y_.add(e.Name)));const e=Asset.filter((e=>"ItemMisc"===e.Group.Name&&e.IsLock));f_=xd(e);for(const t of e)t.OwnerOnly||t.LoverOnly||InventoryIsPermissionBlocked(Player,t.Name,t.Group.Name)||v_.add(t.Name)}()}load(){"boolean"!=typeof tA.wardrobeDefaultExtended&&(tA.wardrobeDefaultExtended=!0),Zd("CharacterAppearanceLoadCharacter",0,((e,t)=>{const n=e[0],r=n.MemberNumber&&XA(n.MemberNumber);return r&&null!=r.BCXVersion?r.getPermissionAccess("misc_wardrobe_item_import").then((e=>{I_=e?r.MemberNumber:-1})).catch((e=>{console.warn("HardCoreClub: Failed to get permission to import wardrobe restraints:",e),I_=-1})):I_=-1,t(e)})),Jd("AppearanceRun",{'DrawButton(1820, 430 + (W - CharacterAppearanceWardrobeOffset) * 95, 160, 65, "Save"':'DrawButton(1860, 430 + (W - CharacterAppearanceWardrobeOffset) * 95, 120, 65, "Save"'}),Jd("AppearanceRun",{"DrawButton(1300, 430 + (W - CharacterAppearanceWardrobeOffset) * 95, 500,":"DrawButton(1385, 430 + (W - CharacterAppearanceWardrobeOffset) * 95, 455,"}),Jd("AppearanceRun",{"1550, 463 + (W - CharacterAppearanceWardrobeOffset) * 95, 496,":"1614, 463 + (W - CharacterAppearanceWardrobeOffset) * 95, 446,"}),Zd("AppearanceRun",7,((e,t)=>G_?G_.Run():t(e))),Zd("AppearanceRun",2,((e,t)=>{if(t(e),"Wardrobe"===CharacterAppearanceMode){if(Id){const e=125;DrawButton(1380,e,50,50,"","White","","How does it work?"),CE("Icons/Question.png",1383,e+3,{Width:44,Height:44});const t=CharacterAppearanceSelection,n=null!=t&&I_===t.MemberNumber;DrawButton(1457,e,50,50,"",n?"White":N_?"pink":"#ddd","","Include items/restraints"),CE("../Icons/Bondage.png",1463,e+6,{Alpha:N_?1:.2,Width:38,Height:38}),DrawButton(1534,e,207,50,"Export","White",""),DrawButton(1768,e,207,50,"Import",!n&&N_?"#ddd":"White","",void 0,!n&&N_)}if(Player.Wardrobe)for(let e=CharacterAppearanceWardrobeOffset;e<Player.Wardrobe.length&&e<CharacterAppearanceWardrobeOffset+6;e++)DrawButton(1300,430+95*(e-CharacterAppearanceWardrobeOffset),65,65,"","White",""),CE("./Icons/DialogPermissionMode.png",1306,430+95*(e-CharacterAppearanceWardrobeOffset)+6,{Width:53,Height:53})}R_&&"Wardrobe"===CharacterAppearanceMode&&(DrawRect(30,190,1240,780,"#ffff88"),DrawEmptyRect(30,190,1240,780,"Black"),MainCanvas.textAlign="left",DrawTextWrap(T_,-550,210,1200,740,"black"),MainCanvas.textAlign="center")})),Jd("AppearanceClick",{"(MouseX >= 1300) && (MouseX < 1800)":"(MouseX >= 1385) && (MouseX < 1385 + 455)"}),Jd("AppearanceClick",{"(MouseX >= 1820) && (MouseX < 1975)":"(MouseX >= 1860) && (MouseX < 1980)"}),Zd("AppearanceClick",7,((e,t)=>G_?G_.Click():t(e))),Zd("AppearanceClick",2,((e,t)=>{if("Wardrobe"===CharacterAppearanceMode){if(Id){const e=125;if(MouseIn(1380,e,50,50)||MouseIn(30,190,1240,780)&&R_)return void(R_=!R_);if(MouseIn(1457,e,50,50))return void(N_=!N_);if(MouseIn(1534,e,207,50))return void u((async()=>{await navigator.clipboard.writeText(C_(N_)),CharacterAppearanceWardrobeText="Copied to clipboard!"}),0);if(MouseIn(1768,e,207,50))return void u((async()=>{if("function"!=typeof navigator.clipboard.readText)return void(CharacterAppearanceWardrobeText="Please press Ctrl+V");const e=await navigator.clipboard.readText(),t=j_()?U_(e):x_(e,N_,lE);t&&(CharacterAppearanceWardrobeText=t)}),0)}if(Array.isArray(Player.Wardrobe)&&MouseIn(1300,430,65,540))for(let e=CharacterAppearanceWardrobeOffset;e<Player.Wardrobe.length&&e<CharacterAppearanceWardrobeOffset+6;e++)if(MouseYIn(430+95*(e-CharacterAppearanceWardrobeOffset),65)){const t=Player.Wardrobe[e];return void(Array.isArray(t)&&t.every((e=>Ed(e)))&&U_(t,!0))}}t(e)})),Zd("AppearanceExit",7,((e,t)=>G_?G_.Exit():t(e))),Zd("WardrobeRun",7,((e,t)=>G_?G_.Run():t(e))),Zd("WardrobeRun",2,((e,t)=>{if(t(e),Id){const e=90;DrawButton(1e3,e,50,50,"","White","","How does it work?"),CE("Icons/Question.png",1003,e+3,{Width:44,Height:44});const t=CharacterAppearanceSelection,n=null!=t&&I_===t.MemberNumber;DrawButton(425,e,50,50,"",n?"White":N_?"pink":"#ddd","","Include items/restraints"),CE("../Icons/Bondage.png",431,e+6,{Alpha:N_?1:.2,Width:38,Height:38}),DrawButton(750,e,225,50,"Export","White",""),DrawButton(500,e,225,50,"Import",!n&&N_?"#ddd":"White","",void 0,!n&&N_)}R_&&(DrawRect(30,190,1240,780,"#ffff88"),DrawEmptyRect(30,190,1240,780,"Black"),MainCanvas.textAlign="left",DrawTextWrap(T_,-550,210,1200,740,"black"),MainCanvas.textAlign="center")})),Zd("WardrobeClick",7,((e,t)=>G_?G_.Click():t(e))),Zd("WardrobeClick",2,((e,t)=>{if(Id){const e=90;if(MouseIn(1e3,e,50,50)||MouseIn(30,190,1240,780)&&R_)return void(R_=!R_);if(MouseIn(425,e,50,50))return void(N_=!N_);if(MouseIn(750,e,225,50))return void u((async()=>{await navigator.clipboard.writeText(C_(N_)),fE("Copied to clipboard!",5e3)}),0);if(MouseIn(500,e,225,50))return void u((async()=>{if("function"!=typeof navigator.clipboard.readText)return void fE("Please press Ctrl+V",5e3);const e=await navigator.clipboard.readText(),t=j_()?U_(e):x_(e,N_,lE);t&&fE(t,5e3)}),0)}t(e)})),document.addEventListener("paste",P_),document.addEventListener("keydown",B_,{capture:!0,passive:!0}),document.addEventListener("keyup",B_,{capture:!0,passive:!0}),Vb("Icons/BCX_Search.png","Icons/Search.png"),Vb("Icons/BCX_SearchExit.png","Icons/Remove.png"),Zd("TextGet",0,((e,t)=>"BCX_Search"===e[0]?"Filter items":"BCX_SearchExit"===e[0]?"":t(e))),Zd("AppearanceMenuBuild",5,((e,t)=>{t(e);const n=e[0];F_()?O_?(AppearanceMenu=[],DialogInventory.length>9&&AppearanceMenu.push("Next"),AppearanceMenu.push("BCX_SearchExit"),"permissions"!==DialogMenuMode&&AppearanceMenu.push("Cancel"),AppearanceMenu.push("Accept")):AppearanceMenu.splice(AppearanceMenu.length-(AppearanceMenu.includes("Cancel")?2:1),0,"BCX_Search"):W_(n)})),Zd("AppearanceMenuClick",4,((e,t)=>{const n=2e3-117*AppearanceMenu.length,r=e[0];for(let e=0;e<AppearanceMenu.length;e++)if(MouseXIn(n+117*e,90)){const t=AppearanceMenu[e];if("BCX_Search"===t)return void H_(r);if("BCX_SearchExit"===t)return void W_(r)}t(e)})),Zd("AppearanceKeyDown",5,((e,t)=>{const n=e[0];return O_||!CharacterAppearanceSelection||!F_()||document.activeElement!==MainCanvas.canvas||1!==n.key.length||n.altKey||n.ctrlKey||n.metaKey?t(e):(H_(CharacterAppearanceSelection,n.key),$_=!0,!0)})),Zd("DialogInventoryAdd",5,((e,t)=>{if(O_){const t=e[1];if(!O_.value.trim().toLocaleLowerCase().split(" ").every((e=>t.Asset.Description.toLocaleLowerCase().includes(e)||t.Asset.Name.toLocaleLowerCase().includes(e))))return}t(e)})),Zd("AppearanceMenuDraw",0,((e,t)=>{O_&&ElementPositionFix("BCXSearch",40,900,35,600,60),t(e)})),kw("utility","wardrobe","- Several convenience wardrobe shortcuts. Use '.wardrobe' for more help",(e=>{const t=(e[0]||"").toLowerCase();if("export"===t){if(!Id)return yE("Error: Your clipboard is not usable."),!1;CharacterAppearanceSelection||(CharacterAppearanceSelection=Player),u((async()=>{await navigator.clipboard.writeText(C_(!0)),yE("Success: Exported to clipboard")}),0)}else if("quickload"===t){if(!Player.CanChangeOwnClothes())return yE("You are unable to change clothes right now."),!1;const n=2===e.length&&/^[0-9]+$/.test(e[1])&&Number.parseInt(e[1],10);if(!n||n<1)return yE(`Needs a <number> greater 0 in '.wardrobe ${t} <number>'`),!1;WardrobeFastLoad(Player,n-1,!0)}else if("strip"===t){if(!Player.CanInteract())return yE("You are too restrained to use this right now."),!1;if(2!==e.length)return yE(`Needs the name of a currently worn clothing behind '.wardrobe ${t}'`),!1;const n=Gw(VA(),e[1],(e=>AE(e,!0)));if("string"==typeof n)return yE(n),!1;InventoryRemove(Player,n.Asset.Group.Name),ChatRoomCharacterUpdate(Player)}else if("stripall"===t){if(!Player.CanInteract())return yE("You are too restrained to use this right now."),!1;CharacterAppearanceStripLayer(Player),ChatRoomCharacterUpdate(Player)}else yE("Usage:\n.wardrobe export - Exports outfit string to the clipboard (including restraints)\n.wardrobe quickload <number> - Changes current outfit to the according BC wardrobe slot if you can\n.wardrobe strip <clothing> - Removes the named clothing if you can\n.wardrobe stripall - Removes all clothes in layered steps (like the wardrobe button)\n");return!0}),(e=>{const t=e[0].toLowerCase();return e.length<=1?$w(t,["export","quickload","strip","stripall"]):"strip"===t&&2===e.length?jw(VA(),e[1],(e=>AE(e,!0))):[]}))}unload(){document.removeEventListener("paste",P_),document.removeEventListener("keydown",B_,{capture:!0}),document.removeEventListener("keyup",B_,{capture:!0}),W_(null!==CharacterAppearanceSelection&&void 0!==CharacterAppearanceSelection?CharacterAppearanceSelection:Player),Y_(null),AppearanceMenuBuild(null!==CharacterAppearanceSelection&&void 0!==CharacterAppearanceSelection?CharacterAppearanceSelection:Player)}}),_b(dd),function(e,t){const n={captureContext:t};Be().captureMessage("HardCoreClub loaded",undefined,n)}(),function(){for(const e of Array.from(document.getElementsByTagName("script"))){const t=/^((https:\/\/[^?/]+|http:\/\/localhost(?::[0-9]+)?)\/([^?]+)?)bcx(\.dev)?\.js($|\?)/i.exec(e.src);if(t)return hE=t[1],void console.debug("HardCoreClub: Using detected source:",hE)}const e=window.BCX_SOURCE;if("string"==typeof e){mE=!0;const t=/^(https:\/\/[^?/]+\/(?:[^?]+?)?)(?:bcx(\.dev)?\.js)?(?:$|\?)/i.exec(e);if(t)return hE=t[1],void console.log("HardCoreClub: External BCX_SOURCE supplied:",hE);console.warn("HardCoreClub: External BCX_SOURCE supplied, but malformed, ignoring",e)}const t="HardCoreClub: Failed to find BCX's source! Some functions will not work properly. Are you using the official version?";console.error(t),alert(t)}(),console.debug("HardCoreClub: Init wait"),null==CurrentScreen||"Login"===CurrentScreen?(Zd("LoginResponse",0,((e,t)=>{console.debug("HardCoreClub: Init LoginResponse caught",e),t(e);const n=e[0];Ed(n)&&"string"==typeof n.Name&&"string"==typeof n.AccountName&&function(e){var t;window.BCX_Loaded||EA!==yd.construct||(t=e,s=!0,l=JSON.parse(JSON.stringify(t)),XC())}(e[0])})),fE("HardCoreClub Ready!"),console.log("HardCoreClub Ready!")):(console.debug("HardCoreClub: Already logged in, init"),XC())})()})();
//# sourceMappingURL=bcx.js.map
//# debugId=a76e42c9-dfe5-5a2c-a157-220fb4a3ec2f
